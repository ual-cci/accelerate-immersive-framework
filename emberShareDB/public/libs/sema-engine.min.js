var version=function(exports){"use strict";class RingBuffer{static getStorageForCapacity(e,t){if(!t.BYTES_PER_ELEMENT)throw"Pass in a ArrayBuffer subclass";var o=8+(e+1)*t.BYTES_PER_ELEMENT;return new SharedArrayBuffer(o)}constructor(e,t){if(!ArrayBuffer.__proto__.isPrototypeOf(t)&&void 0!==t.BYTES_PER_ELEMENT)throw"Pass a concrete typed array class as second argument";this._type=t,this.capacity=(e.byteLength-8)/t.BYTES_PER_ELEMENT,this.buf=e,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new t(this.buf,8,this.capacity)}type(){return this._type.name}push(e){var t=Atomics.load(this.read_ptr,0),o=Atomics.load(this.write_ptr,0);if((o+1)%this._storage_capacity()==t)return 0;let s=Math.min(this._available_write(t,o),e.length),r=Math.min(this._storage_capacity()-o,s),i=s-r;return this._copy(e,0,this.storage,o,r),this._copy(e,r,this.storage,0,i),Atomics.store(this.write_ptr,0,(o+s)%this._storage_capacity()),s}pop(e){var t=Atomics.load(this.read_ptr,0),o=Atomics.load(this.write_ptr,0);if(o==t)return 0;let s=Math.min(this._available_read(t,o),e.length),r=Math.min(this._storage_capacity()-t,e.length),i=s-r;return this._copy(this.storage,t,e,0,r),this._copy(this.storage,0,e,r,i),Atomics.store(this.read_ptr,0,(t+s)%this._storage_capacity()),s}empty(){var e=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)==e}full(){var e=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this.capacity!=e}capacity(){return this.capacity-1}available_read(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}available_write(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}_available_read(e,t){return t>e?t-e:t+this._storage_capacity()-e}_available_write(e,t){let o=e-t-1;return t>=e&&(o+=this._storage_capacity()),o}_storage_capacity(){return this.capacity}_copy(e,t,o,s,r){for(var i=0;i<r;i++)o[s+i]=e[t+i]}}const getBase64=e=>{if(-1!==e.indexOf(";base64,")){var t=e.indexOf(";base64,")+8;return!!e.slice(t).match(/^([A-Za-z0-9+\/]{4})*([A-Za-z0-9+\/]{4}|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{2}==)$/)&&e.slice(t)}return!1},_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",removePaddingFromBase64=e=>64===Module.maxiTools._keyStr.indexOf(e.charAt(e.length-1))?e.substring(0,e.length-1):e,loadSampleToArray=(e,t,o,s)=>{var r=[],i=getBase64(o);if(i){var n=i.length/4*3,l=new ArrayBuffer(n);i=removePaddingFromBase64(removePaddingFromBase64(i));var a,c,p,u,d,m,h,g=parseInt(i.length/4*3,10),b=0,B=0;for(a=new Uint8Array(l),i=i.replace(/[^A-Za-z0-9\+\/\=]/g,""),b=0;b<g;b+=3)c=_keyStr.indexOf(i.charAt(B++))<<2|(d=_keyStr.indexOf(i.charAt(B++)))>>4,p=(15&d)<<4|(m=_keyStr.indexOf(i.charAt(B++)))>>2,u=(3&m)<<6|(h=_keyStr.indexOf(i.charAt(B++))),a[b]=c,64!==m&&(a[b+1]=p),64!==h&&(a[b+2]=u);e.decodeAudioData(l,(function(e){let o=e.getChannelData(0);void 0!==r&&void 0!==s&&s.port.postMessage({sample:t,buffer:o})}),(function(e){console.log("Error decoding source!")}))}else{var F=new XMLHttpRequest;F.addEventListener("load",(()=>console.info(`loading sample '${t}'`))),F.open("GET",o,!0),F.responseType="arraybuffer",F.onload=function(){e.decodeAudioData(F.response,(function(e){let o=e.getChannelData(0);void 0!==r&&void 0!==s&&s.port.postMessage({sample:t,buffer:o})}),(function(e){console.log("Error decoding source!")}))},F.send()}return"Loading module"};class Event{constructor(e){this.eventName=e,this.callbacks=[]}registerCallback(e){this.callbacks.push(e)}unregisterCallback(e){const t=this.callbacks.indexOf(e);t>-1&&this.callbacks.splice(t,1)}emit(e){this.callbacks.slice(0).forEach((t=>{t(e)}))}}class Dispatcher{constructor(){this.events={}}dispatch(e,t){const o=this.events[e];o&&o.emit(t)}addEventListener(e,t){let o=this.events[e];o||(o=new Event(e),this.events[e]=o),o.registerCallback(t)}removeEventListener(e,t){const o=this.events[e];o&&o.callbacks.indexOf(t)>-1&&(o.unregisterCallback(t),0===o.callbacks.length&&delete this.events[e])}}class Engine{constructor(){if(Engine.instance)return Engine.instance;Engine.instance=this,this.origin="",this.learners={},this.analysers={},this.sharedArrayBuffers={},this.dispatcher=new Dispatcher,this.samplesLoaded=!1}async addLearner(e,t){if(!t)throw new Error("Error adding Learner instance to Engine");try{await t.init(this.origin),this.addEventListener("onSharedBuffer",(e=>t.addSharedBuffer(e))),t.addEventListener("onSharedBuffer",(e=>this.addSharedBuffer(e))),this.learners[e]=t}catch(e){console.error("Error adding Learner to Engine: ",e)}}addEventListener(e,t){if(!(this.dispatcher&&e&&t))throw new Error("Error adding event listener to Engine");this.dispatcher.addEventListener(e,t)}createSharedBuffer(e,t,o){let s=RingBuffer.getStorageForCapacity(32*o,Float64Array),r=new RingBuffer(s,Float64Array);return this.audioWorkletNode.port.postMessage({func:"sab",value:s,ttype:t,channelID:e,blocksize:o}),this.sharedArrayBuffers[e]={sab:s,rb:r},s}addSharedBuffer(e){if(!e)throw new Error("Error with onSharedBuffer event");if(e.value&&e.value instanceof SharedArrayBuffer)try{let t=new RingBuffer(e.value,Float64Array);this.audioWorkletNode.port.postMessage({func:"sab",value:e.value,ttype:e.ttype,channelID:e.channelID,blocksize:e.blocksize}),this.sharedArrayBuffers[e.channelID]={sab:e.value,rb:t}}catch(e){console.error("Error pushing SharedBuffer to engine")}else e.name&&e.data&&this.audioWorkletNode.port.postMessage({func:"sendbuf",name:e.name,data:e.data})}pushDataToSharedBuffer(e,t){if(!(e&&t&&(Array.isArray(t),1)))throw new Error("Error in function parameters");this.sharedArrayBuffers&&this.sharedArrayBuffers[e]&&this.sharedArrayBuffers[e].rb.push(t)}pollAnalyserData(e){if(void 0!==e){const t=new Uint8Array(e.fftSize),o=new Uint8Array(e.fftSize);return e.getByteTimeDomainData(t),e.getByteFrequencyData(o),{smoothingTimeConstant:e.smoothingTimeConstant,fftSize:e.fftSize,frequencyDataArray:o,timeDataArray:t}}}createAnalyser(e,t){if(void 0!==this.audioContext&&void 0!==e&&void 0!==t){let o=this.audioContext.createAnalyser();o.smoothingTimeConstant=.25,o.fftSize=256,o.minDecibels=-90,o.maxDecibels=-0,this.audioWorkletNode.connect(o);let s=-1,r={};this.analysers[e]={analyser:o,analyserFrameId:s,callback:t};const i=()=>(r=this.pollAnalyserData(this.analysers[e].analyser),this.analysers[e].callback(r),this.analysers[e].analyserFrameId=requestAnimationFrame(i),s);i()}else void 0===this.audioContext&&(this.analysers[e]={callback:t})}connectAnalysers(){Object.keys(this.analysers).map((e=>this.createAnalyser(e,this.analysers[e].callback)))}removeAnalyser(e){if(void 0!==this.audioContext&&void 0!==this.audioWorkletNode){void 0!==this.analysers[e.id]&&(cancelAnimationFrame(this.analysers[e.id].analyserFrameId),delete this.analysers[e.id])}}async init(e){if(e&&new URL(e)){return this.audioContext,this.origin=e,this.audioWorkletName="maxi-processor",this.audioWorkletUrl=e+"/"+this.audioWorkletName+".js",void 0===this.audioContext&&(this.audioContext=new AudioContext({latencyHint:"playback"})),!!await this.loadWorkletProcessorCode()&&(this.connectWorkletNode(),!0)}throw new Error("Name and valid URL required for AudioWorklet processor")}play(){if(void 0!==this.audioContext)return"suspended"!==this.audioContext.state?(this.stop(),!1):(this.audioContext.resume(),!0)}stop(){void 0!==this.audioWorkletNode&&this.audioContext.suspend()}stopAndRelease(){void 0!==this.audioWorkletNode&&(this.audioWorkletNode.disconnect(this.audioContext.destination),this.audioWorkletNode=void 0)}more(e){if(void 0!==this.audioWorkletNode){const t=this.audioWorkletNode.parameters.get(e);return t.value+=.5,console.log(e+": "+t.value),!0}return!1}less(e){if(void 0!==this.audioWorkletNode){const t=this.audioWorkletNode.parameters.get(e);return t.value-=.5,console.log(e+": "+t.value),!0}return!1}eval(e){return!(!this.audioWorkletNode||!this.audioWorkletNode.port)&&("suspended"===this.audioContext.state&&this.audioContext.resume(),this.audioWorkletNode.port.postMessage({eval:1,setup:e.setup,loop:e.loop}),!0)}asyncPostToProcessor(e){if(!(e&&this.audioWorkletNode&&this.audioWorkletNode.port))throw new Error("Error async posting to processor");console.log("DEBUG:AudioEngine:onMessagingEventHandler:"),console.log(e),this.audioWorkletNode.port.postMessage(e)}sendClockPhase(e,t){void 0!==this.audioWorkletNode&&this.audioWorkletNode.port.postMessage({phase:e,i:t})}onAudioInputInit(e){this.audioContext.createMediaStreamSource(e).connect(this.audioWorkletNode)}onAudioInputFail(e){console.error(`ERROR:Engine:AudioInputFail: ${e.message} ${e.name}`)}async connectMediaStream(){const e=window.constraints={audio:!0,video:!1};navigator.mediaDevices.getUserMedia(e).then((e=>this.onAudioInputInit(e))).catch(this.onAudioInputFail)}async loadWorkletProcessorCode(){if(void 0===this.audioContext)return!1;try{await this.audioContext.audioWorklet.addModule(this.audioWorkletUrl)}catch(e){return console.error("ERROR:Engine:loadWorkletProcessorCode: AudioWorklet not supported in this browser: ",e.message),!1}try{return this.audioWorkletNode=new AudioWorkletNode(this.audioContext,this.audioWorkletName),this.audioWorkletNode.channelInterpretation="discrete",this.audioWorkletNode.channelCountMode="explicit",this.audioWorkletNode.channelCount=this.audioContext.destination.maxChannelCount,!0}catch(e){return console.error("Error loading worklet processor code: ",e),!1}}connectWorkletNode(){if(void 0!==this.audioWorkletNode)try{this.audioContext.destination.channelInterpretation="discrete",this.audioContext.destination.channelCountMode="explicit",this.audioContext.destination.channelCount=this.audioContext.destination.maxChannelCount,this.audioWorkletNode.connect(this.audioContext.destination),this.audioWorkletNode.onprocessorerror=e=>console.error("Engine processor error detected",e),this.audioWorkletNode.onprocessorstatechange=e=>console.info("Engine processor state change: "+audioWorkletNode.processorState),this.audioWorkletNode.port.onmessageerror=e=>console.error("Engine processor port error: "+e),this.audioWorkletNode.port.onmessage=e=>this.onProcessorMessageHandler(e)}catch(e){console.error("Error connecting WorkletNode: ",e)}}onProcessorMessageHandler(e){if(e&&e.data)if(e.data.rq&&"send"===e.data.rq)switch(e.data.ttype){case"ML":break;case"NET":this.peerNet.send(e.data.ch[0],e.data.value,e.data.ch[1])}else if(e.data.rq&&"buf"===e.data.rq)switch(e.data.ttype){case"ML":this.dispatcher.dispatch("onSharedBuffer",{sab:e.data.value,channelID:e.data.channelID,blocksize:e.data.blocksize})}}subscribeProcessorMessage(e){if(!e||!this.audioWorkletNode)throw new Error("Error subscribing processor message");this.audioWorkletNode.port.onmessage=e}loadSample(e,t){if(!this.audioContext||!this.audioWorkletNode)throw"Engine is not initialised!";if(!(t&&0!==t.length&&this.origin&&0!==this.origin.length&&new URL(this.origin+t)))throw"Problem with sample relative URL";try{loadSampleToArray(this.audioContext,e,this.origin+t,this.audioWorkletNode)}catch(o){console.error(`Error loading sample ${e} from ${t}: `,o)}}}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}var nearley=createCommonjsModule((function(e){var t,o;t=commonjsGlobal,o=function(){function e(t,o,s){return this.id=++e.highestId,this.name=t,this.symbols=o,this.postprocess=s,this}function t(e,t,o,s){this.rule=e,this.dot=t,this.reference=o,this.data=[],this.wantedBy=s,this.isComplete=this.dot===e.symbols.length}function o(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function s(e,t){this.rules=e,this.start=t||this.rules[0].name;var o=this.byName={};this.rules.forEach((function(e){o.hasOwnProperty(e.name)||(o[e.name]=[]),o[e.name].push(e)}))}function r(){this.reset("")}function i(e,t,i){if(e instanceof s){var n=e;i=t}else n=s.fromCompiled(e,t);for(var l in this.grammar=n,this.options={keepHistory:!1,lexer:n.lexer||new r},i||{})this.options[l]=i[l];this.lexer=this.options.lexer,this.lexerState=void 0;var a=new o(n,0);this.table=[a],a.wants[n.start]=[],a.predict(n.start),a.process(),this.current=0}function n(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return e.toString();if(e.type)return"%"+e.type;if(e.test)return"<"+String(e.test)+">";throw new Error("Unknown symbol type: "+e)}}return e.highestId=0,e.prototype.toString=function(e){var t=void 0===e?this.symbols.map(n).join(" "):this.symbols.slice(0,e).map(n).join(" ")+" ● "+this.symbols.slice(e).map(n).join(" ");return this.name+" → "+t},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var o=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return o.left=this,o.right=e,o.isComplete&&(o.data=o.build(),o.right=void 0),o},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,i.fail))},o.prototype.process=function(e){for(var t=this.states,o=this.wants,s=this.completed,r=0;r<t.length;r++){var n=t[r];if(n.isComplete){if(n.finish(),n.data!==i.fail){for(var l=n.wantedBy,a=l.length;a--;){var c=l[a];this.complete(c,n)}if(n.reference===this.index){var p=n.rule.name;(this.completed[p]=this.completed[p]||[]).push(n)}}}else{if("string"!=typeof(p=n.rule.symbols[n.dot])){this.scannable.push(n);continue}if(o[p]){if(o[p].push(n),s.hasOwnProperty(p)){var u=s[p];for(a=0;a<u.length;a++){var d=u[a];this.complete(n,d)}}}else o[p]=[n],this.predict(p)}}},o.prototype.predict=function(e){for(var o=this.grammar.byName[e]||[],s=0;s<o.length;s++){var r=o[s],i=this.wants[e],n=new t(r,0,this.index,i);this.states.push(n)}},o.prototype.complete=function(e,t){var o=e.nextState(t);this.states.push(o)},s.fromCompiled=function(t,o){var r=t.Lexer;t.ParserStart&&(o=t.ParserStart,t=t.ParserRules);var i=new s(t=t.map((function(t){return new e(t.name,t.symbols,t.postprocess)})),o);return i.lexer=r,i},r.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},r.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},r.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},r.prototype.formatError=function(e,t){var o=this.buffer;if("string"==typeof o){var s=o.split("\n").slice(Math.max(0,this.line-5),this.line),r=o.indexOf("\n",this.index);-1===r&&(r=o.length);var i=this.index-this.lastLineBreak,n=String(this.line).length;return t+=" at line "+this.line+" col "+i+":\n\n",t+=s.map((function(e,t){return l(this.line-s.length+t+1,n)+" "+e}),this).join("\n"),t+="\n"+l("",n+i)+"^\n"}return t+" at index "+(this.index-1);function l(e,t){var o=String(e);return Array(t-o.length+1).join(" ")+o}},i.fail={},i.prototype.feed=function(e){var t,s=this.lexer;for(s.reset(e,this.lexerState);;){try{if(!(t=s.next()))break}catch(e){var i=new o(this.grammar,this.current+1);throw this.table.push(i),(a=new Error(this.reportLexerError(e))).offset=this.current,a.token=e.token,a}var n=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var l=this.current+1;i=new o(this.grammar,l),this.table.push(i);for(var a,c=void 0!==t.text?t.text:t.value,p=s.constructor===r?t.value:t,u=n.scannable,d=u.length;d--;){var m=u[d],h=m.rule.symbols[m.dot];if(h.test?h.test(p):h.type?h.type===t.type:h.literal===c){var g=m.nextState({data:p,token:t,isToken:!0,reference:l-1});i.states.push(g)}}if(i.process(),0===i.states.length)throw(a=new Error(this.reportError(t))).offset=this.current,a.token=t,a;this.options.keepHistory&&(n.lexerState=s.save()),this.current++}return n&&(this.lexerState=s.save()),this.results=this.finish(),this},i.prototype.reportLexerError=function(e){var t,o,s=e.token;return s?(t="input "+JSON.stringify(s.text[0])+" (lexer error)",o=this.lexer.formatError(s,"Syntax error")):(t="input (lexer error)",o=e.message),this.reportErrorCommon(o,t)},i.prototype.reportError=function(e){var t=(e.type?e.type+" token: ":"")+JSON.stringify(void 0!==e.value?e.value:e),o=this.lexer.formatError(e,"Syntax error");return this.reportErrorCommon(o,t)},i.prototype.reportErrorCommon=function(e,t){var o=[];o.push(e);var s=this.table.length-2,r=this.table[s],i=r.states.filter((function(e){var t=e.rule.symbols[e.dot];return t&&"string"!=typeof t}));return 0===i.length?(o.push("Unexpected "+t+". I did not expect any more input. Here is the state of my parse table:\n"),this.displayStateStack(r.states,o)):(o.push("Unexpected "+t+". Instead, I was expecting to see one of the following:\n"),i.map((function(e){return this.buildFirstStateStack(e,[])||[e]}),this).forEach((function(e){var t=e[0],s=t.rule.symbols[t.dot],r=this.getSymbolDisplay(s);o.push("A "+r+" based on:"),this.displayStateStack(e,o)}),this)),o.push(""),o.join("\n")},i.prototype.displayStateStack=function(e,t){for(var o,s=0,r=0;r<e.length;r++){var i=e[r],n=i.rule.toString(i.dot);n===o?s++:(s>0&&t.push("    ^ "+s+" more lines identical to this"),s=0,t.push("    "+n)),o=n}},i.prototype.getSymbolDisplay=function(e){return function(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return"character matching "+e;if(e.type)return e.type+" token";if(e.test)return"token matching "+String(e.test);throw new Error("Unknown symbol type: "+e)}}(e)},i.prototype.buildFirstStateStack=function(e,t){if(-1!==t.indexOf(e))return null;if(0===e.wantedBy.length)return[e];var o=e.wantedBy[0],s=[e].concat(t),r=this.buildFirstStateStack(o,s);return null===r?null:[e].concat(r)},i.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},i.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},i.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},i.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach((function(o){o.rule.name===t&&o.dot===o.rule.symbols.length&&0===o.reference&&o.data!==i.fail&&e.push(o)})),e.map((function(e){return e.data}))},{Parser:i,Grammar:s,Rule:e}},e.exports?e.exports=o():t.nearley=o()})),moo=createCommonjsModule((function(e){var t,o;t=commonjsGlobal,o=function(){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,o="boolean"==typeof(new RegExp).sticky;function s(e){return e&&"[object RegExp]"===t.call(e)}function r(e){return e&&"object"==typeof e&&!s(e)&&!Array.isArray(e)}function i(e){return"("+e+")"}function n(e){return e.length?"(?:"+e.map((function(e){return"(?:"+e+")"})).join("|")+")":"(?!)"}function l(e){if("string"==typeof e)return"(?:"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(s(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("Not a pattern: "+e)}function a(t,o){if(r(o)||(o={match:o}),o.include)throw new Error("Matching rules cannot also include states");var i={defaultType:t,lineBreaks:!!o.error||!!o.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var n in o)e.call(o,n)&&(i[n]=o[n]);if("string"==typeof i.type&&t!==i.type)throw new Error("Type transform cannot be a string (type '"+i.type+"' for token '"+t+"')");var l=i.match;return i.match=Array.isArray(l)?l:l?[l]:[],i.match.sort((function(e,t){return s(e)&&s(t)?0:s(t)?-1:s(e)?1:t.length-e.length})),i}function c(e){return Array.isArray(e)?function(e){for(var t=[],o=0;o<e.length;o++){var s=e[o];if(s.include)for(var r=[].concat(s.include),i=0;i<r.length;i++)t.push({include:r[i]});else{if(!s.type)throw new Error("Rule has no type: "+JSON.stringify(s));t.push(a(s.type,s))}}return t}(e):function(e){for(var t=Object.getOwnPropertyNames(e),o=[],s=0;s<t.length;s++){var i=t[s],n=e[i],l=[].concat(n);if("include"!==i){var c=[];l.forEach((function(e){r(e)?(c.length&&o.push(a(i,c)),o.push(a(i,e)),c=[]):c.push(e)})),c.length&&o.push(a(i,c))}else for(var p=0;p<l.length;p++)o.push({include:l[p]})}return o}(e)}var p=a("error",{lineBreaks:!0,shouldThrow:!0});function u(e,t){for(var r=null,a=Object.create(null),c=!0,u=null,d=[],m=[],h=0;h<e.length;h++)e[h].fallback&&(c=!1);for(h=0;h<e.length;h++){var g=e[h];if(g.include)throw new Error("Inheritance is not allowed in stateless lexers");if(g.error||g.fallback){if(r)throw!g.fallback==!r.fallback?new Error("Multiple "+(g.fallback?"fallback":"error")+" rules not allowed (for token '"+g.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+g.defaultType+"')");r=g}var b=g.match.slice();if(c)for(;b.length&&"string"==typeof b[0]&&1===b[0].length;)a[b.shift().charCodeAt(0)]=g;if(g.pop||g.push||g.next){if(!t)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+g.defaultType+"')");if(g.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+g.defaultType+"')")}if(0!==b.length){c=!1,d.push(g);for(var B=0;B<b.length;B++){var F=b[B];if(s(F))if(null===u)u=F.unicode;else if(u!==F.unicode&&!1===g.fallback)throw new Error("If one rule is /u then all must be")}var x=n(b.map(l)),I=new RegExp(x);if(I.test(""))throw new Error("RegExp matches empty string: "+I);if(new RegExp("|"+x).exec("").length-1>0)throw new Error("RegExp has capture groups: "+I+"\nUse (?: … ) instead");if(!g.lineBreaks&&I.test("\n"))throw new Error("Rule should declare lineBreaks: "+I);m.push(i(x))}}var y=r&&r.fallback,f=o&&!y?"ym":"gm",U=o||y?"":"|";return!0===u&&(f+="u"),{regexp:new RegExp(n(m)+U,f),groups:d,fast:a,error:r||p}}function d(e,t,o){var s=e&&(e.push||e.next);if(s&&!o[s])throw new Error("Missing state '"+s+"' (in token '"+e.defaultType+"' of state '"+t+"')");if(e&&e.pop&&1!=+e.pop)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+t+"')")}var m=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};m.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.queuedToken=t?t.queuedToken:null,this.queuedThrow=t?t.queuedThrow:null,this.setState(t?t.state:this.startState),this.stack=t&&t.stack?t.stack.slice():[],this},m.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},m.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error,this.re=t.regexp,this.fast=t.fast}},m.prototype.popState=function(){this.setState(this.stack.pop())},m.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var h=o?function(e,t){return e.exec(t)}:function(e,t){var o=e.exec(t);return 0===o[0].length?null:o};function g(){return this.value}if(m.prototype._getGroup=function(e){for(var t=this.groups.length,o=0;o<t;o++)if(void 0!==e[o+1])return this.groups[o];throw new Error("Cannot find token type for matched text")},m.prototype.next=function(){var e=this.index;if(this.queuedGroup){var t=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",t}var o=this.buffer;if(e!==o.length){if(n=this.fast[o.charCodeAt(e)])return this._token(n,o.charAt(e),e);var s=this.re;s.lastIndex=e;var r=h(s,o),i=this.error;if(null==r)return this._token(i,o.slice(e,o.length),e);var n=this._getGroup(r),l=r[0];return i.fallback&&r.index!==e?(this.queuedGroup=n,this.queuedText=l,this._token(i,o.slice(e,r.index),e)):this._token(n,l,e)}},m.prototype._token=function(e,t,o){var s=0;if(e.lineBreaks){var r=/\n/g,i=1;if("\n"===t)s=1;else for(;r.exec(t);)s++,i=r.lastIndex}var n={type:"function"==typeof e.type&&e.type(t)||e.defaultType,value:"function"==typeof e.value?e.value(t):t,text:t,toString:g,offset:o,lineBreaks:s,line:this.line,col:this.col},l=t.length;if(this.index+=l,this.line+=s,0!==s?this.col=l-i+1:this.col+=l,e.shouldThrow)throw new Error(this.formatError(n,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),n},"undefined"!=typeof Symbol&&Symbol.iterator){var b=function(e){this.lexer=e};b.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},b.prototype[Symbol.iterator]=function(){return this},m.prototype[Symbol.iterator]=function(){return new b(this)}}return m.prototype.formatError=function(e,t){if(null==e){var o=this.buffer.slice(this.index);e={text:o,offset:this.index,lineBreaks:-1===o.indexOf("\n")?0:1,line:this.line,col:this.col}}var s=Math.max(0,e.offset-e.col+1),r=e.lineBreaks?e.text.indexOf("\n"):e.text.length,i=this.buffer.substring(s,e.offset+r);return t+=" at line "+e.line+" col "+e.col+":\n\n",t+="  "+i+"\n",t+="  "+Array(e.col).join(" ")+"^"},m.prototype.clone=function(){return new m(this.states,this.state)},m.prototype.has=function(e){return!0},{compile:function(e){var t=u(c(e));return new m({start:t},"start")},states:function(e,t){var o=e.$all?c(e.$all):[];delete e.$all;var s=Object.getOwnPropertyNames(e);t||(t=s[0]);for(var r=Object.create(null),i=0;i<s.length;i++)r[x=s[i]]=c(e[x]).concat(o);for(i=0;i<s.length;i++)for(var n=r[x=s[i]],l=Object.create(null),a=0;a<n.length;a++){var p=n[a];if(p.include){var h=[a,1];if(p.include!==x&&!l[p.include]){l[p.include]=!0;var g=r[p.include];if(!g)throw new Error("Cannot include nonexistent state '"+p.include+"' (in state '"+x+"')");for(var b=0;b<g.length;b++){var B=g[b];-1===n.indexOf(B)&&h.push(B)}}n.splice.apply(n,h),a--}}var F=Object.create(null);for(i=0;i<s.length;i++){var x;F[x=s[i]]=u(r[x],!0)}for(i=0;i<s.length;i++){var I=s[i],y=F[I],f=y.groups;for(a=0;a<f.length;a++)d(f[a],I,F);var U=Object.getOwnPropertyNames(y.fast);for(a=0;a<U.length;a++)d(y.fast[U[a]],I,F)}return new m(F,t)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(e){for(var t=Object.create(null),o=Object.create(null),s=Object.getOwnPropertyNames(e),r=0;r<s.length;r++){var i=s[r],n=e[i];(Array.isArray(n)?n:[n]).forEach((function(e){if((o[e.length]=o[e.length]||[]).push(e),"string"!=typeof e)throw new Error("keyword must be string (in keyword '"+i+"')");t[e]=i}))}function l(e){return JSON.stringify(e)}var a="";for(var c in a+="switch (value.length) {\n",o){var p=o[c];a+="case "+c+":\n",a+="switch (value) {\n",p.forEach((function(e){var o=t[e];a+="case "+l(e)+": return "+l(o)+"\n"})),a+="}\n"}return a+="}\n",Function("value",a)}}},e.exports?e.exports=o():t.moo=o()})),nearleyLanguageBootstrapped=createCommonjsModule((function(e){!function(){function t(e){return e[0]}function o(e){return e[0].value}var s=moo,r=Object.assign({ws:{match:/\s+/,lineBreaks:!0,next:"main"},comment:/\#.*/,arrow:{match:/[=-]+\>/,next:"main"},js:{match:/\{\%(?:[^%]|\%[^}])*\%\}/,value:e=>e.slice(2,-2),lineBreaks:!0},word:{match:/[\w\?\+]+/,next:"afterWord"},string:{match:/"(?:[^\\"\n]|\\["\\/bfnrt]|\\u[a-fA-F0-9]{4})*"/,value:e=>JSON.parse(e),next:"main"},btstring:{match:/`[^`]*`/,value:e=>e.slice(1,-1),next:"main",lineBreaks:!0}},function(e){var t={};for(var o of e)t[o]={match:o,next:"main"};return t}([",","|","$","%","(",")",":?",":*",":+","@include","@builtin","@","]"])),i=s.states({main:Object.assign({},r,{charclass:{match:/\.|\[(?:\\.|[^\\\n])+?\]/,value:e=>new RegExp(e)}}),afterWord:Object.assign({},r,{"[":{match:"[",next:"main"}})});var n={Lexer:i,ParserRules:[{name:"final$ebnf$1",symbols:[i.has("ws")?{type:"ws"}:ws],postprocess:t},{name:"final$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"final",symbols:["_","prog","_","final$ebnf$1"],postprocess:function(e){return e[1]}},{name:"prog",symbols:["prod"],postprocess:function(e){return[e[0]]}},{name:"prog",symbols:["prod","ws","prog"],postprocess:function(e){return[e[0]].concat(e[2])}},{name:"prod",symbols:["word","_",i.has("arrow")?{type:"arrow"}:arrow,"_","expression+"],postprocess:function(e){return{name:e[0],rules:e[4]}}},{name:"prod",symbols:["word",{literal:"["},"_","wordlist","_",{literal:"]"},"_",i.has("arrow")?{type:"arrow"}:arrow,"_","expression+"],postprocess:function(e){return{macro:e[0],args:e[3],exprs:e[9]}}},{name:"prod",symbols:[{literal:"@"},"_","js"],postprocess:function(e){return{body:e[2]}}},{name:"prod",symbols:[{literal:"@"},"word","ws","word"],postprocess:function(e){return{config:e[1],value:e[3]}}},{name:"prod",symbols:[{literal:"@include"},"_","string"],postprocess:function(e){return{include:e[2].literal,builtin:!1}}},{name:"prod",symbols:[{literal:"@builtin"},"_","string"],postprocess:function(e){return{include:e[2].literal,builtin:!0}}},{name:"expression+",symbols:["completeexpression"]},{name:"expression+",symbols:["expression+","_",{literal:"|"},"_","completeexpression"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"expressionlist",symbols:["completeexpression"]},{name:"expressionlist",symbols:["expressionlist","_",{literal:","},"_","completeexpression"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"wordlist",symbols:["word"]},{name:"wordlist",symbols:["wordlist","_",{literal:","},"_","word"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"completeexpression",symbols:["expr"],postprocess:function(e){return{tokens:e[0]}}},{name:"completeexpression",symbols:["expr","_","js"],postprocess:function(e){return{tokens:e[0],postprocess:e[2]}}},{name:"expr_member",symbols:["word"],postprocess:t},{name:"expr_member",symbols:[{literal:"$"},"word"],postprocess:function(e){return{mixin:e[1]}}},{name:"expr_member",symbols:["word",{literal:"["},"_","expressionlist","_",{literal:"]"}],postprocess:function(e){return{macrocall:e[0],args:e[3]}}},{name:"expr_member$ebnf$1",symbols:[{literal:"i"}],postprocess:t},{name:"expr_member$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"expr_member",symbols:["string","expr_member$ebnf$1"],postprocess:function(e){return e[1]?function(e){for(var t=e.literal,o=[],s=0;s<t.length;s++){var r=t.charAt(s);r.toUpperCase()!==r||r.toLowerCase()!==r?o.push(new RegExp("["+r.toLowerCase()+r.toUpperCase()+"]")):o.push({literal:r})}return{subexpression:[{tokens:o,postprocess:function(e){return e.join("")}}]}}(e[0]):e[0]}},{name:"expr_member",symbols:[{literal:"%"},"word"],postprocess:function(e){return{token:e[1]}}},{name:"expr_member",symbols:["charclass"],postprocess:t},{name:"expr_member",symbols:[{literal:"("},"_","expression+","_",{literal:")"}],postprocess:function(e){return{subexpression:e[2]}}},{name:"expr_member",symbols:["expr_member","_","ebnf_modifier"],postprocess:function(e){return{ebnf:e[0],modifier:e[2]}}},{name:"ebnf_modifier",symbols:[{literal:":+"}],postprocess:o},{name:"ebnf_modifier",symbols:[{literal:":*"}],postprocess:o},{name:"ebnf_modifier",symbols:[{literal:":?"}],postprocess:o},{name:"expr",symbols:["expr_member"]},{name:"expr",symbols:["expr","ws","expr_member"],postprocess:function(e){return e[0].concat([e[2]])}},{name:"word",symbols:[i.has("word")?{type:"word"}:word],postprocess:o},{name:"string",symbols:[i.has("string")?{type:"string"}:string],postprocess:e=>({literal:e[0].value})},{name:"string",symbols:[i.has("btstring")?{type:"btstring"}:btstring],postprocess:e=>({literal:e[0].value})},{name:"charclass",symbols:[i.has("charclass")?{type:"charclass"}:charclass],postprocess:o},{name:"js",symbols:[i.has("js")?{type:"js"}:js],postprocess:o},{name:"_$ebnf$1",symbols:["ws"],postprocess:t},{name:"_$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_",symbols:["_$ebnf$1"]},{name:"ws",symbols:[i.has("ws")?{type:"ws"}:ws]},{name:"ws$ebnf$1",symbols:[i.has("ws")?{type:"ws"}:ws],postprocess:t},{name:"ws$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ws",symbols:["ws$ebnf$1",i.has("comment")?{type:"comment"}:comment,"_"]}],ParserStart:"final"};e.exports=n}()}));function compileLowLevel(e,t){var o=uniquer();t.alreadycompiled||(t.alreadycompiled=[]);for(var s={rules:[],body:[],config:{},customTokens:[],macros:{},start:""},r=0;r<e.length;r++){var i=e[r];if(u(i.name,i.pos,i.name&&i.name.length),i.body)t.nojs||s.body.push(i.body);else if(i.include){var n;if(n=i.builtin?i.include:require("path").resolve(t.file?require("path").dirname(t.file):process.cwd(),i.include),-1===t.alreadycompiled.indexOf(n)){if(t.alreadycompiled.push(n),"postprocessors.ne"===n)var l=require("nearley/builtin/postprocessors.ne");else if("whitespace.ne"===n)l=require("nearley/builtin/whitespace.ne");else if("string.ne"===n)l=require("nearley/builtin/string.ne");else if("number.ne"===n)l=require("nearley/builtin/number.ne");else if("cow.ne"===n)l=require("nearley/builtin/cow.ne");var a=nearley.Grammar.fromCompiled(nearleyLanguageBootstrapped),c=new nearley.Parser(a);c.feed(l);var p=Compile(c.results[0],{file:n,__proto__:t});s.rules=s.rules.concat(p.rules),s.body=s.body.concat(p.body),Object.keys(p.config).forEach((function(e){s.config[e]=p.config[e]})),Object.keys(p.macros).forEach((function(e){s.macros[e]=p.macros[e]}))}}else i.macro?s.macros[i.macro]={args:i.args,exprs:i.exprs}:i.config?s.config[i.config]=i.value:(d(i.name,i.rules,{}),s.start||(s.start=i.name))}return s;function u(e,o,s){t.rangeCallback&&t.rangeCallback(e,o,o+s)}function d(e,o,r){for(var i=0;i<o.length;i++){var n=m(e,o[i],r);t.nojs&&(n.postprocess=null),s.rules.push(n)}}function m(e,t,o){for(var s=[],r=0;r<t.tokens.length;r++){var i=h(e,t.tokens[r],o);null!==i&&s.push(i)}return new nearley.Rule(e,s,t.postprocess)}function h(e,t,r){if("string"==typeof t)return"null"===t?null:t;if(t instanceof RegExp)return t;if(t.literal)return t.literal.length?1===t.literal.length||s.config.lexer?t:function(e,t,s){var r=o(e+"$string");return u(r,t.pos,JSON.stringify(t.literal).length),d(r,[{tokens:t.literal.split("").map((function(e){return{literal:e}})),postprocess:{builtin:"joiner"}}],s),r}(e,t,r):null;if(t.token){if(s.config.lexer){var i=t.token;return-1===s.customTokens.indexOf(i)&&s.customTokens.push(i),{token:"("+(s.config.lexer+".has("+JSON.stringify(i)+") ? {type: "+JSON.stringify(i)+"} : "+i)+")"}}return t}if(t.subexpression)return function(e,t,s){var r=t.subexpression,i=o(e+"$subexpression");return d(i,r,s),i}(e,t,r);if(t.ebnf)return function(e,t,s){switch(t.modifier){case":+":return function(e,t,s){var r=o(e+"$ebnf");return d(r,[{tokens:[t.ebnf]},{tokens:[t.ebnf,r],postprocess:{builtin:"arrconcat"}}],s),r}(e,t,s);case":*":return function(e,t,s){var r=o(e+"$ebnf");return d(r,[{tokens:[]},{tokens:[t.ebnf,r],postprocess:{builtin:"arrconcat"}}],s),r}(e,t,s);case":?":return function(e,t,s){var r=o(e+"$ebnf");return d(r,[{tokens:[t.ebnf],postprocess:{builtin:"id"}},{tokens:[],postprocess:{builtin:"nuller"}}],s),r}(e,t,s)}}(e,t,r);if(t.macrocall)return function(e,t,r){var i=o(e+"$macrocall"),n=s.macros[t.macrocall];if(!n)throw new Error("Unkown macro: "+t.macrocall);if(n.args.length!==t.args.length)throw new Error("Argument count mismatch.");for(var l={__proto__:r},a=0;a<n.args.length;a++){var c=o(e+"$macrocall");l[n.args[a]]=c,d(c,[t.args[a]],r)}return d(i,n.exprs,l),i}(e,t,r);if(t.mixin){if(r[t.mixin])return h(e,r[t.mixin],r);throw new Error("Unbound variable: "+t.mixin)}throw new Error("unrecognized token: "+JSON.stringify(t))}}function uniquer(){var e={};return function(t){var o=e[t]=(e[t]||0)+1;return t+"$"+o}}var generate=createCommonjsModule((function(e){var t,o;t=commonjsGlobal,o=function(e){function t(e,t,i){return null==i&&(i=""),"[\n    "+e.map((function(e){return function(e,t){var i="{";return i+='"name": '+JSON.stringify(e.name),i+=', "symbols": ['+e.symbols.map(r).join(", ")+"]",e.postprocess&&(e.postprocess.builtin&&(e.postprocess=t[e.postprocess.builtin]),i+=', "postprocess": '+s(o(e.postprocess),"        ",{indentFirst:!1})),i+="}"}(e,t)})).join(",\n    ")+"\n"+i+"]"}function o(e){var t=e.toString().split(/\n/);if(1===t.length)return[t[0].replace(/^\s+|\s+$/g,"")];for(var o=null,s=t.slice(1),r=0;r<s.length;r++){var i=/^\s*/.exec(s[r]);i&&i[0].length!==s[r].length&&(null===o||i[0].length<o.length)&&(o=i[0])}return null===o?t:t.map((function(e){return e.slice(0,o.length)===o?e.slice(o.length):e}))}function s(e,t,o){var s;return s=Array.isArray(e)?e:e.toString().split("\n"),o=o||{},s.map((function(e,s){var r=!0;return 0!=s||o.indentFirst||(r=!1),r?t+e:e})).join("\n")}function r(e){return e instanceof RegExp?e.toString():e.token?e.token:JSON.stringify(e)}var i=function(e,t){if(e.config.preprocessor||(e.config.preprocessor="_default"),!i[e.config.preprocessor])throw new Error("No such preprocessor: "+e.config.preprocessor);return i[e.config.preprocessor](e,t)};return i.js=i._default=i.javascript=function(e,o){var s="// Generated automatically by nearley, version "+e.version+"\n";return s+="// http://github.com/Hardmath123/nearley\n",s+="(function () {\n",s+="function id(x) { return x[0]; }\n",s+=e.body.join("\n"),s+="var grammar = {\n",s+="    Lexer: "+e.config.lexer+",\n",s+="    ParserRules: "+t(e.rules,i.javascript.builtinPostprocessors)+"\n",s+="  , ParserStart: "+JSON.stringify(e.start)+"\n",s+="}\n",s+="if (typeof module !== 'undefined'&& typeof module.exports !== 'undefined') {\n",s+="   module.exports = grammar;\n",s+="} else {\n",s+="   window."+o+" = grammar;\n",s+="}\n",s+="})();\n"},i.javascript.builtinPostprocessors={joiner:"function joiner(d) {return d.join('');}",arrconcat:"function arrconcat(d) {return [d[0]].concat(d[1]);}",arrpush:"function arrpush(d) {return d[0].concat([d[1]]);}",nuller:"function(d) {return null;}",id:"id"},i.module=i.esmodule=function(e,o){var s="// Generated automatically by nearley, version "+e.version+"\n";return s+="// http://github.com/Hardmath123/nearley\n",s+="function id(x) { return x[0]; }\n",s+=e.body.join("\n"),s+="let Lexer = "+e.config.lexer+";\n",s+="let ParserRules = "+t(e.rules,i.javascript.builtinPostprocessors)+";\n",s+="let ParserStart = "+JSON.stringify(e.start)+";\n",s+="export default { Lexer, ParserRules, ParserStart };\n"},i.cs=i.coffee=i.coffeescript=function(e,r){var n="# Generated automatically by nearley, version "+e.version+"\n";return n+="# http://github.com/Hardmath123/nearley\n",n+="do ->\n",n+="  id = (d) -> d[0]\n",n+=s(o(e.body.join("\n")),"  ")+"\n",n+="  grammar = {\n",n+="    Lexer: "+e.config.lexer+",\n",n+="    ParserRules: "+s(t(e.rules,i.coffeescript.builtinPostprocessors),"      ",{indentFirst:!1})+",\n",n+="    ParserStart: "+JSON.stringify(e.start)+"\n",n+="  }\n",n+="  if typeof module != 'undefined' && typeof module.exports != 'undefined'\n",n+="    module.exports = grammar;\n",n+="  else\n",n+="    window."+r+" = grammar;\n"},i.coffeescript.builtinPostprocessors={joiner:"(d) -> d.join('')",arrconcat:"(d) -> [d[0]].concat(d[1])",arrpush:"(d) -> d[0].concat([d[1]])",nuller:"() -> null",id:"id"},i.ts=i.typescript=function(e,o){var s="// Generated automatically by nearley, version "+e.version+"\n";return s+="// http://github.com/Hardmath123/nearley\n",s+="// Bypasses TS6133. Allow declared but unused functions.\n",s+="// @ts-ignore\n",s+="function id(d: any[]): any { return d[0]; }\n",s+=e.customTokens.map((function(e){return"declare var "+e+": any;\n"})).join(""),s+=e.body.join("\n"),s+="\n",s+="interface NearleyToken {\n",s+="  value: any;\n",s+="  [key: string]: any;\n",s+="};\n",s+="\n",s+="interface NearleyLexer {\n",s+="  reset: (chunk: string, info: any) => void;\n",s+="  next: () => NearleyToken | undefined;\n",s+="  save: () => any;\n",s+="  formatError: (token: never) => string;\n",s+="  has: (tokenType: string) => boolean;\n",s+="};\n",s+="\n",s+="interface NearleyRule {\n",s+="  name: string;\n",s+="  symbols: NearleySymbol[];\n",s+="  postprocess?: (d: any[], loc?: number, reject?: {}) => any;\n",s+="};\n",s+="\n",s+="type NearleySymbol = string | { literal: any } | { test: (token: any) => boolean };\n",s+="\n",s+="interface Grammar {\n",s+="  Lexer: NearleyLexer | undefined;\n",s+="  ParserRules: NearleyRule[];\n",s+="  ParserStart: string;\n",s+="};\n",s+="\n",s+="const grammar: Grammar = {\n",s+="  Lexer: "+e.config.lexer+",\n",s+="  ParserRules: "+t(e.rules,i.typescript.builtinPostprocessors,"  ")+",\n",s+="  ParserStart: "+JSON.stringify(e.start)+",\n",s+="};\n",s+="\n",s+="export default grammar;\n"},i.typescript.builtinPostprocessors={joiner:"(d) => d.join('')",arrconcat:"(d) => [d[0]].concat(d[1])",arrpush:"(d) => d[0].concat([d[1]])",nuller:"() => null",id:"id"},i},e.exports?e.exports=o():t.generate=o(t.nearley)})),warn=function(e,t){e.out.write("WARN\t"+t+"\n")};function lintNames(e,t){var o=[];e.rules.forEach((function(e){o.push(e.name)})),e.rules.forEach((function(e){e.symbols.forEach((function(e){e.literal||e.token||e.constructor===RegExp||-1===o.indexOf(e)&&warn(t,"Undefined symbol `"+e+"` used.")}))}))}function lint(e,t){t.out||(t.out=process.stderr),lintNames(e,t)}var lint_1=lint,objectID=0,vars={},jsFuncMap={saw:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.saw(${t[0].loop})`},sin:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.sinewave(${t[0].loop})`},tri:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.triangle(${t[0].loop})`},pha:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.phasor(${t[0].loop})`},ph2:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>3?t[3].loop:0});`,loop:(e,t)=>`${e}.phasorBetween(${t[0].loop},${t[1].loop},${t[2].loop})`},sqr:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.square(${t[0].loop})`},pul:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>2?t[2].loop:0});`,loop:(e,t)=>`${e}.pulse(${t[0].loop},${t[1].loop})`},imp:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.impulse(${t[0].loop})`},sawn:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.sawn(${t[0].loop})`},noiz:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc()`,loop:(e,t)=>`${e}.noise()*${t[0].loop}`},gt:{setup:(e,t)=>"",loop:(e,t)=>`((${t[0].loop} > ${t[1].loop}) ? 1 : 0)`},lt:{setup:(e,t)=>"",loop:(e,t)=>`((${t[0].loop} < ${t[1].loop}) ? 1 : 0)`},mod:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} % ${t[1].loop})`},add:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} + ${t[1].loop})`},mul:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} * ${t[1].loop})`},sub:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} - ${t[1].loop})`},div:{setup:(e,t)=>"",loop:(e,t)=>`(${t[1].loop} != 0 ? ${t[0].loop}/${t[1].loop} : 0)`},pow:{setup:(e,t)=>"",loop:(e,t)=>`Math.pow(${t[0].loop},${t[1].loop})`},abs:{setup:(e,t)=>"",loop:(e,t)=>`Math.abs(${t[0].loop})`},env:{setup:(e,t)=>`${e} = new Maximilian.maxiEnv();\n                      ${e}.setAttack(${t[1].loop});\n                      ${e}.setDecay(${t[2].loop});\n                      ${e}.setSustain(${t[3].loop});\n                      ${e}.setRelease(${t[4].loop})`,loop:(e,t)=>`${e}.adsr(1,${t[0].loop})`},sum:{setup:(e,t)=>"",loop:(e,t)=>{let o=`(${t[0].loop}`;for(let e=1;e<t.length;e++)o+=`+${t[e].loop}`;return o+")"}},mix:{setup:(e,t)=>"",loop:(e,t)=>{let o=`((${t[0].loop}`;for(let e=1;e<t.length;e++)o+=`+${t[e].loop}`;return o+`)/${t.length})`}},prod:{setup:(e,t)=>"",loop:(e,t)=>{let o=`(${t[0].loop}`;for(let e=1;e<t.length;e++)o+=`*${t[e].loop}`;return o+")"}},blin:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linlin(${t[0].loop}, -1, 1, ${t[1].loop}, ${t[2].loop})`},ulin:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linlin(${t[0].loop}, 0, 1, ${t[1].loop}, ${t[2].loop})`},bexp:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linexp(${t[0].loop}, -1, 1, ${t[1].loop}, ${t[2].loop})`},uexp:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linexp(${t[0].loop}, 0.0000001, 1, ${t[1].loop}, ${t[2].loop})`},linlin:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linlin(${t[0].loop}, ${t[1].loop}, ${t[2].loop},${t[3].loop}, ${t[4].loop})`},linexp:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linexp(${t[0].loop}, ${t[1].loop}, ${t[2].loop}, ${t[3].loop}, ${t[4].loop})`},dist:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.atanDist(${t[0].loop},${t[1].loop})`},softclip:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.softclip(${t[0].loop})`},hardclip:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.hardclip(${t[0].loop})`},asymclip:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.asymclip(${t[0].loop},${t[1].loop},${t[2].loop})`},flange:{setup:(e,t)=>`${e} = new Maximilian.maxiFlanger()`,loop:(e,t)=>`${e}.flange(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},${t[4].loop})`},chor:{setup:(e,t)=>`${e} = new Maximilian.maxiChorus()`,loop:(e,t)=>`${e}.chorus(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},${t[4].loop})`},dl:{setup:(e,t)=>`${e} = new Maximilian.maxiDelayline()`,loop:(e,t)=>`${e}.dl(${t[0].loop},${t[1].loop},${t[2].loop})`},lpf:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.lopass(${t[0].loop},${t[1].loop})`},hpf:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.hipass(${t[0].loop},${t[1].loop})`},lpz:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.lores(${t[0].loop},${t[1].loop},${t[2].loop})`},hpz:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.hires(${t[0].loop},${t[1].loop},${t[2].loop})`},toJS:{setup:(e,t)=>`${e} = new SABOutputTransducer(outputSABs,\n                                      this.port,\n                                      'ML',\n                                      ${t[1].loop},\n                                      this.currentSample,\n                                      ${3==t.length?1:t[3].loop})`,loop:(e,t)=>`${e}.send(${t[0].loop}, ${t[2].loop})`},fromJS:{setup:(e,t)=>`${e} = new SABInputTransducer(${t[0].loop}, ${2==t.length?1:0})`,loop:(e,t)=>`${e}.getSABValue(inputSABs, ${2==t.length?t[1].loop:0})`},mouseX:{setup:(e,t)=>"",loop:(e,t)=>"this.getSABValue('mxy')[0]"},mouseY:{setup:(e,t)=>"",loop:(e,t)=>"this.getSABValue('mxy')[1]"},at:{setup:(e,t)=>"",loop:(e,t)=>`${t[0].loop}[Math.min(${t[1].loop}, ${t[0].loop}.length-1)]`},sah:{setup:(e,t)=>`${e} = new Maximilian.maxiSampleAndHold();`,loop:(e,t)=>`${e}.sah(${t[0].loop},${t[1].loop})`},stretch:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[4].loop}));\n                      ${e}stretch = new Maximilian.maxiStretch();\n                      ${e}stretch.setSample(${e});`,loop:(e,t)=>`(${e}.isReady() ? ${e}stretch.play(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},0.0) : 0.0)`},adc:{setup:(e,t)=>"",loop:(e,t)=>`(inputs * ${t[0].loop})`},sampler:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[t.length-1].loop}));`,loop:(e,t)=>{let o=`${t[0].loop}`;return 3==t.length?o+=`,${t[1].loop}`:4==t.length&&(o+=`,${t[1].loop},${t[2].loop}`),`(${e}.isReady() ? ${e}.playOnZX(${o}) : 0.0)`}},loop:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[1].loop}));`,loop:(e,t)=>`(${e}.isReady() ? ${e}.play(${t[0].loop}) : 0.0)`},slice:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[2].loop}));`,loop:(e,t)=>`(${e}.isReady() ? ${e}.loopSetPosOnZX(${t[0].loop},${t[1].loop}) : 0.0)`},oscin:{setup:(e,t)=>"",loop:(e,t)=>`this.OSCTransducer(${t[0].loop},${t[1].loop})`},oscout:{setup:(e,t)=>"",loop:(e,t)=>`this.OSCTransducer(${t[0].loop},${t[1].loop})`},sah:{setup:(e,t)=>`${e} = new Maximilian.maxiSampleAndHold();`,loop:(e,t)=>`${e}.sah(${t[0].loop},${t[1].loop})`},stretch:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[4].loop}));\n                      ${e}stretch = new Maximilian.maxiStretch();\n                      ${e}stretch.setSample(${e});`,loop:(e,t)=>`(${e}.isReady() ? ${e}stretch.play(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},0.0) : 0.0)`},bitToSig:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.toSignal(${t[0].loop})`},bitToTrigSig:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.toTrigSignal(${t[0].loop})`},bitNeg:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.neg(${t[0].loop})`},bitInc:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.inc(${t[0].loop})`},bitDec:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.dec(${t[0].loop})`},bitAnd:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.land(${t[0].loop},${t[1].loop})`},bitOr:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lor(${t[0].loop},${t[1].loop})`},bitXor:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lxor(${t[0].loop},${t[1].loop})`},bitShl:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.shl(${t[0].loop},${t[1].loop})`},bitShr:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.shr(${t[0].loop},${t[1].loop})`},bitAt:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.at(${t[0].loop},${t[1].loop})`},bitAdd:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.add(${t[0].loop},${t[1].loop})`},bitSub:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.sub(${t[0].loop},${t[1].loop})`},bitMul:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.mul(${t[0].loop},${t[1].loop})`},bitEq:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.eq(${t[0].loop},${t[1].loop})`},bitGt:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.gt(${t[0].loop},${t[1].loop})`},bitGte:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.gte(${t[0].loop},${t[1].loop})`},bitLte:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lte(${t[0].loop},${t[1].loop})`},bitLt:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lt(${t[0].loop},${t[1].loop})`},setup:(e,t)=>"",bitDiv:{loop:(e,t)=>`Maximilian.maxiBits.div(${t[0].loop},${t[1].loop})`},bitr:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.at(${t[0].loop},${t[1].loop},${t[2].loop})`},bitnoise:{setup:(e,t)=>"",loop:(e,t)=>"Maximilian.maxiBits.noise()"},btime:{setup:(e,t)=>"",loop:(e,t)=>"this.bitTime"},bitFromSig:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.fromSignal(${t[0].loop})`},clp:{setup:(e,t)=>"",loop:(e,t)=>`this.clockPhase(${t[0].loop},${t.length>1?t[1].loop:0})`},clt:{setup:(e,t)=>"",loop:(e,t)=>`this.clockTrig(${t[0].loop},${t.length>1?t[1].loop:0})`},clk:{setup:(e,t)=>"",loop:(e,t)=>`(()=>{this.setBPM(${t[0].loop}); this.setBeatsPerBar(${t[1].loop});})()`},onzx:{setup:(e,t)=>`${e} = new Maximilian.maxiTrigger();`,loop:(e,t)=>`${e}.onZX(${t[0].loop})`},onchange:{setup:(e,t)=>`${e} = new Maximilian.maxiTrigger();`,loop:(e,t)=>`${e}.onChanged(${t[0].loop},${t[1].loop})`},count:{setup:(e,t)=>`${e} = new Maximilian.maxiCounter();`,loop:(e,t)=>`${e}.count(${t[0].loop},${t[1].loop})`},idx:{setup:(e,t)=>`${e} = new Maximilian.maxiIndex();`,loop:(e,t)=>`${e}.pull(${t[0].loop},${t[1].loop},${t[2].loop})`},svf:{setup:(e,t)=>`${e} = new Maximilian.maxiSVF();\n                      ${e}_p1 = new Maximilian.maxiTrigger();\n                      ${e}_p2 = new Maximilian.maxiTrigger();`,loop:(e,t)=>`( () => { ${e}_cutoff = ${t[1].loop};\n                                if (${e}_p1.onChanged(${e}_cutoff, 1e-5)) {${e}.setCutoff(${e}_cutoff)};\n                                ${e}_res = ${t[2].loop};\n                                if (${e}_p2.onChanged(${e}_res, 1e-5)) {${e}.setResonance(${e}_res)};\n                                return ${e}.play(${t[0].loop},${t[3].loop},${t[4].loop},${t[5].loop},${t[6].loop})})()`},bitclock:{setup:(e,t)=>"",loop:(e,t)=>"this.bitclock"},pvshift:{setup:(e,t)=>`${e} = new pvshift();`,loop:(e,t)=>`${e}.play(${t[0].loop},${t[1].loop})`},rsq:{setup:(e,t)=>`${e} = new Maximilian.maxiRatioSeq();`,loop:(e,t)=>2==t.length?`${e}.playTrig(${t[0].loop},${t[1].loop})`:`${e}.playValues(${t[0].loop},${t[1].loop},${t[2].loop})`},o303:{setup:(e,t)=>`${e} = new Open303.Open303();\n                      ${e}.setSampleRate(sampleRate);\n                      ${e}_tnote = new Maximilian.maxiTrigger();\n                      ${e}_twf = new Maximilian.maxiTrigger();\n                      ${e}_tcut = new Maximilian.maxiTrigger();\n                      ${e}_tres = new Maximilian.maxiTrigger();\n                      ${e}_tenvm = new Maximilian.maxiTrigger();\n                      ${e}_tdec = new Maximilian.maxiTrigger();\n                      ${e}_tnoteoff = new Maximilian.maxiTrigger();\n                      ${e}_tatt = new Maximilian.maxiTrigger();`,loop:(e,t)=>`(()=>{\n\t\t\tlet newNote = ${e}_tnote.onZX(${t[0].loop});\n\t\t\tlet accent = ${t[3].loop};\n\t\t\tif (newNote) {\n\t\t\t\tif (${t[2].loop}>0) {\n\t\t\t\t\t${e}.slideToNote(${t[1].loop},accent);\n\t\t\t\t}else{\n\t\t\t\t\t${e}.triggerNote(${t[1].loop},accent);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (${e}_tnoteoff.onChanged(${t[4].loop}, 1e-5)) {${e}.allNotesOff()};\n\t\t\tif (${e}_twf.onChanged(${t[5].loop}, 1e-5)) {${e}.setWaveform(${t[5].loop})};\n\t\t\tif (${e}_tcut.onChanged(${t[6].loop}, 1e-5)) {${e}.setCutoff(${t[6].loop})};\n\t\t\tif (${e}_tres.onChanged(${t[7].loop}, 1e-5)) {${e}.setResonance(${t[7].loop})};\n\t\t\tif (${e}_tenvm.onChanged(${t[8].loop}, 1e-5)) {${e}.setEnvMod(${t[8].loop})};\n\t\t\tif (${e}_tatt.onChanged(${t[9].loop}, 1e-5)) {${e}.setNormalAttack(${t[9].loop})};\n\t\t\tif (${e}_tdec.onChanged(${t[10].loop}, 1e-5)) {${e}.setDecay(${t[10].loop})};\n\t\t\t${e}.setAccent(${t[11].loop});\n\t\t\treturn ${e}.play();})()`},freeverb:{setup:(e,t)=>`${e} = new Maximilian.maxiFreeVerb();`,loop:(e,t)=>`${e}.play(${t[0].loop},${t[1].loop},${t[2].loop})`},line:{setup:(e,t)=>`${e} = new Maximilian.maxiLine(); ${e}.prepare(0,1,${t[1].loop}, false); ${e}.triggerEnable(1);`,loop:(e,t)=>`${e}.play(${t[0].loop})`},const:{setup:(e,t)=>"",loop:(e,t)=>`${t[0].loop}`},poll:{setup:(e,t)=>`${e} = new poll()`,loop:(e,t)=>`${e}.play(${t[0].loop})`},dac:{setup:(e,t)=>"",loop:(e,t)=>1==t.length?`this.dacOutAll(${t[0].loop})`:`this.dacOut(${t[0].loop},${t[1].loop})`},fft:{setup:(e,t)=>`${e} = new fft(${t[1].loop}, ${t[2].loop})`,loop:(e,t)=>`${e}.play(${t[0].loop})`},ifft:{setup:(e,t)=>`${e} = new ifft(${t[3].loop}, ${t[4].loop})`,loop:(e,t)=>`${e}.play(${t[0].loop}, ${t[1].loop}, ${t[2].loop})`},mfcc:{setup:(e,t)=>`${e} = new mfcc(${t[1].loop}, ${t[2].loop}, ${t[3].loop})`,loop:(e,t)=>`${e}.play(${t[0].loop})`}};class ASTreeToJavascript{static getNextID(){return objectID=objectID>9999?0:++objectID}static emptyCode(){return{setup:"",loop:"",paramMarkers:[]}}static traverseTree(e,t,o,s,r){let i={"@lang":(e,t)=>(t.map((t=>{let i=ASTreeToJavascript.traverseTree(t,ASTreeToJavascript.emptyCode(),o,s,r);e.setup+=i.setup,e.loop+=i.loop})),e),"@spawn":(e,t)=>((e=ASTreeToJavascript.traverseTree(t,e,o,s,r)).loop+=";",e),"@sigp":(e,t)=>{let i=[{s:t.paramBegin,e:t.paramEnd,l:o}];e.paramMarkers=e.paramMarkers.concat(i);let n=t["@func"].value,l=jsFuncMap[n],a="q.b"+r+"u"+ASTreeToJavascript.getNextID(),c=[];for(let e=0;e<t["@params"].length;e++){let i=ASTreeToJavascript.emptyCode();i=ASTreeToJavascript.traverseTree(t["@params"][e],i,o+1,s,r),c[e]=i}let p="";for(let t in c)p+=c[t].setup,e.paramMarkers=e.paramMarkers.concat(c[t].paramMarkers);return e.setup+=`${p} ${l.setup(a,c)};`,e.loop+=`${l.loop(a,c)}`,e},"@setvar":(e,t)=>{let i=t["@varname"],n=s[i];null==n&&(n=Object.keys(s).length,s[i]=n);let l=ASTreeToJavascript.traverseTree(t["@varvalue"],ASTreeToJavascript.emptyCode(),o+1,s,r);return e.setup+=l.setup,e.loop=`(mem[${n}] = ${l.loop})`,e},"@getvar":(e,t)=>{let o=s[t];return null==o&&(o=Object.keys(s).length,s[t]=o),e.loop+=`(mem[${o}] != undefined ? mem[${o}] : 0)`,e},"@string":(e,t)=>(("string"==typeof t||t instanceof String)&&(e.loop+=`'${t}'`),e),"@num":(e,t)=>(null!=t.value&&(e.loop+=`${t.value}`),e),"@list":(e,t)=>{let i="q.b"+r+"l"+ASTreeToJavascript.getNextID();e.setup+=`${i} = new Float64Array(${t.length});`,e.loop+="(()=>{";let n="";for(let l=0;l<t.length;l++){let a=ASTreeToJavascript.traverseTree(t[l],ASTreeToJavascript.emptyCode(),o,s,r);"@num"==Object.keys(t[l])[0]?e.setup+=`${i}[${l}] = ${a.loop};`:(n+=a.setup,e.loop+=`${i}[${l}] = ${a.loop};`)}return e.loop+=`return ${i}})()`,e.setup+=n,e}};return Array.isArray(e)?e.map((e=>{Object.keys(e).map((o=>{t=i[o](t,e[o])}))})):Object.keys(e).map((o=>{t=i[o](t,e[o])})),t}static treeToCode(e,t=0){vars={};let o=ASTreeToJavascript.traverseTree(e,ASTreeToJavascript.emptyCode(),0,vars,t);return o.setup=`() => {let q=this.newq(); ${o.setup}; return q;}`,o.loop=`(q, inputs, mem) => {${o.loop}}`,o}}var IR=Object.freeze({__proto__:null,default:ASTreeToJavascript}),sema=createCommonjsModule((function(e){var t;t=commonjsGlobal,e.exports?e.exports={num:function(e){return{"@num":{value:e}}},str:function(e){return{"@string":e}},synth:function(e,t){return{"@sigp":{"@params":t,"@func":{value:e}}}},setvar:function(e,t){return{"@setvar":{"@varname":e,"@varvalue":t}}},getvar:function(e){return{"@getvar":e}}}:t.sema={num:function(e){return{"@num":{value:e}}},str:function(e){return{"@string":e}},synth:function(e,t){return{"@sigp":{"@params":t,"@func":{value:e}}}},setvar:function(e,t){return{"@setvar":{"@varname":e,"@varvalue":t}}},getvar:function(e){return{"@getvar":e}}}}));function getParserModuleExports(source){let sema$1=sema;sema$1.num("3");let module={exports:""};return eval(source),module.exports}function compile(e,t){try{let o;const{errors:s,output:r}=compileGrammar(e),i=getParserModuleExports(r),n=new nearley.Parser(i);if(!s&&n){const e=n.feed(t);e&&(o=ASTreeToJavascript.treeToCode(e.results,0))}return{dspCode:o}}catch(e){return{errors:e}}}function stream(){let e="";return{write(t){e+=t},dump:()=>e}}function AnnotatePositions(e){return e.map((e=>new nearley.Rule(e.name,e.symbols,e.postprocess&&((t,o,s)=>{var r=e.postprocess(t,o,s);return null===r?null:("object"!=typeof r||r.slice||(r.pos=o),r)}))))}function compileGrammar(e){let t=new nearley.Parser(AnnotatePositions(nearleyLanguageBootstrapped.ParserRules),nearleyLanguageBootstrapped.ParserStart,{lexer:nearleyLanguageBootstrapped.Lexer}),o=stream(),s="",r={};try{if(t.feed(e),t.results[0]){var i=compileLowLevel(t.results[0],{rangeCallback:function(e,t,o){r[e]=[t,o]}});lint_1(i,{out:o}),s=generate(i,"grammar")}}catch(e){o.write(e)}return{errors:o.dump(),positions:r,output:s}}var WorkerClass=null;try{var WorkerThreads="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");WorkerClass=WorkerThreads.Worker}catch(e){}function decodeBase64(e,t){return Buffer.from(e,"base64").toString(t?"utf16":"utf8")}function createBase64WorkerFactory(e,t,o){var s=void 0===t?null:t,r=decodeBase64(e,void 0!==o&&o),i=r.indexOf("\n",10)+1,n=r.substring(i)+(s?"//# sourceMappingURL="+s:"");return function(e){return new WorkerClass(n,Object.assign({},e,{eval:!0}))}}function decodeBase64$1(e,t){var o=atob(e);if(t){for(var s=new Uint8Array(o.length),r=0,i=o.length;r<i;++r)s[r]=o.charCodeAt(r);return String.fromCharCode.apply(null,new Uint16Array(s.buffer))}return o}function createURL(e,t,o){var s=void 0===t?null:t,r=decodeBase64$1(e,void 0!==o&&o),i=r.indexOf("\n",10)+1,n=r.substring(i)+(s?"//# sourceMappingURL="+s:""),l=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(l)}function createBase64WorkerFactory$1(e,t,o){var s;return function(r){return s=s||createURL(e,t,o),new Worker(s,r)}}var kIsNodeJS="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);function isNodeJS(){return kIsNodeJS}function createBase64WorkerFactory$2(e,t,o){return isNodeJS()?createBase64WorkerFactory(e,t,o):createBase64WorkerFactory$1(e,t,o)}var WorkerFactory=createBase64WorkerFactory$2("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgdHtzdGF0aWMgZ2V0U3RvcmFnZUZvckNhcGFjaXR5KHQsZSl7aWYoIWUuQllURVNfUEVSX0VMRU1FTlQpdGhyb3ciUGFzcyBpbiBhIEFycmF5QnVmZmVyIHN1YmNsYXNzIjt2YXIgYT04Kyh0KzEpKmUuQllURVNfUEVSX0VMRU1FTlQ7cmV0dXJuIG5ldyBTaGFyZWRBcnJheUJ1ZmZlcihhKX1jb25zdHJ1Y3Rvcih0LGUpe2lmKCFBcnJheUJ1ZmZlci5fX3Byb3RvX18uaXNQcm90b3R5cGVPZihlKSYmdm9pZCAwIT09ZS5CWVRFU19QRVJfRUxFTUVOVCl0aHJvdyJQYXNzIGEgY29uY3JldGUgdHlwZWQgYXJyYXkgY2xhc3MgYXMgc2Vjb25kIGFyZ3VtZW50Ijt0aGlzLl90eXBlPWUsdGhpcy5jYXBhY2l0eT0odC5ieXRlTGVuZ3RoLTgpL2UuQllURVNfUEVSX0VMRU1FTlQsdGhpcy5idWY9dCx0aGlzLndyaXRlX3B0cj1uZXcgVWludDMyQXJyYXkodGhpcy5idWYsMCwxKSx0aGlzLnJlYWRfcHRyPW5ldyBVaW50MzJBcnJheSh0aGlzLmJ1Ziw0LDEpLHRoaXMuc3RvcmFnZT1uZXcgZSh0aGlzLmJ1Ziw4LHRoaXMuY2FwYWNpdHkpfXR5cGUoKXtyZXR1cm4gdGhpcy5fdHlwZS5uYW1lfXB1c2godCl7dmFyIGU9QXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsMCksYT1BdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsMCk7aWYoKGErMSkldGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpPT1lKXJldHVybiAwO2xldCBzPU1hdGgubWluKHRoaXMuX2F2YWlsYWJsZV93cml0ZShlLGEpLHQubGVuZ3RoKSxyPU1hdGgubWluKHRoaXMuX3N0b3JhZ2VfY2FwYWNpdHkoKS1hLHMpLGk9cy1yO3JldHVybiB0aGlzLl9jb3B5KHQsMCx0aGlzLnN0b3JhZ2UsYSxyKSx0aGlzLl9jb3B5KHQscix0aGlzLnN0b3JhZ2UsMCxpKSxBdG9taWNzLnN0b3JlKHRoaXMud3JpdGVfcHRyLDAsKGErcykldGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpKSxzfXBvcCh0KXt2YXIgZT1BdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwwKSxhPUF0b21pY3MubG9hZCh0aGlzLndyaXRlX3B0ciwwKTtpZihhPT1lKXJldHVybiAwO2xldCBzPU1hdGgubWluKHRoaXMuX2F2YWlsYWJsZV9yZWFkKGUsYSksdC5sZW5ndGgpLHI9TWF0aC5taW4odGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpLWUsdC5sZW5ndGgpLGk9cy1yO3JldHVybiB0aGlzLl9jb3B5KHRoaXMuc3RvcmFnZSxlLHQsMCxyKSx0aGlzLl9jb3B5KHRoaXMuc3RvcmFnZSwwLHQscixpKSxBdG9taWNzLnN0b3JlKHRoaXMucmVhZF9wdHIsMCwoZStzKSV0aGlzLl9zdG9yYWdlX2NhcGFjaXR5KCkpLHN9ZW1wdHkoKXt2YXIgdD1BdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwwKTtyZXR1cm4gQXRvbWljcy5sb2FkKHRoaXMud3JpdGVfcHRyLDApPT10fWZ1bGwoKXt2YXIgdD1BdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwwKTtyZXR1cm4oQXRvbWljcy5sb2FkKHRoaXMud3JpdGVfcHRyLDApKzEpJXRoaXMuY2FwYWNpdHkhPXR9Y2FwYWNpdHkoKXtyZXR1cm4gdGhpcy5jYXBhY2l0eS0xfWF2YWlsYWJsZV9yZWFkKCl7dmFyIHQ9QXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsMCksZT1BdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsMCk7cmV0dXJuIHRoaXMuX2F2YWlsYWJsZV9yZWFkKHQsZSl9YXZhaWxhYmxlX3dyaXRlKCl7dmFyIHQ9QXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsMCksZT1BdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsMCk7cmV0dXJuIHRoaXMuX2F2YWlsYWJsZV93cml0ZSh0LGUpfV9hdmFpbGFibGVfcmVhZCh0LGUpe3JldHVybiBlPnQ/ZS10OmUrdGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpLXR9X2F2YWlsYWJsZV93cml0ZSh0LGUpe2xldCBhPXQtZS0xO3JldHVybiBlPj10JiYoYSs9dGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpKSxhfV9zdG9yYWdlX2NhcGFjaXR5KCl7cmV0dXJuIHRoaXMuY2FwYWNpdHl9X2NvcHkodCxlLGEscyxyKXtmb3IodmFyIGk9MDtpPHI7aSsrKWFbcytpXT10W2UraV19fXNlbGYuUmluZ0J1ZmZlcj10O3ZhciBlPXt9O2NsYXNzIGF7Y29uc3RydWN0b3IoYSxzLHIpe3RoaXMuY2hhbm5lbD1zLHRoaXMuYmxvY2tzaXplPXIscyBpbiBlJiZlW3NdLmJsb2Nrc2l6ZT09cj90aGlzLnJpbmdidWY9ZVtzXS5yYjoodGhpcy5zYWI9dC5nZXRTdG9yYWdlRm9yQ2FwYWNpdHkoMzIqcixGbG9hdDY0QXJyYXkpLHRoaXMucmluZ2J1Zj1uZXcgdCh0aGlzLnNhYixGbG9hdDY0QXJyYXkpLGVbc109e3JiOnRoaXMucmluZ2J1ZixzYWI6dGhpcy5zYWIsY3JlYXRlZDpEYXRlLm5vdygpLGJsb2Nrc2l6ZTpyfSxwb3N0TWVzc2FnZSh7ZnVuYzoic2FiIix2YWx1ZTp0aGlzLnNhYix0dHlwZTphLGNoYW5uZWxJRDpzLGJsb2Nrc2l6ZTpyfSkpfXNlbmQodCl7aWYodGhpcy5yaW5nYnVmLmF2YWlsYWJsZV93cml0ZSgpPjEpaWYoIm51bWJlciI9PXR5cGVvZiB0KXRoaXMucmluZ2J1Zi5wdXNoKG5ldyBGbG9hdDY0QXJyYXkoW3RdKSk7ZWxzZSBpZih0Lmxlbmd0aD09dGhpcy5ibG9ja3NpemUpdGhpcy5yaW5nYnVmLnB1c2godCk7ZWxzZSBpZih0Lmxlbmd0aDx0aGlzLmJsb2Nrc2l6ZSl7bGV0IGU9bmV3IEZsb2F0NjRBcnJheSh0aGlzLmJsb2Nrc2l6ZSk7Zm9yKGxldCBhIGluIHQpZVthXT10W2FdO3RoaXMucmluZ2J1Zi5wdXNoKGUpfWVsc2UgdGhpcy5yaW5nYnVmLnB1c2godC5zbGljZSgwLHRoaXMuYmxvY2tzaXplKSl9fXNlbGYuY3JlYXRlT3V0cHV0Q2hhbm5lbD0odCxlKT0+bmV3IGEoIk1MIix0LGUpLHNlbGYuaW5wdXQ9KHQsZSk9Pnt9LHNlbGYub3V0cHV0PSh0LGUpPT57cG9zdE1lc3NhZ2Uoe2Z1bmM6ImRhdGEiLHZhbDp0LGNoOmV9KX0sc2VsZi5sb2FkUmVzcG9uZGVycz17fSxzZWxmLmlucHV0U0FCcz17fSxzZWxmLnNlbWE9e3NhdmVGMzJBcnJheToodCxlKT0+KHBvc3RNZXNzYWdlKHtmdW5jOiJzYXZlIixuYW1lOnQsdmFsOmV9KSwwKSxsb2FkRjMyQXJyYXk6KHQsZSk9Pihwb3N0TWVzc2FnZSh7ZnVuYzoibG9hZCIsbmFtZTp0fSksbG9hZFJlc3BvbmRlcnNbdF09ZSwwKSxkb3dubG9hZDp0PT57cG9zdE1lc3NhZ2Uoe2Z1bmM6ImRvd25sb2FkIixuYW1lOnR9KX0sc2VuZENvZGU6dD0+e3Bvc3RNZXNzYWdlKHtmdW5jOiJzZW5kY29kZSIsY29kZTp0fSl9LHBiY29weTp0PT57cG9zdE1lc3NhZ2Uoe2Z1bmM6InBiY29weSIsbXNnOnR9KX0sc2VuZEJ1ZmZlcjoodCxlKT0+e3Bvc3RNZXNzYWdlKHtmdW5jOiJzZW5kYnVmIixuYW1lOnQsZGF0YTplfSl9LGVudjp7c2F2ZUxvY2FsOnQ9Pntwb3N0TWVzc2FnZSh7ZnVuYzoiZW52c2F2ZSIsbmFtZTp0LHN0b3JhZ2U6ImxvY2FsIn0pfSxsb2FkTG9jYWw6dD0+e3Bvc3RNZXNzYWdlKHtmdW5jOiJlbnZsb2FkIixuYW1lOnQsc3RvcmFnZToibG9jYWwifSl9LHNhdmVUb1BCOigpPT57cG9zdE1lc3NhZ2Uoe2Z1bmM6ImVudnNhdmUiLHN0b3JhZ2U6InBhc3RlYnVmZmVyIn0pfSxsb2FkR2lzdDp0PT57cG9zdE1lc3NhZ2Uoe2Z1bmM6ImVudmxvYWQiLG5hbWU6dCxzdG9yYWdlOiJnaXN0In0pfX0sZG9tZXZhbDp0PT57cG9zdE1lc3NhZ2Uoe2Z1bmM6ImRvbWV2YWwiLGNvZGU6dH0pfSxwZWVyaW5mbzooKT0+e3Bvc3RNZXNzYWdlKHtmdW5jOiJwZWVyaW5mbyJ9KSxjb25zb2xlLmxvZygiWW91ciBwZWVyIElEIGhhcyBiZWVuIGNvcGllZCB0byB0aGUgcGFzdGUgYnVmZmVyIil9fTtmdW5jdGlvbiBzKCl7dHJ5e2ZvcihsZXQgdCBpbiBpbnB1dFNBQnMpe2xldCBlPWlucHV0U0FCc1t0XS5yYi5hdmFpbGFibGVfcmVhZCgpO2lmKGUhPWlucHV0U0FCc1t0XS5yYi5jYXBhY2l0eSYmZT4wKWZvcihsZXQgYT0wO2E8ZTthKz1pbnB1dFNBQnNbdF0uYmxvY2tzaXplKXtsZXQgZT1uZXcgRmxvYXQ2NEFycmF5KGlucHV0U0FCc1t0XS5ibG9ja3NpemUpO2lucHV0U0FCc1t0XS5yYi5wb3AoZSksaW5wdXQodCxlKX19c2V0VGltZW91dChzLDIwKX1jYXRjaCh0KXtzZXRUaW1lb3V0KHMsMTAwKX19b25tZXNzYWdlPWU9PntpZihlLmRhdGEudXJsKSFmdW5jdGlvbih0KXtpZihuZXcgVVJMKHQpKXt0cnl7aW1wb3J0U2NyaXB0cyh0KyIvbGFsb2xpYi5qcyIpfWNhdGNoKHQpe2NvbnNvbGUuZXJyb3IoIkVSUk9SOiBpbXBvcnRTY3JpcHRzIOKAkyBsYWxvbGliLmpzICIsdCl9dHJ5e2ltcG9ydFNjcmlwdHModCsiL3N2ZC5qcyIpfWNhdGNoKHQpe2NvbnNvbGUuZXJyb3IoIkVSUk9SOiBpbXBvcnRTY3JpcHRzIOKAkyBzdmQuanMgIix0KX10cnl7aW1wb3J0U2NyaXB0cygiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9AdGVuc29yZmxvdy90ZmpzL2Rpc3QvdGYubWluLmpzIil9Y2F0Y2godCl7Y29uc29sZS5lcnJvcigiRVJST1I6IGltcG9ydFNjcmlwdHMg4oCTIHRmanMiLHQpfXRyeXtzKCl9Y2F0Y2godCl7Y29uc29sZS5lcnJvcigiRVJST1I6IHNhYkNoZWNrZXIiLHQpfXBvc3RNZXNzYWdlKHtpbml0OiEwfSl9ZWxzZSBjb25zb2xlLmVycm9yKCJFUlJPUjogaW5pdFdpdGhVUkwg4oCTIEludmFsaWQgVVJMIil9KGUuZGF0YS51cmwpO2Vsc2UgaWYoZS5kYXRhLmV2YWwpKHQ9Pnt0cnl7aWYoIWUpdmFyIGU9ZXZhbDtsZXQgYT1lKHQpO3ZvaWQgMCE9PWE/Y29uc29sZS5pbmZvKGEpOmNvbnNvbGUuaW5mbygiZG9uZSIpfWNhdGNoKHQpe2NvbnNvbGUuZXJyb3IoIkV2YWwgZXhjZXB0aW9uIG9uIExlYXJuZXI6ICIsdCl9fSkoZS5kYXRhLmV2YWwpO2Vsc2UgaWYoInZhbCJpbiBlLmRhdGEpe2xldCB0PWUuZGF0YS52YWw7dD1KU09OLnBhcnNlKGBbJHt0fV1gKSxsb2FkUmVzcG9uZGVyc1tlLmRhdGEubmFtZV0odCksZGVsZXRlIGxvYWRSZXNwb25kZXJzW2UuZGF0YS5uYW1lXX1lbHNlIGlmKCJtb2RlbC1pbnB1dC1kYXRhIj09PWUuZGF0YS50eXBlKWlucHV0KGUuZGF0YS52YWx1ZSxlLmRhdGEuY2gpO2Vsc2UgaWYoZS5kYXRhLnNhYil7Y29uc29sZS5pbmZvKCJidWZmZXIgcmVjZWl2ZWQiKTtsZXQgYT1lLmRhdGEuc2FiLHM9bmV3IHQoYSxGbG9hdDY0QXJyYXkpO2lucHV0U0FCc1tlLmRhdGEuY2hhbm5lbElEXT17c2FiOmEscmI6cyxibG9ja3NpemU6ZS5kYXRhLmJsb2Nrc2l6ZX19fX0oKTsKCg==","data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2VyLmpzIiwic291cmNlcyI6WyJub2RlX21vZHVsZXMvcmluZ2J1Zi5qcy9qcy9yaW5nYnVmLmpzIiwid29ya2VyOi8vd2ViLXdvcmtlci9zcmMvbGVhcm5lci93b3JrZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQSBTaW5nbGUgUHJvZHVjZXIgLSBTaW5nbGUgQ29uc3VtZXIgdGhyZWFkLXNhZmUgd2FpdC1mcmVlIHJpbmcgYnVmZmVyLlxuLy9cbi8vIFRoZSBwcm9kdWNlciBhbmQgdGhlIGNvbnN1bWVyIGNhbiBiZSBzZXBhcmF0ZSB0aHJlYWQsIGJ1dCBjYW5ub3QgY2hhbmdlIHJvbGUsXG4vLyBleGNlcHQgd2l0aCBleHRlcm5hbCBzeW5jaHJvbml6YXRpb24uXG5cbmV4cG9ydCBjbGFzcyBSaW5nQnVmZmVyIHtcbiAgc3RhdGljIGdldFN0b3JhZ2VGb3JDYXBhY2l0eShjYXBhY2l0eSwgdHlwZSkge1xuICAgIGlmICghdHlwZS5CWVRFU19QRVJfRUxFTUVOVCkge1xuICAgICAgdGhyb3cgXCJQYXNzIGluIGEgQXJyYXlCdWZmZXIgc3ViY2xhc3NcIjtcbiAgICB9XG4gICAgdmFyIGJ5dGVzID0gOCArIChjYXBhY2l0eSArIDEpICogdHlwZS5CWVRFU19QRVJfRUxFTUVOVDtcbiAgICByZXR1cm4gbmV3IFNoYXJlZEFycmF5QnVmZmVyKGJ5dGVzKTtcbiAgfVxuICAvLyBgc2FiYCBpcyBhIFNoYXJlZEFycmF5QnVmZmVyIHdpdGggYSBjYXBhY2l0eSBjYWxjdWxhdGVkIGJ5IGNhbGxpbmdcbiAgLy8gYGdldFN0b3JhZ2VGb3JDYXBhY2l0eWAgd2l0aCB0aGUgZGVzaXJlZCBjYXBhY2l0eS5cbiAgY29uc3RydWN0b3Ioc2FiLCB0eXBlKSB7XG4gICAgaWYgKCFBcnJheUJ1ZmZlci5fX3Byb3RvX18uaXNQcm90b3R5cGVPZih0eXBlKSAmJlxuICAgICAgdHlwZS5CWVRFU19QRVJfRUxFTUVOVCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBcIlBhc3MgYSBjb25jcmV0ZSB0eXBlZCBhcnJheSBjbGFzcyBhcyBzZWNvbmQgYXJndW1lbnRcIjtcbiAgICB9XG5cbiAgICAvLyBNYXhpbXVtIHVzYWJsZSBzaXplIGlzIDE8PDMyIC0gdHlwZS5CWVRFU19QRVJfRUxFTUVOVCBieXRlcyBpbiB0aGUgcmluZ1xuICAgIC8vIGJ1ZmZlciBmb3IgdGhpcyB2ZXJzaW9uLCBlYXNpbHkgY2hhbmdlYWJsZS5cbiAgICAvLyAtNCBmb3IgdGhlIHdyaXRlIHB0ciAodWludDMyX3Qgb2Zmc2V0cylcbiAgICAvLyAtNCBmb3IgdGhlIHJlYWQgcHRyICh1aW50MzJfdCBvZmZzZXRzKVxuICAgIC8vIGNhcGFjaXR5IGNvdW50cyB0aGUgZW1wdHkgc2xvdCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGZ1bGwgYW5kIGVtcHR5LlxuICAgIHRoaXMuX3R5cGUgPSB0eXBlO1xuICAgIHRoaXMuY2FwYWNpdHkgPSAoc2FiLmJ5dGVMZW5ndGggLSA4KSAvIHR5cGUuQllURVNfUEVSX0VMRU1FTlQ7XG4gICAgdGhpcy5idWYgPSBzYWI7XG4gICAgdGhpcy53cml0ZV9wdHIgPSBuZXcgVWludDMyQXJyYXkodGhpcy5idWYsIDAsIDEpO1xuICAgIHRoaXMucmVhZF9wdHIgPSBuZXcgVWludDMyQXJyYXkodGhpcy5idWYsIDQsIDEpO1xuICAgIHRoaXMuc3RvcmFnZSA9IG5ldyB0eXBlKHRoaXMuYnVmLCA4LCB0aGlzLmNhcGFjaXR5KTtcbiAgfVxuICAvLyBSZXR1cm5zIHRoZSB0eXBlIG9mIHRoZSB1bmRlcmx5aW5nIEFycmF5QnVmZmVyIGZvciB0aGlzIFJpbmdCdWZmZXIuIFRoaXNcbiAgLy8gYWxsb3dzIGltcGxlbWVudGluZyBjcnVkZSB0eXBlIGNoZWNraW5nLlxuICB0eXBlKCkge1xuICAgIHJldHVybiB0aGlzLl90eXBlLm5hbWU7XG4gIH1cbiAgLy8gUHVzaCBieXRlcyB0byB0aGUgcmluZyBidWZmZXIuIGBieXRlc2AgaXMgYW4gdHlwZWQgYXJyYXkgb2YgdGhlIHNhbWUgdHlwZVxuICAvLyBhcyBwYXNzZWQgaW4gdGhlIGN0b3IsIHRvIGJlIHdyaXR0ZW4gdG8gdGhlIHF1ZXVlLlxuICAvLyBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgd3JpdHRlbiB0byB0aGUgcXVldWUuXG4gIHB1c2goZWxlbWVudHMpIHtcbiAgICB2YXIgcmQgPSBBdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwgMCk7XG4gICAgdmFyIHdyID0gQXRvbWljcy5sb2FkKHRoaXMud3JpdGVfcHRyLCAwKTtcblxuICAgIGlmICgod3IgKyAxKSAlIHRoaXMuX3N0b3JhZ2VfY2FwYWNpdHkoKSA9PSByZCkge1xuICAgICAgLy8gZnVsbFxuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgbGV0IHRvX3dyaXRlID0gTWF0aC5taW4odGhpcy5fYXZhaWxhYmxlX3dyaXRlKHJkLCB3ciksIGVsZW1lbnRzLmxlbmd0aCk7XG4gICAgbGV0IGZpcnN0X3BhcnQgPSBNYXRoLm1pbih0aGlzLl9zdG9yYWdlX2NhcGFjaXR5KCkgLSB3ciwgdG9fd3JpdGUpO1xuICAgIGxldCBzZWNvbmRfcGFydCA9IHRvX3dyaXRlIC0gZmlyc3RfcGFydDtcblxuICAgIHRoaXMuX2NvcHkoZWxlbWVudHMsIDAsIHRoaXMuc3RvcmFnZSwgd3IsIGZpcnN0X3BhcnQpO1xuICAgIHRoaXMuX2NvcHkoZWxlbWVudHMsIGZpcnN0X3BhcnQsIHRoaXMuc3RvcmFnZSwgMCwgc2Vjb25kX3BhcnQpO1xuXG4gICAgLy8gcHVibGlzaCB0aGUgZW5xdWV1ZWQgZGF0YSB0byB0aGUgb3RoZXIgc2lkZVxuICAgIEF0b21pY3Muc3RvcmUoXG4gICAgICB0aGlzLndyaXRlX3B0cixcbiAgICAgIDAsXG4gICAgICAod3IgKyB0b193cml0ZSkgJSB0aGlzLl9zdG9yYWdlX2NhcGFjaXR5KClcbiAgICApO1xuXG4gICAgcmV0dXJuIHRvX3dyaXRlO1xuICB9XG4gIC8vIFJlYWQgYGVsZW1lbnRzLmxlbmd0aGAgZWxlbWVudHMgZnJvbSB0aGUgcmluZyBidWZmZXIuIGBlbGVtZW50c2AgaXMgYSB0eXBlZFxuICAvLyBhcnJheSBvZiB0aGUgc2FtZSB0eXBlIGFzIHBhc3NlZCBpbiB0aGUgY3Rvci5cbiAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIHJlYWQgZnJvbSB0aGUgcXVldWUsIHRoZXkgYXJlIHBsYWNlZCBhdCB0aGVcbiAgLy8gYmVnaW5uaW5nIG9mIHRoZSBhcnJheSBwYXNzZWQgYXMgcGFyYW1ldGVyLlxuICBwb3AoZWxlbWVudHMpIHtcbiAgICB2YXIgcmQgPSBBdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwgMCk7XG4gICAgdmFyIHdyID0gQXRvbWljcy5sb2FkKHRoaXMud3JpdGVfcHRyLCAwKTtcblxuICAgIGlmICh3ciA9PSByZCkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgbGV0IHRvX3JlYWQgPSBNYXRoLm1pbih0aGlzLl9hdmFpbGFibGVfcmVhZChyZCwgd3IpLCBlbGVtZW50cy5sZW5ndGgpO1xuXG4gICAgbGV0IGZpcnN0X3BhcnQgPSBNYXRoLm1pbih0aGlzLl9zdG9yYWdlX2NhcGFjaXR5KCkgLSByZCwgZWxlbWVudHMubGVuZ3RoKTtcbiAgICBsZXQgc2Vjb25kX3BhcnQgPSB0b19yZWFkIC0gZmlyc3RfcGFydDtcblxuICAgIHRoaXMuX2NvcHkodGhpcy5zdG9yYWdlLCByZCwgZWxlbWVudHMsIDAsIGZpcnN0X3BhcnQpO1xuICAgIHRoaXMuX2NvcHkodGhpcy5zdG9yYWdlLCAwLCBlbGVtZW50cywgZmlyc3RfcGFydCwgc2Vjb25kX3BhcnQpO1xuXG4gICAgQXRvbWljcy5zdG9yZSh0aGlzLnJlYWRfcHRyLCAwLCAocmQgKyB0b19yZWFkKSAlIHRoaXMuX3N0b3JhZ2VfY2FwYWNpdHkoKSk7XG5cbiAgICByZXR1cm4gdG9fcmVhZDtcbiAgfVxuXG4gIC8vIFRydWUgaWYgdGhlIHJpbmcgYnVmZmVyIGlzIGVtcHR5IGZhbHNlIG90aGVyd2lzZS4gVGhpcyBjYW4gYmUgbGF0ZSBvbiB0aGVcbiAgLy8gcmVhZGVyIHNpZGU6IGl0IGNhbiByZXR1cm4gdHJ1ZSBldmVuIGlmIHNvbWV0aGluZyBoYXMganVzdCBiZWVuIHB1c2hlZC5cbiAgZW1wdHkoKSB7XG4gICAgdmFyIHJkID0gQXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsIDApO1xuICAgIHZhciB3ciA9IEF0b21pY3MubG9hZCh0aGlzLndyaXRlX3B0ciwgMCk7XG5cbiAgICByZXR1cm4gd3IgPT0gcmQ7XG4gIH1cblxuICAvLyBUcnVlIGlmIHRoZSByaW5nIGJ1ZmZlciBpcyBmdWxsLCBmYWxzZSBvdGhlcndpc2UuIFRoaXMgY2FuIGJlIGxhdGUgb24gdGhlXG4gIC8vIHdyaXRlIHNpZGU6IGl0IGNhbiByZXR1cm4gdHJ1ZSB3aGVuIHNvbWV0aGluZyBoYXMganVzdCBiZWVuIHBvcGVkLlxuICBmdWxsKCkge1xuICAgIHZhciByZCA9IEF0b21pY3MubG9hZCh0aGlzLnJlYWRfcHRyLCAwKTtcbiAgICB2YXIgd3IgPSBBdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsIDApO1xuXG4gICAgcmV0dXJuICh3ciArIDEpICUgdGhpcy5jYXBhY2l0eSAhPSByZDtcbiAgfVxuXG4gIC8vIFRoZSB1c2FibGUgY2FwYWNpdHkgZm9yIHRoZSByaW5nIGJ1ZmZlcjogdGhlIG51bWJlciBvZiBlbGVtZW50cyB0aGF0IGNhbiBiZVxuICAvLyBzdG9yZWQuXG4gIGNhcGFjaXR5KCkge1xuICAgIHJldHVybiB0aGlzLmNhcGFjaXR5IC0gMTtcbiAgfVxuXG4gIC8vIE51bWJlciBvZiBlbGVtZW50cyBhdmFpbGFibGUgZm9yIHJlYWRpbmcuIFRoaXMgY2FuIGJlIGxhdGUsIGFuZCByZXBvcnQgbGVzc1xuICAvLyBlbGVtZW50cyB0aGF0IGlzIGFjdHVhbGx5IGluIHRoZSBxdWV1ZSwgd2hlbiBzb21ldGhpbmcgaGFzIGp1c3QgYmVlblxuICAvLyBlbnF1ZXVlZC5cbiAgYXZhaWxhYmxlX3JlYWQoKSB7XG4gICAgdmFyIHJkID0gQXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsIDApO1xuICAgIHZhciB3ciA9IEF0b21pY3MubG9hZCh0aGlzLndyaXRlX3B0ciwgMCk7XG4gICAgcmV0dXJuIHRoaXMuX2F2YWlsYWJsZV9yZWFkKHJkLCB3cik7XG4gIH1cblxuICAvLyBOdW1iZXIgb2YgZWxlbWVudHMgYXZhaWxhYmxlIGZvciB3cml0aW5nLiBUaGlzIGNhbiBiZSBsYXRlLCBhbmQgcmVwb3J0IGxlc3NcbiAgLy8gZWxlbXRucyB0aGF0IGlzIGFjdHVhbGx5IGF2YWlsYWJsZSBmb3Igd3JpdGluZywgd2hlbiBzb21ldGhpbmcgaGFzIGp1c3RcbiAgLy8gYmVlbiBkZXF1ZXVlZC5cbiAgYXZhaWxhYmxlX3dyaXRlKCkge1xuICAgIHZhciByZCA9IEF0b21pY3MubG9hZCh0aGlzLnJlYWRfcHRyLCAwKTtcbiAgICB2YXIgd3IgPSBBdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsIDApO1xuICAgIHJldHVybiB0aGlzLl9hdmFpbGFibGVfd3JpdGUocmQsIHdyKTtcbiAgfVxuXG4gIC8vIHByaXZhdGUgbWV0aG9kcyAvL1xuXG4gIC8vIE51bWJlciBvZiBlbGVtZW50cyBhdmFpbGFibGUgZm9yIHJlYWRpbmcsIGdpdmVuIGEgcmVhZCBhbmQgd3JpdGUgcG9pbnRlci4uXG4gIF9hdmFpbGFibGVfcmVhZChyZCwgd3IpIHtcbiAgICBpZiAod3IgPiByZCkge1xuICAgICAgcmV0dXJuIHdyIC0gcmQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB3ciArIHRoaXMuX3N0b3JhZ2VfY2FwYWNpdHkoKSAtIHJkO1xuICAgIH1cbiAgfVxuXG4gIC8vIE51bWJlciBvZiBlbGVtZW50cyBhdmFpbGFibGUgZnJvbSB3cml0aW5nLCBnaXZlbiBhIHJlYWQgYW5kIHdyaXRlIHBvaW50ZXIuXG4gIF9hdmFpbGFibGVfd3JpdGUocmQsIHdyKSB7XG4gICAgbGV0IHJ2ID0gcmQgLSB3ciAtIDE7XG4gICAgaWYgKHdyID49IHJkKSB7XG4gICAgICBydiArPSB0aGlzLl9zdG9yYWdlX2NhcGFjaXR5KCk7XG4gICAgfVxuICAgIHJldHVybiBydjtcbiAgfVxuXG4gIC8vIFRoZSBzaXplIG9mIHRoZSBzdG9yYWdlIGZvciBlbGVtZW50cyBub3QgYWNjb3VudGluZyB0aGUgc3BhY2UgZm9yIHRoZSBpbmRleC5cbiAgX3N0b3JhZ2VfY2FwYWNpdHkoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FwYWNpdHk7XG4gIH1cblxuICAvLyBDb3B5IGBzaXplYCBlbGVtZW50cyBmcm9tIGBpbnB1dGAsIHN0YXJ0aW5nIGF0IG9mZnNldCBgb2Zmc2V0X2lucHV0YCwgdG9cbiAgLy8gYG91dHB1dGAsIHN0YXJ0aW5nIGF0IG9mZnNldCBgb2Zmc2V0X291dHB1dGAuXG4gIF9jb3B5KGlucHV0LCBvZmZzZXRfaW5wdXQsIG91dHB1dCwgb2Zmc2V0X291dHB1dCwgc2l6ZSkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7XG4gICAgICBvdXRwdXRbb2Zmc2V0X291dHB1dCArIGldID0gaW5wdXRbb2Zmc2V0X2lucHV0ICsgaV07XG4gICAgfVxuICB9XG59XG4iLCJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHsgUmluZ0J1ZmZlciB9IGZyb20gXCJyaW5nYnVmLmpzXCI7XG5zZWxmLlJpbmdCdWZmZXIgPSBSaW5nQnVmZmVyO1xuXG52YXIgb3V0cHV0U0FCcyA9IHt9O1xuXG5jbGFzcyBNTFNBQk91dHB1dFRyYW5zZHVjZXIge1xuXG4gIGNvbnN0cnVjdG9yKGJ1ZmZlclR5cGUsIGNoYW5uZWwsIGJsb2Nrc2l6ZSkge1xuICAgIHRoaXMuY2hhbm5lbCA9IGNoYW5uZWw7XG4gICAgdGhpcy5ibG9ja3NpemUgPSBibG9ja3NpemU7XG4gICAgICAvL2NoZWNrIGZvciBleGlzdGluZyBjaGFubmVsc1xuICAgIGlmIChjaGFubmVsIGluIG91dHB1dFNBQnMgJiYgb3V0cHV0U0FCc1tjaGFubmVsXS5ibG9ja3NpemUgPT0gYmxvY2tzaXplKSB7XG4gICAgICAvL3JldXNlIGV4aXN0aW5nXG4gICAgICB0aGlzLnJpbmdidWYgPSBvdXRwdXRTQUJzW2NoYW5uZWxdLnJiO1xuICAgIH1lbHNle1xuICAgICAgLy9jcmVhdGUgYSBuZXcgU0FCIGFuZCBub3RpZnkgdGhlIHJlY2VpdmVyXG4gICAgICB0aGlzLnNhYiA9IFJpbmdCdWZmZXIuZ2V0U3RvcmFnZUZvckNhcGFjaXR5KDMyICogYmxvY2tzaXplLCBGbG9hdDY0QXJyYXkpO1xuICAgICAgdGhpcy5yaW5nYnVmID0gbmV3IFJpbmdCdWZmZXIodGhpcy5zYWIsIEZsb2F0NjRBcnJheSk7XG5cbiAgICAgIG91dHB1dFNBQnNbY2hhbm5lbF0gPSB7XG4gICAgICAgIHJiOnRoaXMucmluZ2J1ZixcbiAgICAgICAgc2FiOnRoaXMuc2FiLFxuICAgICAgICBjcmVhdGVkOkRhdGUubm93KCksXG4gICAgICAgIGJsb2Nrc2l6ZTpibG9ja3NpemUgfTtcblxuICAgICAgcG9zdE1lc3NhZ2Uoe1xuICAgICAgICBmdW5jOiAnc2FiJyxcbiAgICAgICAgdmFsdWU6IHRoaXMuc2FiLFxuICAgICAgICB0dHlwZTogYnVmZmVyVHlwZSxcbiAgICAgICAgY2hhbm5lbElEOiBjaGFubmVsLFxuICAgICAgICBibG9ja3NpemU6YmxvY2tzaXplXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBzZW5kKHZhbHVlKSB7XG4gICAgaWYgKHRoaXMucmluZ2J1Zi5hdmFpbGFibGVfd3JpdGUoKSA+IDEpIHtcbiAgICAgIGlmICh0eXBlb2YodmFsdWUpID09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgdGhpcy5yaW5nYnVmLnB1c2gobmV3IEZsb2F0NjRBcnJheShbdmFsdWVdKSk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PSB0aGlzLmJsb2Nrc2l6ZSkge1xuICAgICAgICAgIHRoaXMucmluZ2J1Zi5wdXNoKHZhbHVlKTtcbiAgICAgICAgfWVsc2UgaWYgKHZhbHVlLmxlbmd0aCA8IHRoaXMuYmxvY2tzaXplKSB7XG4gICAgICAgICAgbGV0IG5ld1ZhbCA9IG5ldyBGbG9hdDY0QXJyYXkodGhpcy5ibG9ja3NpemUpO1xuICAgICAgICAgIGZvcihsZXQgaSBpbiB2YWx1ZSkgbmV3VmFsW2ldID0gdmFsdWVbaV07XG4gICAgICAgICAgdGhpcy5yaW5nYnVmLnB1c2gobmV3VmFsKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdGhpcy5yaW5nYnVmLnB1c2godmFsdWUuc2xpY2UoMCx0aGlzLmJsb2Nrc2l6ZSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbnNlbGYuY3JlYXRlT3V0cHV0Q2hhbm5lbCA9ICggaWQsIGJsb2Nrc2l6ZSApID0+IHtcbiAgcmV0dXJuIG5ldyBNTFNBQk91dHB1dFRyYW5zZHVjZXIoJ01MJywgaWQsIGJsb2Nrc2l6ZSk7XG59O1xuXG5zZWxmLmlucHV0ID0gKCB2YWx1ZSwgY2hhbm5lbCApID0+IHt9XG5cbnNlbGYub3V0cHV0ID0gKCB2YWx1ZSwgY2hhbm5lbCApID0+IHsgcG9zdE1lc3NhZ2UoIHsgZnVuYzonZGF0YScsIHZhbDp2YWx1ZSwgY2g6Y2hhbm5lbCB9KTsgfVxuXG5zZWxmLmxvYWRSZXNwb25kZXJzID0ge307XG5cbnNlbGYuaW5wdXRTQUJzID0ge307XG5cbnNlbGYuc2VtYSA9IHtcblx0c2F2ZUYzMkFycmF5OiAobmFtZSwgdmFsKSA9PiB7XG5cdFx0cG9zdE1lc3NhZ2Uoe1xuXHRcdFx0ZnVuYzogXCJzYXZlXCIsXG5cdFx0XHRuYW1lOiBuYW1lLFxuXHRcdFx0dmFsOiB2YWwsXG5cdFx0fSk7XG5cdFx0cmV0dXJuIDA7XG5cdH0sXG5cdGxvYWRGMzJBcnJheTogKG5hbWUsIG9ubG9hZCkgPT4ge1xuXHRcdHBvc3RNZXNzYWdlKHtcblx0XHRcdGZ1bmM6IFwibG9hZFwiLFxuXHRcdFx0bmFtZTogbmFtZSxcblx0XHR9KTtcblx0XHRsb2FkUmVzcG9uZGVyc1tuYW1lXSA9IG9ubG9hZDtcblx0XHRyZXR1cm4gMDtcblx0fSxcblx0ZG93bmxvYWQ6IChuYW1lKSA9PiB7XG5cdFx0cG9zdE1lc3NhZ2Uoe1xuXHRcdFx0ZnVuYzogXCJkb3dubG9hZFwiLFxuXHRcdFx0bmFtZTogbmFtZSxcblx0XHR9KTtcblx0fSxcblx0c2VuZENvZGU6IChjb2RlKSA9PiB7XG5cdFx0cG9zdE1lc3NhZ2Uoe1xuXHRcdFx0ZnVuYzogXCJzZW5kY29kZVwiLFxuXHRcdFx0Y29kZTogY29kZSxcblx0XHR9KTtcblx0fSxcblx0cGJjb3B5OiAobXNnKSA9PiB7XG5cdFx0cG9zdE1lc3NhZ2Uoe1xuXHRcdFx0ZnVuYzogXCJwYmNvcHlcIixcblx0XHRcdG1zZzogbXNnLFxuXHRcdH0pO1xuXHR9LFxuXHRzZW5kQnVmZmVyOiAoYnVmZmVyTmFtZSwgZGF0YSkgPT4ge1xuXHRcdHBvc3RNZXNzYWdlKHtcblx0XHRcdGZ1bmM6IFwic2VuZGJ1ZlwiLFxuXHRcdFx0bmFtZTogYnVmZmVyTmFtZSxcblx0XHRcdGRhdGE6IGRhdGEsXG5cdFx0fSk7XG5cdH0sXG5cdGVudjoge1xuXHRcdHNhdmVMb2NhbDogKG5hbWUpID0+IHtcblx0XHRcdHBvc3RNZXNzYWdlKHtcblx0XHRcdFx0ZnVuYzogXCJlbnZzYXZlXCIsXG5cdFx0XHRcdG5hbWU6IG5hbWUsXG5cdFx0XHRcdHN0b3JhZ2U6IFwibG9jYWxcIixcblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0bG9hZExvY2FsOiAobmFtZSkgPT4ge1xuXHRcdFx0cG9zdE1lc3NhZ2Uoe1xuXHRcdFx0XHRmdW5jOiBcImVudmxvYWRcIixcblx0XHRcdFx0bmFtZTogbmFtZSxcblx0XHRcdFx0c3RvcmFnZTogXCJsb2NhbFwiLFxuXHRcdFx0fSk7XG5cdFx0fSxcblx0XHRzYXZlVG9QQjogKCkgPT4ge1xuXHRcdFx0cG9zdE1lc3NhZ2Uoe1xuXHRcdFx0XHRmdW5jOiBcImVudnNhdmVcIixcblx0XHRcdFx0c3RvcmFnZTogXCJwYXN0ZWJ1ZmZlclwiLFxuXHRcdFx0fSk7XG5cdFx0fSxcblx0XHRsb2FkR2lzdDogKGdpc3RpZCkgPT4ge1xuXHRcdFx0cG9zdE1lc3NhZ2Uoe1xuXHRcdFx0XHRmdW5jOiBcImVudmxvYWRcIixcblx0XHRcdFx0bmFtZTogZ2lzdGlkLFxuXHRcdFx0XHRzdG9yYWdlOiBcImdpc3RcIixcblx0XHRcdH0pO1xuXHRcdH0sXG5cdH0sXG5cdC8vcnVuIGluIHRoZSBET01cblx0ZG9tZXZhbDogKGNvZGUpID0+IHtcblx0XHRwb3N0TWVzc2FnZSh7XG5cdFx0XHRmdW5jOiBcImRvbWV2YWxcIixcblx0XHRcdGNvZGU6IGNvZGUsXG5cdFx0fSk7XG5cdH0sXG5cdHBlZXJpbmZvOiAoKSA9PiB7XG5cdFx0cG9zdE1lc3NhZ2Uoe1xuXHRcdFx0ZnVuYzogXCJwZWVyaW5mb1wiLFxuXHRcdH0pO1xuXHRcdGNvbnNvbGUubG9nKFwiWW91ciBwZWVyIElEIGhhcyBiZWVuIGNvcGllZCB0byB0aGUgcGFzdGUgYnVmZmVyXCIpO1xuXHR9LFxufTtcblxuZnVuY3Rpb24gaW5pdFdpdGhVUkwodXJsKXtcbiAgaWYoIG5ldyBVUkwodXJsKSApe1xuICAgIHRyeSB7XG4gICAgICBpbXBvcnRTY3JpcHRzKHVybCArIFwiL2xhbG9saWIuanNcIik7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRVJST1I6IGltcG9ydFNjcmlwdHMg4oCTIGxhbG9saWIuanMgXCIsIGVycik7XG4gICAgfVxuICAgIHRyeXtcbiAgICAgIGltcG9ydFNjcmlwdHModXJsICsgXCIvc3ZkLmpzXCIpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVSUk9SOiBpbXBvcnRTY3JpcHRzIOKAkyBzdmQuanMgXCIsIGVycik7XG4gICAgfVxuICAgIHRyeXtcbiAgICAgIGltcG9ydFNjcmlwdHMoXG4gICAgICAgIFwiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9AdGVuc29yZmxvdy90ZmpzL2Rpc3QvdGYubWluLmpzXCJcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRVJST1I6IGltcG9ydFNjcmlwdHMg4oCTIHRmanNcIiwgZXJyKTtcbiAgICB9XG4gICAgdHJ5e1xuICAgICAgc2FiQ2hlY2tlcigpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVSUk9SOiBzYWJDaGVja2VyXCIsIGVycik7XG4gICAgfVxuICAgIHBvc3RNZXNzYWdlKHsgaW5pdDogdHJ1ZSB9KTtcbiAgfVxuICBlbHNlXG4gICAgY29uc29sZS5lcnJvcihcIkVSUk9SOiBpbml0V2l0aFVSTCDigJMgSW52YWxpZCBVUkxcIik7XG59XG5cbmNvbnN0IGdldmFsVG9Db25zb2xlID0gZSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKCFnZXZhbClcbiAgICAgIHZhciBnZXZhbCA9IGV2YWw7XG4gICAgbGV0IHJlcyA9IGdldmFsKGUpO1xuICAgIGlmIChyZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc29sZS5pbmZvKHJlcyk7IC8vIHByaW50IHRvIGNvbnNvbGUgaWYgc3VjY2Vzc2Z1bFxuICAgIH0gZWxzZSAgY29uc29sZS5pbmZvKFwiZG9uZVwiKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGBFdmFsIGV4Y2VwdGlvbiBvbiBMZWFybmVyOiBgLCBlcnJvcik7XG4gIH1cbn1cblxub25tZXNzYWdlID0gbSA9PiB7XG5cbiAgaWYobS5kYXRhLnVybClcbiAgICBpbml0V2l0aFVSTChtLmRhdGEudXJsKTtcbiAgZWxzZSBpZiAobS5kYXRhLmV2YWwpXG4gICAgZ2V2YWxUb0NvbnNvbGUobS5kYXRhLmV2YWwpO1xuICBlbHNlIGlmIChcInZhbFwiIGluIG0uZGF0YSkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwiREVCVUc6bWwud29ya2VyOm9ubWVzc2FnZTp2YWxcIik7XG4gICAgbGV0IHZhbCA9IG0uZGF0YS52YWw7XG4gICAgLy8gY29uc29sZS5sb2codmFsKTtcbiAgICB2YWwgPSBKU09OLnBhcnNlKGBbJHt2YWx9XWApO1xuICAgIC8vIGNvbnNvbGUubG9nKHZhbCk7XG4gICAgLy8gY29uc29sZS5sb2cobG9hZFJlc3BvbmRlcnMpO1xuICAgIGxvYWRSZXNwb25kZXJzW20uZGF0YS5uYW1lXSh2YWwpO1xuICAgIGRlbGV0ZSBsb2FkUmVzcG9uZGVyc1ttLmRhdGEubmFtZV07XG4gIH0gZWxzZSBpZiAobS5kYXRhLnR5cGUgPT09IFwibW9kZWwtaW5wdXQtZGF0YVwiKSB7XG4gICAgaW5wdXQobS5kYXRhLnZhbHVlLCBtLmRhdGEuY2gpO1xuICB9IGVsc2UgaWYgKG0uZGF0YS5zYWIpe1xuICAgIGNvbnNvbGUuaW5mbygnYnVmZmVyIHJlY2VpdmVkJyk7XG4gICAgbGV0IHNhYiA9IG0uZGF0YS5zYWI7XG4gICAgbGV0IHJiID0gbmV3IFJpbmdCdWZmZXIoc2FiLCBGbG9hdDY0QXJyYXkpO1xuICAgIGlucHV0U0FCc1ttLmRhdGEuY2hhbm5lbElEXSA9IHtcbiAgICAgIHNhYixcbiAgICAgIHJiLFxuICAgICAgYmxvY2tzaXplOiBtLmRhdGEuYmxvY2tzaXplXG4gICAgfTtcbiAgfVxufTtcblxuZnVuY3Rpb24gc2FiQ2hlY2tlcigpIHtcbiAgdHJ5IHtcbiAgICAvLyBjb25zb2xlLmxvZyhpbnB1dFNBQnMpO1xuICAgIGZvciAobGV0IHYgaW4gaW5wdXRTQUJzKSB7XG4gICAgICBsZXQgYXZhaWwgPSBpbnB1dFNBQnNbdl0ucmIuYXZhaWxhYmxlX3JlYWQoKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGF2YWlsLCBpbnB1dFNBQnNbdl0ucmIuY2FwYWNpdHksIGlucHV0U0FCc1t2XS5ibG9ja3NpemUpO1xuICAgICAgaWYgKGF2YWlsICE9IGlucHV0U0FCc1t2XS5yYi5jYXBhY2l0eSAmJiBhdmFpbCA+IDApIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhdmFpbDsgaSArPSBpbnB1dFNBQnNbdl0uYmxvY2tzaXplKSB7XG4gICAgICAgICAgbGV0IHZhbCA9IG5ldyBGbG9hdDY0QXJyYXkoaW5wdXRTQUJzW3ZdLmJsb2Nrc2l6ZSk7XG4gICAgICAgICAgaW5wdXRTQUJzW3ZdLnJiLnBvcCh2YWwpO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbCk7XG4gICAgICAgICAgaW5wdXQodiwgdmFsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBzZXRUaW1lb3V0KHNhYkNoZWNrZXIsIDIwKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgc2V0VGltZW91dChzYWJDaGVja2VyLCAxMDApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJSaW5nQnVmZmVyIiwiW29iamVjdCBPYmplY3RdIiwiY2FwYWNpdHkiLCJ0eXBlIiwiQllURVNfUEVSX0VMRU1FTlQiLCJieXRlcyIsIlNoYXJlZEFycmF5QnVmZmVyIiwic2FiIiwiQXJyYXlCdWZmZXIiLCJfX3Byb3RvX18iLCJpc1Byb3RvdHlwZU9mIiwidW5kZWZpbmVkIiwidGhpcyIsIl90eXBlIiwiYnl0ZUxlbmd0aCIsImJ1ZiIsIndyaXRlX3B0ciIsIlVpbnQzMkFycmF5IiwicmVhZF9wdHIiLCJzdG9yYWdlIiwibmFtZSIsImVsZW1lbnRzIiwicmQiLCJBdG9taWNzIiwibG9hZCIsIndyIiwiX3N0b3JhZ2VfY2FwYWNpdHkiLCJ0b193cml0ZSIsIk1hdGgiLCJtaW4iLCJfYXZhaWxhYmxlX3dyaXRlIiwibGVuZ3RoIiwiZmlyc3RfcGFydCIsInNlY29uZF9wYXJ0IiwiX2NvcHkiLCJzdG9yZSIsInRvX3JlYWQiLCJfYXZhaWxhYmxlX3JlYWQiLCJydiIsImlucHV0Iiwib2Zmc2V0X2lucHV0Iiwib3V0cHV0Iiwib2Zmc2V0X291dHB1dCIsInNpemUiLCJpIiwic2VsZiIsIm91dHB1dFNBQnMiLCJNTFNBQk91dHB1dFRyYW5zZHVjZXIiLCJidWZmZXJUeXBlIiwiY2hhbm5lbCIsImJsb2Nrc2l6ZSIsInJpbmdidWYiLCJyYiIsImdldFN0b3JhZ2VGb3JDYXBhY2l0eSIsIkZsb2F0NjRBcnJheSIsImNyZWF0ZWQiLCJEYXRlIiwibm93IiwicG9zdE1lc3NhZ2UiLCJmdW5jIiwidmFsdWUiLCJ0dHlwZSIsImNoYW5uZWxJRCIsImF2YWlsYWJsZV93cml0ZSIsInB1c2giLCJuZXdWYWwiLCJzbGljZSIsImNyZWF0ZU91dHB1dENoYW5uZWwiLCJpZCIsInZhbCIsImNoIiwibG9hZFJlc3BvbmRlcnMiLCJpbnB1dFNBQnMiLCJzZW1hIiwic2F2ZUYzMkFycmF5IiwibG9hZEYzMkFycmF5Iiwib25sb2FkIiwiZG93bmxvYWQiLCJzZW5kQ29kZSIsImNvZGUiLCJwYmNvcHkiLCJtc2ciLCJzZW5kQnVmZmVyIiwiYnVmZmVyTmFtZSIsImRhdGEiLCJlbnYiLCJzYXZlTG9jYWwiLCJsb2FkTG9jYWwiLCJzYXZlVG9QQiIsImxvYWRHaXN0IiwiZ2lzdGlkIiwiZG9tZXZhbCIsInBlZXJpbmZvIiwiY29uc29sZSIsImxvZyIsInNhYkNoZWNrZXIiLCJ2IiwiYXZhaWwiLCJhdmFpbGFibGVfcmVhZCIsInBvcCIsInNldFRpbWVvdXQiLCJlcnJvciIsIm9ubWVzc2FnZSIsIm0iLCJ1cmwiLCJVUkwiLCJpbXBvcnRTY3JpcHRzIiwiZXJyIiwiaW5pdCIsImluaXRXaXRoVVJMIiwiZXZhbCIsImUiLCJnZXZhbCIsInJlcyIsImluZm8iLCJnZXZhbFRvQ29uc29sZSIsIkpTT04iLCJwYXJzZSJdLCJtYXBwaW5ncyI6InlCQUtBLE1BQWFBLEVBQ1hDLDZCQUE2QkMsRUFBVUMsR0FDckMsSUFBS0EsRUFBS0Msa0JBQ1IsS0FBTSxpQ0FFUixJQUFJQyxFQUFRLEdBQUtILEVBQVcsR0FBS0MsRUFBS0Msa0JBQ3RDLE9BQU8sSUFBSUUsa0JBQWtCRCxHQUkvQkosWUFBWU0sRUFBS0osR0FDZixJQUFLSyxZQUFZQyxVQUFVQyxjQUFjUCxTQUNaUSxJQUEzQlIsRUFBS0Msa0JBQ0wsS0FBTSx1REFRUlEsS0FBS0MsTUFBUVYsRUFDYlMsS0FBS1YsVUFBWUssRUFBSU8sV0FBYSxHQUFLWCxFQUFLQyxrQkFDNUNRLEtB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",!1);class Learner{constructor(){this.dispatcher=new Dispatcher}addEventListener(e,t){if(!(this.dispatcher&&e&&t))throw new Error("Error adding event listener to Learner");this.dispatcher.addEventListener(e,t)}removeEventListner(e,t){if(!(this.dispatcher&&e&&t))throw new Error("Error removing event listener to Learner");this.dispatcher.removeEventListener(e,t)}async init(e){return this.worker=new WorkerFactory,new Promise(((t,o)=>{let s={};this.worker&&new URL(e)&&(this.worker.postMessage({url:e}),this.worker.onerror=this.onErrorHandler,this.worker.onmessage=e=>{s=e.data.init,console.info("running Learner"),t(s),this.worker.onmessage=this.onMessageHandler})}))}onMessageHandler=e=>{if(e&&e.data&&e.data.func){({sab:e=>{this.dispatcher.dispatch("onSharedBuffer",e)},sendbuf:e=>{this.dispatcher.dispatch("onSharedBuffer",e)},save:e=>{window.localStorage.setItem(e.name,e.val)},load:e=>{let t={name:e.name,val:window.localStorage.getItem(e.name)};modelWorker.postMessage(t)},download:e=>{let t=window.localStorage.getItem(e.name),o=new Blob([t],{type:"text/plain;charset=utf-8"});saveData(o,`${e.name}.data`)},sendcode:e=>{},pbcopy:e=>{copyToPasteBuffer(e.msg)},envsave:e=>{messaging.publish("env-save",e)},envload:e=>{messaging.publish("env-load",e)},domeval:e=>{evalDOMCode(e.code)},peerinfo:e=>{messaging.publish("peerinfo-request",{})}})[e.data.func](e.data)}else void 0!==e.data&&0!=e.data.length&&res(e.data)};onErrorHandler=e=>{console.log("onError"),console.log(e)};eval(e){this.worker&&e&&this.worker.postMessage({eval:e})}addSharedBuffer(e){if(!(this.worker&&e&&e.sab&&e.sab instanceof SharedArrayBuffer))throw new Error("Error pushing SharedBuffer in Learner");this.worker.postMessage({sab:e.sab,blocksize:e.blocksize,channelID:e.channelID})}evalBlock(e){let t=e.indexOf("\n");"//--DOM"==e.substr(0,t)?(e=e.substr(t),evalDomCode(e),addToHistory("dom-history-",e)):(this.worker.postMessage({eval:e}),window.localStorage.setItem("modelEditorValue",codeMirror.getValue()),addToHistory("model-history-",e))}terminate(){this.worker.terminate(),this.worker=null}}function getBlock(e){if(e){let t=e.getCursor(),o=t.line,s=e.lastLine();for(;o<s;){if(/___+/.test(e.getLine(o))){s=o-1;break}o++}o=t.line;let r=-1;for(;o>=0;){if(/___+/.test(e.getLine(o))){r=o;break}o--}return r>-1&&r++,e.getRange({line:r,ch:0},{line:s+1,ch:0})}}return exports.ASTreeToJavascript=IR,exports.Engine=Engine,exports.Learner=Learner,exports.compile=compile,exports.compileGrammar=compileGrammar,exports.getBlock=getBlock,exports.getParserModuleExports=getParserModuleExports,exports.mooo=moo.mooo,exports.nearley=nearley.nearley,exports.semaa=sema.semaa,Object.defineProperty(exports,"__esModule",{value:!0}),exports}({});
//# sourceMappingURL=sema-engine.min.js.map
