{"version":3,"file":"index.mjs","sources":["node_modules/ringbuf.js/js/ringbuf.js","src/engine/maximilian.util.js","src/common/event.js","src/common/dispatcher.js","src/common/logger.js","src/engine/engine.js","node_modules/nearley/lib/nearley.js","node_modules/moo/moo.js","node_modules/nearley/lib/nearley-language-bootstrapped.js","src/compiler/compiler-low-level.js","node_modules/nearley/lib/generate.js","node_modules/nearley/lib/lint.js","src/compiler/IR.js","src/compiler/sema.js","src/compiler/compiler.js","src/learner/learner.js","src/common/blockTracker.js"],"sourcesContent":["// A Single Producer - Single Consumer thread-safe wait-free ring buffer.\n//\n// The producer and the consumer can be separate thread, but cannot change role,\n// except with external synchronization.\n\nexport class RingBuffer {\n  static getStorageForCapacity(capacity, type) {\n    if (!type.BYTES_PER_ELEMENT) {\n      throw \"Pass in a ArrayBuffer subclass\";\n    }\n    var bytes = 8 + (capacity + 1) * type.BYTES_PER_ELEMENT;\n    return new SharedArrayBuffer(bytes);\n  }\n  // `sab` is a SharedArrayBuffer with a capacity calculated by calling\n  // `getStorageForCapacity` with the desired capacity.\n  constructor(sab, type) {\n    if (!ArrayBuffer.__proto__.isPrototypeOf(type) &&\n      type.BYTES_PER_ELEMENT !== undefined) {\n      throw \"Pass a concrete typed array class as second argument\";\n    }\n\n    // Maximum usable size is 1<<32 - type.BYTES_PER_ELEMENT bytes in the ring\n    // buffer for this version, easily changeable.\n    // -4 for the write ptr (uint32_t offsets)\n    // -4 for the read ptr (uint32_t offsets)\n    // capacity counts the empty slot to distinguish between full and empty.\n    this._type = type;\n    this.capacity = (sab.byteLength - 8) / type.BYTES_PER_ELEMENT;\n    this.buf = sab;\n    this.write_ptr = new Uint32Array(this.buf, 0, 1);\n    this.read_ptr = new Uint32Array(this.buf, 4, 1);\n    this.storage = new type(this.buf, 8, this.capacity);\n  }\n  // Returns the type of the underlying ArrayBuffer for this RingBuffer. This\n  // allows implementing crude type checking.\n  type() {\n    return this._type.name;\n  }\n  // Push bytes to the ring buffer. `bytes` is an typed array of the same type\n  // as passed in the ctor, to be written to the queue.\n  // Returns the number of elements written to the queue.\n  push(elements) {\n    var rd = Atomics.load(this.read_ptr, 0);\n    var wr = Atomics.load(this.write_ptr, 0);\n\n    if ((wr + 1) % this._storage_capacity() == rd) {\n      // full\n      return 0;\n    }\n\n    let to_write = Math.min(this._available_write(rd, wr), elements.length);\n    let first_part = Math.min(this._storage_capacity() - wr, to_write);\n    let second_part = to_write - first_part;\n\n    this._copy(elements, 0, this.storage, wr, first_part);\n    this._copy(elements, first_part, this.storage, 0, second_part);\n\n    // publish the enqueued data to the other side\n    Atomics.store(\n      this.write_ptr,\n      0,\n      (wr + to_write) % this._storage_capacity()\n    );\n\n    return to_write;\n  }\n  // Read `elements.length` elements from the ring buffer. `elements` is a typed\n  // array of the same type as passed in the ctor.\n  // Returns the number of elements read from the queue, they are placed at the\n  // beginning of the array passed as parameter.\n  pop(elements) {\n    var rd = Atomics.load(this.read_ptr, 0);\n    var wr = Atomics.load(this.write_ptr, 0);\n\n    if (wr == rd) {\n      return 0;\n    }\n\n    let to_read = Math.min(this._available_read(rd, wr), elements.length);\n\n    let first_part = Math.min(this._storage_capacity() - rd, elements.length);\n    let second_part = to_read - first_part;\n\n    this._copy(this.storage, rd, elements, 0, first_part);\n    this._copy(this.storage, 0, elements, first_part, second_part);\n\n    Atomics.store(this.read_ptr, 0, (rd + to_read) % this._storage_capacity());\n\n    return to_read;\n  }\n\n  // True if the ring buffer is empty false otherwise. This can be late on the\n  // reader side: it can return true even if something has just been pushed.\n  empty() {\n    var rd = Atomics.load(this.read_ptr, 0);\n    var wr = Atomics.load(this.write_ptr, 0);\n\n    return wr == rd;\n  }\n\n  // True if the ring buffer is full, false otherwise. This can be late on the\n  // write side: it can return true when something has just been poped.\n  full() {\n    var rd = Atomics.load(this.read_ptr, 0);\n    var wr = Atomics.load(this.write_ptr, 0);\n\n    return (wr + 1) % this.capacity != rd;\n  }\n\n  // The usable capacity for the ring buffer: the number of elements that can be\n  // stored.\n  capacity() {\n    return this.capacity - 1;\n  }\n\n  // Number of elements available for reading. This can be late, and report less\n  // elements that is actually in the queue, when something has just been\n  // enqueued.\n  available_read() {\n    var rd = Atomics.load(this.read_ptr, 0);\n    var wr = Atomics.load(this.write_ptr, 0);\n    return this._available_read(rd, wr);\n  }\n\n  // Number of elements available for writing. This can be late, and report less\n  // elemtns that is actually available for writing, when something has just\n  // been dequeued.\n  available_write() {\n    var rd = Atomics.load(this.read_ptr, 0);\n    var wr = Atomics.load(this.write_ptr, 0);\n    return this._available_write(rd, wr);\n  }\n\n  // private methods //\n\n  // Number of elements available for reading, given a read and write pointer..\n  _available_read(rd, wr) {\n    if (wr > rd) {\n      return wr - rd;\n    } else {\n      return wr + this._storage_capacity() - rd;\n    }\n  }\n\n  // Number of elements available from writing, given a read and write pointer.\n  _available_write(rd, wr) {\n    let rv = rd - wr - 1;\n    if (wr >= rd) {\n      rv += this._storage_capacity();\n    }\n    return rv;\n  }\n\n  // The size of the storage for elements not accounting the space for the index.\n  _storage_capacity() {\n    return this.capacity;\n  }\n\n  // Copy `size` elements from `input`, starting at offset `offset_input`, to\n  // `output`, starting at offset `offset_output`.\n  _copy(input, offset_input, output, offset_output, size) {\n    for (var i = 0; i < size; i++) {\n      output[offset_output + i] = input[offset_input + i];\n    }\n  }\n}\n","export const getArrayAsVectorDbl = (arrayIn) => {\n  var vecOut = new exports.VectorDouble();\n  for (var i = 0; i < arrayIn.length; i++) {\n    vecOut.push_back(arrayIn[i]);\n  }\n  return vecOut;\n};\n\nexport const getBase64 = (str) => {\n  //check if the string is a data URI\n  if (str.indexOf(';base64,') !== -1) {\n    //see where the actual data begins\n    var dataStart = str.indexOf(';base64,') + 8;\n    //check if the data is base64-encoded, if yes, return it\n    // taken from\n    // http://stackoverflow.com/a/8571649\n    return str.slice(dataStart).match(/^([A-Za-z0-9+\\/]{4})*([A-Za-z0-9+\\/]{4}|[A-Za-z0-9+\\/]{3}=|[A-Za-z0-9+\\/]{2}==)$/) ? str.slice(dataStart) : false;\n  } else return false;\n};\n\nexport const _keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n\nexport const removePaddingFromBase64 = (input) => {\n  var lkey = Module.maxiTools._keyStr.indexOf(input.charAt(input.length - 1));\n  if (lkey === 64) {\n    return input.substring(0, input.length - 1);\n  }\n  return input;\n};\n\n\nexport const loadSampleToArray = (audioContext, sampleObjectName, url, audioWorkletNode) => {\n  var data = [];\n\n  var context = audioContext;\n\n  //check if url is actually a base64-encoded string\n  var b64 = getBase64(url);\n  if (b64) {\n    //convert to arraybuffer\n    //modified version of this:\n    // https://github.com/danguer/blog-examples/blob/master/js/base64-binary.js\n    var ab_bytes = (b64.length / 4) * 3;\n    var arrayBuffer = new ArrayBuffer(ab_bytes);\n\n    b64 = removePaddingFromBase64(removePaddingFromBase64(b64));\n\n    var bytes = parseInt((b64.length / 4) * 3, 10);\n\n    var uarray;\n    var chr1, chr2, chr3;\n    var enc1, enc2, enc3, enc4;\n    var i = 0;\n    var j = 0;\n\n    uarray = new Uint8Array(arrayBuffer);\n\n    b64 = b64.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n    for (i = 0; i < bytes; i += 3) {\n      //get the 3 octects in 4 ascii chars\n      enc1 = _keyStr.indexOf(b64.charAt(j++));\n      enc2 = _keyStr.indexOf(b64.charAt(j++));\n      enc3 = _keyStr.indexOf(b64.charAt(j++));\n      enc4 = _keyStr.indexOf(b64.charAt(j++));\n\n      chr1 = (enc1 << 2) | (enc2 >> 4);\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n      chr3 = ((enc3 & 3) << 6) | enc4;\n\n      uarray[i] = chr1;\n      if (enc3 !== 64) {\n        uarray[i + 1] = chr2;\n      }\n      if (enc4 !== 64) {\n        uarray[i + 2] = chr3;\n      }\n    }\n\n    // https://webaudio.github.io/web-audio-api/#dom-baseaudiocontext-decodeaudiodata\n    // Asynchronously decodes the audio file data contained in the ArrayBuffer.\n    audioContext.decodeAudioData(\n      arrayBuffer, // has its content-type determined by sniffing\n      function (buffer) { // successCallback, argument is an AudioBuffer representing the decoded PCM audio data.\n        // source.buffer = buffer;\n        // source.loop = true;\n        // source.start(0);\n        let float32ArrayBuffer = buffer.getChannelData(0);\n        if (data !== undefined && audioWorkletNode !== undefined) {\n          // console.log('f32array: ' + float32Array);\n          audioWorkletNode.port.postMessage({\n            \"sample\":sampleObjectName,\n            \"buffer\": float32ArrayBuffer,\n          });\n        }\n      },\n      function (buffer) { // errorCallback\n        console.log(\"Error decoding source!\");\n      }\n    );\n  } else {\n    // Load asynchronously\n    // NOTE: This is giving me an error\n    // Uncaught ReferenceError: XMLHttpRequest is not defined (index):97 MaxiProcessor Error detected: undefined\n    // NOTE: followed the trail to the wasmmodule.js\n    // when loading on if (typeof XMLHttpRequest !== 'undefined') {\n    // throw new Error(\"Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers.\n    // Use --embed-file or --preload-file in emcc on the main thread.\");\n    var request = new XMLHttpRequest();\n    request.addEventListener(\"load\", () =>\n\t\t\tconsole.info(`loading sample '${sampleObjectName}'`)\n\t\t);\n    request.open(\"GET\", url, true);\n    request.responseType = \"arraybuffer\";\n    request.onload = function () {\n      audioContext.decodeAudioData(\n        request.response,\n        function (buffer) {\n          let float32ArrayBuffer = buffer.getChannelData(0);\n          if (data !== undefined && audioWorkletNode !== undefined) {\n            // console.log('f32array: ' + float32Array);\n            audioWorkletNode.port.postMessage({\n              \"sample\":sampleObjectName,\n              \"buffer\": float32ArrayBuffer,\n            });\n          }\n        },\n        function (buffer) {\n          console.log(\"Error decoding source!\");\n        }\n      );\n    };\n    request.send();\n  }\n  return \"Loading module\";\n};\n\n/**\n * @buildWorkletStringForBlob\n */\nexport const buildWorkletStringForBlob = (userDefinedFunction) => {\n\t// let = \"\";\n\t// switch (expression % 2) {\n\t// \tcase 0:\n\t// \t\tuserDefinedFunction = `Math.random() * 2`;\n\t// \t\tbreak;\n\t// \tcase 1:\n\t// \t\tuserDefinedFunction = `(Math.sin(400) + 0.4)`;\n\t// \t\tbreak;\n\t// \tdefault:\n\t// \t\tuserDefinedFunction = `(Math.sin(440) + 0.4)`;\n\t// }\n\n\t// We get an \"Error on loading worklet:  DOMException\" with the following import:\n\t// import Module from './maximilian.wasmmodule.js';\n\treturn `\n      import Module from './maximilian.wasmmodule.js';\n      cwlass CustomProcessor extends AudioWorkletProcessor {\n        static get parameterDescriptors() {\n          return [{\n            name: 'gain',\n            defaultValue: 0.1\n          }];\n        }\n        constructor() {\n          super();\n          this.sampleRate = 44100;\n\n          this.port.onmessage = (event) => {\n            console.log(event.data);\n          };\n\n        }\n        process(inputs, outputs, parameters) {\n\n          const outputsLength = outputs.length;\n          for (let outputId = 0; outputId < outputsLength; ++outputId) {\n            let output = outputs[outputId];\n            const channelLenght = output.length;\n\n            for (let channelId = 0; channelId < channelLenght; ++channelId) {\n              const gain = parameters.gain;\n              const isConstant = gain.length === 1\n              let outputChannel = output[channelId];\n\n              for (let i = 0; i < outputChannel.length; ++i) {\n                const amp = isConstant ? gain[0] : gain[i]\n                outputChannel[i] = ${userDefinedFunction} * amp;\n              }\n            }\n          }\n          return true;\n        }\n      }`;\n};\n\n/**\n * @createAndRegisterCustomProcessorCode\n */\nexport const createAndRegisterCustomProcessorCode = (il2pCode, processorName) => {\n\n  return `${il2pCode}\n\n    registerProcessor(\"${processorName}\", CustomProcessor);`;\n}\n\n/**\n * @buildWorkletStringForBlob\n */\nexport const buildWorkletFromBlob = () => {\n  // console.log('processorCount: ' + this.processorCount);\n  // // const userCode = editor.getDoc().getValue();\n  // const processorName = `processor-${this.processorCount}`;\n\n  // this.il2pCode = this.translateIntermediateLanguageToProcessorCode(this.processorCount);\n\n  // const code = this.createAndRegisterCustomProcessorCode(this.il2pCode, processorName);\n\n  // console.log(code);\n\n  // const blob = new Blob([code], {\n  //   type: \"application/javascript; charset=utf-8\",\n  // });\n\n  return blob;\n}\n\n/**\n * TODO: Check for memory leaks\n * @runProcessorCode\n */\n// export const runProcessorCode = () => {\n//   // TODO: Check for memory leaks\n//   // URL.revokeObjectURL()\n//   const workletUrl = window.URL.createObjectURL(blob);\n\n//   // Set custom processor in audio worklet\n//   this.audioContext.audioWorklet.addModule(workletUrl).then(() => {\n//     this.stop();\n//     this.customNode = new CustomAudioNode(this.audioContext, processorName);\n//     this.customNode.port.onmessage = (event) => {\n//       //  data from the processor.\n//       console.log(\"from processor: \" + event.data);\n//     };\n//     this.customNode.connect(this.audioContext.destination);\n//   }).catch(e => console.log(\"Error on loading worklet: \", e));\n// }\n\n\nexport const generateNoiseBuffer = (length) => {\n  var bufferData = new Module.VectorDouble();\n  for (var n = 0; n < length; n++) {\n    bufferData.push_back(Math.random(1));\n  }\n  return bufferData;\n}\n\n\nexport const translateBlobToBuffer = (blob) => {\n\n  let arrayBuffer = null;\n  let float32Array = null;\n  var fileReader = new FileReader();\n  fileReader.onload = function (event) {\n    arrayBuffer = event.target.result;\n    float32Array = new Float32Array(arrayBuffer);\n  };\n  fileReader.readAsArrayBuffer(blob);\n  let audioFloat32Array = fileReader.result;\n  var maxiSampleBufferData = new Module.VectorDouble();\n  for (var i = 0; i < audioFloat32Array.length; i++) {\n    maxiSampleBufferData.push_back(audioFloat32Array[i]);\n  }\n  return maxiSampleBufferData;\n}\n","export default class Event {\n\tconstructor(eventName) {\n\t\tthis.eventName = eventName;\n\t\tthis.callbacks = [];\n\t}\n\n\tregisterCallback(callback) {\n    this.callbacks.push(callback);\n\t}\n\n\tunregisterCallback(callback) {\n    const index = this.callbacks.indexOf(callback);\n\t\tif (index > -1) {\n\t\t\tthis.callbacks.splice(index, 1);\n\t\t}\n\t}\n\n\temit(data) {\n    const callbacks = this.callbacks.slice(0);\n\t\tcallbacks.forEach( callback => {\n\t\t\tcallback(data);\n\t\t});\n\t}\n}\n","import Event from './event.js';\n\nexport default class Dispatcher {\n\n  constructor() {\n\t\tthis.events = {};\n\t}\n\n\tdispatch(eventName, data) {\n\t\t// console.log(\"dispatch is getting called.\");\n\t\tconst event = this.events[eventName];\n\t\t//let event = Event()\n\n\t\t// console.log(\"event\", this.events, \"data\", data);\n\t\t// console.log(\"data\", data, event);\n\t\tif (event) {\n\t\t\t// console.log(\"data being emitted\", data)\n\t\t\tevent.emit(data);\n\t\t}\n\t}\n\n\taddEventListener(eventName, callback) {\n\t\tlet event = this.events[eventName];\n\t\tif (!event) {\n\t\t\tevent = new Event(eventName);\n\t\t\tthis.events[eventName] = event;\n\t\t}\n\t\tevent.registerCallback(callback);\n\t}\n\n\tremoveEventListener(eventName, callback) {\n\t\tconst event = this.events[eventName];\n\t\tif (event && event.callbacks.indexOf(callback) > -1) {\n\t\t\tevent.unregisterCallback(callback);\n\t\t\tif (event.callbacks.length === 0) {\n\t\t\t\tdelete this.events[eventName];\n\t\t\t}\n\t\t}\n\t}\n}\n","import Dispatcher from './dispatcher.js';\n\n// var cl, ci, cw, ce;\n\nexport class Logger {\n\t/**\n\t * @constructor\n\t */\n\tconstructor() {\n\t\tif (Logger.instance) {\n\t\t\treturn Logger.instance; // Singleton pattern\n\t\t}\n\t\tLogger.instance = this;\n\n\t\tthis.log = [];\n\t\tthis.rawLog = \"\"; //raw log of string data\n\n\t\tthis.dispatcher = new Dispatcher();\n\t}\n\n\n\n\t//pass in svelte store, of log\n\t// setStore(storeLog){\n\t// \tstoreLog.set = this.rawLog;\n\t// }\n\n\taddEventListener(event, callback) {\n\t\t// console.log(\"registering\", event, callback);\n\t\tif (this.dispatcher && event && callback) {\n\t\t\tthis.dispatcher.addEventListener(event, callback);\n\t\t\t// console.log(\"registered\");\n\t\t} else throw new Error(\"Error adding event listener to Logger\");\n\t}\n\n\tpush(data) {\n\t\tthis.log.push(data);\n\t\tthis.rawLog =\n\t\tthis.rawLog + \"\\n\" + data.type + \" \" + [...data.payload].join();\n\t\tthis.dispatcher.dispatch(\"onLog\");\n\t\t//console.log(\"getting dispatched\", this.rawLog);\n\t\t//this.dispatcher.dispatch(\"onConsoleLogsUpdate\", {test:10});\n\t}\n\n\t//console.log = overrideConsoleLog();\n\n\ttakeOverConsole() {\n\t\tif (window.console) {\n// this.onMessageHandler.bind(this);\n\t\t\tlet cl, ci, cw, ce;\n\n\t\t\tif (window.console.log) cl = console.log;\n\t\t\tif (window.console.info) ci = console.info;\n\t\t\tif (window.console.warn) cw = console.warn;\n\t\t\tif (window.console.error) ce = console.error;\n\t\t\tif (cl && ci && cw && ce) {\n\t\t\t\tcw(\"taking over MAIN console\");\n\n\t\t\t\tconsole.log = function (text) {\n\t\t\t\t\tthis.push({\n\t\t\t\t\t\tfunc: \"logs\",\n\t\t\t\t\t\tpayload: [...arguments],\n\t\t\t\t\t\ttype: \"[MAIN]\",\n\t\t\t\t\t});\n\t\t\t\t\tcl.apply(this, arguments);\n\t\t\t\t}.bind(this);\n\n\t\t\t\tconsole.info = function (text) {\n\t\t\t\t\tthis.push({\n\t\t\t\t\t\tfunc: \"logs\",\n\t\t\t\t\t\tpayload: [...arguments],\n\t\t\t\t\t\ttype: \"[MAIN]\",\n\t\t\t\t\t});\n\t\t\t\t\tci.apply(this, arguments);\n\t\t\t\t}.bind(this);\n\n\t\t\t\tconsole.warn = function (text) {\n\t\t\t\t\t// window.postMessage({\n\t\t\t\t\tthis.push({\n\t\t\t\t\t\tfunc: \"logs\",\n\t\t\t\t\t\tpayload: [...arguments],\n\t\t\t\t\t\ttype: \"[MAIN]\",\n\t\t\t\t\t});\n\t\t\t\t\tcw.apply(this, arguments);\n\t\t\t\t}.bind(this);\n\n\t\t\t\tconsole.error = function (text) {\n\t\t\t\t\t// window.postMessage({\n\t\t\t\t\tthis.push({\n\t\t\t\t\t\tfunc: \"logs\",\n\t\t\t\t\t\tpayload: [...arguments],\n\t\t\t\t\t\ttype: \"[MAIN]\",\n\t\t\t\t\t});\n\t\t\t\t\tce.apply(this, arguments);\n\t\t\t\t}.bind(this);\n\n\t\t\t\tce(\"MAIN console taken over\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// takeOverConsole(f) {\n\t// \tif (f) {\n\t// \t\ttry {\n\t// \t\t\tvar original = window.console;\n\n\t// \t\t\tfunction handle(method, args) {\n\t// \t\t\t\tvar message = Array.prototype.slice.apply(args).join(\" \");\n\t// \t\t\t\tif (original) original[method](\"> \" + message);\n\t// \t\t\t}\n\n\t// \t\t\twindow.console = {\n\t// \t\t\t\tlog: function () {\n\t// \t\t\t\t\thandle(\"log\", arguments);\n\t// \t\t\t\t},\n\t// \t\t\t\twarn: function () {\n\t// \t\t\t\t\thandle(\"warn\", arguments);\n\t// \t\t\t\t},\n\t// \t\t\t\terror: function () {\n\t// \t\t\t\t\thandle(\"error\", arguments);\n\t// \t\t\t\t},\n\t// \t\t\t\tinfo: function () {\n\t// \t\t\t\t\thandle(\"info\", arguments);\n\t// \t\t\t\t},\n\t// \t\t\t};\n\t// \t\t} catch (error) {\n\t// \t\t\tconsole.error(error);\n\t// \t\t}\n\t// \t}\n\t// }\n}\n","// NOTE: this imports RingBuffer directly from node_modules\n// which is different from maxi-processor that\n// dynamically loads from the adjacent ringBuf.js file\nimport { RingBuffer } from 'ringbuf.js'; //thanks padenot\nimport { loadSampleToArray } from './maximilian.util.js';\nimport { Logger } from \"../common/logger.js\";\nimport Dispatcher from '../common/dispatcher.js';\n// import { isThisTypeNode } from 'typescript';\n// import {\n//   kuramotoNetClock\n// } from './interfaces/clockInterface.js';\n// import {\n//   PeerStreaming\n// } from '../interfaces/peerStreaming.js';\n\n/**\n * The CustomMaxiNode is a class that extends AudioWorkletNode\n * to hold an Custom Audio Worklet Processor and connect to Web Audio graph\n * @class CustomMaxiNode\n * @extends AudioWorkletNode\n */\n// if(true){\nclass CustomMaxiNode extends AudioWorkletNode {\n  constructor(audioContext, processorName) {\n    // super(audioContext, processorName);\n    // console.log();\n    let options = {\n      numberOfInputs: 1,\n      numberOfOutputs: 1,\n      outputChannelCount: [audioContext.destination.maxChannelCount]\n    };\n    super(audioContext, processorName, options);\n  }\n}\n// }\n\n/**\n * The Engine is a singleton class that encapsulates the AudioContext\n * and all WASM and Maximilian -powered Audio Worklet Processor\n * @class AudioEngine\n * TODO more error handling\n * TODO more checking of arguments passed to methods\n * TODO optimise performance, especially on analysers which are pumping data continuously\n */\nexport class Engine {\n\t/**\n\t * @constructor\n\t */\n\tconstructor() {\n\t\tif (Engine.instance) {\n\t\t\treturn Engine.instance; // Singleton pattern\n\t\t}\n\t\tEngine.instance = this;\n\n\t\tthis.origin = \"\";\n\n\t\tthis.learners = {};\n\n\t\t// Hash of on-demand analysers (e.g. spectrogram, oscilloscope)\n\t\t// NOTE: analysers serialized to localStorage are de-serialized\n\t\t// and loaded from localStorage before user-triggered audioContext init\n\t\tthis.analysers = {};\n\n\t\tthis.mediaStreamSource = {};\n\t\tthis.mediaStream = {};\n\n\t\t// Shared array buffers for sharing client side data to the audio engine- e.g. mouse coords\n\t\tthis.sharedArrayBuffers = {};\n\n\t\t// Event emitter that should be subscribed by SAB receivers\n\t\tthis.dispatcher = new Dispatcher();\n\t\tthis.logger = new Logger();\n\n\t\tthis.samplesLoaded = false;\n    this.isHushed = false;\n\t}\n\n\t/**\n\t * Add learner instance\n\t */\n\tasync addLearner(id, learner) {\n\t\tif (learner) {\n\t\t\ttry {\n\t\t\t\t// `this` is the scope that will\n\t\t\t\tawait learner.init(this.origin);\n\n\t\t\t\tthis.addEventListener(\"onSharedBuffer\", (e) =>\n\t\t\t\t\tlearner.addSharedBuffer(e)\n\t\t\t\t); // Engine's SAB emissions subscribed by Learner\n\n\t\t\t\tlearner.addEventListener(\"onSharedBuffer\", (e) =>\n\t\t\t\t\tthis.addSharedBuffer(e)\n\t\t\t\t); // Learner's SAB emissions subscribed by Engine\n\n\t\t\t\tthis.learners[id] = learner;\n\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Error adding Learner to Engine: \", error);\n\t\t\t}\n\t\t} else throw new Error(\"Error adding Learner instance to Engine\");\n\t}\n\n\tremoveLearner(id) {\n\t\tif (id){\n\t\t\tif (this.learners && ( id in this.learners ) ) {\n\t\t\t\tlet learner = this.learners[id];\n\t\t\t\tlearner.removeEventListener(\"onSharedBuffer\", (e) =>\n\t\t\t\t\tthis.addSharedBuffer(e)\n\t\t\t\t);\n\t\t\t\tlearner = null;\n\t\t\t\tdelete this.learners[id];\n\t\t\t}\n\t\t\t// else throw new Error(\"Error removing Learner from Engine: \");\n\t\t} else throw new Error(\"Error with learner ID when removing Learner from Engine\");\n\t}\n\n\t/**\n\t * Engine's event subscription\n\t * @addEventListener\n\t * @param {*} event\n\t * @param {*} callback\n\t */\n\taddEventListener(event, callback) {\n\t\tif (this.dispatcher && event && callback)\n\t\t\tthis.dispatcher.addEventListener(event, callback);\n\t\telse throw new Error(\"Error adding event listener to Engine\");\n\t}\n\n\t/* #region SharedBuffers */\n\n\t/**\n\t * Create a shared array buffer for communicating with the audio engine\n\t * @param channelId\n\t * @param ttype\n\t * @param blocksize\n\t */\n\tcreateSharedBuffer(channelId, ttype, blocksize) {\n\t\tlet sab = RingBuffer.getStorageForCapacity(32 * blocksize, Float64Array);\n\t\tlet ringbuf = new RingBuffer(sab, Float64Array);\n\n\t\tthis.audioWorkletNode.port.postMessage({\n\t\t\tfunc: \"sab\",\n\t\t\tvalue: sab,\n\t\t\tttype: ttype,\n\t\t\tchannelID: channelId,\n\t\t\tblocksize: blocksize,\n\t\t});\n\n\t\tthis.sharedArrayBuffers[channelId] = {\n\t\t\tsab: sab, // TODO: this is redundant, you can access the sab from the rb,\n\t\t\t// TODO change hashmap name it is confusing and induces error\n\t\t\trb: ringbuf,\n\t\t};\n\n\t\treturn sab;\n\t}\n\n\t/**\n\t * Push data to shared array buffer for communicating with the audio engine and ML worker\n\t * @param {*} e\n\t */\n\taddSharedBuffer(e) {\n\t\tif (e) {\n\t\t\tif (e.value && e.value instanceof SharedArrayBuffer) {\n\t\t\t\ttry {\n\t\t\t\t\tlet ringbuf = new RingBuffer(e.value, Float64Array);\n\t\t\t\t\tthis.audioWorkletNode.port.postMessage({\n\t\t\t\t\t\tfunc: \"sab\",\n\t\t\t\t\t\tvalue: e.value,\n\t\t\t\t\t\tttype: e.ttype,\n\t\t\t\t\t\tchannelID: e.channelID,\n\t\t\t\t\t\tblocksize: e.blocksize,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.sharedArrayBuffers[e.channelID] = {\n\t\t\t\t\t\tsab: e.value, // TODO this is redundant, you can access the sab from the rb,\n\t\t\t\t\t\t// TODO also change hashmap name it is confusing and induces error\n\t\t\t\t\t\trb: ringbuf,\n\t\t\t\t\t};\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error(\"Error pushing SharedBuffer to engine\");\n\t\t\t\t}\n\t\t\t} else if (e.name && e.data) {\n\t\t\t\tthis.audioWorkletNode.port.postMessage({\n\t\t\t\t\tfunc: \"sendbuf\",\n\t\t\t\t\tname: e.name,\n\t\t\t\t\tdata: e.data,\n\t\t\t\t});\n\t\t\t}\n\t\t} else throw new Error(\"Error with onSharedBuffer event\");\n\t}\n\n\t/**\n\t * Push data to shared array buffer for communicating with the audio engine and ML worker\n\t * @param {*} e\n\t * @param {*} channelId\n\t */\n\tpushDataToSharedBuffer(channelId, data) {\n\t\tif (channelId && data && typeof Array.isArray(data)) {\n\t\t\tif (this.sharedArrayBuffers && this.sharedArrayBuffers[channelId]) {\n\t\t\t\tthis.sharedArrayBuffers[channelId].rb.push(data);\n\t\t\t}\n\t\t} else throw new Error(\"Error in function parameters\");\n\t}\n\n\t/* #region Analysers */\n\n\t/**\n\t * Polls data from connected WAAPI analyser return structured object with data and time data in arrays\n\t * @param {*} analyser\n\t */\n\tpollAnalyserData(analyser) {\n\t\tif (analyser !== undefined) {\n\t\t\tconst timeDataArray = new Uint8Array(analyser.fftSize); // Uint8Array should be the same length as the fftSize\n\t\t\tconst frequencyDataArray = new Uint8Array(analyser.fftSize);\n\n\t\t\tanalyser.getByteTimeDomainData(timeDataArray);\n\t\t\tanalyser.getByteFrequencyData(frequencyDataArray);\n\n\t\t\treturn {\n\t\t\t\tsmoothingTimeConstant: analyser.smoothingTimeConstant,\n\t\t\t\tfftSize: analyser.fftSize,\n\t\t\t\tfrequencyDataArray: frequencyDataArray,\n\t\t\t\ttimeDataArray: timeDataArray,\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Creates a WAAPI analyser node\n\t * @todo configuration object as argumen\n\t * @createAnalyser\n\t */\n\tcreateAnalyser(analyserID, callback) {\n\t\t// If Analyser creation happens after AudioContext intialization, create and connect WAAPI analyser\n\t\tif (analyserID && callback){\n      if(this.audioContext && this.audioWorkletNode ) {\n\n        let analyser = this.audioContext.createAnalyser();\n        analyser.smoothingTimeConstant = 0.25;\n        analyser.fftSize = 256; // default 2048;\n        analyser.minDecibels = -90; // default\n        analyser.maxDecibels = -0; // default -10; max 0\n        this.audioWorkletNode.connect(analyser);\n\n        let analyserFrameId = -1,\n            analyserData = {};\n\n        this.analysers[analyserID] = {\n          analyser,\n          analyserFrameId,\n          callback,\n        };\n\n        /**\n         * Creates requestAnimationFrame loop for polling data and publishing\n         * Returns Analyser Frame ID for adding to Analysers hash\n         * and cancelling animation frame\n         */\n        const analyserPollingLoop = () => {\n          analyserData = this.pollAnalyserData(\n            this.analysers[analyserID].analyser\n          );\n          this.analysers[analyserID].callback(analyserData); // Invoke callback that carries\n          // This will guarantee feeding poll request at steady animation framerate\n          this.analysers[analyserID].analyserFrameId = requestAnimationFrame(\n            analyserPollingLoop\n          );\n          return analyserFrameId;\n        };\n\n\t\t\t\tconsole.info(\"Created analyser\");\n\n        analyserPollingLoop();\n\n\t\t\t// Other if AudioContext is NOT created yet (after app load, before splashScreen click)\n      } else {\n        this.analysers[analyserID] = { callback };\n      }\n    } else throw new Error('Parameters to createAnalyser incorrect')\n\t}\n\n\t/**\n\t * Connects WAAPI analyser nodes to the main audio worklet for visualisation.\n\t * @connectAnalysers\n\t */\n\tconnectAnalysers() {\n\t\tObject.keys(this.analysers).map((id) =>\n\t\t\tthis.createAnalyser(id, this.analysers[id].callback)\n\t\t);\n\t}\n\n\t/**\n\t * Removes a WAAPI analyser node, disconnects graph, cancels animation frame, deletes from hash\n\t * @removeAnalyser\n\t */\n\tremoveAnalyser(event) {\n\t\tif ( this.audioContext && this.audioWorkletNode ) {\n\t\t\tlet analyser = this.analysers[event.id];\n\t\t\tif (analyser !== undefined) {\n\t\t\t\tcancelAnimationFrame(this.analysers[event.id].analyserFrameId);\n\t\t\t\tdelete this.analysers[event.id];\n\t\t\t\t// this.audioWorkletNode.disconnect(analyser);\n\t\t\t}\n\t\t}\n\t}\n\n\t/* #endregion */\n\n\t/**\n\t * Initialises audio context and sets worklet processor code\n\t * @play\n\t */\n\tasync init(origin) {\n\t\tif (origin && new URL(origin)) {\n\n      let isWorkletProcessorLoaded;\n\n      try{\n        // AudioContext needs lazy loading to workaround the Chrome warning\n        // Audio Engine first play() call, triggered by user, prevents the warning\n        // by setting this.audioContext = new AudioContext();\n        this.audioContext;\n        this.origin = origin;\n        this.audioWorkletName = \"maxi-processor\";\n        this.audioWorkletUrl = origin + \"/\" + this.audioWorkletName + \".js\";\n\n        if (this.audioContext === undefined) {\n          this.audioContext = new AudioContext({\n            // create audio context with latency optimally configured for playback\n            latencyHint: \"playback\",\n            // latencyHint: 32/44100,  //this doesn't work below 512 on chrome (?)\n            // sampleRate: 48000\n          });\n        }\n\n        isWorkletProcessorLoaded = await this.loadWorkletProcessorCode();\n\t\t\t\tconsole.log(\"Processor loaded\")\n      }\n      catch(err){\n        return false;\n      }\n\n\t\t\tif (isWorkletProcessorLoaded) {\n\n\t\t\t\tthis.connectWorkletNode();\n\n\n\n\t\t\t\treturn true;\n\t\t\t} else return false;\n\n\t\t\t// No need to inject the callback here, messaging is built in KuraClock\n\t\t\t// this.kuraClock = new kuramotoNetClock((phase, idx) => {\n\t\t\t//   // console.log( `DEBUG:AudioEngine:sendPeersMyClockPhase:phase:${phase}:id:${idx}`);\n\t\t\t//   // This requires an initialised audio worklet\n\t\t\t//   this.audioWorkletNode.port.postMessage({ phase: phase, i: idx });\n\t\t\t// });\n\t\t\t// if (this.kuraClock.connected()) {\n\t\t\t// \tthis.kuraClock.queryPeers(async numClockPeers => {\n\t\t\t// \t\tconsole.log(`DEBUG:AudioEngine:init:numClockPeers: ${numClockPeers}`);\n\t\t\t// \t});\n\t\t\t// }\n\t\t} else {\n\t\t\tthrow new Error(\"Name and valid URL required for AudioWorklet processor\");\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Initialises audio context and sets worklet processor code\n\t * or re-starts audio playback by stopping and running the latest Audio Worklet Processor code\n\t * @play\n\t */\n\tplay() {\n\t\tif (this.audioContext !== undefined) {\n\t\t\tif (this.audioContext.state === \"suspended\") {\n\t\t\t\tthis.audioContext.resume();\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tthis.hush();\n\t\t\t\t// this.stop();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Suspends AudioContext (Pause)\n\t * @stop\n\t */\n\tstop() {\n\t\tif (this.audioWorkletNode !== undefined) {\n\t\t\tthis.hush();\n\t\t\t// this.audioContext.suspend();\n\t\t}\n\t}\n\n\t/**\n\t * Stops audio by disconnecting AudioNode with AudioWorkletProcessor code\n\t * from Web Audio graph TODO Investigate when it is best to just STOP the graph exectution\n\t * @stop\n\t */\n\tstopAndRelease() {\n\t\tif (this.audioWorkletNode !== undefined) {\n\t\t\tthis.audioWorkletNode.disconnect(this.audioContext.destination);\n\t\t\tthis.audioWorkletNode = undefined;\n\t\t}\n\t}\n\n\tsetGain(gain) {\n\t\tif (this.audioWorkletNode !== undefined && gain >= 0 && gain <= 1) {\n\t\t\tconst gainParam = this.audioWorkletNode.parameters.get(\"gain\");\n\t\t\tgainParam.value = gain;\n\t\t\tconsole.log(gainParam.value); // DEBUG\n\t\t\treturn true;\n\t\t} else return false;\n\t}\n\n\tmore() {\n\t\tif (this.audioWorkletNode !== undefined) {\n\t\t\tconst gainParam = this.audioWorkletNode.parameters.get(\"gain\");\n\t\t\tgainParam.value += 0.05;\n\t\t\tconsole.info(gainParam.value); // DEBUG\n\t\t\treturn gainParam.value;\n\t\t} else throw new Error(\"error increasing sound level\");\n\t}\n\n\tless() {\n\t\tif (this.audioWorkletNode !== undefined) {\n\t\t\tconst gainParam = this.audioWorkletNode.parameters.get(\"gain\");\n\t\t\tgainParam.value -= 0.05;\n\t\t\tconsole.info(gainParam.value); // DEBUG\n\t\t\treturn gainParam.value;\n\t\t} else throw new Error(\"error decreasing sound level\");\n\t}\n\n\thush() {\n\t\tif (this.audioWorkletNode !== undefined) {\n\t\t\tthis.audioWorkletNode.port.postMessage({\n\t\t\t\thush: 1,\n\t\t\t});\n      this.isHushed = true;\n\t\t\treturn true;\n\t\t} else return false;\n\t}\n\n\tunHush() {\n\t\tif (this.audioWorkletNode !== undefined) {\n\t\t\tthis.audioWorkletNode.port.postMessage({\n\t\t\t\tunhush: 1,\n\t\t\t});\n      this.isHushed = false;\n\t\t\treturn true;\n\t\t} else return false;\n\t}\n\n\teval(dspFunction) {\n\t\tif (this.audioWorkletNode && this.audioWorkletNode.port) {\n\t\t\tif (this.audioContext.state === \"suspended\") {\n\t\t\t\tthis.audioContext.resume();\n\t\t\t}\n\t\t\tthis.audioWorkletNode.port.postMessage({\n\t\t\t\teval: 1,\n\t\t\t\tsetup: dspFunction.setup,\n\t\t\t\tloop: dspFunction.loop,\n\t\t\t});\n      this.isHushed = false;\n\t\t\treturn true;\n\t\t} else return false;\n\t}\n\n\t/**\n\t * Handler of the Pub/Sub message events\n\t * whose topics are subscribed to in the audio engine constructor\n\t * @asyncPostToProcessor\n\t * @param {*} event\n\t */\n\tasyncPostToProcessor(event) {\n\t\tif (event && this.audioWorkletNode && this.audioWorkletNode.port) {\n\t\t\t// Receive notification from 'model-output-data' topic\n\t\t\tconsole.log(\"DEBUG:AudioEngine:onMessagingEventHandler:\");\n\t\t\tconsole.log(event);\n\t\t\tthis.audioWorkletNode.port.postMessage(event);\n\t\t} else throw new Error(\"Error async posting to processor\");\n\t}\n\n\tsendClockPhase(phase, idx) {\n\t\tif (this.audioWorkletNode !== undefined) {\n\t\t\tthis.audioWorkletNode.port.postMessage({\n\t\t\t\tphase: phase,\n\t\t\t\ti: idx,\n\t\t\t});\n\t\t}\n\t}\n\n\tonAudioInputInit(stream) {\n    try {\n      this.mediaStreamSource = this.audioContext.createMediaStreamSource(stream);\n      this.mediaStreamSource.connect(this.audioWorkletNode);\n      this.mediaStream = stream;\n      this.mediaStreamSourceConnected = true;\n    } catch (error) {\n      console.error(error);\n    }\n\t}\n\n\tonAudioInputFail(error) {\n\t\tthis.mediaStreamSourceConnected = false;\n\t\tconsole.error(\n\t\t\t`ERROR:Engine:AudioInputFail: ${error.message} ${error.name}`\n\t\t);\n\t}\n\n\tonAudioInputDisconnect() {\n\n\t}\n\n\t/**\n\t * Sets up an AudioIn WAAPI sub-graph\n\t * @connectMediaStreamSourceInput\n\t */\n\tasync connectMediaStream() {\n\t\tconst constraints = ( window.constraints = {\n      audio: {\n        latency: 0.02,\n        echoCancellation: false,\n        mozNoiseSuppression: false,\n        mozAutoGainControl: false\n      },\n\t\t\tvideo: false,\n\t\t});\n    // onAudioInputDisconnect();\n\t\tawait navigator.mediaDevices\n\t\t\t.getUserMedia(constraints)\n\t\t\t.then( s => this.onAudioInputInit(s) )\n\t\t\t.catch(this.onAudioInputFail);\n\n\t\treturn this.mediaStreamSourceConnected;\n\t}\n\n\t/**\n\t * Breaks up an AudioIn WAAPI sub-graph\n\t * @disconnectMediaStreamSourceInput\n\t */\n\tasync disconnectMediaStream() {\n\n    try {\n\t\t\tthis.mediaStreamSource.disconnect(this.audioWorkletNode);\n\t\t\tthis.mediaStream.getAudioTracks().forEach((at) => at.stop());\n\t\t\tthis.mediaStreamSource = null;\n\t\t\tthis.mediaStreamSourceConnected = false;\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t}\n    finally {\n      return this.mediaStreamSourceConnected;\n    }\n\t\t// await navigator.mediaDevices\n\t\t// \t.getUserMedia(constraints)\n\t\t// \t.then((s) => this.onAudioInputDisconnect(s))\n\t\t// \t.catch(this.onAudioInputFail);\n\n\n\t}\n\n\t/**\n\t * Loads audioWorklet processor code into a worklet,\n\t * setups up all handlers (errors, async messaging, etc),\n\t * connects the worklet processor to the WAAPI graph\n\t */\n\tasync loadWorkletProcessorCode() {\n\t\tif (this.audioContext !== undefined) {\n\t\t\ttry {\n\t\t\t\tawait this.audioContext.audioWorklet.addModule(this.audioWorkletUrl)\n\t\t\t\t\t.then(\n\t\t\t\t\t\tconsole.info(\n\t\t\t\t\t\t\t\"running %csema-engine v0.1.0\",\n\t\t\t\t\t\t\t\"font-weight: bold; color: #ffb7c5\"\n\t\t\t\t\t\t\t// \"font-weight: bold; background: #000; color: #bada55\"\n\t\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t\"ERROR:Engine:loadWorkletProcessorCode: AudioWorklet not supported in this browser: \",\n\t\t\t\t\terr.message\n\t\t\t\t);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\t// Custom node constructor with required parameters\n\t\t\t\t// this.audioWorkletNode = new CustomMaxiNode(\n\t\t\t\tthis.audioWorkletNode = new AudioWorkletNode(\n\t\t\t\t\tthis.audioContext,\n\t\t\t\t\tthis.audioWorkletName\n\t\t\t\t);\n\n\t\t\t\tthis.audioWorkletNode.channelInterpretation = \"discrete\";\n\t\t\t\tthis.audioWorkletNode.channelCountMode = \"explicit\";\n\t\t\t\tthis.audioWorkletNode.channelCount = this.audioContext.destination.maxChannelCount;\n\n\t\t\t\treturn true;\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Error loading worklet processor code: \", err);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * connects all error event handlers and default processor message callback\n\t */\n\tconnectWorkletNode() {\n\t\tif (this.audioWorkletNode !== undefined) {\n\t\t\ttry {\n\t\t\t\tthis.audioContext.destination.channelInterpretation = \"discrete\";\n\t\t\t\tthis.audioContext.destination.channelCountMode = \"explicit\";\n\t\t\t\tthis.audioContext.destination.channelCount = this.audioContext.destination.maxChannelCount;\n\n\t\t\t\t// Connect the worklet node to the audio graph\n\t\t\t\tthis.audioWorkletNode.connect(this.audioContext.destination);\n\n\t\t\t\t// All possible error event handlers subscribed\n\t\t\t\tthis.audioWorkletNode.onprocessorerror = (e) =>\n\t\t\t\t\t// Errors from the processor\n\t\t\t\t\tconsole.error(`Engine processor error detected`, e);\n\n\t\t\t\t// Subscribe state changes in the audio worklet processor\n\t\t\t\tthis.audioWorkletNode.onprocessorstatechange = (e) =>\n\t\t\t\t\tconsole.info(\n\t\t\t\t\t\t`Engine processor state change: ` + audioWorkletNode.processorState\n\t\t\t\t\t);\n\n\t\t\t\t// Subscribe errors from the processor port\n\t\t\t\tthis.audioWorkletNode.port.onmessageerror = (e) =>\n\t\t\t\t\tconsole.error(`Engine processor port error: ` + e);\n\n\t\t\t\t// Default worklet processor message handler\n\t\t\t\t// gets replaced by user callback with 'subscribeAsyncMessage'\n\t\t\t\tthis.audioWorkletNode.port.onmessage = (e) =>\n\t\t\t\t\tthis.onProcessorMessageHandler(e);\n\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Error connecting WorkletNode: \", err);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Default worklet processor message handler\n\t * gets replaced by user-supplied callback through 'subscribeProcessorMessage'\n\t * @param {*} event\n\t */\n\tonProcessorMessageHandler(event) {\n\n\t\tif (event && event.data) {\n\t\t\tif (event.data.func === 'logs') {\n\t\t\t\tthis.logger.push(event.data); //recieve data from the worker.js and push it to the logger.\n\t\t\t}\n\t\t\telse if (event.data.rq && event.data.rq === \"send\") {\n\t\t\t\tswitch (event.data.ttype) {\n\t\t\t\t\tcase \"ML\":\n\t\t\t\t\t\t// this.messaging.publish(\"model-input-data\", {\n\t\t\t\t\t\t//   type: \"model-input-data\",\n\t\t\t\t\t\t//   value: event.data.value,\n\t\t\t\t\t\t//   ch: event.data.ch\n\t\t\t\t\t\t// });\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"NET\":\n\t\t\t\t\t\tthis.peerNet.send(\n\t\t\t\t\t\t\tevent.data.ch[0],\n\t\t\t\t\t\t\tevent.data.value,\n\t\t\t\t\t\t\tevent.data.ch[1]\n\t\t\t\t\t\t);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (event.data.rq && event.data.rq === \"buf\") {\n\t\t\t\tswitch (event.data.ttype) {\n\t\t\t\t\tcase \"ML\":\n\t\t\t\t\t\tthis.dispatcher.dispatch(\"onSharedBuffer\", {\n\t\t\t\t\t\t\tsab: event.data.value,\n\t\t\t\t\t\t\tchannelID: event.data.channelID, //channel ID\n\t\t\t\t\t\t\tblocksize: event.data.blocksize,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"scope\":\n\t\t\t\t\t\t// this.dispatcher.dispatch(\"onSharedBuffer\", {\n\t\t\t\t\t\t// \tsab: event.data.value,\n\t\t\t\t\t\t// \tchannelID: event.data.channelID, //channel ID\n\t\t\t\t\t\t// \tblocksize: event.data.blocksize,\n\t\t\t\t\t\t// });\n\n\t\t\t\t\t\tlet ringbuf = new RingBuffer(event.data.value, Float64Array);\n\n\t\t\t\t\t\tthis.sharedArrayBuffers[event.data.channelID] = {\n\t\t\t\t\t\t\tsab: event.data.value, // TODO: this is redundant, you can access the sab from the rb,\n\t\t\t\t\t\t\t// TODO change hashmap name it is confusing and induces error\n\t\t\t\t\t\t\trb: ringbuf,\n\t\t\t\t\t\t\tttype: event.data.ttype,\n\t\t\t\t\t\t\tchannelID: event.data.channelID, //channel ID\n\t\t\t\t\t\t\tblocksize: event.data.blocksize,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (event.data.rq && event.data.rq === \"rts\") { // ready to suspend\n\t\t  \tthis.audioContext.suspend();\n        this.isHushed = true;\n\t\t  }\n      else if (event.data instanceof Error){\n        // TODO use a logger to inject error\n        console.error(`On Processor Message ${event.data}`);\n      }\n\n\t\t}\n\t}\n\n\t/**\n\t * Public method for subscribing async messaging from the Audio Worklet Processor scope\n\t * @param callback\n\t */\n\tsubscribeProcessorMessage(callback) {\n\t\tif (callback && this.audioWorkletNode)\n\t\t\tthis.audioWorkletNode.port.onmessage = callback;\n\t\telse throw new Error(\"Error subscribing processor message\");\n\t}\n\n\t/**\n\t * Load individual audio sample, assuming an origin URL with which the engine\n\t * is initialised\n\t * @param {*} objectName name of the sample\n\t * @param {*} url relative URL to the origin URL, startgin with `/`\n\t */\n\tloadSample(objectName, url) {\n\t\tif (this.audioContext && this.audioWorkletNode) {\n\t\t\tif (\n\t\t\t\turl &&\n\t\t\t\turl.length !== 0 &&\n\t\t\t\tthis.origin &&\n\t\t\t\tthis.origin.length !== 0 &&\n\t\t\t\tnew URL(this.origin + url)\n\t\t\t) {\n\t\t\t\ttry {\n\t\t\t\t\tloadSampleToArray(\n\t\t\t\t\t\tthis.audioContext,\n\t\t\t\t\t\tobjectName,\n\t\t\t\t\t\tthis.origin + url,\n\t\t\t\t\t\tthis.audioWorkletNode\n\t\t\t\t\t);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t`Error loading sample ${objectName} from ${url}: `,\n\t\t\t\t\t\terror\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else throw \"Problem with sample relative URL\";\n\t\t} else throw \"Engine is not initialised!\";\n\t}\n}\n","(function(root, factory) {\n    if (typeof module === 'object' && module.exports) {\n        module.exports = factory();\n    } else {\n        root.nearley = factory();\n    }\n}(this, function() {\n\n    function Rule(name, symbols, postprocess) {\n        this.id = ++Rule.highestId;\n        this.name = name;\n        this.symbols = symbols;        // a list of literal | regex class | nonterminal\n        this.postprocess = postprocess;\n        return this;\n    }\n    Rule.highestId = 0;\n\n    Rule.prototype.toString = function(withCursorAt) {\n        var symbolSequence = (typeof withCursorAt === \"undefined\")\n                             ? this.symbols.map(getSymbolShortDisplay).join(' ')\n                             : (   this.symbols.slice(0, withCursorAt).map(getSymbolShortDisplay).join(' ')\n                                 + \" ● \"\n                                 + this.symbols.slice(withCursorAt).map(getSymbolShortDisplay).join(' ')     );\n        return this.name + \" → \" + symbolSequence;\n    }\n\n\n    // a State is a rule at a position from a given starting point in the input stream (reference)\n    function State(rule, dot, reference, wantedBy) {\n        this.rule = rule;\n        this.dot = dot;\n        this.reference = reference;\n        this.data = [];\n        this.wantedBy = wantedBy;\n        this.isComplete = this.dot === rule.symbols.length;\n    }\n\n    State.prototype.toString = function() {\n        return \"{\" + this.rule.toString(this.dot) + \"}, from: \" + (this.reference || 0);\n    };\n\n    State.prototype.nextState = function(child) {\n        var state = new State(this.rule, this.dot + 1, this.reference, this.wantedBy);\n        state.left = this;\n        state.right = child;\n        if (state.isComplete) {\n            state.data = state.build();\n            // Having right set here will prevent the right state and its children\n            // form being garbage collected\n            state.right = undefined;\n        }\n        return state;\n    };\n\n    State.prototype.build = function() {\n        var children = [];\n        var node = this;\n        do {\n            children.push(node.right.data);\n            node = node.left;\n        } while (node.left);\n        children.reverse();\n        return children;\n    };\n\n    State.prototype.finish = function() {\n        if (this.rule.postprocess) {\n            this.data = this.rule.postprocess(this.data, this.reference, Parser.fail);\n        }\n    };\n\n\n    function Column(grammar, index) {\n        this.grammar = grammar;\n        this.index = index;\n        this.states = [];\n        this.wants = {}; // states indexed by the non-terminal they expect\n        this.scannable = []; // list of states that expect a token\n        this.completed = {}; // states that are nullable\n    }\n\n\n    Column.prototype.process = function(nextColumn) {\n        var states = this.states;\n        var wants = this.wants;\n        var completed = this.completed;\n\n        for (var w = 0; w < states.length; w++) { // nb. we push() during iteration\n            var state = states[w];\n\n            if (state.isComplete) {\n                state.finish();\n                if (state.data !== Parser.fail) {\n                    // complete\n                    var wantedBy = state.wantedBy;\n                    for (var i = wantedBy.length; i--; ) { // this line is hot\n                        var left = wantedBy[i];\n                        this.complete(left, state);\n                    }\n\n                    // special-case nullables\n                    if (state.reference === this.index) {\n                        // make sure future predictors of this rule get completed.\n                        var exp = state.rule.name;\n                        (this.completed[exp] = this.completed[exp] || []).push(state);\n                    }\n                }\n\n            } else {\n                // queue scannable states\n                var exp = state.rule.symbols[state.dot];\n                if (typeof exp !== 'string') {\n                    this.scannable.push(state);\n                    continue;\n                }\n\n                // predict\n                if (wants[exp]) {\n                    wants[exp].push(state);\n\n                    if (completed.hasOwnProperty(exp)) {\n                        var nulls = completed[exp];\n                        for (var i = 0; i < nulls.length; i++) {\n                            var right = nulls[i];\n                            this.complete(state, right);\n                        }\n                    }\n                } else {\n                    wants[exp] = [state];\n                    this.predict(exp);\n                }\n            }\n        }\n    }\n\n    Column.prototype.predict = function(exp) {\n        var rules = this.grammar.byName[exp] || [];\n\n        for (var i = 0; i < rules.length; i++) {\n            var r = rules[i];\n            var wantedBy = this.wants[exp];\n            var s = new State(r, 0, this.index, wantedBy);\n            this.states.push(s);\n        }\n    }\n\n    Column.prototype.complete = function(left, right) {\n        var copy = left.nextState(right);\n        this.states.push(copy);\n    }\n\n\n    function Grammar(rules, start) {\n        this.rules = rules;\n        this.start = start || this.rules[0].name;\n        var byName = this.byName = {};\n        this.rules.forEach(function(rule) {\n            if (!byName.hasOwnProperty(rule.name)) {\n                byName[rule.name] = [];\n            }\n            byName[rule.name].push(rule);\n        });\n    }\n\n    // So we can allow passing (rules, start) directly to Parser for backwards compatibility\n    Grammar.fromCompiled = function(rules, start) {\n        var lexer = rules.Lexer;\n        if (rules.ParserStart) {\n          start = rules.ParserStart;\n          rules = rules.ParserRules;\n        }\n        var rules = rules.map(function (r) { return (new Rule(r.name, r.symbols, r.postprocess)); });\n        var g = new Grammar(rules, start);\n        g.lexer = lexer; // nb. storing lexer on Grammar is iffy, but unavoidable\n        return g;\n    }\n\n\n    function StreamLexer() {\n      this.reset(\"\");\n    }\n\n    StreamLexer.prototype.reset = function(data, state) {\n        this.buffer = data;\n        this.index = 0;\n        this.line = state ? state.line : 1;\n        this.lastLineBreak = state ? -state.col : 0;\n    }\n\n    StreamLexer.prototype.next = function() {\n        if (this.index < this.buffer.length) {\n            var ch = this.buffer[this.index++];\n            if (ch === '\\n') {\n              this.line += 1;\n              this.lastLineBreak = this.index;\n            }\n            return {value: ch};\n        }\n    }\n\n    StreamLexer.prototype.save = function() {\n      return {\n        line: this.line,\n        col: this.index - this.lastLineBreak,\n      }\n    }\n\n    StreamLexer.prototype.formatError = function(token, message) {\n        // nb. this gets called after consuming the offending token,\n        // so the culprit is index-1\n        var buffer = this.buffer;\n        if (typeof buffer === 'string') {\n            var lines = buffer\n                .split(\"\\n\")\n                .slice(\n                    Math.max(0, this.line - 5), \n                    this.line\n                );\n\n            var nextLineBreak = buffer.indexOf('\\n', this.index);\n            if (nextLineBreak === -1) nextLineBreak = buffer.length;\n            var col = this.index - this.lastLineBreak;\n            var lastLineDigits = String(this.line).length;\n            message += \" at line \" + this.line + \" col \" + col + \":\\n\\n\";\n            message += lines\n                .map(function(line, i) {\n                    return pad(this.line - lines.length + i + 1, lastLineDigits) + \" \" + line;\n                }, this)\n                .join(\"\\n\");\n            message += \"\\n\" + pad(\"\", lastLineDigits + col) + \"^\\n\";\n            return message;\n        } else {\n            return message + \" at index \" + (this.index - 1);\n        }\n\n        function pad(n, length) {\n            var s = String(n);\n            return Array(length - s.length + 1).join(\" \") + s;\n        }\n    }\n\n    function Parser(rules, start, options) {\n        if (rules instanceof Grammar) {\n            var grammar = rules;\n            var options = start;\n        } else {\n            var grammar = Grammar.fromCompiled(rules, start);\n        }\n        this.grammar = grammar;\n\n        // Read options\n        this.options = {\n            keepHistory: false,\n            lexer: grammar.lexer || new StreamLexer,\n        };\n        for (var key in (options || {})) {\n            this.options[key] = options[key];\n        }\n\n        // Setup lexer\n        this.lexer = this.options.lexer;\n        this.lexerState = undefined;\n\n        // Setup a table\n        var column = new Column(grammar, 0);\n        var table = this.table = [column];\n\n        // I could be expecting anything.\n        column.wants[grammar.start] = [];\n        column.predict(grammar.start);\n        // TODO what if start rule is nullable?\n        column.process();\n        this.current = 0; // token index\n    }\n\n    // create a reserved token for indicating a parse fail\n    Parser.fail = {};\n\n    Parser.prototype.feed = function(chunk) {\n        var lexer = this.lexer;\n        lexer.reset(chunk, this.lexerState);\n\n        var token;\n        while (true) {\n            try {\n                token = lexer.next();\n                if (!token) {\n                    break;\n                }\n            } catch (e) {\n                // Create the next column so that the error reporter\n                // can display the correctly predicted states.\n                var nextColumn = new Column(this.grammar, this.current + 1);\n                this.table.push(nextColumn);\n                var err = new Error(this.reportLexerError(e));\n                err.offset = this.current;\n                err.token = e.token;\n                throw err;\n            }\n            // We add new states to table[current+1]\n            var column = this.table[this.current];\n\n            // GC unused states\n            if (!this.options.keepHistory) {\n                delete this.table[this.current - 1];\n            }\n\n            var n = this.current + 1;\n            var nextColumn = new Column(this.grammar, n);\n            this.table.push(nextColumn);\n\n            // Advance all tokens that expect the symbol\n            var literal = token.text !== undefined ? token.text : token.value;\n            var value = lexer.constructor === StreamLexer ? token.value : token;\n            var scannable = column.scannable;\n            for (var w = scannable.length; w--; ) {\n                var state = scannable[w];\n                var expect = state.rule.symbols[state.dot];\n                // Try to consume the token\n                // either regex or literal\n                if (expect.test ? expect.test(value) :\n                    expect.type ? expect.type === token.type\n                                : expect.literal === literal) {\n                    // Add it\n                    var next = state.nextState({data: value, token: token, isToken: true, reference: n - 1});\n                    nextColumn.states.push(next);\n                }\n            }\n\n            // Next, for each of the rules, we either\n            // (a) complete it, and try to see if the reference row expected that\n            //     rule\n            // (b) predict the next nonterminal it expects by adding that\n            //     nonterminal's start state\n            // To prevent duplication, we also keep track of rules we have already\n            // added\n\n            nextColumn.process();\n\n            // If needed, throw an error:\n            if (nextColumn.states.length === 0) {\n                // No states at all! This is not good.\n                var err = new Error(this.reportError(token));\n                err.offset = this.current;\n                err.token = token;\n                throw err;\n            }\n\n            // maybe save lexer state\n            if (this.options.keepHistory) {\n              column.lexerState = lexer.save()\n            }\n\n            this.current++;\n        }\n        if (column) {\n          this.lexerState = lexer.save()\n        }\n\n        // Incrementally keep track of results\n        this.results = this.finish();\n\n        // Allow chaining, for whatever it's worth\n        return this;\n    };\n\n    Parser.prototype.reportLexerError = function(lexerError) {\n        var tokenDisplay, lexerMessage;\n        // Planning to add a token property to moo's thrown error\n        // even on erroring tokens to be used in error display below\n        var token = lexerError.token;\n        if (token) {\n            tokenDisplay = \"input \" + JSON.stringify(token.text[0]) + \" (lexer error)\";\n            lexerMessage = this.lexer.formatError(token, \"Syntax error\");\n        } else {\n            tokenDisplay = \"input (lexer error)\";\n            lexerMessage = lexerError.message;\n        }\n        return this.reportErrorCommon(lexerMessage, tokenDisplay);\n    };\n\n    Parser.prototype.reportError = function(token) {\n        var tokenDisplay = (token.type ? token.type + \" token: \" : \"\") + JSON.stringify(token.value !== undefined ? token.value : token);\n        var lexerMessage = this.lexer.formatError(token, \"Syntax error\");\n        return this.reportErrorCommon(lexerMessage, tokenDisplay);\n    };\n\n    Parser.prototype.reportErrorCommon = function(lexerMessage, tokenDisplay) {\n        var lines = [];\n        lines.push(lexerMessage);\n        var lastColumnIndex = this.table.length - 2;\n        var lastColumn = this.table[lastColumnIndex];\n        var expectantStates = lastColumn.states\n            .filter(function(state) {\n                var nextSymbol = state.rule.symbols[state.dot];\n                return nextSymbol && typeof nextSymbol !== \"string\";\n            });\n\n        if (expectantStates.length === 0) {\n            lines.push('Unexpected ' + tokenDisplay + '. I did not expect any more input. Here is the state of my parse table:\\n');\n            this.displayStateStack(lastColumn.states, lines);\n        } else {\n            lines.push('Unexpected ' + tokenDisplay + '. Instead, I was expecting to see one of the following:\\n');\n            // Display a \"state stack\" for each expectant state\n            // - which shows you how this state came to be, step by step.\n            // If there is more than one derivation, we only display the first one.\n            var stateStacks = expectantStates\n                .map(function(state) {\n                    return this.buildFirstStateStack(state, []) || [state];\n                }, this);\n            // Display each state that is expecting a terminal symbol next.\n            stateStacks.forEach(function(stateStack) {\n                var state = stateStack[0];\n                var nextSymbol = state.rule.symbols[state.dot];\n                var symbolDisplay = this.getSymbolDisplay(nextSymbol);\n                lines.push('A ' + symbolDisplay + ' based on:');\n                this.displayStateStack(stateStack, lines);\n            }, this);\n        }\n        lines.push(\"\");\n        return lines.join(\"\\n\");\n    }\n    \n    Parser.prototype.displayStateStack = function(stateStack, lines) {\n        var lastDisplay;\n        var sameDisplayCount = 0;\n        for (var j = 0; j < stateStack.length; j++) {\n            var state = stateStack[j];\n            var display = state.rule.toString(state.dot);\n            if (display === lastDisplay) {\n                sameDisplayCount++;\n            } else {\n                if (sameDisplayCount > 0) {\n                    lines.push('    ^ ' + sameDisplayCount + ' more lines identical to this');\n                }\n                sameDisplayCount = 0;\n                lines.push('    ' + display);\n            }\n            lastDisplay = display;\n        }\n    };\n\n    Parser.prototype.getSymbolDisplay = function(symbol) {\n        return getSymbolLongDisplay(symbol);\n    };\n\n    /*\n    Builds a the first state stack. You can think of a state stack as the call stack\n    of the recursive-descent parser which the Nearley parse algorithm simulates.\n    A state stack is represented as an array of state objects. Within a\n    state stack, the first item of the array will be the starting\n    state, with each successive item in the array going further back into history.\n\n    This function needs to be given a starting state and an empty array representing\n    the visited states, and it returns an single state stack.\n\n    */\n    Parser.prototype.buildFirstStateStack = function(state, visited) {\n        if (visited.indexOf(state) !== -1) {\n            // Found cycle, return null\n            // to eliminate this path from the results, because\n            // we don't know how to display it meaningfully\n            return null;\n        }\n        if (state.wantedBy.length === 0) {\n            return [state];\n        }\n        var prevState = state.wantedBy[0];\n        var childVisited = [state].concat(visited);\n        var childResult = this.buildFirstStateStack(prevState, childVisited);\n        if (childResult === null) {\n            return null;\n        }\n        return [state].concat(childResult);\n    };\n\n    Parser.prototype.save = function() {\n        var column = this.table[this.current];\n        column.lexerState = this.lexerState;\n        return column;\n    };\n\n    Parser.prototype.restore = function(column) {\n        var index = column.index;\n        this.current = index;\n        this.table[index] = column;\n        this.table.splice(index + 1);\n        this.lexerState = column.lexerState;\n\n        // Incrementally keep track of results\n        this.results = this.finish();\n    };\n\n    // nb. deprecated: use save/restore instead!\n    Parser.prototype.rewind = function(index) {\n        if (!this.options.keepHistory) {\n            throw new Error('set option `keepHistory` to enable rewinding')\n        }\n        // nb. recall column (table) indicies fall between token indicies.\n        //        col 0   --   token 0   --   col 1\n        this.restore(this.table[index]);\n    };\n\n    Parser.prototype.finish = function() {\n        // Return the possible parsings\n        var considerations = [];\n        var start = this.grammar.start;\n        var column = this.table[this.table.length - 1]\n        column.states.forEach(function (t) {\n            if (t.rule.name === start\n                    && t.dot === t.rule.symbols.length\n                    && t.reference === 0\n                    && t.data !== Parser.fail) {\n                considerations.push(t);\n            }\n        });\n        return considerations.map(function(c) {return c.data; });\n    };\n\n    function getSymbolLongDisplay(symbol) {\n        var type = typeof symbol;\n        if (type === \"string\") {\n            return symbol;\n        } else if (type === \"object\") {\n            if (symbol.literal) {\n                return JSON.stringify(symbol.literal);\n            } else if (symbol instanceof RegExp) {\n                return 'character matching ' + symbol;\n            } else if (symbol.type) {\n                return symbol.type + ' token';\n            } else if (symbol.test) {\n                return 'token matching ' + String(symbol.test);\n            } else {\n                throw new Error('Unknown symbol type: ' + symbol);\n            }\n        }\n    }\n\n    function getSymbolShortDisplay(symbol) {\n        var type = typeof symbol;\n        if (type === \"string\") {\n            return symbol;\n        } else if (type === \"object\") {\n            if (symbol.literal) {\n                return JSON.stringify(symbol.literal);\n            } else if (symbol instanceof RegExp) {\n                return symbol.toString();\n            } else if (symbol.type) {\n                return '%' + symbol.type;\n            } else if (symbol.test) {\n                return '<' + String(symbol.test) + '>';\n            } else {\n                throw new Error('Unknown symbol type: ' + symbol);\n            }\n        }\n    }\n\n    return {\n        Parser: Parser,\n        Grammar: Grammar,\n        Rule: Rule,\n    };\n\n}));\n","(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory) /* global define */\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory()\n  } else {\n    root.moo = factory()\n  }\n}(this, function() {\n  'use strict';\n\n  var hasOwnProperty = Object.prototype.hasOwnProperty\n  var toString = Object.prototype.toString\n  var hasSticky = typeof new RegExp().sticky === 'boolean'\n\n  /***************************************************************************/\n\n  function isRegExp(o) { return o && toString.call(o) === '[object RegExp]' }\n  function isObject(o) { return o && typeof o === 'object' && !isRegExp(o) && !Array.isArray(o) }\n\n  function reEscape(s) {\n    return s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&')\n  }\n  function reGroups(s) {\n    var re = new RegExp('|' + s)\n    return re.exec('').length - 1\n  }\n  function reCapture(s) {\n    return '(' + s + ')'\n  }\n  function reUnion(regexps) {\n    if (!regexps.length) return '(?!)'\n    var source =  regexps.map(function(s) {\n      return \"(?:\" + s + \")\"\n    }).join('|')\n    return \"(?:\" + source + \")\"\n  }\n\n  function regexpOrLiteral(obj) {\n    if (typeof obj === 'string') {\n      return '(?:' + reEscape(obj) + ')'\n\n    } else if (isRegExp(obj)) {\n      // TODO: consider /u support\n      if (obj.ignoreCase) throw new Error('RegExp /i flag not allowed')\n      if (obj.global) throw new Error('RegExp /g flag is implied')\n      if (obj.sticky) throw new Error('RegExp /y flag is implied')\n      if (obj.multiline) throw new Error('RegExp /m flag is implied')\n      return obj.source\n\n    } else {\n      throw new Error('Not a pattern: ' + obj)\n    }\n  }\n\n  function objectToRules(object) {\n    var keys = Object.getOwnPropertyNames(object)\n    var result = []\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i]\n      var thing = object[key]\n      var rules = [].concat(thing)\n      if (key === 'include') {\n        for (var j = 0; j < rules.length; j++) {\n          result.push({include: rules[j]})\n        }\n        continue\n      }\n      var match = []\n      rules.forEach(function(rule) {\n        if (isObject(rule)) {\n          if (match.length) result.push(ruleOptions(key, match))\n          result.push(ruleOptions(key, rule))\n          match = []\n        } else {\n          match.push(rule)\n        }\n      })\n      if (match.length) result.push(ruleOptions(key, match))\n    }\n    return result\n  }\n\n  function arrayToRules(array) {\n    var result = []\n    for (var i = 0; i < array.length; i++) {\n      var obj = array[i]\n      if (obj.include) {\n        var include = [].concat(obj.include)\n        for (var j = 0; j < include.length; j++) {\n          result.push({include: include[j]})\n        }\n        continue\n      }\n      if (!obj.type) {\n        throw new Error('Rule has no type: ' + JSON.stringify(obj))\n      }\n      result.push(ruleOptions(obj.type, obj))\n    }\n    return result\n  }\n\n  function ruleOptions(type, obj) {\n    if (!isObject(obj)) {\n      obj = { match: obj }\n    }\n    if (obj.include) {\n      throw new Error('Matching rules cannot also include states')\n    }\n\n    // nb. error and fallback imply lineBreaks\n    var options = {\n      defaultType: type,\n      lineBreaks: !!obj.error || !!obj.fallback,\n      pop: false,\n      next: null,\n      push: null,\n      error: false,\n      fallback: false,\n      value: null,\n      type: null,\n      shouldThrow: false,\n    }\n\n    // Avoid Object.assign(), so we support IE9+\n    for (var key in obj) {\n      if (hasOwnProperty.call(obj, key)) {\n        options[key] = obj[key]\n      }\n    }\n\n    // type transform cannot be a string\n    if (typeof options.type === 'string' && type !== options.type) {\n      throw new Error(\"Type transform cannot be a string (type '\" + options.type + \"' for token '\" + type + \"')\")\n    }\n\n    // convert to array\n    var match = options.match\n    options.match = Array.isArray(match) ? match : match ? [match] : []\n    options.match.sort(function(a, b) {\n      return isRegExp(a) && isRegExp(b) ? 0\n           : isRegExp(b) ? -1 : isRegExp(a) ? +1 : b.length - a.length\n    })\n    return options\n  }\n\n  function toRules(spec) {\n    return Array.isArray(spec) ? arrayToRules(spec) : objectToRules(spec)\n  }\n\n  var defaultErrorRule = ruleOptions('error', {lineBreaks: true, shouldThrow: true})\n  function compileRules(rules, hasStates) {\n    var errorRule = null\n    var fast = Object.create(null)\n    var fastAllowed = true\n    var unicodeFlag = null\n    var groups = []\n    var parts = []\n\n    // If there is a fallback rule, then disable fast matching\n    for (var i = 0; i < rules.length; i++) {\n      if (rules[i].fallback) {\n        fastAllowed = false\n      }\n    }\n\n    for (var i = 0; i < rules.length; i++) {\n      var options = rules[i]\n\n      if (options.include) {\n        // all valid inclusions are removed by states() preprocessor\n        throw new Error('Inheritance is not allowed in stateless lexers')\n      }\n\n      if (options.error || options.fallback) {\n        // errorRule can only be set once\n        if (errorRule) {\n          if (!options.fallback === !errorRule.fallback) {\n            throw new Error(\"Multiple \" + (options.fallback ? \"fallback\" : \"error\") + \" rules not allowed (for token '\" + options.defaultType + \"')\")\n          } else {\n            throw new Error(\"fallback and error are mutually exclusive (for token '\" + options.defaultType + \"')\")\n          }\n        }\n        errorRule = options\n      }\n\n      var match = options.match.slice()\n      if (fastAllowed) {\n        while (match.length && typeof match[0] === 'string' && match[0].length === 1) {\n          var word = match.shift()\n          fast[word.charCodeAt(0)] = options\n        }\n      }\n\n      // Warn about inappropriate state-switching options\n      if (options.pop || options.push || options.next) {\n        if (!hasStates) {\n          throw new Error(\"State-switching options are not allowed in stateless lexers (for token '\" + options.defaultType + \"')\")\n        }\n        if (options.fallback) {\n          throw new Error(\"State-switching options are not allowed on fallback tokens (for token '\" + options.defaultType + \"')\")\n        }\n      }\n\n      // Only rules with a .match are included in the RegExp\n      if (match.length === 0) {\n        continue\n      }\n      fastAllowed = false\n\n      groups.push(options)\n\n      // Check unicode flag is used everywhere or nowhere\n      for (var j = 0; j < match.length; j++) {\n        var obj = match[j]\n        if (!isRegExp(obj)) {\n          continue\n        }\n\n        if (unicodeFlag === null) {\n          unicodeFlag = obj.unicode\n        } else if (unicodeFlag !== obj.unicode && options.fallback === false) {\n          throw new Error('If one rule is /u then all must be')\n        }\n      }\n\n      // convert to RegExp\n      var pat = reUnion(match.map(regexpOrLiteral))\n\n      // validate\n      var regexp = new RegExp(pat)\n      if (regexp.test(\"\")) {\n        throw new Error(\"RegExp matches empty string: \" + regexp)\n      }\n      var groupCount = reGroups(pat)\n      if (groupCount > 0) {\n        throw new Error(\"RegExp has capture groups: \" + regexp + \"\\nUse (?: … ) instead\")\n      }\n\n      // try and detect rules matching newlines\n      if (!options.lineBreaks && regexp.test('\\n')) {\n        throw new Error('Rule should declare lineBreaks: ' + regexp)\n      }\n\n      // store regex\n      parts.push(reCapture(pat))\n    }\n\n\n    // If there's no fallback rule, use the sticky flag so we only look for\n    // matches at the current index.\n    //\n    // If we don't support the sticky flag, then fake it using an irrefutable\n    // match (i.e. an empty pattern).\n    var fallbackRule = errorRule && errorRule.fallback\n    var flags = hasSticky && !fallbackRule ? 'ym' : 'gm'\n    var suffix = hasSticky || fallbackRule ? '' : '|'\n\n    if (unicodeFlag === true) flags += \"u\"\n    var combined = new RegExp(reUnion(parts) + suffix, flags)\n    return {regexp: combined, groups: groups, fast: fast, error: errorRule || defaultErrorRule}\n  }\n\n  function compile(rules) {\n    var result = compileRules(toRules(rules))\n    return new Lexer({start: result}, 'start')\n  }\n\n  function checkStateGroup(g, name, map) {\n    var state = g && (g.push || g.next)\n    if (state && !map[state]) {\n      throw new Error(\"Missing state '\" + state + \"' (in token '\" + g.defaultType + \"' of state '\" + name + \"')\")\n    }\n    if (g && g.pop && +g.pop !== 1) {\n      throw new Error(\"pop must be 1 (in token '\" + g.defaultType + \"' of state '\" + name + \"')\")\n    }\n  }\n  function compileStates(states, start) {\n    var all = states.$all ? toRules(states.$all) : []\n    delete states.$all\n\n    var keys = Object.getOwnPropertyNames(states)\n    if (!start) start = keys[0]\n\n    var ruleMap = Object.create(null)\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i]\n      ruleMap[key] = toRules(states[key]).concat(all)\n    }\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i]\n      var rules = ruleMap[key]\n      var included = Object.create(null)\n      for (var j = 0; j < rules.length; j++) {\n        var rule = rules[j]\n        if (!rule.include) continue\n        var splice = [j, 1]\n        if (rule.include !== key && !included[rule.include]) {\n          included[rule.include] = true\n          var newRules = ruleMap[rule.include]\n          if (!newRules) {\n            throw new Error(\"Cannot include nonexistent state '\" + rule.include + \"' (in state '\" + key + \"')\")\n          }\n          for (var k = 0; k < newRules.length; k++) {\n            var newRule = newRules[k]\n            if (rules.indexOf(newRule) !== -1) continue\n            splice.push(newRule)\n          }\n        }\n        rules.splice.apply(rules, splice)\n        j--\n      }\n    }\n\n    var map = Object.create(null)\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i]\n      map[key] = compileRules(ruleMap[key], true)\n    }\n\n    for (var i = 0; i < keys.length; i++) {\n      var name = keys[i]\n      var state = map[name]\n      var groups = state.groups\n      for (var j = 0; j < groups.length; j++) {\n        checkStateGroup(groups[j], name, map)\n      }\n      var fastKeys = Object.getOwnPropertyNames(state.fast)\n      for (var j = 0; j < fastKeys.length; j++) {\n        checkStateGroup(state.fast[fastKeys[j]], name, map)\n      }\n    }\n\n    return new Lexer(map, start)\n  }\n\n  function keywordTransform(map) {\n    var reverseMap = Object.create(null)\n    var byLength = Object.create(null)\n    var types = Object.getOwnPropertyNames(map)\n    for (var i = 0; i < types.length; i++) {\n      var tokenType = types[i]\n      var item = map[tokenType]\n      var keywordList = Array.isArray(item) ? item : [item]\n      keywordList.forEach(function(keyword) {\n        (byLength[keyword.length] = byLength[keyword.length] || []).push(keyword)\n        if (typeof keyword !== 'string') {\n          throw new Error(\"keyword must be string (in keyword '\" + tokenType + \"')\")\n        }\n        reverseMap[keyword] = tokenType\n      })\n    }\n\n    // fast string lookup\n    // https://jsperf.com/string-lookups\n    function str(x) { return JSON.stringify(x) }\n    var source = ''\n    source += 'switch (value.length) {\\n'\n    for (var length in byLength) {\n      var keywords = byLength[length]\n      source += 'case ' + length + ':\\n'\n      source += 'switch (value) {\\n'\n      keywords.forEach(function(keyword) {\n        var tokenType = reverseMap[keyword]\n        source += 'case ' + str(keyword) + ': return ' + str(tokenType) + '\\n'\n      })\n      source += '}\\n'\n    }\n    source += '}\\n'\n    return Function('value', source) // type\n  }\n\n  /***************************************************************************/\n\n  var Lexer = function(states, state) {\n    this.startState = state\n    this.states = states\n    this.buffer = ''\n    this.stack = []\n    this.reset()\n  }\n\n  Lexer.prototype.reset = function(data, info) {\n    this.buffer = data || ''\n    this.index = 0\n    this.line = info ? info.line : 1\n    this.col = info ? info.col : 1\n    this.queuedToken = info ? info.queuedToken : null\n    this.queuedThrow = info ? info.queuedThrow : null\n    this.setState(info ? info.state : this.startState)\n    this.stack = info && info.stack ? info.stack.slice() : []\n    return this\n  }\n\n  Lexer.prototype.save = function() {\n    return {\n      line: this.line,\n      col: this.col,\n      state: this.state,\n      stack: this.stack.slice(),\n      queuedToken: this.queuedToken,\n      queuedThrow: this.queuedThrow,\n    }\n  }\n\n  Lexer.prototype.setState = function(state) {\n    if (!state || this.state === state) return\n    this.state = state\n    var info = this.states[state]\n    this.groups = info.groups\n    this.error = info.error\n    this.re = info.regexp\n    this.fast = info.fast\n  }\n\n  Lexer.prototype.popState = function() {\n    this.setState(this.stack.pop())\n  }\n\n  Lexer.prototype.pushState = function(state) {\n    this.stack.push(this.state)\n    this.setState(state)\n  }\n\n  var eat = hasSticky ? function(re, buffer) { // assume re is /y\n    return re.exec(buffer)\n  } : function(re, buffer) { // assume re is /g\n    var match = re.exec(buffer)\n    // will always match, since we used the |(?:) trick\n    if (match[0].length === 0) {\n      return null\n    }\n    return match\n  }\n\n  Lexer.prototype._getGroup = function(match) {\n    var groupCount = this.groups.length\n    for (var i = 0; i < groupCount; i++) {\n      if (match[i + 1] !== undefined) {\n        return this.groups[i]\n      }\n    }\n    throw new Error('Cannot find token type for matched text')\n  }\n\n  function tokenToString() {\n    return this.value\n  }\n\n  Lexer.prototype.next = function() {\n    var index = this.index\n\n    // If a fallback token matched, we don't need to re-run the RegExp\n    if (this.queuedGroup) {\n      var token = this._token(this.queuedGroup, this.queuedText, index)\n      this.queuedGroup = null\n      this.queuedText = \"\"\n      return token\n    }\n\n    var buffer = this.buffer\n    if (index === buffer.length) {\n      return // EOF\n    }\n\n    // Fast matching for single characters\n    var group = this.fast[buffer.charCodeAt(index)]\n    if (group) {\n      return this._token(group, buffer.charAt(index), index)\n    }\n\n    // Execute RegExp\n    var re = this.re\n    re.lastIndex = index\n    var match = eat(re, buffer)\n\n    // Error tokens match the remaining buffer\n    var error = this.error\n    if (match == null) {\n      return this._token(error, buffer.slice(index, buffer.length), index)\n    }\n\n    var group = this._getGroup(match)\n    var text = match[0]\n\n    if (error.fallback && match.index !== index) {\n      this.queuedGroup = group\n      this.queuedText = text\n\n      // Fallback tokens contain the unmatched portion of the buffer\n      return this._token(error, buffer.slice(index, match.index), index)\n    }\n\n    return this._token(group, text, index)\n  }\n\n  Lexer.prototype._token = function(group, text, offset) {\n    // count line breaks\n    var lineBreaks = 0\n    if (group.lineBreaks) {\n      var matchNL = /\\n/g\n      var nl = 1\n      if (text === '\\n') {\n        lineBreaks = 1\n      } else {\n        while (matchNL.exec(text)) { lineBreaks++; nl = matchNL.lastIndex }\n      }\n    }\n\n    var token = {\n      type: (typeof group.type === 'function' && group.type(text)) || group.defaultType,\n      value: typeof group.value === 'function' ? group.value(text) : text,\n      text: text,\n      toString: tokenToString,\n      offset: offset,\n      lineBreaks: lineBreaks,\n      line: this.line,\n      col: this.col,\n    }\n    // nb. adding more props to token object will make V8 sad!\n\n    var size = text.length\n    this.index += size\n    this.line += lineBreaks\n    if (lineBreaks !== 0) {\n      this.col = size - nl + 1\n    } else {\n      this.col += size\n    }\n\n    // throw, if no rule with {error: true}\n    if (group.shouldThrow) {\n      throw new Error(this.formatError(token, \"invalid syntax\"))\n    }\n\n    if (group.pop) this.popState()\n    else if (group.push) this.pushState(group.push)\n    else if (group.next) this.setState(group.next)\n\n    return token\n  }\n\n  if (typeof Symbol !== 'undefined' && Symbol.iterator) {\n    var LexerIterator = function(lexer) {\n      this.lexer = lexer\n    }\n\n    LexerIterator.prototype.next = function() {\n      var token = this.lexer.next()\n      return {value: token, done: !token}\n    }\n\n    LexerIterator.prototype[Symbol.iterator] = function() {\n      return this\n    }\n\n    Lexer.prototype[Symbol.iterator] = function() {\n      return new LexerIterator(this)\n    }\n  }\n\n  Lexer.prototype.formatError = function(token, message) {\n    if (token == null) {\n      // An undefined token indicates EOF\n      var text = this.buffer.slice(this.index)\n      var token = {\n        text: text,\n        offset: this.index,\n        lineBreaks: text.indexOf('\\n') === -1 ? 0 : 1,\n        line: this.line,\n        col: this.col,\n      }\n    }\n    var start = Math.max(0, token.offset - token.col + 1)\n    var eol = token.lineBreaks ? token.text.indexOf('\\n') : token.text.length\n    var firstLine = this.buffer.substring(start, token.offset + eol)\n    message += \" at line \" + token.line + \" col \" + token.col + \":\\n\\n\"\n    message += \"  \" + firstLine + \"\\n\"\n    message += \"  \" + Array(token.col).join(\" \") + \"^\"\n    return message\n  }\n\n  Lexer.prototype.clone = function() {\n    return new Lexer(this.states, this.state)\n  }\n\n  Lexer.prototype.has = function(tokenType) {\n    return true\n  }\n\n\n  return {\n    compile: compile,\n    states: compileStates,\n    error: Object.freeze({error: true}),\n    fallback: Object.freeze({fallback: true}),\n    keywords: keywordTransform,\n  }\n\n}));\n","// Generated automatically by nearley, version 2.19.5\n// http://github.com/Hardmath123/nearley\n(function () {\nfunction id(x) { return x[0]; }\n\nfunction getValue(d) {\n    return d[0].value\n}\n\nfunction literals(list) {\n    var rules = {}\n    for (var lit of list) {\n        rules[lit] = {match: lit, next: 'main'}\n    }\n    return rules\n}\n\nvar moo = require('moo')\nvar rules = Object.assign({\n    ws: {match: /\\s+/, lineBreaks: true, next: 'main'},\n    comment: /\\#.*/,\n    arrow: {match: /[=-]+\\>/, next: 'main'},\n    js: {\n        match: /\\{\\%(?:[^%]|\\%[^}])*\\%\\}/,\n        value: x => x.slice(2, -2),\n        lineBreaks: true,\n    },\n    word: {match: /[\\w\\?\\+]+/, next: 'afterWord'},\n    string: {\n        match: /\"(?:[^\\\\\"\\n]|\\\\[\"\\\\/bfnrt]|\\\\u[a-fA-F0-9]{4})*\"/,\n        value: x => JSON.parse(x),\n        next: 'main',\n    },\n    btstring: {\n        match: /`[^`]*`/,\n        value: x => x.slice(1, -1),\n        next: 'main',\n        lineBreaks: true,\n    },\n}, literals([\n    \",\", \"|\", \"$\", \"%\", \"(\", \")\",\n    \":?\", \":*\", \":+\",\n    \"@include\", \"@builtin\", \"@\",\n    \"]\",\n]))\n\nvar lexer = moo.states({\n    main: Object.assign({}, rules, {\n        charclass: {\n            match: /\\.|\\[(?:\\\\.|[^\\\\\\n])+?\\]/,\n            value: x => new RegExp(x),\n        },\n    }),\n    // Both macro arguments and charclasses are both enclosed in [ ].\n    // We disambiguate based on whether the previous token was a `word`.\n    afterWord: Object.assign({}, rules, {\n        \"[\": {match: \"[\", next: 'main'},\n    }),\n})\n\nfunction insensitive(sl) {\n    var s = sl.literal;\n    var result = [];\n    for (var i=0; i<s.length; i++) {\n        var c = s.charAt(i);\n        if (c.toUpperCase() !== c || c.toLowerCase() !== c) {\n            result.push(new RegExp(\"[\" + c.toLowerCase() + c.toUpperCase() + \"]\"));\n            } else {\n            result.push({literal: c});\n        }\n    }\n    return {subexpression: [{tokens: result, postprocess: function(d) {return d.join(\"\"); }}]};\n}\n\nvar grammar = {\n    Lexer: lexer,\n    ParserRules: [\n    {\"name\": \"final$ebnf$1\", \"symbols\": [(lexer.has(\"ws\") ? {type: \"ws\"} : ws)], \"postprocess\": id},\n    {\"name\": \"final$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"final\", \"symbols\": [\"_\", \"prog\", \"_\", \"final$ebnf$1\"], \"postprocess\": function(d) { return d[1]; }},\n    {\"name\": \"prog\", \"symbols\": [\"prod\"], \"postprocess\": function(d) { return [d[0]]; }},\n    {\"name\": \"prog\", \"symbols\": [\"prod\", \"ws\", \"prog\"], \"postprocess\": function(d) { return [d[0]].concat(d[2]); }},\n    {\"name\": \"prod\", \"symbols\": [\"word\", \"_\", (lexer.has(\"arrow\") ? {type: \"arrow\"} : arrow), \"_\", \"expression+\"], \"postprocess\": function(d) { return {name: d[0], rules: d[4]}; }},\n    {\"name\": \"prod\", \"symbols\": [\"word\", {\"literal\":\"[\"}, \"_\", \"wordlist\", \"_\", {\"literal\":\"]\"}, \"_\", (lexer.has(\"arrow\") ? {type: \"arrow\"} : arrow), \"_\", \"expression+\"], \"postprocess\": function(d) {return {macro: d[0], args: d[3], exprs: d[9]}}},\n    {\"name\": \"prod\", \"symbols\": [{\"literal\":\"@\"}, \"_\", \"js\"], \"postprocess\": function(d) { return {body: d[2]}; }},\n    {\"name\": \"prod\", \"symbols\": [{\"literal\":\"@\"}, \"word\", \"ws\", \"word\"], \"postprocess\": function(d) { return {config: d[1], value: d[3]}; }},\n    {\"name\": \"prod\", \"symbols\": [{\"literal\":\"@include\"}, \"_\", \"string\"], \"postprocess\": function(d) {return {include: d[2].literal, builtin: false}}},\n    {\"name\": \"prod\", \"symbols\": [{\"literal\":\"@builtin\"}, \"_\", \"string\"], \"postprocess\": function(d) {return {include: d[2].literal, builtin: true }}},\n    {\"name\": \"expression+\", \"symbols\": [\"completeexpression\"]},\n    {\"name\": \"expression+\", \"symbols\": [\"expression+\", \"_\", {\"literal\":\"|\"}, \"_\", \"completeexpression\"], \"postprocess\": function(d) { return d[0].concat([d[4]]); }},\n    {\"name\": \"expressionlist\", \"symbols\": [\"completeexpression\"]},\n    {\"name\": \"expressionlist\", \"symbols\": [\"expressionlist\", \"_\", {\"literal\":\",\"}, \"_\", \"completeexpression\"], \"postprocess\": function(d) { return d[0].concat([d[4]]); }},\n    {\"name\": \"wordlist\", \"symbols\": [\"word\"]},\n    {\"name\": \"wordlist\", \"symbols\": [\"wordlist\", \"_\", {\"literal\":\",\"}, \"_\", \"word\"], \"postprocess\": function(d) { return d[0].concat([d[4]]); }},\n    {\"name\": \"completeexpression\", \"symbols\": [\"expr\"], \"postprocess\": function(d) { return {tokens: d[0]}; }},\n    {\"name\": \"completeexpression\", \"symbols\": [\"expr\", \"_\", \"js\"], \"postprocess\": function(d) { return {tokens: d[0], postprocess: d[2]}; }},\n    {\"name\": \"expr_member\", \"symbols\": [\"word\"], \"postprocess\": id},\n    {\"name\": \"expr_member\", \"symbols\": [{\"literal\":\"$\"}, \"word\"], \"postprocess\": function(d) {return {mixin: d[1]}}},\n    {\"name\": \"expr_member\", \"symbols\": [\"word\", {\"literal\":\"[\"}, \"_\", \"expressionlist\", \"_\", {\"literal\":\"]\"}], \"postprocess\": function(d) {return {macrocall: d[0], args: d[3]}}},\n    {\"name\": \"expr_member$ebnf$1\", \"symbols\": [{\"literal\":\"i\"}], \"postprocess\": id},\n    {\"name\": \"expr_member$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"expr_member\", \"symbols\": [\"string\", \"expr_member$ebnf$1\"], \"postprocess\": function(d) { if (d[1]) {return insensitive(d[0]); } else {return d[0]; } }},\n    {\"name\": \"expr_member\", \"symbols\": [{\"literal\":\"%\"}, \"word\"], \"postprocess\": function(d) {return {token: d[1]}}},\n    {\"name\": \"expr_member\", \"symbols\": [\"charclass\"], \"postprocess\": id},\n    {\"name\": \"expr_member\", \"symbols\": [{\"literal\":\"(\"}, \"_\", \"expression+\", \"_\", {\"literal\":\")\"}], \"postprocess\": function(d) {return {'subexpression': d[2]} ;}},\n    {\"name\": \"expr_member\", \"symbols\": [\"expr_member\", \"_\", \"ebnf_modifier\"], \"postprocess\": function(d) {return {'ebnf': d[0], 'modifier': d[2]}; }},\n    {\"name\": \"ebnf_modifier\", \"symbols\": [{\"literal\":\":+\"}], \"postprocess\": getValue},\n    {\"name\": \"ebnf_modifier\", \"symbols\": [{\"literal\":\":*\"}], \"postprocess\": getValue},\n    {\"name\": \"ebnf_modifier\", \"symbols\": [{\"literal\":\":?\"}], \"postprocess\": getValue},\n    {\"name\": \"expr\", \"symbols\": [\"expr_member\"]},\n    {\"name\": \"expr\", \"symbols\": [\"expr\", \"ws\", \"expr_member\"], \"postprocess\": function(d){ return d[0].concat([d[2]]); }},\n    {\"name\": \"word\", \"symbols\": [(lexer.has(\"word\") ? {type: \"word\"} : word)], \"postprocess\": getValue},\n    {\"name\": \"string\", \"symbols\": [(lexer.has(\"string\") ? {type: \"string\"} : string)], \"postprocess\": d => ({literal: d[0].value})},\n    {\"name\": \"string\", \"symbols\": [(lexer.has(\"btstring\") ? {type: \"btstring\"} : btstring)], \"postprocess\": d => ({literal: d[0].value})},\n    {\"name\": \"charclass\", \"symbols\": [(lexer.has(\"charclass\") ? {type: \"charclass\"} : charclass)], \"postprocess\": getValue},\n    {\"name\": \"js\", \"symbols\": [(lexer.has(\"js\") ? {type: \"js\"} : js)], \"postprocess\": getValue},\n    {\"name\": \"_$ebnf$1\", \"symbols\": [\"ws\"], \"postprocess\": id},\n    {\"name\": \"_$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"_\", \"symbols\": [\"_$ebnf$1\"]},\n    {\"name\": \"ws\", \"symbols\": [(lexer.has(\"ws\") ? {type: \"ws\"} : ws)]},\n    {\"name\": \"ws$ebnf$1\", \"symbols\": [(lexer.has(\"ws\") ? {type: \"ws\"} : ws)], \"postprocess\": id},\n    {\"name\": \"ws$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"ws\", \"symbols\": [\"ws$ebnf$1\", (lexer.has(\"comment\") ? {type: \"comment\"} : comment), \"_\"]}\n]\n  , ParserStart: \"final\"\n}\nif (typeof module !== 'undefined'&& typeof module.exports !== 'undefined') {\n   module.exports = grammar;\n} else {\n   window.grammar = grammar;\n}\n})();\n","/*\n  MIT License\n  Copyright (c) 2019 Guillermo Webster\n  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n\n// import nearley from \"nearley\";\nimport nearley from \"../../node_modules/nearley/lib/nearley.js\";\n\n// import bootstraped from \"nearley/lib/nearley-language-bootstrapped\";\nimport bootstraped from \"../../node_modules/nearley/lib/nearley-language-bootstrapped.js\";\n\nexport default function compileLowLevel(structure, opts) {\n\tvar unique = uniquer();\n\tif (!opts.alreadycompiled) {\n\t\topts.alreadycompiled = [];\n\t}\n\n\tvar result = {\n\t\trules: [],\n\t\tbody: [], // @directives list\n\t\tconfig: {}, // @config value\n\t\tcustomTokens: [], // %tokens\n\t\tmacros: {},\n\t\tstart: \"\"\n\t};\n\n\tfor (var i = 0; i < structure.length; i++) {\n\t\tvar productionRule = structure[i];\n\t\tmarkRange(\n\t\t\tproductionRule.name,\n\t\t\tproductionRule.pos,\n\t\t\tproductionRule.name && productionRule.name.length\n\t\t);\n\n\t\tif (productionRule.body) {\n\t\t\t// This isn't a rule, it's an @directive.\n\t\t\tif (!opts.nojs) {\n\t\t\t\tresult.body.push(productionRule.body);\n\t\t\t}\n\t\t} else if (productionRule.include) {\n\t\t\t// Include file\n\t\t\tvar path;\n\t\t\tif (!productionRule.builtin) {\n\t\t\t\tpath = require(\"path\").resolve(\n\t\t\t\t\topts.file ? require(\"path\").dirname(opts.file) : process.cwd(),\n\t\t\t\t\tproductionRule.include\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tpath = productionRule.include;\n\t\t\t}\n\t\t\tif (opts.alreadycompiled.indexOf(path) === -1) {\n\t\t\t\topts.alreadycompiled.push(path);\n\t\t\t\tif (path === \"postprocessors.ne\") {\n\t\t\t\t\tvar f = require(\"nearley/builtin/postprocessors.ne\");\n\t\t\t\t} else if (path === \"whitespace.ne\") {\n\t\t\t\t\tvar f = require(\"nearley/builtin/whitespace.ne\");\n\t\t\t\t} else if (path === \"string.ne\") {\n\t\t\t\t\tvar f = require(\"nearley/builtin/string.ne\");\n\t\t\t\t} else if (path === \"number.ne\") {\n\t\t\t\t\tvar f = require(\"nearley/builtin/number.ne\");\n\t\t\t\t} else if (path === \"cow.ne\") {\n\t\t\t\t\tvar f = require(\"nearley/builtin/cow.ne\");\n\t\t\t\t}\n\n\t\t\t\tvar parserGrammar = nearley.Grammar.fromCompiled(bootstraped);\n\t\t\t\tvar parser = new nearley.Parser(parserGrammar);\n\t\t\t\tparser.feed(f);\n\t\t\t\tvar c = Compile(parser.results[0], {\n\t\t\t\t\tfile: path,\n\t\t\t\t\t__proto__: opts\n\t\t\t\t});\n\n\t\t\t\tresult.rules = result.rules.concat(c.rules);\n\t\t\t\tresult.body = result.body.concat(c.body);\n\t\t\t\t// result.customTokens = result.customTokens.concat(c.customTokens);\n\t\t\t\tObject.keys(c.config).forEach(function(k) {\n\t\t\t\t\tresult.config[k] = c.config[k];\n\t\t\t\t});\n\t\t\t\tObject.keys(c.macros).forEach(function(k) {\n\t\t\t\t\tresult.macros[k] = c.macros[k];\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (productionRule.macro) {\n\t\t\tresult.macros[productionRule.macro] = {\n\t\t\t\targs: productionRule.args,\n\t\t\t\texprs: productionRule.exprs\n\t\t\t};\n\t\t} else if (productionRule.config) {\n\t\t\t// This isn't a rule, it's an @config.\n\t\t\tresult.config[productionRule.config] = productionRule.value;\n\t\t} else {\n\t\t\tproduceRules(productionRule.name, productionRule.rules, {});\n\t\t\tif (!result.start) {\n\t\t\t\tresult.start = productionRule.name;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn result;\n\n\tfunction markRange(name, start, length) {\n\t\t// console.log(name, [start, start + length])\n\t\tif (opts.rangeCallback) {\n\t\t\topts.rangeCallback(name, start, start + length);\n\t\t}\n\t}\n\n\tfunction produceRules(name, rules, env) {\n\t\tfor (var i = 0; i < rules.length; i++) {\n\t\t\tvar rule = buildRule(name, rules[i], env);\n\t\t\tif (opts.nojs) {\n\t\t\t\trule.postprocess = null;\n\t\t\t}\n\t\t\tresult.rules.push(rule);\n\t\t}\n\t}\n\n\tfunction buildRule(ruleName, rule, env) {\n\t\tvar tokens = [];\n\t\tfor (var i = 0; i < rule.tokens.length; i++) {\n\t\t\tvar token = buildToken(ruleName, rule.tokens[i], env);\n\t\t\tif (token !== null) {\n\t\t\t\ttokens.push(token);\n\t\t\t}\n\t\t}\n\t\treturn new nearley.Rule(ruleName, tokens, rule.postprocess);\n\t}\n\n\tfunction buildToken(ruleName, token, env) {\n\t\tif (typeof token === \"string\") {\n\t\t\tif (token === \"null\") {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn token;\n\t\t}\n\n\t\tif (token instanceof RegExp) {\n\t\t\treturn token;\n\t\t}\n\n\t\tif (token.literal) {\n\t\t\tif (!token.literal.length) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tif (token.literal.length === 1 || result.config.lexer) {\n\t\t\t\treturn token;\n\t\t\t}\n\t\t\treturn buildStringToken(ruleName, token, env);\n\t\t}\n\t\tif (token.token) {\n\t\t\tif (result.config.lexer) {\n\t\t\t\tvar name = token.token;\n\t\t\t\tif (result.customTokens.indexOf(name) === -1) {\n\t\t\t\t\tresult.customTokens.push(name);\n\t\t\t\t}\n\t\t\t\tvar expr =\n\t\t\t\t\tresult.config.lexer +\n\t\t\t\t\t\".has(\" +\n\t\t\t\t\tJSON.stringify(name) +\n\t\t\t\t\t\") ? {type: \" +\n\t\t\t\t\tJSON.stringify(name) +\n\t\t\t\t\t\"} : \" +\n\t\t\t\t\tname;\n\t\t\t\treturn { token: \"(\" + expr + \")\" };\n\t\t\t}\n\n\t\t\treturn token;\n\t\t}\n\n\t\tif (token.subexpression) {\n\t\t\treturn buildSubExpressionToken(ruleName, token, env);\n\t\t}\n\n\t\tif (token.ebnf) {\n\t\t\treturn buildEBNFToken(ruleName, token, env);\n\t\t}\n\n\t\tif (token.macrocall) {\n\t\t\treturn buildMacroCallToken(ruleName, token, env);\n\t\t}\n\n\t\tif (token.mixin) {\n\t\t\tif (env[token.mixin]) {\n\t\t\t\treturn buildToken(ruleName, env[token.mixin], env);\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Unbound variable: \" + token.mixin);\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error(\"unrecognized token: \" + JSON.stringify(token));\n\t}\n\n\tfunction buildStringToken(ruleName, token, env) {\n\t\tvar newname = unique(ruleName + \"$string\");\n\t\tmarkRange(newname, token.pos, JSON.stringify(token.literal).length);\n\n\t\tproduceRules(\n\t\t\tnewname,\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\ttokens: token.literal.split(\"\").map(function charLiteral(d) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tliteral: d\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t\t\tpostprocess: { builtin: \"joiner\" }\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv\n\t\t);\n\t\treturn newname;\n\t}\n\n\tfunction buildSubExpressionToken(ruleName, token, env) {\n\t\tvar data = token.subexpression;\n\t\tvar name = unique(ruleName + \"$subexpression\");\n\t\t//structure.push({\"name\": name, \"rules\": data});\n\t\tproduceRules(name, data, env);\n\t\treturn name;\n\t}\n\n\tfunction buildEBNFToken(ruleName, token, env) {\n\t\tswitch (token.modifier) {\n\t\t\tcase \":+\":\n\t\t\t\treturn buildEBNFPlus(ruleName, token, env);\n\t\t\tcase \":*\":\n\t\t\t\treturn buildEBNFStar(ruleName, token, env);\n\t\t\tcase \":?\":\n\t\t\t\treturn buildEBNFOpt(ruleName, token, env);\n\t\t}\n\t}\n\n\tfunction buildEBNFPlus(ruleName, token, env) {\n\t\tvar name = unique(ruleName + \"$ebnf\");\n\t\t/*\n        structure.push({\n            name: name,\n            rules: [{\n                tokens: [token.ebnf],\n            }, {\n                tokens: [token.ebnf, name],\n                postprocess: {builtin: \"arrconcat\"}\n            }]\n        });\n        */\n\t\tproduceRules(\n\t\t\tname,\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\ttokens: [token.ebnf]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttokens: [token.ebnf, name],\n\t\t\t\t\tpostprocess: { builtin: \"arrconcat\" }\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv\n\t\t);\n\t\treturn name;\n\t}\n\n\tfunction buildEBNFStar(ruleName, token, env) {\n\t\tvar name = unique(ruleName + \"$ebnf\");\n\t\t/*\n        structure.push({\n            name: name,\n            rules: [{\n                tokens: [],\n            }, {\n                tokens: [token.ebnf, name],\n                postprocess: {builtin: \"arrconcat\"}\n            }]\n        });\n        */\n\t\tproduceRules(\n\t\t\tname,\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\ttokens: []\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttokens: [token.ebnf, name],\n\t\t\t\t\tpostprocess: { builtin: \"arrconcat\" }\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv\n\t\t);\n\t\treturn name;\n\t}\n\n\tfunction buildEBNFOpt(ruleName, token, env) {\n\t\tvar name = unique(ruleName + \"$ebnf\");\n\t\t/*\n        structure.push({\n            name: name,\n            rules: [{\n                tokens: [token.ebnf],\n                postprocess: {builtin: \"id\"}\n            }, {\n                tokens: [],\n                postprocess: {builtin: \"nuller\"}\n            }]\n        });\n        */\n\t\tproduceRules(\n\t\t\tname,\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\ttokens: [token.ebnf],\n\t\t\t\t\tpostprocess: { builtin: \"id\" }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttokens: [],\n\t\t\t\t\tpostprocess: { builtin: \"nuller\" }\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv\n\t\t);\n\t\treturn name;\n\t}\n\n\tfunction buildMacroCallToken(ruleName, token, env) {\n\t\tvar name = unique(ruleName + \"$macrocall\");\n\t\tvar macro = result.macros[token.macrocall];\n\t\tif (!macro) {\n\t\t\tthrow new Error(\"Unkown macro: \" + token.macrocall);\n\t\t}\n\t\tif (macro.args.length !== token.args.length) {\n\t\t\tthrow new Error(\"Argument count mismatch.\");\n\t\t}\n\t\tvar newenv = { __proto__: env };\n\t\tfor (var i = 0; i < macro.args.length; i++) {\n\t\t\tvar argrulename = unique(ruleName + \"$macrocall\");\n\t\t\tnewenv[macro.args[i]] = argrulename;\n\t\t\tproduceRules(argrulename, [token.args[i]], env);\n\t\t\t//structure.push({\"name\": argrulename, \"rules\":[token.args[i]]});\n\t\t\t//buildRule(name, token.args[i], env);\n\t\t}\n\t\tproduceRules(name, macro.exprs, newenv);\n\t\treturn name;\n\t}\n}\n\nfunction uniquer() {\n\tvar uns = {};\n\treturn unique;\n\tfunction unique(name) {\n\t\tvar un = (uns[name] = (uns[name] || 0) + 1);\n\t\treturn name + \"$\" + un;\n\t}\n}\n","(function(root, factory) {\n    if (typeof module === 'object' && module.exports) {\n        module.exports = factory(require('./nearley'));\n    } else {\n        root.generate = factory(root.nearley);\n    }\n}(this, function(nearley) {\n\n    function serializeRules(rules, builtinPostprocessors, extraIndent) {\n        if (extraIndent == null) {\n            extraIndent = ''\n        }\n\n        return '[\\n    ' + rules.map(function(rule) {\n            return serializeRule(rule, builtinPostprocessors);\n        }).join(',\\n    ') + '\\n' + extraIndent + ']';\n    }\n\n    function dedentFunc(func) {\n        var lines = func.toString().split(/\\n/);\n\n        if (lines.length === 1) {\n            return [lines[0].replace(/^\\s+|\\s+$/g, '')];\n        }\n\n        var indent = null;\n        var tail = lines.slice(1);\n        for (var i = 0; i < tail.length; i++) {\n            var match = /^\\s*/.exec(tail[i]);\n            if (match && match[0].length !== tail[i].length) {\n                if (indent === null ||\n                    match[0].length < indent.length) {\n                    indent = match[0];\n                }\n            }\n        }\n\n        if (indent === null) {\n            return lines;\n        }\n\n        return lines.map(function dedent(line) {\n            if (line.slice(0, indent.length) === indent) {\n                return line.slice(indent.length);\n            }\n            return line;\n        });\n    }\n\n    function tabulateString(string, indent, options) {\n        var lines;\n        if(Array.isArray(string)) {\n          lines = string;\n        } else {\n          lines = string.toString().split('\\n');\n        }\n\n        options = options || {};\n        var tabulated = lines.map(function addIndent(line, i) {\n            var shouldIndent = true;\n\n            if(i == 0 && !options.indentFirst) {\n              shouldIndent = false;\n            }\n\n            if(shouldIndent) {\n                return indent + line;\n            } else {\n                return line;\n            }\n        }).join('\\n');\n\n        return tabulated;\n    }\n\n    function serializeSymbol(s) {\n        if (s instanceof RegExp) {\n            return s.toString();\n        } else if (s.token) {\n            return s.token;\n        } else {\n            return JSON.stringify(s);\n        }\n    }\n\n    function serializeRule(rule, builtinPostprocessors) {\n        var ret = '{';\n        ret += '\"name\": ' + JSON.stringify(rule.name);\n        ret += ', \"symbols\": [' + rule.symbols.map(serializeSymbol).join(', ') + ']';\n        if (rule.postprocess) {\n            if(rule.postprocess.builtin) {\n                rule.postprocess = builtinPostprocessors[rule.postprocess.builtin];\n            }\n            ret += ', \"postprocess\": ' + tabulateString(dedentFunc(rule.postprocess), '        ', {indentFirst: false});\n        }\n        ret += '}';\n        return ret;\n    }\n\n    var generate = function (parser, exportName) {\n        if(!parser.config.preprocessor) {\n            parser.config.preprocessor = \"_default\";\n        }\n\n        if(!generate[parser.config.preprocessor]) {\n            throw new Error(\"No such preprocessor: \" + parser.config.preprocessor)\n        }\n\n        return generate[parser.config.preprocessor](parser, exportName);\n    };\n\n    generate.js = generate._default = generate.javascript = function (parser, exportName) {\n        var output = \"// Generated automatically by nearley, version \" + parser.version + \"\\n\";\n        output +=  \"// http://github.com/Hardmath123/nearley\\n\";\n        output += \"(function () {\\n\";\n        output += \"function id(x) { return x[0]; }\\n\";\n        output += parser.body.join('\\n');\n        output += \"var grammar = {\\n\";\n        output += \"    Lexer: \" + parser.config.lexer + \",\\n\";\n        output += \"    ParserRules: \" +\n            serializeRules(parser.rules, generate.javascript.builtinPostprocessors)\n            + \"\\n\";\n        output += \"  , ParserStart: \" + JSON.stringify(parser.start) + \"\\n\";\n        output += \"}\\n\";\n        output += \"if (typeof module !== 'undefined'\"\n            + \"&& typeof module.exports !== 'undefined') {\\n\";\n        output += \"   module.exports = grammar;\\n\";\n        output += \"} else {\\n\";\n        output += \"   window.\" + exportName + \" = grammar;\\n\";\n        output += \"}\\n\";\n        output += \"})();\\n\";\n        return output;\n    };\n\n    generate.javascript.builtinPostprocessors = {\n        \"joiner\": \"function joiner(d) {return d.join('');}\",\n        \"arrconcat\": \"function arrconcat(d) {return [d[0]].concat(d[1]);}\",\n        \"arrpush\": \"function arrpush(d) {return d[0].concat([d[1]]);}\",\n        \"nuller\": \"function(d) {return null;}\",\n        \"id\": \"id\"\n    }\n\n    generate.module = generate.esmodule = function (parser, exportName) {\n        var output = \"// Generated automatically by nearley, version \" + parser.version + \"\\n\";\n        output +=  \"// http://github.com/Hardmath123/nearley\\n\";\n        output += \"function id(x) { return x[0]; }\\n\";\n        output += parser.body.join('\\n');\n        output += \"let Lexer = \" + parser.config.lexer + \";\\n\";\n        output += \"let ParserRules = \" + serializeRules(parser.rules, generate.javascript.builtinPostprocessors) + \";\\n\";\n        output += \"let ParserStart = \" + JSON.stringify(parser.start) + \";\\n\";\n        output += \"export default { Lexer, ParserRules, ParserStart };\\n\";\n        return output;\n    };\n\n    generate.cs = generate.coffee = generate.coffeescript = function (parser, exportName) {\n        var output = \"# Generated automatically by nearley, version \" + parser.version + \"\\n\";\n        output +=  \"# http://github.com/Hardmath123/nearley\\n\";\n        output += \"do ->\\n\";\n        output += \"  id = (d) -> d[0]\\n\";\n        output += tabulateString(dedentFunc(parser.body.join('\\n')), '  ') + '\\n';\n        output += \"  grammar = {\\n\";\n        output += \"    Lexer: \" + parser.config.lexer + \",\\n\";\n        output += \"    ParserRules: \" +\n            tabulateString(\n                    serializeRules(parser.rules, generate.coffeescript.builtinPostprocessors),\n                    '      ',\n                    {indentFirst: false})\n        + \",\\n\";\n        output += \"    ParserStart: \" + JSON.stringify(parser.start) + \"\\n\";\n        output += \"  }\\n\";\n        output += \"  if typeof module != 'undefined' \"\n            + \"&& typeof module.exports != 'undefined'\\n\";\n        output += \"    module.exports = grammar;\\n\";\n        output += \"  else\\n\";\n        output += \"    window.\" + exportName + \" = grammar;\\n\";\n        return output;\n    };\n\n    generate.coffeescript.builtinPostprocessors = {\n        \"joiner\": \"(d) -> d.join('')\",\n        \"arrconcat\": \"(d) -> [d[0]].concat(d[1])\",\n        \"arrpush\": \"(d) -> d[0].concat([d[1]])\",\n        \"nuller\": \"() -> null\",\n        \"id\": \"id\"\n    };\n\n    generate.ts = generate.typescript = function (parser, exportName) {\n        var output = \"// Generated automatically by nearley, version \" + parser.version + \"\\n\";\n        output +=  \"// http://github.com/Hardmath123/nearley\\n\";\n        output +=  \"// Bypasses TS6133. Allow declared but unused functions.\\n\";\n        output +=  \"// @ts-ignore\\n\";\n        output += \"function id(d: any[]): any { return d[0]; }\\n\";\n        output += parser.customTokens.map(function (token) { return \"declare var \" + token + \": any;\\n\" }).join(\"\")\n        output += parser.body.join('\\n');\n        output += \"\\n\";\n        output += \"interface NearleyToken {\\n\";\n        output += \"  value: any;\\n\";\n        output += \"  [key: string]: any;\\n\";\n        output += \"};\\n\";\n        output += \"\\n\";\n        output += \"interface NearleyLexer {\\n\";\n        output += \"  reset: (chunk: string, info: any) => void;\\n\";\n        output += \"  next: () => NearleyToken | undefined;\\n\";\n        output += \"  save: () => any;\\n\";\n        output += \"  formatError: (token: never) => string;\\n\";\n        output += \"  has: (tokenType: string) => boolean;\\n\";\n        output += \"};\\n\";\n        output += \"\\n\";\n        output += \"interface NearleyRule {\\n\";\n        output += \"  name: string;\\n\";\n        output += \"  symbols: NearleySymbol[];\\n\";\n        output += \"  postprocess?: (d: any[], loc?: number, reject?: {}) => any;\\n\";\n        output += \"};\\n\";\n        output += \"\\n\";\n        output += \"type NearleySymbol = string | { literal: any } | { test: (token: any) => boolean };\\n\";\n        output += \"\\n\";\n        output += \"interface Grammar {\\n\";\n        output += \"  Lexer: NearleyLexer | undefined;\\n\";\n        output += \"  ParserRules: NearleyRule[];\\n\";\n        output += \"  ParserStart: string;\\n\";\n        output += \"};\\n\";\n        output += \"\\n\";\n        output += \"const grammar: Grammar = {\\n\";\n        output += \"  Lexer: \" + parser.config.lexer + \",\\n\";\n        output += \"  ParserRules: \" + serializeRules(parser.rules, generate.typescript.builtinPostprocessors, \"  \") + \",\\n\";\n        output += \"  ParserStart: \" + JSON.stringify(parser.start) + \",\\n\";\n        output += \"};\\n\";\n        output += \"\\n\";\n        output += \"export default grammar;\\n\";\n\n        return output;\n    };\n\n    generate.typescript.builtinPostprocessors = {\n        \"joiner\": \"(d) => d.join('')\",\n        \"arrconcat\": \"(d) => [d[0]].concat(d[1])\",\n        \"arrpush\": \"(d) => d[0].concat([d[1]])\",\n        \"nuller\": \"() => null\",\n        \"id\": \"id\"\n    };\n\n    return generate;\n\n}));\n","// Node-only\n\nvar warn = function (opts, str) {\n    opts.out.write(\"WARN\"+\"\\t\" + str + \"\\n\");\n}\n\nfunction lintNames(grm, opts) {\n    var all = [];\n    grm.rules.forEach(function(rule) {\n        all.push(rule.name);\n    });\n    grm.rules.forEach(function(rule) {\n        rule.symbols.forEach(function(symbol) {\n            if (!symbol.literal && !symbol.token && symbol.constructor !== RegExp) {\n                if (all.indexOf(symbol) === -1) {\n                    warn(opts,\"Undefined symbol `\" + symbol + \"` used.\");\n                }\n            }\n        });\n    });\n}\n\nfunction lint(grm, opts) {\n    if (!opts.out) opts.out = process.stderr;\n    lintNames(grm, opts);\n}\n\nmodule.exports = lint;\n","\n\nvar objectID = 0;\n\nvar vars = {};\n\nfunction genBlepOsc(waveform) {\n\treturn {\n\t\tsetup: (o, p) => `${o} = new Maximilian.maxiPolyBLEP();\n\t\t\t\t\t\t\t\t\t\t\t${o}.setWaveform(${waveform});\n\t\t\t\t\t\t\t\t\t\t\t`,\n\t\tloop: (o, p) => {\n\t\t\tif (p.length==1) {\n\t\t\t\treturn `${o}.play(${p[0].loop})`\n\t\t\t}else{\n\t\t\t\treturn `(()=>{${o}.setPulseWidth(${p[1].loop}); return ${o}.play(${p[0].loop});})()`\n\t\t\t}\n\t\t}\n\t}\n};\n\nvar jsFuncMap = {\n\tsaw: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiOsc();\n                      ${o}.phaseReset(${p.length > 1 ? p[1].loop : 0.0});`,\n\t\tloop: (o, p) => `${o}.saw(${p[0].loop})`,\n\t},\n\tsin: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiOsc();\n                      ${o}.phaseReset(${p.length > 1 ? p[1].loop : 0.0});`,\n\t\tloop: (o, p) => `${o}.sinewave(${p[0].loop})`,\n\t},\n\ttri: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiOsc();\n                      ${o}.phaseReset(${p.length > 1 ? p[1].loop : 0.0});`,\n\t\tloop: (o, p) => `${o}.triangle(${p[0].loop})`,\n\t},\n\tpha: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiOsc();\n                      ${o}.phaseReset(${p.length > 1 ? p[1].loop : 0.0});`,\n\t\tloop: (o, p) => `${o}.phasor(${p[0].loop})`,\n\t},\n\tph2: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiOsc();\n                      ${o}.phaseReset(${p.length > 3 ? p[3].loop : 0.0});`,\n\t\tloop: (o, p) =>\n\t\t\t`${o}.phasorBetween(${p[0].loop},${p[1].loop},${p[2].loop})`,\n\t},\n\tsqr: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiOsc();\n                      ${o}.phaseReset(${p.length > 1 ? p[1].loop : 0.0});`,\n\t\tloop: (o, p) => `${o}.square(${p[0].loop})`,\n\t},\n\tpul: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiOsc();\n                      ${o}.phaseReset(${p.length > 2 ? p[2].loop : 0.0});`,\n\t\tloop: (o, p) => `${o}.pulse(${p[0].loop},${p[1].loop})`,\n\t},\n\timp: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiOsc();\n                      ${o}.phaseReset(${p.length > 1 ? p[1].loop : 0.0});`,\n\t\tloop: (o, p) => `${o}.impulse(${p[0].loop})`,\n\t},\n\tsawn: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiOsc();\n                      ${o}.phaseReset(${p.length > 1 ? p[1].loop : 0.0});`,\n\t\tloop: (o, p) => `${o}.sawn(${p[0].loop})`,\n\t},\n\tnoiz: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiOsc()`,\n\t\tloop: (o, p) => `${o}.noise()*${p[0].loop}`,\n\t},\n\tgt: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `((${p[0].loop} > ${p[1].loop}) ? 1 : 0)`,\n\t},\n\tlt: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `((${p[0].loop} < ${p[1].loop}) ? 1 : 0)`,\n\t},\n\tmod: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `(${p[0].loop} % ${p[1].loop})`,\n\t},\n\tadd: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `(${p[0].loop} + ${p[1].loop})`,\n\t},\n\tmul: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `(${p[0].loop} * ${p[1].loop})`,\n\t},\n\tsub: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `(${p[0].loop} - ${p[1].loop})`,\n\t},\n\tdiv: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `(${p[1].loop} != 0 ? ${p[0].loop}/${p[1].loop} : 0)`,\n\t},\n\tpow: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Math.pow(${p[0].loop},${p[1].loop})`,\n\t},\n\tabs: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Math.abs(${p[0].loop})`,\n\t},\n\tenv: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiEnv();\n                      ${o}.setAttack(${p[1].loop});\n                      ${o}.setDecay(${p[2].loop});\n                      ${o}.setSustain(${p[3].loop});\n                      ${o}.setRelease(${p[4].loop})`,\n\t\tloop: (o, p) => `${o}.adsr(1,${p[0].loop})`,\n\t},\n\tsum: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => {\n\t\t\tlet s = `(${p[0].loop}`;\n\t\t\tfor (let i = 1; i < p.length; i++) s += `+${p[i].loop}`;\n\t\t\treturn s + \")\";\n\t\t},\n\t},\n\tmix: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => {\n\t\t\tlet s = `((${p[0].loop}`;\n\t\t\tfor (let i = 1; i < p.length; i++) s += `+${p[i].loop}`;\n\t\t\treturn s + `)/${p.length})`;\n\t\t},\n\t},\n\tprod: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => {\n\t\t\tlet s = `(${p[0].loop}`;\n\t\t\tfor (let i = 1; i < p.length; i++) s += `*${p[i].loop}`;\n\t\t\treturn s + \")\";\n\t\t},\n\t},\n\tblin: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) =>\n\t\t\t`Module.maxiMap.linlin(${p[0].loop}, -1, 1, ${p[1].loop}, ${p[2].loop})`,\n\t},\n\tulin: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) =>\n\t\t\t`Module.maxiMap.linlin(${p[0].loop}, 0, 1, ${p[1].loop}, ${p[2].loop})`,\n\t},\n\tbexp: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) =>\n\t\t\t`Module.maxiMap.linexp(${p[0].loop}, -1, 1, ${p[1].loop}, ${p[2].loop})`,\n\t},\n\tuexp: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) =>\n\t\t\t`Module.maxiMap.linexp(${p[0].loop}, 0.0000001, 1, ${p[1].loop}, ${p[2].loop})`,\n\t},\n\tlinlin: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) =>\n\t\t\t`Module.maxiMap.linlin(${p[0].loop}, ${p[1].loop}, ${p[2].loop},${p[3].loop}, ${p[4].loop})`,\n\t},\n\tlinexp: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) =>\n\t\t\t`Module.maxiMap.linexp(${p[0].loop}, ${p[1].loop}, ${p[2].loop}, ${p[3].loop}, ${p[4].loop})`,\n\t},\n\tdist: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiNonlinearity()`,\n\t\tloop: (o, p) => `${o}.atanDist(${p[0].loop},${p[1].loop})`,\n\t},\n\tsoftclip: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiNonlinearity()`,\n\t\tloop: (o, p) => `${o}.softclip(${p[0].loop})`,\n\t},\n\thardclip: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiNonlinearity()`,\n\t\tloop: (o, p) => `${o}.hardclip(${p[0].loop})`,\n\t},\n\tasymclip: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiNonlinearity()`,\n\t\tloop: (o, p) => `${o}.asymclip(${p[0].loop},${p[1].loop},${p[2].loop})`,\n\t},\n\tflange: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiFlanger()`,\n\t\tloop: (o, p) =>\n\t\t\t`${o}.flange(${p[0].loop},${p[1].loop},${p[2].loop},${p[3].loop},${p[4].loop})`,\n\t},\n\tchor: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiChorus()`,\n\t\tloop: (o, p) =>\n\t\t\t`${o}.chorus(${p[0].loop},${p[1].loop},${p[2].loop},${p[3].loop},${p[4].loop})`,\n\t},\n\tdl: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiDelayline()`,\n\t\tloop: (o, p) => `${o}.dl(${p[0].loop},${p[1].loop},${p[2].loop})`,\n\t},\n\tlpf: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiFilter()`,\n\t\tloop: (o, p) => `${o}.lopass(${p[0].loop},${p[1].loop})`,\n\t},\n\thpf: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiFilter()`,\n\t\tloop: (o, p) => `${o}.hipass(${p[0].loop},${p[1].loop})`,\n\t},\n\tlpz: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiFilter()`,\n\t\tloop: (o, p) => `${o}.lores(${p[0].loop},${p[1].loop},${p[2].loop})`,\n\t},\n\thpz: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiFilter()`,\n\t\tloop: (o, p) => `${o}.hires(${p[0].loop},${p[1].loop},${p[2].loop})`,\n\t},\n\n\t// `toJS`: { //freq, data, channel\n\t// \tsetup: (o, p) => `${o} = this.createMLOutputTransducer(${p[0].loop})`,\n\t// \tloop:  (o, p) => `${o}.send(${p[1].loop}, ${p[2].loop})`\n\t// },\n\tscop: {\n\t\t//freq, data, channel, [blocksize]\n\t\tsetup: (o, p) =>\n\t\t\t`${o} = new SABOutputTransducer(outputSABs,\n                                      this.port,\n                                      'scope',\n                                      ${p[1].loop},\n                                      this.currentSample,\n                                      ${p.length == 3 ? 1 : p[3].loop})`,\n\t\tloop: (o, p) => `${o}.send(${p[0].loop}, ${p[2].loop})`,\n\t},\n\n\ttoJS: {\n\t\t//freq, data, channel, [blocksize]\n\t\tsetup: (o, p) =>\n\t\t\t`${o} = new SABOutputTransducer(outputSABs,\n                                      this.port,\n                                      'ML',\n                                      ${p[1].loop},\n                                      this.currentSample,\n                                      ${p.length == 3 ? 1 : p[3].loop})`,\n\t\tloop: (o, p) => `${o}.send(${p[0].loop}, ${p[2].loop})`,\n\t},\n\tfromJS: {\n\t\t//channel\n\t\t// setup: (o, p) => `${o} = this.registerInputTransducer('ML', ${p[0].loop})`,\n\t\t// loop:  (o, p) => `${o}.getValue()`\n\t\tsetup: (o, p) =>\n\t\t\t`${o} = new SABInputTransducer(${p[0].loop}, ${p.length == 2 ? 1 : 0})`,\n\t\tloop: (o, p) =>\n\t\t\t`${o}.getSABValue(inputSABs, ${p.length == 2 ? p[1].loop : 0})`,\n\t},\n\tmouseX: {\n\t\tsetup: (o, p) => ``,\n\t\tloop: (o, p) => `this.getSABValue('mxy')[0]`,\n\t},\n\tmouseY: {\n\t\tsetup: (o, p) => ``,\n\t\tloop: (o, p) => `this.getSABValue('mxy')[1]`,\n\t},\n\tat: {\n\t\tsetup: (o, p) => ``,\n\t\tloop: (o, p) =>\n\t\t\t`${p[0].loop}[Math.min(${p[1].loop}, ${p[0].loop}.length-1)]`,\n\t},\n\n\t// toPeer: { //value, dest, channel, frequency\n\t//   setup: (o, p) => `${o} = this.createNetOutputTransducer(${p[3].loop})`,\n\t// \tloop:  (o, p) => `${o}.send(${p[0].loop},[${p[1].loop},${p[2].loop}])`\n\t// },\n\t// fromPeer: { //source, channel\n\t// \tsetup: (o, p) => `${o} = this.registerInputTransducer('NET', [${p[0].loop}, ${p[1].loop}])`,\n\t// \tloop:  (o, p) => `${o}.getValue()`\n\t// },\n\n\t// oscin: {\n\t// \tsetup: (o, p) => \"\",\n\t// \tloop:  (o, p) => `this.OSCTransducer(${p[0].loop},${p[1].loop})`\n\t// },\n\t// oscout: {\n\t// \tsetup: (o, p) => \"\",\n\t// \tloop:  (o, p) => `this.OSCTransducer(${p[0].loop},${p[1].loop})`\n\t// },\n\n\tsah: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiSampleAndHold();`,\n\t\tloop: (o, p) => `${o}.sah(${p[0].loop},${p[1].loop})`,\n\t},\n\tstretch: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiSample();\n                      ${o}.setSample(this.getSampleBuffer(${p[4].loop}));\n                      ${o}stretch = new Module.maxiStretch();\n                      ${o}stretch.setSample(${o});`,\n\t\tloop: (o, p) =>\n\t\t\t`(${o}.isReady() ? ${o}stretch.play(${p[0].loop},${p[1].loop},${p[2].loop},${p[3].loop},0.0) : 0.0)`,\n\t},\n\t// 'adc': {\"setup\":(o,p)=>\"\", \"loop\":(o,p)=>`inputs[${p[0].loop}]`},\n\tadc: { setup: (o, p) => \"\", loop: (o, p) => `(inputs * ${p[0].loop})` },\n\tsampler: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiSample();\n                      ${o}.setSample(this.getSampleBuffer(${\n\t\t\tp[p.length - 1].loop\n\t\t}));`,\n\t\tloop: (o, p) => {\n\t\t\t// let playArgs = `${p[0].loop}`;\n\t\t\t// if (p.length == 3) {\n\t\t\t// \tplayArgs += `,${p[1].loop}`;\n\t\t\t// } else if (p.length == 4) {\n\t\t\t// \tplayArgs += `,${p[1].loop},${p[2].loop}`;\n\t\t\t// }\n\t\t\t// return `(${o}.isReady() ? ${o}.playOnZX(${playArgs}) : 0.0)`;\n\t\t\tlet playFunction=\"\";\n\t\t\tswitch(p.length) {\n\t\t\t\tcase 2:\n\t\t\t\t\tplayFunction = `playOnZX(${p[0].loop})`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tplayFunction = `playOnZXAtSpeed(${p[0].loop},${p[1].loop})`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tplayFunction = `playOnZXAtSpeedFromOffset(${p[0].loop},${p[1].loop},${p[2].loop})`;\n\t\t\t\t\tbreak;\t\t\t\t\n\t\t\t}\n\t\t\treturn `(${o}.isReady() ? ${o}.${playFunction} : 0.0)`;\n\t\t},\n\t},\n\tloop: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiSample();\n                      ${o}.setSample(this.getSampleBuffer(${p[1].loop}));`,\n\t\tloop: (o, p) => `(${o}.isReady() ? ${o}.play(${p[0].loop}) : 0.0)`,\n\t},\n\tslice: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiSample();\n                      ${o}.setSample(this.getSampleBuffer(${p[2].loop}));`,\n\t\tloop: (o, p) =>\n\t\t\t`(${o}.isReady() ? ${o}.loopSetPosOnZX(${p[0].loop},${p[1].loop}) : 0.0)`,\n\t},\n\toscin: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `this.OSCTransducer(${p[0].loop},${p[1].loop})`,\n\t},\n\toscout: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `this.OSCTransducer(${p[0].loop},${p[1].loop})`,\n\t},\n\tsah: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiSampleAndHold();`,\n\t\tloop: (o, p) => `${o}.sah(${p[0].loop},${p[1].loop})`,\n\t},\n\tstretch: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiSample();\n                      ${o}.setSample(this.getSampleBuffer(${p[4].loop}));\n                      ${o}stretch = new Module.maxiStretch();\n                      ${o}stretch.setSample(${o});`,\n\t\tloop: (o, p) =>\n\t\t\t`(${o}.isReady() ? ${o}stretch.play(${p[0].loop},${p[1].loop},${p[2].loop},${p[3].loop},0.0) : 0.0)`,\n\t},\n\tbitToSig: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.toSignal(${p[0].loop})`,\n\t},\n\tbitToTrigSig: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.toTrigSignal(${p[0].loop})`,\n\t},\n\tbitNeg: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.neg(${p[0].loop})`,\n\t},\n\tbitInc: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.inc(${p[0].loop})`,\n\t},\n\tbitDec: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.dec(${p[0].loop})`,\n\t},\n\tbitAnd: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.land(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitOr: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.lor(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitXor: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.lxor(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitShl: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.shl(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitShr: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.shr(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitAt: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.at(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitAdd: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.add(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitSub: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.sub(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitMul: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.mul(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitEq: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.eq(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitGt: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.gt(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitGte: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.gte(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitLte: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.lte(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitLt: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.lt(${p[0].loop},${p[1].loop})`,\n\t},\n\tsetup: (o, p) => \"\",\n\tbitDiv: {\n\t\tloop: (o, p) => `Module.maxiBits.div(${p[0].loop},${p[1].loop})`,\n\t},\n\tbitr: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) =>\n\t\t\t`Module.maxiBits.at(${p[0].loop},${p[1].loop},${p[2].loop})`,\n\t},\n\tbitnoise: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.noise()`,\n\t},\n\tbtime: {\n\t\tsetup: (o, p) => ``,\n\t\tloop: (o, p) => `this.bitTime`,\n\t},\n\tbitFromSig: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `Module.maxiBits.fromSignal(${p[0].loop})`,\n\t},\n\t//basic clock functions\n\tclp: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) =>\n\t\t\t`this.clockPhase(${p[0].loop},${p.length > 1 ? p[1].loop : 0})`,\n\t},\n\tclt: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) =>\n\t\t\t`this.clockTrig(${p[0].loop},${p.length > 1 ? p[1].loop : 0})`,\n\t},\n\t//clock meta\n\tclk: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) =>\n\t\t\t`(()=>{this.setBPM(${p[0].loop}); this.setBeatsPerBar(${p[1].loop});})()`,\n\t},\n\t/*quantise code evaluations to the bar.\n\tvalues from maxiProcessor\n\t\tthis.codeQuantModes = {\n\t\t\tQUANTISE_TO_BAR: 0,\n\t\t\tDONTQUANTISE:1\n\t\t};\n*/\n\tquantise: {\n\t\tsetup: (o, p) => `this.setCodeQuantiseMode(${p[0].loop > 0 ? 0 : 1})`,\n\t\tloop: (o, p) =>\n\t\t\t\"\",\n\t},\n\n\n\tonzx: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiTrigger();`,\n\t\tloop: (o, p) => `${o}.onZX(${p[0].loop})`,\n\t},\n\tonchange: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiTrigger();`,\n\t\tloop: (o, p) => `${o}.onChanged(${p[0].loop},${p[1].loop})`,\n\t},\n\tcount: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiCounter();`,\n\t\tloop: (o, p) => `${o}.count(${p[0].loop},${p[1].loop})`,\n\t},\n\tidx: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiIndex();`,\n\t\tloop: (o, p) => `${o}.pull(${p[0].loop},${p[1].loop},${p[2].loop})`,\n\t},\n\tsvf: {\n\t\t//set cutoff and resonance only when params change to save CPU\n\t\tsetup: (o, p) => `${o} = new Module.maxiSVF();\n                      ${o}_p1 = new Module.maxiTrigger();\n                      ${o}_p2 = new Module.maxiTrigger();`,\n\t\tloop: (o, p) => `( () => { ${o}_cutoff = ${p[1].loop};\n                                if (${o}_p1.onChanged(${o}_cutoff, 1e-5)) {${o}.setCutoff(${o}_cutoff)};\n                                ${o}_res = ${p[2].loop};\n                                if (${o}_p2.onChanged(${o}_res, 1e-5)) {${o}.setResonance(${o}_res)};\n                                return ${o}.play(${p[0].loop},${p[3].loop},${p[4].loop},${p[5].loop},${p[6].loop})})()`,\n\t},\n\tbitclock: {\n\t\tsetup: (o, p) => \"\",\n\t\tloop: (o, p) => `this.bitclock`,\n\t},\n\tpvshift: {\n\t\tsetup: (o, p) => `${o} = new pvshift();`,\n\t\tloop: (o, p) => `${o}.play(${p[0].loop},${p[1].loop})`,\n\t},\n\n\trsq: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiRatioSeq();`,\n\t\tloop: (o, p) => {\n\t\t\treturn p.length == 2\n\t\t\t\t? `${o}.playTrig(${p[0].loop},${p[1].loop})`\n\t\t\t\t: `${o}.playValues(${p[0].loop},${p[1].loop},${p[2].loop})`;\n\t\t},\n\t},\n\to303: {\n\t\tsetup: (o, p) => `${o} = new Module.Open303();\n                      ${o}.setSampleRate(sampleRate);\n                      ${o}_tnote = new Module.maxiTrigger();\n                      ${o}_twf = new Module.maxiTrigger();\n                      ${o}_tcut = new Module.maxiTrigger();\n                      ${o}_tres = new Module.maxiTrigger();\n                      ${o}_tenvm = new Module.maxiTrigger();\n                      ${o}_tdec = new Module.maxiTrigger();\n                      ${o}_tnoteoff = new Module.maxiTrigger();\n                      ${o}_tatt = new Module.maxiTrigger();`,\n\t\tloop: (o, p) => `(()=>{\n\t\t\tlet newNote = ${o}_tnote.onZX(${p[0].loop});\n\t\t\tlet accent = ${p[3].loop};\n\t\t\tif (newNote) {\n\t\t\t\tif (${p[2].loop}>0) {\n\t\t\t\t\t${o}.slideToNote(${p[1].loop},accent);\n\t\t\t\t}else{\n\t\t\t\t\t${o}.triggerNote(${p[1].loop},accent);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (${o}_tnoteoff.onChanged(${p[4].loop}, 1e-5)) {${o}.allNotesOff()};\n\t\t\tif (${o}_twf.onChanged(${p[5].loop}, 1e-5)) {${o}.setWaveform(${p[5].loop})};\n\t\t\tif (${o}_tcut.onChanged(${p[6].loop}, 1e-5)) {${o}.setCutoff(${p[6].loop})};\n\t\t\tif (${o}_tres.onChanged(${p[7].loop}, 1e-5)) {${o}.setResonance(${p[7].loop})};\n\t\t\tif (${o}_tenvm.onChanged(${p[8].loop}, 1e-5)) {${o}.setEnvMod(${p[8].loop})};\n\t\t\tif (${o}_tatt.onChanged(${p[9].loop}, 1e-5)) {${o}.setNormalAttack(${p[9].loop})};\n\t\t\tif (${o}_tdec.onChanged(${p[10].loop}, 1e-5)) {${o}.setDecay(${p[10].loop})};\n\t\t\t${o}.setAccent(${p[11].loop});\n\t\t\treturn ${o}.play();})()`,\n\t},\n\tfreeverb: {\n\t\tsetup: (o, p) => `${o} = new Module.maxiFreeVerb();`,\n\t\tloop: (o, p) => `${o}.play(${p[0].loop},${p[1].loop},${p[2].loop})`,\n\t},\n\tline: {\n\t\t//creates a triggered line from 0-1 - use other functions to shape the line\n\t\tsetup: (o, p) =>\n\t\t\t`${o} = new Module.maxiLine(); ${o}.prepare(0,1,${p[1].loop}, false); ${o}.triggerEnable(1);`,\n\t\tloop: (o, p) => `${o}.play(${p[0].loop})`,\n\t},\n\tconst: {\n\t\tsetup: (o, p) => ``,\n\t\tloop: (o, p) => `${p[0].loop}`,\n\t},\n\tpoll: {\n\t\tsetup: (o, p) => `${o} = new poll()`,\n\t\tloop: (o, p) => `${o}.play(${p[0].loop})`,\n\t},\n\tdac: {\n\t\tsetup: (o, p) => ``,\n\t\tloop: (o, p) => {\n\t\t\tif (p.length == 1) {\n\t\t\t\treturn `this.dacOutAll(${p[0].loop})`;\n\t\t\t} else {\n\t\t\t\treturn `this.dacOut(${p[0].loop},${p[1].loop})`;\n\t\t\t}\n\t\t},\n\t},\n\tfft: {\n\t\tsetup: (o, p) => `${o} = new fft(${p[1].loop}, ${p[2].loop})`,\n\t\tloop: (o, p) => `${o}.play(${p[0].loop})`,\n\t},\n\tifft: {\n\t\tsetup: (o, p) => `${o} = new ifft(${p[3].loop}, ${p[4].loop})`,\n\t\tloop: (o, p) => `${o}.play(${p[0].loop}, ${p[1].loop}, ${p[2].loop})`,\n\t},\n\tmfcc: {\n\t\tsetup: (o, p) =>\n\t\t\t`${o} = new mfcc(${p[1].loop}, ${p[2].loop}, ${p[3].loop})`,\n\t\tloop: (o, p) => `${o}.play(${p[0].loop})`,\n\t},\n\n\t//polybleps\n\tsinb: genBlepOsc(0),\n\tcosb: genBlepOsc(1),\n\ttrib: genBlepOsc(2),\n\tsqrb: genBlepOsc(3),\n\trectb: genBlepOsc(4),\n\tsawb: genBlepOsc(5),\n\trampb: genBlepOsc(6),\n\tmodtrib: genBlepOsc(7),\n\tmodsqrb: genBlepOsc(8),\n\threcsinb: genBlepOsc(9),\n\tfrecsinb: genBlepOsc(10),\n\ttripulb: genBlepOsc(11),\n\ttrapb: genBlepOsc(12),\n\tvtrapb: genBlepOsc(13),\n\t//blep with modulatable waveform\n\tpolyblep:{\n\t\tsetup: (o, p) => `${o} = new Maximilian.maxiPolyBLEP();`,\n\t\tloop: (o, p) => {\n\t\t\tif (p.length==2) {\n\t\t\t\treturn `(()=>{${o}.setWaveform(${p[1].loop}); return ${o}.play(${p[0].loop});})()`;\n\t\t\t}else{\n\t\t\t\treturn `(()=>{${o}.setPulseWidth(${p[2].loop}); ${o}.setWaveform(${p[1].loop});  return ${o}.play(${p[0].loop});})()`;\n\t\t\t}\n\t\t}\n\t},\n};\n\n// if (${o}_twf.onChanged(${p[2].loop}, 1e-5)) {${o}.setWaveform(${p[2].loop})};\n// if (${o}_tcut.onChanged(${p[3].loop}, 1e-5)) {${o}.setCutoff(${p[3].loop})};\n// if (${o}_tres.onChanged(${p[4].loop}, 1e-5)) {${o}.setResonance(${p[4].loop})};\n// if (${o}_tenvm.onChanged(${p[5].loop}, 1e-5)) {${o}.setEnvMod(${p[5].loop})};\n// if (${o}_tdec.onChanged(${p[6].loop}, 1e-5)) {${o}.setDecay(${p[6].loop})};\n// if (newPitch || newVel) {${o}.noteOn(${p[0].loop},${p[1].loop})};\n\nexport default class ASTreeToJavascript {\n\n  static getNextID() {\n    objectID = objectID > 9999 ? 0 : ++objectID;\n    return objectID;\n  }\n\n  static emptyCode() {\n    return {\n      \"setup\": \"\",\n      \"loop\": \"\",\n      \"paramMarkers\": []\n    };\n  }\n\n  static traverseTree(t, code, level, vars, blockIdx) {\n    // console.log(`DEBUG:IR:traverseTree:level: ${level}`);\n    // console.log(`DEBUG:IR:traverseTree:vars:`);\n    // console.log(vars);\n    let attribMap = {\n      '@lang': (ccode, el) => {\n        let statements = [];\n        el.map((langEl) => {\n          let statementCode = ASTreeToJavascript.traverseTree(langEl, ASTreeToJavascript.emptyCode(), level, vars, blockIdx);\n          // console.log(\"@lang: \" + statementCode.loop);\n          ccode.setup += statementCode.setup;\n          ccode.loop += statementCode.loop;\n          // ccode.paramMarkers\n        });\n        return ccode;\n      },\n      // '@sigOut': (ccode, el) => {\n      //   ccode = ASTreeToJavascript.traverseTree(el, ccode, level, vars, blockIdx);\n      //   ccode.loop = `q.sigOut = ${ccode.loop};`;\n      //   return ccode;\n      // },\n      '@spawn': (ccode, el) => {\n        ccode = ASTreeToJavascript.traverseTree(el, ccode, level, vars, blockIdx);\n        ccode.loop += \";\";\n        return ccode;\n      },\n      '@sigp': (ccode, el) => {\n        let paramMarkers = [{\"s\":el['paramBegin'], \"e\":el['paramEnd'], \"l\":level}]\n        ccode.paramMarkers = ccode.paramMarkers.concat(paramMarkers);\n\n        let functionName = el['@func'].value;\n        let funcInfo = jsFuncMap[functionName];\n        let objName = \"q.b\" + blockIdx + \"u\" + ASTreeToJavascript.getNextID();\n\n        let allParams=[];\n\n        for (let p = 0; p < el['@params'].length; p++) {\n          let params = ASTreeToJavascript.emptyCode();\n          params = ASTreeToJavascript.traverseTree(el['@params'][p], params, level+1, vars, blockIdx);\n          // console.log(params);\n          allParams[p] = params;\n        }\n        // console.log(allParams);\n        let setupCode = \"\";\n        for (let param in allParams) {\n          setupCode += allParams[param].setup;\n          ccode.paramMarkers = ccode.paramMarkers.concat(allParams[param].paramMarkers);\n        }\n        ccode.setup += `${setupCode} ${funcInfo.setup(objName, allParams)};`;\n        ccode.loop += `${funcInfo.loop(objName, allParams)}`;\n        return ccode;\n      },\n      '@setvar': (ccode, el) => {\n        // console.log(\"DEBUG:traverseTree:@setvar\");\n        // console.log(vars);\n        // console.log(el['@varname']);\n        let variableName = el['@varname'];\n        // console.log(variableName);\n        let memIdx = vars[variableName];\n        // console.log(memIdx);\n        if (memIdx == undefined) {\n          // console.log(\"var not found\");\n          memIdx = Object.keys(vars).length;\n          vars[variableName] = memIdx;\n          // console.log(memIdx);\n        }\n        let varValueCode = ASTreeToJavascript.traverseTree(el['@varvalue'], ASTreeToJavascript.emptyCode(), level+1, vars, blockIdx);\n        ccode.setup += varValueCode.setup;\n        // ccode.loop = `this.setvar(q, '${el['@varname']}', ${varValueCode.loop})`;\n        ccode.loop = `(mem[${memIdx}] = ${varValueCode.loop})`;\n        return ccode;\n      },\n      '@getvar': (ccode, el) => {\n        let memIdx = vars[el];\n        if (memIdx == undefined) {\n\t\t\t\t\tmemIdx = Object.keys(vars).length;\n          vars[el] = memIdx;\n        }\n        // ccode.loop += `this.getvar(q, '${el.value}')`;\n        ccode.loop += `(mem[${memIdx}] != undefined ? mem[${memIdx}] : 0)`;\n        return ccode;\n      },\n      '@string': (ccode, el) => {\n        // console.log(el.value);\n        if (typeof el === 'string' || el instanceof String) {\n          ccode.loop += `'${el}'`;\n        }\n        // else {\n        //   ccode = ASTreeToJavascript.traverseTree(el, ccode, level, vars, blockIdx);\n        // }\n        return ccode;\n      },\n      '@num': (ccode, el) => {\n        if (el.value != undefined) {\n          ccode.loop += `${el.value}`;\n        }\n        //  else {\n        //   ccode = ASTreeToJavascript.traverseTree(el, ccode, level);\n        // }\n        return ccode;\n      },\n      '@list': (ccode, el) => {\n        //a list can be static and/or dynamic\n        //create a vector for the list\n        let objName = \"q.b\" + blockIdx + \"l\" + ASTreeToJavascript.getNextID();\n\t\t\t\t// ccode.setup += `${objName} = new Module.VectorDouble();`;\n        // ccode.setup += `${objName}.resize(${el.length},0);`;\n\t\t\t\tccode.setup += `${objName} = new Float64Array(${el.length});`;\n\n        //in the loop, we create a function that returns the list. It might also update dynamic elements of the list\n        ccode.loop += `(()=>{`;\n        let extraSetupCode = \"\";\n\n        for(let i_list=0; i_list < el.length; i_list++) {\n          //if the element is a static number, set this element once in the setup code\n          let element =  ASTreeToJavascript.traverseTree(el[i_list], ASTreeToJavascript.emptyCode(), level, vars, blockIdx);\n          if(Object.keys(el[i_list])[0] == '@num') {\n\t\t\t\t\t\t// ccode.setup += `${objName}.set(${i_list}, ${element.loop});`;\n\t\t\t\t\t\tccode.setup += `${objName}[${i_list}] = ${element.loop};`;\n          }else{\n              //if the element not a number, set this element each update before returning the list\n              extraSetupCode += element.setup;\n              ccode.loop += `${objName}[${i_list}] = ${element.loop};`;\n          }\n        }\n\n        ccode.loop += `return ${objName}})()`;\n        ccode.setup += extraSetupCode;\n        // ccode.loop+=`${objName}`;\n        // console.log(ccode);\n        return ccode;\n      }\n    }\n\n    if (Array.isArray(t)) {\n      t.map((el) => {\n        Object.keys(el).map((k) => {\n          // console.log(\"DEBUG:traverseTree:@ARRAYAttribMap\");\n          // console.log(k);\n          code = attribMap[k](code, el[k]);\n        });\n      })\n    } else {\n      Object.keys(t).map((k) => {\n        // console.log(\"DEBUG:traverseTree:@OBJECTAttribMap\");\n        // console.log(k);\n        code = attribMap[k](code, t[k]);\n      });\n    }\n    return code;\n  }\n\n  static treeToCode(tree, blockIdx=0) {\n    // console.log(tree);\n    vars = {};\n    let code = ASTreeToJavascript.traverseTree(tree, ASTreeToJavascript.emptyCode(), 0, vars, blockIdx);\n    // console.log(vars);\n\t\t// code.setup = `() => {let q=this.newq(); q.sigOut=0; ${code.setup}; return q;}`;\n    // code.loop = `(q, inputs, mem) => {${code.loop} return q.sigOut;}`\n\t\tcode.setup = `() => {let q=this.newq(); ${code.setup}; return q;}`;\n    code.loop = `(q, inputs, mem) => {${code.loop}}`\n    // console.log(\"DEBUG:treeToCode\");\n\t\tconsole.log(code.setup);\n\t\tconsole.log(code.loop); \n    return code;\n  }\n}\n\n","(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory) /* global define */\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory()\n  } else {\n    root.sema = factory()\n  }\n}(this, function() {\n  'use strict';\n\n\n  // create the tree structure for a number\n  function num(val) {\n    return { \"@num\": { value: val } };\n  }\n\n  // create the tree structure for a string - useful for naming samples\n  function str(val) {\n    return { \"@string\": val };\n  }\n\n  // create the tree structure for a DSP function\n  function synth(functionName, params) {\n    let branch = {\n      \"@sigp\": { \"@params\": params, \"@func\": { value: functionName } }\n    };\n    return branch;\n  }\n\n  // create the tree structure for setting a variable\n  function setvar(name, value) {\n    return { \"@setvar\": { \"@varname\": name, \"@varvalue\": value } };\n  }\n\n  // create the tree structure for reading a variable\n  function getvar(name) {\n    return { \"@getvar\": name };\n  }\n\n  return {\n\t\tnum: num,\n\t\tstr: str,\n\t\tsynth: synth,\n\t\tsetvar: setvar,\n\t\tgetvar: getvar\n\t}\n\n}));","\n\n\nimport nearley from \"../../node_modules/nearley/lib/nearley.js\";\nimport compileLowLevel from \"./compiler-low-level.js\";\nimport {\n\tParserRules,\n\tParserStart,\n\tLexer\n} from \"../../node_modules/nearley/lib/nearley-language-bootstrapped.js\";\nimport generate from \"../../node_modules/nearley/lib/generate.js\";\nimport lint from \"../../node_modules/nearley/lib/lint.js\";\n\nimport ASTreeToJavascript from \"./IR.js\";\nimport mooo from \"../../node_modules/moo/moo.js\";\nimport semaa from \"./sema.js\";\n\n// import compilerWorker from \"web-worker:./worker.js\";\n\nexport function getModuleExports(source) {\n\tlet moo = mooo; //  `let` local scope, works with eval – does NOT work with Geval\n\tlet sema = semaa; // does NOT work with Geval, works with eval\n\tsema.num(\"3\"); // hack to force the module to load before eval\n\tlet module = { exports: \"\" };\n\tconst encodedJs = encodeURIComponent(source);\n\tconst dataUri = \"data:text/javascript;charset=utf-8,\" + encodedJs;\n\timport(dataUri);\n\treturn module.exports;\n}\n\n\nexport function evalToGlobalScope(source) {\n\t// let moo = mooo; //  `let` local scope, works with eval – does NOT work with Geval\n\twindow.moo = mooo; //  global scope, works with Geval\n\t// let sema = semaa; // does NOT work with Geval, works with eval\n\twindow.sema = semaa; // global scope, works with Geval\n\tsema.num(\"3\"); // hack to force the module to load before eval\n\tlet module = { exports: \"\" };\n\t// eval(source);\n\tvar geval = eval; // eval in the global scope, avoiding rollup warning - https://rollupjs.org/guide/en/#avoiding-eval\n\tgeval(source); // does NOT work with geval – ReferenceError: moo is not defined\n  // inject parser in window.grammar\n}\n\n/**\n * Loads the modules dependencies in the compiled parser source code (moo, sema)\n * before dynamically loading it with eval\n * @param {*} source\n * * sema.num('3') is a hack to force the module to load before eval,\n * TODO need to check how the module is built differently from moo\n */\nexport function getParserModuleExports(source) {\n\tlet moo = mooo; //  `let` local scope, works with eval – does NOT work with Geval\n\tlet sema = semaa; // does NOT work with Geval, works with eval\n\tsema.num(\"3\"); // hack to force the module to load before eval\n\tlet module = { exports: \"\" };\n\teval(source); // works but gets flagged by Rollup!\n\treturn module.exports;\n}\n\n\n/**\n * Given a livecode's grammar source code, compile a livecode's source\n * @param {*} grammarSource\n * @param {*} livecodeSource\n */\nexport function compile(grammarSource, livecodeSource) {\n  try {\n\t\tlet dspCode;\n\t\tlet sema = semaa;\n\n\t\tconst { errors, output } = compileGrammar(grammarSource);\n\n\t\t// const grammar = getModuleExports(output);\n\n\t\t// evalToGlobalScope(output); // FAILS in unit testing, `ReferenceError: window is not defined`\n\t\t// const compiledParser = new nearley.Parser(window.grammar);\n\n\t\tconst grammar = getParserModuleExports(output);\n\t\tconst compiledParser = new nearley.Parser(grammar);\n\n\t\t// let worker = new compilerWorker();\n\t\t// worker.postMessage({ livecodeSource, grammarSource });\n\n\t\tif (!errors && compiledParser) {\n\t\t\tconst livecodeParseTree = compiledParser.feed(livecodeSource);\n\t\t\tif (livecodeParseTree) {\n\t\t\t\tdspCode = ASTreeToJavascript.treeToCode(livecodeParseTree.results, 0);\n\t\t\t}\n\t\t}\n\t\treturn { dspCode };\n\t} catch (error) {\n \t\treturn { errors: error };\n  }\n}\n\n/**\n * Given a livecode's grammar source code, compile a livecode's source\n * @param {*} grammarSource\n * @param {*} livecodeSource\n */\nexport function parse(grammarSource, livecodeSource) {\n  try {\n\t\tlet dspCode;\n\t\tlet sema = semaa;\n\n\t\tconst { errors, output } = compileGrammar(grammarSource);\n\n\t\t// const grammar = getModuleExports(output);\n\n\t\t// evalToGlobalScope(output); // FAILS in unit testing, `ReferenceError: window is not defined`\n\t\t// const compiledParser = new nearley.Parser(window.grammar);\n\n\t\tconst grammar = getParserModuleExports(output);\n\t\tconst compiledParser = new nearley.Parser(grammar);\n\n\t\t// let worker = new compilerWorker();\n\t\t// worker.postMessage({ livecodeSource, grammarSource });\n\n\t\tif (!errors && compiledParser) {\n\t\t\tconst livecodeParseTree = compiledParser.feed(livecodeSource).results;\n\t\t\treturn { livecodeParseTree }\n\t\t}\n\t\telse return { errors };\n\t} catch (error) {\n \t\treturn { errors: error };\n  }\n}\n\n/**\n * Given an abstract syntax tree, generate Javascript DSP code\n * @param {*} liveCodeParseTree\n */\nexport function ASTreeToDSPcode(livecodeParseTree) {\n\tif (livecodeParseTree) {\n    try {\n\t\t\tconst dspCode = ASTreeToJavascript.treeToCode(livecodeParseTree, 0);\n      return { dspCode };\n    }\n    catch (error) {\n      return { errors: error };\n    }\n  }\n  else throw new Error('Problem with livecodeParseTree argument passed to ASTreeToDSPCode');\n}\n\n/*\n  MIT License\n  Copyright (c) 2019 Guillermo Webster\n  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n\nfunction stream() {\n\tlet out = \"\";\n\treturn {\n\t\twrite(str) {\n\t\t\tout += str;\n\t\t},\n\t\tdump() {\n\t\t\treturn out;\n\t\t}\n\t};\n}\n\nfunction AnnotatePositions(rules) {\n\treturn rules.map(\n\t\trule =>\n\t\t\tnew nearley.Rule(\n\t\t\t\trule.name,\n\t\t\t\trule.symbols,\n\t\t\t\trule.postprocess &&\n\t\t\t\t\t((data, ref, reject) => {\n\t\t\t\t\t\tvar orig = rule.postprocess(data, ref, reject);\n\t\t\t\t\t\tif (orig === null) return null;\n\t\t\t\t\t\tif (typeof orig == \"object\" && !orig.slice) {\n\t\t\t\t\t\t\torig.pos = ref;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn orig;\n\t\t\t\t\t})\n\t\t\t)\n\t);\n}\n\nexport function compileGrammar(grammar) {\n\n\tlet parser = new nearley.Parser( AnnotatePositions(ParserRules), ParserStart, { lexer: Lexer } );\n\n\tlet errors = stream();\n\tlet output = \"\";\n\tlet positions = {};\n\n\ttry {\n\t\tparser.feed(grammar);\n\t\tif (parser.results[0]) {\n\t\t\tfunction rangeCallback(name, start, end) {\n\t\t\t\tpositions[name] = [start, end];\n\t\t\t}\n\t\t\tvar c = compileLowLevel(parser.results[0], {\n\t\t\t\trangeCallback: rangeCallback\n\t\t\t});\n\t\t\tlint(c, { out: errors });\n\n\t\t\toutput = generate(c, \"grammar\");\n\t\t}\n\t} catch (e) {\n\t\terrors.write(e);\n\t}\n\n\treturn {\n\t\terrors: errors.dump(),\n\t\tpositions,\n\t\toutput\n\t};\n}\n","\nimport Dispatcher from \"../common/dispatcher.js\";\n\n// here we use the default pattern but any RegEx can be configured\nimport mlworker from 'web-worker:./worker.js';\n\nimport { Logger } from \"../common/logger.js\";\n\n/**\n * The Learner class encapsulates a worker thread\n * and does async initialization and manages all async communication with it\n * @class Learner\n * TODO more error handling\n * TODO more checking of arguments passed to methods\n */\nexport class Learner {\n\t/**\n\t * @constructor\n\t */\n\tconstructor() {\n\t\t// Manager of events subscrition and emission, that should be subscribed by SAB receivers\n\t\tthis.dispatcher = new Dispatcher();\n\t\tthis.logger = new Logger();\n\t}\n\n\t/**\n\t * Learner's event subscription\n\t * @addEventListener\n\t * @param {*} event\n\t * @param {*} callback\n\t */\n\taddEventListener(event, callback) {\n\t\tif (this.dispatcher && event && callback)\n\t\t\tthis.dispatcher.addEventListener(event, callback);\n\t\telse throw new Error(\"Error adding event listener to Learner\");\n\t}\n\n\tremoveEventListener(event, callback) {\n\t\tif (this.dispatcher && event && callback)\n\t\t\tthis.dispatcher.removeEventListener(event, callback);\n\t\telse throw new Error(\"Error removing event listener to Learner\");\n\t}\n\n\t/**\n\t * Initialises worker with origin URL\n\t * @param {*} url\n\t * @param {*} sab\n\t */\n\tasync init(url) {\n\t\t// this.dispatcher = new Dispatcher();\n\t\tthis.worker = new mlworker();\n\t\t//this.logger = new Logger(); //make a logger instance\n\n\t\t//console.log(\"TEST CONSOLE TAKEOVER IN LEARNER\");\n\n\t\treturn new Promise( (resolve, reject) => {\n\t\t\tlet result = {};\n\t\t\tif (this.worker && new URL(url)) {\n\n\t\t\t\tthis.worker.postMessage({ url });\n\n\t\t\t\tthis.worker.onerror = e => {\n\t\t\t\t\tconsole.log(\"onError\");\n          reject(e);\n        };\n\n\t\t\t\tthis.worker.onmessage = e => {\n\t\t\t\t\tresult = e.data.init;\n\t\t\t\t\tconsole.info(\"running Learner\");\n\t\t\t\t\tresolve(result);\n\t\t\t\t\t// this.worker.onmessage = this.onMessageHandler;\n\t\t\t\t\tthis.worker.onmessage = this.onMessageHandler.bind(this);\n\t\t\t\t};\n\n\t\t\t}\n\t\t});\n\t}\n\n\tonMessageHandler(m){\n\n\t\t// data is a property of postMessage. func is then a property of data sent in our messages.\n\t\tif ( m && m.data && m.data.func ) {\n\n\t\t\tlet responders = {\n\n\t\t\t\tsab: (data) => {\n\t\t\t\t\t// Publish data to audio engine\n\t\t\t\t\tthis.dispatcher.dispatch(\"onSharedBuffer\", data);\n\t\t\t\t},\n\t\t\t\tsendbuf: (data) => {\n\t\t\t\t\t// Publish data to audio engine\n\t\t\t\t\tthis.dispatcher.dispatch(\"onSharedBuffer\", data);\n\t\t\t\t},\n\t\t\t\tsave: (data) => {\n\t\t\t\t\t// console.log(\"save\");\n\t\t\t\t\twindow.localStorage.setItem(data.name, data.val);\n\t\t\t\t},\n\t\t\t\tload: (data) => {\n\t\t\t\t\t// console.log(\"load\");\n\t\t\t\t\tlet msg = {\n\t\t\t\t\t\tname: data.name,\n\t\t\t\t\t\tval: window.localStorage.getItem(data.name),\n\t\t\t\t\t};\n\t\t\t\t\tmodelWorker.postMessage(msg);\n\t\t\t\t},\n\t\t\t\tdownload: (data) => {\n\t\t\t\t\t// console.log(\"download\");\n\t\t\t\t\tlet downloadData = window.localStorage.getItem(data.name);\n\t\t\t\t\tlet blob = new Blob([downloadData], {\n\t\t\t\t\t\ttype: \"text/plain;charset=utf-8\",\n\t\t\t\t\t});\n\t\t\t\t\tsaveData(blob, `${data.name}.data`);\n\t\t\t\t},\n\t\t\t\tsendcode: (data) => {\n\t\t\t\t\t// console.log(data);\n\t\t\t\t},\n        // DEPRECATED\n        data: () => {\n\t\t\t\t\t// Publish data to audio engine\n\t\t\t\t\t// messaging.publish(\"model-output-data\", data);\n\t\t\t\t},\n\t\t\t\tpbcopy: (data) => {\n\t\t\t\t\tcopyToPasteBuffer(data.msg);\n\t\t\t\t\t// let copyField=document.getElementById(\"hiddenCopyField\");\n\t\t\t\t\t// copyField.value = data.msg;\n\t\t\t\t\t// copyField.select();\n\t\t\t\t\t// document.execCommand(\"Copy\");\n\t\t\t\t},\n\t\t\t\tenvsave: (data) => {\n\t\t\t\t\tmessaging.publish(\"env-save\", data);\n\t\t\t\t},\n\t\t\t\tenvload: (data) => {\n\t\t\t\t\tmessaging.publish(\"env-load\", data);\n\t\t\t\t},\n\t\t\t\tdomeval: (data) => {\n\t\t\t\t\tevalDOMCode(data.code);\n\t\t\t\t},\n\t\t\t\tpeerinfo: (data) => {\n\t\t\t\t\tmessaging.publish(\"peerinfo-request\", {});\n\t\t\t\t},\n\t\t\t\t// data from the worker.js for the logger widget\n\t\t\t\tlogs: (data) => {\n\t\t\t\t\t// console.log(\">\", [...data.payload].join()); //for now just log to console and have it captured here.\n\t\t\t\t\tthis.logger.push(data); //recieve data from the worker.js and push it to the logger.\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tresponders[m.data.func](m.data);\n\n    } else if (m.data !== undefined && m.data.length !== 0) {\n\t\t\t// res(m.data);\n\t\t\tconsole.log(m.data);\n\t\t}\n\t\t// clearTimeout(timeout);\n\t};\n\n\t/**\n\t *\n\t */\n\teval(expression) {\n\t\tif (this.worker && expression)\n\t\t\tthis.worker.postMessage({ eval: expression });\n\t\t//console.log(\"DEBUG:ModelEditor:evalModelEditorExpression: \" + code);\n\t\t// window.localStorage.setItem(\"modelEditorValue\", codeMirror.getValue());\n\t\t// addToHistory(\"model-history-\", modelCode);\n\t}\n\n\t/**\n\t *\n\t * @param {*} sab\n\t * @param {*} blocksize\n\t * @param {*} channelID\n\t */\n\taddSharedBuffer(e) {\n\t\tif (this.worker && e && e.sab && e.sab instanceof SharedArrayBuffer) {\n\t\t\tthis.worker.postMessage({\n\t\t\t\tsab: e.sab,\n\t\t\t\tblocksize: e.blocksize,\n\t\t\t\tchannelID: e.channelID,\n\t\t\t});\n\t\t} else throw new Error(\"Error pushing SharedBuffer in Learner\");\n\t}\n\n\tevalBlock(block) {\n\t\t// let modelCode = codeMirror.getBlock();\n\t\t// console.log(modelCode);\n\t\tlet linebreakPos = block.indexOf(\"\\n\");\n\t\tlet firstLine = block.substr(0, linebreakPos);\n\t\t// console.log(firstLine);\n\t\tif (firstLine == \"//--DOM\") {\n\t\t\tblock = block.substr(linebreakPos);\n\t\t\tevalDomCode(block);\n\t\t\taddToHistory(\"dom-history-\", block);\n\t\t} else {\n\t\t\tthis.worker.postMessage({ eval: block });\n\t\t\t// console.log(\"DEBUG:ModelEditor:evalModelEditorExpressionBlock: \" + code);\n\t\t\twindow.localStorage.setItem(\"modelEditorValue\", codeMirror.getValue());\n\t\t\taddToHistory(\"model-history-\", block);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t */\n\tterminate() {\n\t\tthis.worker.onmessage = null; // remove event handler subscription\n\t\tthis.worker.terminate();\n\t\tthis.worker = null; // make sure it is deleted by GC\n\t}\n}\n","/**\n * Find code between dividers,\n * const divider = \"__________\";\n */\nexport function getBlock(editor) {\n\tif (editor) {\n\t\tlet cursorInfo = editor.getCursor();\n\t\t//find post divider\n\t\tlet line = cursorInfo.line;\n\t\tlet linePost = editor.lastLine();\n\n\t\twhile (line < linePost) {\n\t\t\tif (/___+/.test(editor.getLine(line))) {\n\t\t\t\t// Test RegEx at least 3 underscores\n\t\t\t\tlinePost = line - 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tline++;\n\t\t}\n\n\t\tline = cursorInfo.line;\n\t\tlet linePre = -1;\n\t\twhile (line >= 0) {\n\t\t\t// console.log(editor2.getLine(line));\n\t\t\tif (/___+/.test(editor.getLine(line))) {\n\t\t\t\tlinePre = line;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tline--;\n\t\t}\n\t\tif (linePre > -1) {\n\t\t\tlinePre++;\n\t\t}\n\t\tlet code = editor.getRange(\n\t\t\t{\n\t\t\t\tline: linePre,\n\t\t\t\tch: 0,\n\t\t\t},\n\t\t\t{\n\t\t\t\tline: linePost + 1,\n\t\t\t\tch: 0,\n\t\t\t}\n\t\t);\n\n\t\treturn code;\n\t}\n}\n"],"names":["RingBuffer","getStorageForCapacity","capacity","type","BYTES_PER_ELEMENT","bytes","SharedArrayBuffer","constructor","sab","ArrayBuffer","__proto__","isPrototypeOf","undefined","this","_type","byteLength","buf","write_ptr","Uint32Array","read_ptr","storage","name","push","elements","rd","Atomics","load","wr","_storage_capacity","to_write","Math","min","_available_write","length","first_part","second_part","_copy","store","pop","to_read","_available_read","empty","full","available_read","available_write","rv","input","offset_input","output","offset_output","size","i","getBase64","str","indexOf","dataStart","slice","match","_keyStr","removePaddingFromBase64","Module","maxiTools","charAt","substring","loadSampleToArray","audioContext","sampleObjectName","url","audioWorkletNode","data","b64","ab_bytes","arrayBuffer","uarray","chr1","chr2","chr3","enc2","enc3","enc4","parseInt","j","Uint8Array","replace","decodeAudioData","buffer","float32ArrayBuffer","getChannelData","port","postMessage","sample","console","log","request","XMLHttpRequest","addEventListener","info","open","responseType","onload","response","send","Event","eventName","callbacks","registerCallback","callback","unregisterCallback","index","splice","emit","forEach","Dispatcher","events","dispatch","event","removeEventListener","Logger","instance","rawLog","dispatcher","Error","payload","join","takeOverConsole","window","cl","ci","cw","ce","warn","error","text","func","arguments","apply","bind","Engine","origin","learners","analysers","mediaStreamSource","mediaStream","sharedArrayBuffers","logger","samplesLoaded","isHushed","addLearner","id","learner","init","e","addSharedBuffer","removeLearner","createSharedBuffer","channelId","ttype","blocksize","Float64Array","ringbuf","value","channelID","rb","err","pushDataToSharedBuffer","Array","isArray","pollAnalyserData","analyser","timeDataArray","fftSize","frequencyDataArray","getByteTimeDomainData","getByteFrequencyData","smoothingTimeConstant","createAnalyser","analyserID","minDecibels","maxDecibels","connect","analyserFrameId","analyserData","analyserPollingLoop","requestAnimationFrame","connectAnalysers","Object","keys","map","removeAnalyser","cancelAnimationFrame","URL","isWorkletProcessorLoaded","audioWorkletName","audioWorkletUrl","AudioContext","latencyHint","loadWorkletProcessorCode","connectWorkletNode","play","state","resume","hush","stop","stopAndRelease","disconnect","destination","setGain","gain","gainParam","parameters","get","more","less","unHush","unhush","eval","dspFunction","setup","loop","asyncPostToProcessor","sendClockPhase","phase","idx","onAudioInputInit","stream","createMediaStreamSource","mediaStreamSourceConnected","onAudioInputFail","message","onAudioInputDisconnect","connectMediaStream","constraints","audio","latency","echoCancellation","mozNoiseSuppression","mozAutoGainControl","video","navigator","mediaDevices","getUserMedia","then","s","catch","disconnectMediaStream","getAudioTracks","at","audioWorklet","addModule","AudioWorkletNode","channelInterpretation","channelCountMode","channelCount","maxChannelCount","onprocessorerror","onprocessorstatechange","processorState","onmessageerror","onmessage","onProcessorMessageHandler","rq","peerNet","ch","suspend","subscribeProcessorMessage","loadSample","objectName","root","factory","Rule","symbols","postprocess","highestId","State","rule","dot","reference","wantedBy","isComplete","Column","grammar","states","wants","scannable","completed","Grammar","rules","start","byName","hasOwnProperty","StreamLexer","reset","Parser","options","fromCompiled","key","keepHistory","lexer","lexerState","column","table","predict","process","current","getSymbolShortDisplay","symbol","literal","JSON","stringify","RegExp","toString","test","String","prototype","withCursorAt","symbolSequence","nextState","child","left","right","build","children","node","reverse","finish","fail","nextColumn","w","complete","exp","nulls","r","copy","Lexer","ParserStart","ParserRules","g","line","lastLineBreak","col","next","save","formatError","token","lines","split","max","lastLineDigits","pad","n","feed","chunk","reportLexerError","offset","expect","isToken","reportError","results","lexerError","tokenDisplay","lexerMessage","reportErrorCommon","lastColumnIndex","lastColumn","expectantStates","filter","nextSymbol","displayStateStack","buildFirstStateStack","stateStack","symbolDisplay","getSymbolDisplay","lastDisplay","sameDisplayCount","display","getSymbolLongDisplay","visited","prevState","childVisited","concat","childResult","restore","rewind","considerations","t","c","module","exports","nearley","hasSticky","sticky","isRegExp","o","call","isObject","reCapture","reUnion","regexps","regexpOrLiteral","obj","ignoreCase","global","multiline","source","ruleOptions","include","defaultType","lineBreaks","fallback","shouldThrow","sort","a","b","toRules","spec","array","result","arrayToRules","object","getOwnPropertyNames","thing","objectToRules","defaultErrorRule","compileRules","hasStates","errorRule","fast","create","fastAllowed","unicodeFlag","groups","parts","shift","charCodeAt","unicode","pat","regexp","exec","fallbackRule","flags","suffix","checkStateGroup","startState","stack","queuedToken","queuedThrow","setState","re","popState","pushState","eat","tokenToString","_getGroup","groupCount","queuedGroup","_token","queuedText","group","lastIndex","matchNL","nl","Symbol","iterator","LexerIterator","done","eol","firstLine","clone","has","tokenType","compile","all","$all","ruleMap","included","newRules","k","newRule","fastKeys","freeze","keywords","reverseMap","byLength","types","item","keyword","x","Function","moo","getValue","d","require$$0","assign","ws","comment","arrow","js","word","string","parse","btstring","list","lit","literals","main","charclass","afterWord","macro","args","exprs","body","config","builtin","tokens","mixin","macrocall","sl","toUpperCase","toLowerCase","subexpression","insensitive","ebnf","modifier","compileLowLevel","structure","opts","unique","uniquer","alreadycompiled","customTokens","macros","productionRule","markRange","pos","nojs","path","require","resolve","file","dirname","cwd","f","parserGrammar","bootstraped","parser","Compile","produceRules","rangeCallback","env","buildRule","ruleName","buildToken","newname","buildStringToken","buildSubExpressionToken","buildEBNFPlus","buildEBNFStar","buildEBNFOpt","buildEBNFToken","newenv","argrulename","buildMacroCallToken","uns","un","serializeRules","builtinPostprocessors","extraIndent","ret","serializeSymbol","tabulateString","dedentFunc","indentFirst","serializeRule","indent","tail","shouldIndent","generate","exportName","preprocessor","_default","javascript","version","joiner","arrconcat","arrpush","nuller","esmodule","cs","coffee","coffeescript","ts","typescript","out","write","lintNames","grm","lint","stderr","objectID","vars","genBlepOsc","waveform","p","jsFuncMap","saw","sin","tri","pha","ph2","sqr","pul","imp","sawn","noiz","gt","lt","mod","add","mul","sub","div","pow","abs","sum","mix","prod","blin","ulin","bexp","uexp","linlin","linexp","dist","softclip","hardclip","asymclip","flange","chor","dl","lpf","hpf","lpz","hpz","scop","toJS","fromJS","mouseX","mouseY","sah","stretch","adc","sampler","playFunction","oscin","oscout","bitToSig","bitToTrigSig","bitNeg","bitInc","bitDec","bitAnd","bitOr","bitXor","bitShl","bitShr","bitAt","bitAdd","bitSub","bitMul","bitEq","bitGt","bitGte","bitLte","bitLt","bitDiv","bitr","bitnoise","btime","bitFromSig","clp","clt","clk","quantise","onzx","onchange","count","svf","bitclock","pvshift","rsq","o303","freeverb","const","poll","dac","fft","ifft","mfcc","sinb","cosb","trib","sqrb","rectb","sawb","rampb","modtrib","modsqrb","hrecsinb","frecsinb","tripulb","trapb","vtrapb","polyblep","ASTreeToJavascript","getNextID","emptyCode","paramMarkers","traverseTree","code","level","blockIdx","attribMap","ccode","el","langEl","statementCode","l","functionName","funcInfo","objName","allParams","params","setupCode","param","variableName","memIdx","varValueCode","extraSetupCode","i_list","element","treeToCode","tree","num","val","synth","setvar","getvar","sema","getParserModuleExports","semaa","grammarSource","livecodeSource","dspCode","errors","compileGrammar","compiledParser","livecodeParseTree","ASTreeToDSPcode","dump","AnnotatePositions","ref","reject","orig","positions","end","Learner","worker","mlworker","Promise","onerror","onMessageHandler","m","sendbuf","localStorage","setItem","msg","getItem","modelWorker","download","downloadData","blob","Blob","saveData","sendcode","pbcopy","copyToPasteBuffer","envsave","messaging","publish","envload","domeval","evalDOMCode","peerinfo","logs","expression","evalBlock","block","linebreakPos","substr","evalDomCode","addToHistory","codeMirror","terminate","getBlock","editor","cursorInfo","getCursor","linePost","lastLine","getLine","linePre","getRange"],"mappings":"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"}