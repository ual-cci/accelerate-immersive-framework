class RingBuffer{static getStorageForCapacity(e,t){if(!t.BYTES_PER_ELEMENT)throw"Pass in a ArrayBuffer subclass";var o=8+(e+1)*t.BYTES_PER_ELEMENT;return new SharedArrayBuffer(o)}constructor(e,t){if(!ArrayBuffer.__proto__.isPrototypeOf(t)&&void 0!==t.BYTES_PER_ELEMENT)throw"Pass a concrete typed array class as second argument";this._type=t,this.capacity=(e.byteLength-8)/t.BYTES_PER_ELEMENT,this.buf=e,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new t(this.buf,8,this.capacity)}type(){return this._type.name}push(e){var t=Atomics.load(this.read_ptr,0),o=Atomics.load(this.write_ptr,0);if((o+1)%this._storage_capacity()==t)return 0;let n=Math.min(this._available_write(t,o),e.length),r=Math.min(this._storage_capacity()-o,n),i=n-r;return this._copy(e,0,this.storage,o,r),this._copy(e,r,this.storage,0,i),Atomics.store(this.write_ptr,0,(o+n)%this._storage_capacity()),n}pop(e){var t=Atomics.load(this.read_ptr,0),o=Atomics.load(this.write_ptr,0);if(o==t)return 0;let n=Math.min(this._available_read(t,o),e.length),r=Math.min(this._storage_capacity()-t,e.length),i=n-r;return this._copy(this.storage,t,e,0,r),this._copy(this.storage,0,e,r,i),Atomics.store(this.read_ptr,0,(t+n)%this._storage_capacity()),n}empty(){var e=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)==e}full(){var e=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this.capacity!=e}capacity(){return this.capacity-1}available_read(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}available_write(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}_available_read(e,t){return t>e?t-e:t+this._storage_capacity()-e}_available_write(e,t){let o=e-t-1;return t>=e&&(o+=this._storage_capacity()),o}_storage_capacity(){return this.capacity}_copy(e,t,o,n,r){for(var i=0;i<r;i++)o[n+i]=e[t+i]}}const getBase64=e=>{if(-1!==e.indexOf(";base64,")){var t=e.indexOf(";base64,")+8;return!!e.slice(t).match(/^([A-Za-z0-9+\/]{4})*([A-Za-z0-9+\/]{4}|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{2}==)$/)&&e.slice(t)}return!1},_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",removePaddingFromBase64=e=>64===Module.maxiTools._keyStr.indexOf(e.charAt(e.length-1))?e.substring(0,e.length-1):e,loadSampleToArray=(e,t,o,n)=>{var r=[],i=getBase64(o);if(i){var s=i.length/4*3,a=new ArrayBuffer(s);i=removePaddingFromBase64(removePaddingFromBase64(i));var l,c,p,u,h,d,f,m=parseInt(i.length/4*3,10),y=0,g=0;for(l=new Uint8Array(a),i=i.replace(/[^A-Za-z0-9\+\/\=]/g,""),y=0;y<m;y+=3)c=_keyStr.indexOf(i.charAt(g++))<<2|(h=_keyStr.indexOf(i.charAt(g++)))>>4,p=(15&h)<<4|(d=_keyStr.indexOf(i.charAt(g++)))>>2,u=(3&d)<<6|(f=_keyStr.indexOf(i.charAt(g++))),l[y]=c,64!==d&&(l[y+1]=p),64!==f&&(l[y+2]=u);e.decodeAudioData(a,(function(e){let o=e.getChannelData(0);void 0!==r&&void 0!==n&&n.port.postMessage({sample:t,buffer:o})}),(function(e){console.log("Error decoding source!")}))}else{var b=new XMLHttpRequest;b.addEventListener("load",(()=>console.info(`loading sample '${t}'`))),b.open("GET",o,!0),b.responseType="arraybuffer",b.onload=function(){e.decodeAudioData(b.response,(function(e){let o=e.getChannelData(0);void 0!==r&&void 0!==n&&n.port.postMessage({sample:t,buffer:o})}),(function(e){console.log("Error decoding source!")}))},b.send()}return"Loading module"};class Event{constructor(e){this.eventName=e,this.callbacks=[]}registerCallback(e){this.callbacks.push(e)}unregisterCallback(e){const t=this.callbacks.indexOf(e);t>-1&&this.callbacks.splice(t,1)}emit(e){this.callbacks.slice(0).forEach((t=>{t(e)}))}}class Dispatcher{constructor(){this.events={}}dispatch(e,t){const o=this.events[e];o&&o.emit(t)}addEventListener(e,t){let o=this.events[e];o||(o=new Event(e),this.events[e]=o),o.registerCallback(t)}removeEventListener(e,t){const o=this.events[e];o&&o.callbacks.indexOf(t)>-1&&(o.unregisterCallback(t),0===o.callbacks.length&&delete this.events[e])}}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports
/*!
 * assertion-error
 * Copyright(c) 2013 Jake Luer <jake@qualiancy.com>
 * MIT Licensed
 */
/*!
 * Return a function that will copy properties from
 * one object to another excluding any originally
 * listed. Returned function will create a new `{}`.
 *
 * @param {String} excluded properties ...
 * @return {Function}
 */}function exclude(){var e=[].slice.call(arguments);function t(t,o){Object.keys(o).forEach((function(n){~e.indexOf(n)||(t[n]=o[n])}))}return function(){for(var e=[].slice.call(arguments),o=0,n={};o<e.length;o++)t(n,e[o]);return n}}
/*!
 * Primary Exports
 */var assertionError=AssertionError;function AssertionError(e,t,o){var n=exclude("name","message","stack","constructor","toJSON")(t||{});for(var r in this.message=e||"Unspecified AssertionError",this.showDiff=!1,n)this[r]=n[r];if(o=o||AssertionError,Error.captureStackTrace)Error.captureStackTrace(this,o);else try{throw new Error}catch(e){this.stack=e.stack}}
/*!
 * Inherit from Error.prototype
 */function hasProperty$1(e,t){return null!=e&&t in Object(e)}function parsePath(e){return e.replace(/([^\\])\[/g,"$1.[").match(/(\\\.|[^.]+?)+/g).map((function(e){if("constructor"===e||"__proto__"===e||"prototype"===e)return{};var t=/^\[(\d+)\]$/.exec(e);return t?{i:parseFloat(t[1])}:{p:e.replace(/\\([.[\]])/g,"$1")}}))}function internalGetPathValue(e,t,o){var n=e,r=null;o=void 0===o?t.length:o;for(var i=0;i<o;i++){var s=t[i];n&&(n=void 0===s.p?n[s.i]:n[s.p],i===o-1&&(r=n))}return r}function internalSetPathValue(e,t,o){for(var n=e,r=o.length,i=null,s=0;s<r;s++){var a=null,l=null;if(i=o[s],s===r-1)n[a=void 0===i.p?i.i:i.p]=t;else if(void 0!==i.p&&n[i.p])n=n[i.p];else if(void 0!==i.i&&n[i.i])n=n[i.i];else{var c=o[s+1];a=void 0===i.p?i.i:i.p,l=void 0===c.p?[]:{},n[a]=l,n=n[a]}}}function getPathInfo$1(e,t){var o=parsePath(t),n=o[o.length-1],r={parent:o.length>1?internalGetPathValue(e,o,o.length-1):e,name:n.p||n.i,value:internalGetPathValue(e,o)};return r.exists=hasProperty$1(r.parent,r.name),r}function getPathValue(e,t){return getPathInfo$1(e,t).value}function setPathValue(e,t,o){return internalSetPathValue(e,o,parsePath(t)),e}AssertionError.prototype=Object.create(Error.prototype),
/*!
 * Statically set name
 */
AssertionError.prototype.name="AssertionError",
/*!
 * Ensure correct constructor
 */
AssertionError.prototype.constructor=AssertionError,AssertionError.prototype.toJSON=function(e){var t=exclude("constructor","toJSON","stack")({name:this.name},this);return!1!==e&&this.stack&&(t.stack=this.stack),t};var pathval={hasProperty:hasProperty$1,getPathInfo:getPathInfo$1,getPathValue:getPathValue,setPathValue:setPathValue},flag$1=function(e,t,o){var n=e.__flags||(e.__flags=Object.create(null));if(3!==arguments.length)return n[t];n[t]=o},test$1=function(e,t){var o=flag$1(e,"negate"),n=t[0];return o?!n:n},typeDetect=createCommonjsModule((function(e,t){e.exports=function(){var e="function"==typeof Promise,t="object"==typeof self?self:commonjsGlobal,o="undefined"!=typeof Symbol,n="undefined"!=typeof Map,r="undefined"!=typeof Set,i="undefined"!=typeof WeakMap,s="undefined"!=typeof WeakSet,a="undefined"!=typeof DataView,l=o&&void 0!==Symbol.iterator,c=o&&void 0!==Symbol.toStringTag,p=r&&"function"==typeof Set.prototype.entries,u=n&&"function"==typeof Map.prototype.entries,h=p&&Object.getPrototypeOf((new Set).entries()),d=u&&Object.getPrototypeOf((new Map).entries()),f=l&&"function"==typeof Array.prototype[Symbol.iterator],m=f&&Object.getPrototypeOf([][Symbol.iterator]()),y=l&&"function"==typeof String.prototype[Symbol.iterator],g=y&&Object.getPrototypeOf(""[Symbol.iterator]()),b=8,w=-1;function v(o){var l=typeof o;if("object"!==l)return l;if(null===o)return"null";if(o===t)return"global";if(Array.isArray(o)&&(!1===c||!(Symbol.toStringTag in o)))return"Array";if("object"==typeof window&&null!==window){if("object"==typeof window.location&&o===window.location)return"Location";if("object"==typeof window.document&&o===window.document)return"Document";if("object"==typeof window.navigator){if("object"==typeof window.navigator.mimeTypes&&o===window.navigator.mimeTypes)return"MimeTypeArray";if("object"==typeof window.navigator.plugins&&o===window.navigator.plugins)return"PluginArray"}if(("function"==typeof window.HTMLElement||"object"==typeof window.HTMLElement)&&o instanceof window.HTMLElement){if("BLOCKQUOTE"===o.tagName)return"HTMLQuoteElement";if("TD"===o.tagName)return"HTMLTableDataCellElement";if("TH"===o.tagName)return"HTMLTableHeaderCellElement"}}var p=c&&o[Symbol.toStringTag];if("string"==typeof p)return p;var u=Object.getPrototypeOf(o);return u===RegExp.prototype?"RegExp":u===Date.prototype?"Date":e&&u===Promise.prototype?"Promise":r&&u===Set.prototype?"Set":n&&u===Map.prototype?"Map":s&&u===WeakSet.prototype?"WeakSet":i&&u===WeakMap.prototype?"WeakMap":a&&u===DataView.prototype?"DataView":n&&u===d?"Map Iterator":r&&u===h?"Set Iterator":f&&u===m?"Array Iterator":y&&u===g?"String Iterator":null===u?"Object":Object.prototype.toString.call(o).slice(b,w)}return v}()})),expectTypes$1=function(e,t){var o=flag$1(e,"message"),n=flag$1(e,"ssfi");o=o?o+": ":"",e=flag$1(e,"object"),(t=t.map((function(e){return e.toLowerCase()}))).sort();var r=t.map((function(e,o){var n=~["a","e","i","o","u"].indexOf(e.charAt(0))?"an":"a";return(t.length>1&&o===t.length-1?"or ":"")+n+" "+e})).join(", "),i=typeDetect(e).toLowerCase();if(!t.some((function(e){return i===e})))throw new assertionError(o+"object tested must be "+r+", but "+i+" given",void 0,n)},getActual$1=function(e,t){return t.length>4?t[4]:e._obj},toString=Function.prototype.toString,functionNameMatch$1=/\s*function(?:\s|\s*\/\*[^(?:*\/)]+\*\/\s*)*([^\s\(\/]+)/;
/*!
 * Chai - flag utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */function getFuncName(e){if("function"!=typeof e)return null;var t="";if(void 0===Function.prototype.name&&void 0===e.name){var o=toString.call(e).match(functionNameMatch$1);o&&(t=o[1])}else t=e.name;return t}var getFuncName_1=getFuncName,getProperties=function(e){var t=Object.getOwnPropertyNames(e);function o(e){-1===t.indexOf(e)&&t.push(e)}for(var n=Object.getPrototypeOf(e);null!==n;)Object.getOwnPropertyNames(n).forEach(o),n=Object.getPrototypeOf(n);return t},getEnumerableProperties=function(e){var t=[];for(var o in e)t.push(o);return t},config={includeStack:!1,showDiff:!0,truncateThreshold:40,useProxy:!0,proxyExcludedKeys:["then","catch","inspect","toJSON"]},inspect_1=createCommonjsModule((function(e,t){e.exports=function(e,t,n,r){return o({showHidden:t,seen:[],stylize:function(e){return e}},e,void 0===n?2:n)};function o(e,c,p){if(c&&"function"==typeof c.inspect&&c.inspect!==t.inspect&&(!c.constructor||c.constructor.prototype!==c)){var u=c.inspect(p,e);return"string"!=typeof u&&(u=o(e,u,p)),u}var h,d=function(e,t){switch(typeof t){case"undefined":return e.stylize("undefined","undefined");case"string":var o="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(o,"string");case"number":return 0===t&&1/t==-1/0?e.stylize("-0","number"):e.stylize(""+t,"number");case"boolean":return e.stylize(""+t,"boolean");case"symbol":return e.stylize(t.toString(),"symbol");case"bigint":return e.stylize(t.toString()+"n","bigint")}if(null===t)return e.stylize("null","null")}(e,c);if(d)return d;if(h=c,"object"==typeof HTMLElement?h instanceof HTMLElement:h&&"object"==typeof h&&"nodeType"in h&&1===h.nodeType&&"string"==typeof h.nodeName){if("outerHTML"in c)return c.outerHTML;try{if(document.xmlVersion)return(new XMLSerializer).serializeToString(c);var f=document.createElementNS("http://www.w3.org/1999/xhtml","_");f.appendChild(c.cloneNode(!1));var m=f.innerHTML.replace("><",">"+c.innerHTML+"<");return f.innerHTML="",m}catch(e){}}var y,g,b=getEnumerableProperties(c),w=e.showHidden?getProperties(c):b;if(0===w.length||a(c)&&(1===w.length&&"stack"===w[0]||2===w.length&&"description"===w[0]&&"stack"===w[1])){if("function"==typeof c)return g=(y=getFuncName_1(c))?": "+y:"",e.stylize("[Function"+g+"]","special");if(i(c))return e.stylize(RegExp.prototype.toString.call(c),"regexp");if(s(c))return e.stylize(Date.prototype.toUTCString.call(c),"date");if(a(c))return n(c)}var v,x,$="",S=!1,k=!1,M=["{","}"];if("object"==typeof(v=c)&&/\w+Array]$/.test(l(v))&&(k=!0,M=["[","]"]),function(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"===l(e)}(c)&&(S=!0,M=["[","]"]),"function"==typeof c&&($=" [Function"+(g=(y=getFuncName_1(c))?": "+y:"")+"]"),i(c)&&($=" "+RegExp.prototype.toString.call(c)),s(c)&&($=" "+Date.prototype.toUTCString.call(c)),a(c))return n(c);if(0===w.length&&(!S||0==c.length))return M[0]+$+M[1];if(p<0)return i(c)?e.stylize(RegExp.prototype.toString.call(c),"regexp"):e.stylize("[Object]","special");if(e.seen.push(c),S)x=function(e,t,o,n,i){for(var s=[],a=0,l=t.length;a<l;++a)Object.prototype.hasOwnProperty.call(t,String(a))?s.push(r(e,t,o,n,String(a),!0)):s.push("");return i.forEach((function(i){i.match(/^\d+$/)||s.push(r(e,t,o,n,i,!0))})),s}(e,c,p,b,w);else{if(k)return function(e){for(var t="[ ",o=0;o<e.length;++o){if(t.length>=config.truncateThreshold-7){t+="...";break}t+=e[o]+", "}-1!==(t+=" ]").indexOf(",  ]")&&(t=t.replace(",  ]"," ]"));return t}(c);x=w.map((function(t){return r(e,c,p,b,t,S)}))}return e.seen.pop(),function(e,t,o){if(e.reduce((function(e,t){return e+t.length+1}),0)>60)return o[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+o[1];return o[0]+t+" "+e.join(", ")+" "+o[1]}(x,$,M)}function n(e){return"["+Error.prototype.toString.call(e)+"]"}function r(e,t,n,r,i,s){var a,l,c=Object.getOwnPropertyDescriptor(t,i);if(c&&(c.get?l=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(l=e.stylize("[Setter]","special"))),r.indexOf(i)<0&&(a="["+i+"]"),l||(e.seen.indexOf(t[i])<0?(l=o(e,t[i],null===n?null:n-1)).indexOf("\n")>-1&&(l=s?l.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+l.split("\n").map((function(e){return"   "+e})).join("\n")):l=e.stylize("[Circular]","special")),void 0===a){if(s&&i.match(/^\d+$/))return l;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+l}function i(e){return"object"==typeof e&&"[object RegExp]"===l(e)}function s(e){return"object"==typeof e&&"[object Date]"===l(e)}function a(e){return"object"==typeof e&&"[object Error]"===l(e)}function l(e){return Object.prototype.toString.call(e)}})),objDisplay$1=function(e){var t=inspect_1(e),o=Object.prototype.toString.call(e);if(config.truncateThreshold&&t.length>=config.truncateThreshold){if("[object Function]"===o)return e.name&&""!==e.name?"[Function: "+e.name+"]":"[Function]";if("[object Array]"===o)return"[ Array("+e.length+") ]";if("[object Object]"===o){var n=Object.keys(e);return"{ Object ("+(n.length>2?n.splice(0,2).join(", ")+", ...":n.join(", "))+") }"}return t}return t},getMessage$2=function(e,t){var o=flag$1(e,"negate"),n=flag$1(e,"object"),r=t[3],i=getActual$1(e,t),s=o?t[2]:t[1],a=flag$1(e,"message");return"function"==typeof s&&(s=s()),s=(s=s||"").replace(/#\{this\}/g,(function(){return objDisplay$1(n)})).replace(/#\{act\}/g,(function(){return objDisplay$1(i)})).replace(/#\{exp\}/g,(function(){return objDisplay$1(r)})),a?a+": "+s:s},transferFlags$1=function(e,t,o){var n=e.__flags||(e.__flags=Object.create(null));for(var r in t.__flags||(t.__flags=Object.create(null)),o=3!==arguments.length||o,n)(o||"object"!==r&&"ssfi"!==r&&"lockSsfi"!==r&&"message"!=r)&&(t.__flags[r]=n[r])};
/*!
 * Chai - getProperties utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
/*!
 * deep-eql
 * Copyright(c) 2013 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
function FakeMap(){this._key="chai/deep-eql__"+Math.random()+Date.now()}FakeMap.prototype={get:function(e){return e[this._key]},set:function(e,t){Object.isExtensible(e)&&Object.defineProperty(e,this._key,{value:t,configurable:!0})}};var MemoizeMap="function"==typeof WeakMap?WeakMap:FakeMap;
/*!
 * Check to see if the MemoizeMap has recorded a result of the two operands
 *
 * @param {Mixed} leftHandOperand
 * @param {Mixed} rightHandOperand
 * @param {MemoizeMap} memoizeMap
 * @returns {Boolean|null} result
*/function memoizeCompare(e,t,o){if(!o||isPrimitive(e)||isPrimitive(t))return null;var n=o.get(e);if(n){var r=n.get(t);if("boolean"==typeof r)return r}return null}
/*!
 * Set the result of the equality into the MemoizeMap
 *
 * @param {Mixed} leftHandOperand
 * @param {Mixed} rightHandOperand
 * @param {MemoizeMap} memoizeMap
 * @param {Boolean} result
*/function memoizeSet(e,t,o,n){if(o&&!isPrimitive(e)&&!isPrimitive(t)){var r=o.get(e);r?r.set(t,n):((r=new MemoizeMap).set(t,n),o.set(e,r))}}
/*!
 * Primary Export
 */var deepEql=deepEqual,MemoizeMap_1=MemoizeMap;function deepEqual(e,t,o){if(o&&o.comparator)return extensiveDeepEqual(e,t,o);var n=simpleEqual(e,t);return null!==n?n:extensiveDeepEqual(e,t,o)}function simpleEqual(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t||!isPrimitive(e)&&!isPrimitive(t)&&null}
/*!
 * The main logic of the `deepEqual` function.
 *
 * @param {Mixed} leftHandOperand
 * @param {Mixed} rightHandOperand
 * @param {Object} [options] (optional) Additional options
 * @param {Array} [options.comparator] (optional) Override default algorithm, determining custom equality.
 * @param {Array} [options.memoize] (optional) Provide a custom memoization object which will cache the results of
    complex objects for a speed boost. By passing `false` you can disable memoization, but this will cause circular
    references to blow the stack.
 * @return {Boolean} equal match
*/function extensiveDeepEqual(e,t,o){(o=o||{}).memoize=!1!==o.memoize&&(o.memoize||new MemoizeMap);var n=o&&o.comparator,r=memoizeCompare(e,t,o.memoize);if(null!==r)return r;var i=memoizeCompare(t,e,o.memoize);if(null!==i)return i;if(n){var s=n(e,t);if(!1===s||!0===s)return memoizeSet(e,t,o.memoize,s),s;var a=simpleEqual(e,t);if(null!==a)return a}var l=typeDetect(e);if(l!==typeDetect(t))return memoizeSet(e,t,o.memoize,!1),!1;memoizeSet(e,t,o.memoize,!0);var c=extensiveDeepEqualByType(e,t,l,o);return memoizeSet(e,t,o.memoize,c),c}function extensiveDeepEqualByType(e,t,o,n){switch(o){case"String":case"Number":case"Boolean":case"Date":return deepEqual(e.valueOf(),t.valueOf());case"Promise":case"Symbol":case"function":case"WeakMap":case"WeakSet":case"Error":return e===t;case"Arguments":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"Array":return iterableEqual(e,t,n);case"RegExp":return regexpEqual(e,t);case"Generator":return generatorEqual(e,t,n);case"DataView":return iterableEqual(new Uint8Array(e.buffer),new Uint8Array(t.buffer),n);case"ArrayBuffer":return iterableEqual(new Uint8Array(e),new Uint8Array(t),n);case"Set":case"Map":return entriesEqual(e,t,n);default:return objectEqual(e,t,n)}}
/*!
 * Compare two Regular Expressions for equality.
 *
 * @param {RegExp} leftHandOperand
 * @param {RegExp} rightHandOperand
 * @return {Boolean} result
 */function regexpEqual(e,t){return e.toString()===t.toString()}
/*!
 * Compare two Sets/Maps for equality. Faster than other equality functions.
 *
 * @param {Set} leftHandOperand
 * @param {Set} rightHandOperand
 * @param {Object} [options] (Optional)
 * @return {Boolean} result
 */function entriesEqual(e,t,o){if(e.size!==t.size)return!1;if(0===e.size)return!0;var n=[],r=[];return e.forEach((function(e,t){n.push([e,t])})),t.forEach((function(e,t){r.push([e,t])})),iterableEqual(n.sort(),r.sort(),o)}
/*!
 * Simple equality for flat iterable objects such as Arrays, TypedArrays or Node.js buffers.
 *
 * @param {Iterable} leftHandOperand
 * @param {Iterable} rightHandOperand
 * @param {Object} [options] (Optional)
 * @return {Boolean} result
 */function iterableEqual(e,t,o){var n=e.length;if(n!==t.length)return!1;if(0===n)return!0;for(var r=-1;++r<n;)if(!1===deepEqual(e[r],t[r],o))return!1;return!0}
/*!
 * Simple equality for generator objects such as those returned by generator functions.
 *
 * @param {Iterable} leftHandOperand
 * @param {Iterable} rightHandOperand
 * @param {Object} [options] (Optional)
 * @return {Boolean} result
 */function generatorEqual(e,t,o){return iterableEqual(getGeneratorEntries(e),getGeneratorEntries(t),o)}
/*!
 * Determine if the given object has an @@iterator function.
 *
 * @param {Object} target
 * @return {Boolean} `true` if the object has an @@iterator function.
 */function hasIteratorFunction(e){return"undefined"!=typeof Symbol&&"object"==typeof e&&void 0!==Symbol.iterator&&"function"==typeof e[Symbol.iterator]}
/*!
 * Gets all iterator entries from the given Object. If the Object has no @@iterator function, returns an empty array.
 * This will consume the iterator - which could have side effects depending on the @@iterator implementation.
 *
 * @param {Object} target
 * @returns {Array} an array of entries from the @@iterator function
 */function getIteratorEntries(e){if(hasIteratorFunction(e))try{return getGeneratorEntries(e[Symbol.iterator]())}catch(e){return[]}return[]}
/*!
 * Gets all entries from a Generator. This will consume the generator - which could have side effects.
 *
 * @param {Generator} target
 * @returns {Array} an array of entries from the Generator.
 */function getGeneratorEntries(e){for(var t=e.next(),o=[t.value];!1===t.done;)t=e.next(),o.push(t.value);return o}
/*!
 * Gets all own and inherited enumerable keys from a target.
 *
 * @param {Object} target
 * @returns {Array} an array of own and inherited enumerable keys from the target.
 */function getEnumerableKeys(e){var t=[];for(var o in e)t.push(o);return t}
/*!
 * Determines if two objects have matching values, given a set of keys. Defers to deepEqual for the equality check of
 * each key. If any value of the given key is not equal, the function will return false (early).
 *
 * @param {Mixed} leftHandOperand
 * @param {Mixed} rightHandOperand
 * @param {Array} keys An array of keys to compare the values of leftHandOperand and rightHandOperand against
 * @param {Object} [options] (Optional)
 * @return {Boolean} result
 */function keysEqual(e,t,o,n){var r=o.length;if(0===r)return!0;for(var i=0;i<r;i+=1)if(!1===deepEqual(e[o[i]],t[o[i]],n))return!1;return!0}
/*!
 * Recursively check the equality of two Objects. Once basic sameness has been established it will defer to `deepEqual`
 * for each enumerable key in the object.
 *
 * @param {Mixed} leftHandOperand
 * @param {Mixed} rightHandOperand
 * @param {Object} [options] (Optional)
 * @return {Boolean} result
 */function objectEqual(e,t,o){var n=getEnumerableKeys(e),r=getEnumerableKeys(t);if(n.length&&n.length===r.length)return n.sort(),r.sort(),!1!==iterableEqual(n,r)&&keysEqual(e,t,n,o);var i=getIteratorEntries(e),s=getIteratorEntries(t);return i.length&&i.length===s.length?(i.sort(),s.sort(),iterableEqual(i,s,o)):0===n.length&&0===i.length&&0===r.length&&0===s.length}
/*!
 * Returns true if the argument is a primitive.
 *
 * This intentionally returns true for all objects that can be compared by reference,
 * including functions and symbols.
 *
 * @param {Mixed} value
 * @return {Boolean} result
 */function isPrimitive(e){return null===e||"object"!=typeof e}deepEql.MemoizeMap=MemoizeMap_1;
/*!
 * Chai - isProxyEnabled helper
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
var isProxyEnabled$1=function(){return config.useProxy&&"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect},addProperty$1=function(e,t,o){o=void 0===o?function(){}:o,Object.defineProperty(e,t,{get:function e(){isProxyEnabled$1()||flag$1(this,"lockSsfi")||flag$1(this,"ssfi",e);var t=o.call(this);if(void 0!==t)return t;var n=new chai$1.Assertion;return transferFlags$1(this,n),n},configurable:!0})},fnLengthDesc=Object.getOwnPropertyDescriptor((function(){}),"length"),addLengthGuard$1=function(e,t,o){return fnLengthDesc.configurable?(Object.defineProperty(e,"length",{get:function(){if(o)throw Error("Invalid Chai property: "+t+'.length. Due to a compatibility issue, "length" cannot directly follow "'+t+'". Use "'+t+'.lengthOf" instead.');throw Error("Invalid Chai property: "+t+'.length. See docs for proper usage of "'+t+'".')}}),e):e},builtins=["__flags","__methods","_obj","assert"],proxify$1=function(e,t){return isProxyEnabled$1()?new Proxy(e,{get:function e(o,n){if("string"==typeof n&&-1===config.proxyExcludedKeys.indexOf(n)&&!Reflect.has(o,n)){if(t)throw Error("Invalid Chai property: "+t+"."+n+'. See docs for proper usage of "'+t+'".');var r=null,i=4;throw getProperties(o).forEach((function(e){if(!Object.prototype.hasOwnProperty(e)&&-1===builtins.indexOf(e)){var t=stringDistanceCapped(n,e,i);t<i&&(r=e,i=t)}})),null!==r?Error("Invalid Chai property: "+n+'. Did you mean "'+r+'"?'):Error("Invalid Chai property: "+n)}return-1!==builtins.indexOf(n)||flag$1(o,"lockSsfi")||flag$1(o,"ssfi",e),Reflect.get(o,n)}}):e};
/*!
 * Chai - addProperty utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */function stringDistanceCapped(e,t,o){if(Math.abs(e.length-t.length)>=o)return o;for(var n=[],r=0;r<=e.length;r++)n[r]=Array(t.length+1).fill(0),n[r][0]=r;for(var i=0;i<t.length;i++)n[0][i]=i;for(r=1;r<=e.length;r++){var s=e.charCodeAt(r-1);for(i=1;i<=t.length;i++)Math.abs(r-i)>=o?n[r][i]=o:n[r][i]=Math.min(n[r-1][i]+1,n[r][i-1]+1,n[r-1][i-1]+(s===t.charCodeAt(i-1)?0:1))}return n[e.length][t.length]}
/*!
 * Chai - addMethod utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */var addMethod$1=function(e,t,o){var n=function(){flag$1(this,"lockSsfi")||flag$1(this,"ssfi",n);var e=o.apply(this,arguments);if(void 0!==e)return e;var t=new chai$1.Assertion;return transferFlags$1(this,t),t};addLengthGuard$1(n,t,!1),e[t]=proxify$1(n,t)},overwriteProperty$1=function(e,t,o){var n=Object.getOwnPropertyDescriptor(e,t),r=function(){};n&&"function"==typeof n.get&&(r=n.get),Object.defineProperty(e,t,{get:function e(){isProxyEnabled$1()||flag$1(this,"lockSsfi")||flag$1(this,"ssfi",e);var t=flag$1(this,"lockSsfi");flag$1(this,"lockSsfi",!0);var n=o(r).call(this);if(flag$1(this,"lockSsfi",t),void 0!==n)return n;var i=new chai$1.Assertion;return transferFlags$1(this,i),i},configurable:!0})},overwriteMethod$1=function(e,t,o){var n=e[t],r=function(){throw new Error(t+" is not a function")};n&&"function"==typeof n&&(r=n);var i=function(){flag$1(this,"lockSsfi")||flag$1(this,"ssfi",i);var e=flag$1(this,"lockSsfi");flag$1(this,"lockSsfi",!0);var t=o(r).apply(this,arguments);if(flag$1(this,"lockSsfi",e),void 0!==t)return t;var n=new chai$1.Assertion;return transferFlags$1(this,n),n};addLengthGuard$1(i,t,!1),e[t]=proxify$1(i,t)},canSetPrototype="function"==typeof Object.setPrototypeOf,testFn=function(){},excludeNames=Object.getOwnPropertyNames(testFn).filter((function(e){var t=Object.getOwnPropertyDescriptor(testFn,e);return"object"!=typeof t||!t.configurable})),call=Function.prototype.call,apply=Function.prototype.apply,addChainableMethod$1=function(e,t,o,n){"function"!=typeof n&&(n=function(){});var r={method:o,chainingBehavior:n};e.__methods||(e.__methods={}),e.__methods[t]=r,Object.defineProperty(e,t,{get:function(){r.chainingBehavior.call(this);var o=function(){flag$1(this,"lockSsfi")||flag$1(this,"ssfi",o);var e=r.method.apply(this,arguments);if(void 0!==e)return e;var t=new chai$1.Assertion;return transferFlags$1(this,t),t};if(addLengthGuard$1(o,t,!0),canSetPrototype){var n=Object.create(this);n.call=call,n.apply=apply,Object.setPrototypeOf(o,n)}else{Object.getOwnPropertyNames(e).forEach((function(t){if(-1===excludeNames.indexOf(t)){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(o,t,n)}}))}return transferFlags$1(this,o),proxify$1(o)},configurable:!0})},overwriteChainableMethod$1=function(e,t,o,n){var r=e.__methods[t],i=r.chainingBehavior;r.chainingBehavior=function(){var e=n(i).call(this);if(void 0!==e)return e;var t=new chai$1.Assertion;return transferFlags$1(this,t),t};var s=r.method;r.method=function(){var e=o(s).apply(this,arguments);if(void 0!==e)return e;var t=new chai$1.Assertion;return transferFlags$1(this,t),t}},compareByInspect$1=function(e,t){return inspect_1(e)<inspect_1(t)?-1:1},getOwnEnumerablePropertySymbols$1=function(e){return"function"!=typeof Object.getOwnPropertySymbols?[]:Object.getOwnPropertySymbols(e).filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))},getOwnEnumerableProperties$1=function(e){return Object.keys(e).concat(getOwnEnumerablePropertySymbols$1(e))};
/*!
 * Chai - overwriteProperty utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */function compatibleInstance(e,t){return t instanceof Error&&e===t}function compatibleConstructor(e,t){return t instanceof Error?e.constructor===t.constructor||e instanceof t.constructor:(t.prototype instanceof Error||t===Error)&&(e.constructor===t||e instanceof t)}function compatibleMessage(e,t){var o="string"==typeof e?e:e.message;return t instanceof RegExp?t.test(o):"string"==typeof t&&-1!==o.indexOf(t)}var functionNameMatch=/\s*function(?:\s|\s*\/\*[^(?:*\/)]+\*\/\s*)*([^\(\/]+)/;function getFunctionName(e){var t="";if(void 0===e.name){var o=String(e).match(functionNameMatch);o&&(t=o[1])}else t=e.name;return t}function getConstructorName(e){var t=e;return e instanceof Error?t=getFunctionName(e.constructor):"function"==typeof e&&(t=getFunctionName(e).trim()||getFunctionName(new e)),t}function getMessage$1(e){var t="";return e&&e.message?t=e.message:"string"==typeof e&&(t=e),t}var checkError$1={compatibleInstance:compatibleInstance,compatibleConstructor:compatibleConstructor,compatibleMessage:compatibleMessage,getMessage:getMessage$1,getConstructorName:getConstructorName};
/*!
 * Chai - isNaN utility
 * Copyright(c) 2012-2015 Sakthipriyan Vairamani <thechargingvolcano@gmail.com>
 * MIT Licensed
 */function isNaN(e){return e!=e}var _isNaN$1=Number.isNaN||isNaN;function isObjectType(e){var t=typeDetect(e);return-1!==["Array","Object","function"].indexOf(t)}var getOperator$1=function(e,t){var o=flag$1(e,"operator"),n=flag$1(e,"negate"),r=t[3],i=n?t[2]:t[1];if(o)return o;if("function"==typeof i&&(i=i()),(i=i||"")&&!/\shave\s/.test(i)){var s=isObjectType(r);return/\snot\s/.test(i)?s?"notDeepStrictEqual":"notStrictEqual":s?"deepStrictEqual":"strictEqual"}},test=test$1,type=typeDetect,expectTypes=expectTypes$1,getMessage=getMessage$2,getActual=getActual$1,inspect=inspect_1,objDisplay=objDisplay$1,flag=flag$1,transferFlags=transferFlags$1,eql=deepEql,getPathInfo=pathval.getPathInfo,hasProperty=pathval.hasProperty,getName=getFuncName_1,addProperty=addProperty$1,addMethod=addMethod$1,overwriteProperty=overwriteProperty$1,overwriteMethod=overwriteMethod$1,addChainableMethod=addChainableMethod$1,overwriteChainableMethod=overwriteChainableMethod$1,compareByInspect=compareByInspect$1,getOwnEnumerablePropertySymbols=getOwnEnumerablePropertySymbols$1,getOwnEnumerableProperties=getOwnEnumerableProperties$1,checkError=checkError$1,proxify=proxify$1,addLengthGuard=addLengthGuard$1,isProxyEnabled=isProxyEnabled$1,_isNaN=_isNaN$1,getOperator=getOperator$1,utils={test:test,type:type,expectTypes:expectTypes,getMessage:getMessage,getActual:getActual,inspect:inspect,objDisplay:objDisplay,flag:flag,transferFlags:transferFlags,eql:eql,getPathInfo:getPathInfo,hasProperty:hasProperty,getName:getName,addProperty:addProperty,addMethod:addMethod,overwriteProperty:overwriteProperty,overwriteMethod:overwriteMethod,addChainableMethod:addChainableMethod,overwriteChainableMethod:overwriteChainableMethod,compareByInspect:compareByInspect,getOwnEnumerablePropertySymbols:getOwnEnumerablePropertySymbols,getOwnEnumerableProperties:getOwnEnumerableProperties,checkError:checkError,proxify:proxify,addLengthGuard:addLengthGuard,isProxyEnabled:isProxyEnabled,isNaN:_isNaN,getOperator:getOperator},assertion=function(e,t){
/*!
   * Module dependencies.
   */
var o=e.AssertionError,n=t.flag;
/*!
   * Module export.
   */
/*!
   * Assertion Constructor
   *
   * Creates object for chaining.
   *
   * `Assertion` objects contain metadata in the form of flags. Three flags can
   * be assigned during instantiation by passing arguments to this constructor:
   *
   * - `object`: This flag contains the target of the assertion. For example, in
   *   the assertion `expect(numKittens).to.equal(7);`, the `object` flag will
   *   contain `numKittens` so that the `equal` assertion can reference it when
   *   needed.
   *
   * - `message`: This flag contains an optional custom error message to be
   *   prepended to the error message that's generated by the assertion when it
   *   fails.
   *
   * - `ssfi`: This flag stands for "start stack function indicator". It
   *   contains a function reference that serves as the starting point for
   *   removing frames from the stack trace of the error that's created by the
   *   assertion when it fails. The goal is to provide a cleaner stack trace to
   *   end users by removing Chai's internal functions. Note that it only works
   *   in environments that support `Error.captureStackTrace`, and only when
   *   `Chai.config.includeStack` hasn't been set to `false`.
   *
   * - `lockSsfi`: This flag controls whether or not the given `ssfi` flag
   *   should retain its current value, even as assertions are chained off of
   *   this object. This is usually set to `true` when creating a new assertion
   *   from within another assertion. It's also temporarily set to `true` before
   *   an overwritten assertion gets called by the overwriting assertion.
   *
   * @param {Mixed} obj target of the assertion
   * @param {String} msg (optional) custom error message
   * @param {Function} ssfi (optional) starting point for removing stack frames
   * @param {Boolean} lockSsfi (optional) whether or not the ssfi flag is locked
   * @api private
   */
function r(e,o,i,s){return n(this,"ssfi",i||r),n(this,"lockSsfi",s),n(this,"object",e),n(this,"message",o),t.proxify(this)}e.Assertion=r,Object.defineProperty(r,"includeStack",{get:function(){return console.warn("Assertion.includeStack is deprecated, use chai.config.includeStack instead."),config.includeStack},set:function(e){console.warn("Assertion.includeStack is deprecated, use chai.config.includeStack instead."),config.includeStack=e}}),Object.defineProperty(r,"showDiff",{get:function(){return console.warn("Assertion.showDiff is deprecated, use chai.config.showDiff instead."),config.showDiff},set:function(e){console.warn("Assertion.showDiff is deprecated, use chai.config.showDiff instead."),config.showDiff=e}}),r.addProperty=function(e,o){t.addProperty(this.prototype,e,o)},r.addMethod=function(e,o){t.addMethod(this.prototype,e,o)},r.addChainableMethod=function(e,o,n){t.addChainableMethod(this.prototype,e,o,n)},r.overwriteProperty=function(e,o){t.overwriteProperty(this.prototype,e,o)},r.overwriteMethod=function(e,o){t.overwriteMethod(this.prototype,e,o)},r.overwriteChainableMethod=function(e,o,n){t.overwriteChainableMethod(this.prototype,e,o,n)},r.prototype.assert=function(e,r,i,s,a,l){var c=t.test(this,arguments);if(!1!==l&&(l=!0),void 0===s&&void 0===a&&(l=!1),!0!==config.showDiff&&(l=!1),!c){r=t.getMessage(this,arguments);var p=t.getActual(this,arguments),u={actual:p,expected:s,showDiff:l},h=t.getOperator(this,arguments);throw h&&(u.operator=h),new o(r,u,config.includeStack?this.assert:n(this,"ssfi"))}},
/*!
   * ### ._obj
   *
   * Quick reference to stored `actual` value for plugin developers.
   *
   * @api private
   */
Object.defineProperty(r.prototype,"_obj",{get:function(){return n(this,"object")},set:function(e){n(this,"object",e)}})},assertions=function(e,t){var o=e.Assertion,n=e.AssertionError,r=t.flag;function i(e,o){o&&r(this,"message",o),e=e.toLowerCase();var n=r(this,"object"),i=~["a","e","i","o","u"].indexOf(e.charAt(0))?"an ":"a ";this.assert(e===t.type(n).toLowerCase(),"expected #{this} to be "+i+e,"expected #{this} not to be "+i+e)}function s(e,o){return t.isNaN(e)&&t.isNaN(o)||e===o}function a(){r(this,"contains",!0)}function l(e,i){i&&r(this,"message",i);var a=r(this,"object"),l=t.type(a).toLowerCase(),c=r(this,"message"),p=r(this,"negate"),u=r(this,"ssfi"),h=r(this,"deep"),d=h?"deep ":"";c=c?c+": ":"";var f=!1;switch(l){case"string":f=-1!==a.indexOf(e);break;case"weakset":if(h)throw new n(c+"unable to use .deep.include with WeakSet",void 0,u);f=a.has(e);break;case"map":var m=h?t.eql:s;a.forEach((function(t){f=f||m(t,e)}));break;case"set":h?a.forEach((function(o){f=f||t.eql(o,e)})):f=a.has(e);break;case"array":f=h?a.some((function(o){return t.eql(o,e)})):-1!==a.indexOf(e);break;default:if(e!==Object(e))throw new n(c+"the given combination of arguments ("+l+" and "+t.type(e).toLowerCase()+") is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a "+t.type(e).toLowerCase(),void 0,u);var y=Object.keys(e),g=null,b=0;if(y.forEach((function(i){var s=new o(a);if(t.transferFlags(this,s,!0),r(s,"lockSsfi",!0),p&&1!==y.length)try{s.property(i,e[i])}catch(e){if(!t.checkError.compatibleConstructor(e,n))throw e;null===g&&(g=e),b++}else s.property(i,e[i])}),this),p&&y.length>1&&b===y.length)throw g;return}this.assert(f,"expected #{this} to "+d+"include "+t.inspect(e),"expected #{this} to not "+d+"include "+t.inspect(e))}function c(){var e=r(this,"object");this.assert(null!=e,"expected #{this} to exist","expected #{this} to not exist")}function p(){var e=r(this,"object"),o=t.type(e);this.assert("Arguments"===o,"expected #{this} to be arguments but got "+o,"expected #{this} to not be arguments")}function u(e,t){t&&r(this,"message",t);var o=r(this,"object");if(r(this,"deep")){var n=r(this,"lockSsfi");r(this,"lockSsfi",!0),this.eql(e),r(this,"lockSsfi",n)}else this.assert(e===o,"expected #{this} to equal #{exp}","expected #{this} to not equal #{exp}",e,this._obj,!0)}function h(e,o){o&&r(this,"message",o),this.assert(t.eql(e,r(this,"object")),"expected #{this} to deeply equal #{exp}","expected #{this} to not deeply equal #{exp}",e,this._obj,!0)}function d(e,i){i&&r(this,"message",i);var s,a=r(this,"object"),l=r(this,"doLength"),c=r(this,"message"),p=c?c+": ":"",u=r(this,"ssfi"),h=t.type(a).toLowerCase(),d=t.type(e).toLowerCase(),f=!0;if(l&&"map"!==h&&"set"!==h&&new o(a,c,u,!0).to.have.property("length"),l||"date"!==h||"date"===d)if("number"===d||!l&&"number"!==h)if(l||"date"===h||"number"===h)f=!1;else{s=p+"expected "+("string"===h?"'"+a+"'":a)+" to be a number or a date"}else s=p+"the argument to above must be a number";else s=p+"the argument to above must be a date";if(f)throw new n(s,void 0,u);if(l){var m,y="length";"map"===h||"set"===h?(y="size",m=a.size):m=a.length,this.assert(m>e,"expected #{this} to have a "+y+" above #{exp} but got #{act}","expected #{this} to not have a "+y+" above #{exp}",e,m)}else this.assert(a>e,"expected #{this} to be above #{exp}","expected #{this} to be at most #{exp}",e)}function f(e,i){i&&r(this,"message",i);var s,a=r(this,"object"),l=r(this,"doLength"),c=r(this,"message"),p=c?c+": ":"",u=r(this,"ssfi"),h=t.type(a).toLowerCase(),d=t.type(e).toLowerCase(),f=!0;if(l&&"map"!==h&&"set"!==h&&new o(a,c,u,!0).to.have.property("length"),l||"date"!==h||"date"===d)if("number"===d||!l&&"number"!==h)if(l||"date"===h||"number"===h)f=!1;else{s=p+"expected "+("string"===h?"'"+a+"'":a)+" to be a number or a date"}else s=p+"the argument to least must be a number";else s=p+"the argument to least must be a date";if(f)throw new n(s,void 0,u);if(l){var m,y="length";"map"===h||"set"===h?(y="size",m=a.size):m=a.length,this.assert(m>=e,"expected #{this} to have a "+y+" at least #{exp} but got #{act}","expected #{this} to have a "+y+" below #{exp}",e,m)}else this.assert(a>=e,"expected #{this} to be at least #{exp}","expected #{this} to be below #{exp}",e)}function m(e,i){i&&r(this,"message",i);var s,a=r(this,"object"),l=r(this,"doLength"),c=r(this,"message"),p=c?c+": ":"",u=r(this,"ssfi"),h=t.type(a).toLowerCase(),d=t.type(e).toLowerCase(),f=!0;if(l&&"map"!==h&&"set"!==h&&new o(a,c,u,!0).to.have.property("length"),l||"date"!==h||"date"===d)if("number"===d||!l&&"number"!==h)if(l||"date"===h||"number"===h)f=!1;else{s=p+"expected "+("string"===h?"'"+a+"'":a)+" to be a number or a date"}else s=p+"the argument to below must be a number";else s=p+"the argument to below must be a date";if(f)throw new n(s,void 0,u);if(l){var m,y="length";"map"===h||"set"===h?(y="size",m=a.size):m=a.length,this.assert(m<e,"expected #{this} to have a "+y+" below #{exp} but got #{act}","expected #{this} to not have a "+y+" below #{exp}",e,m)}else this.assert(a<e,"expected #{this} to be below #{exp}","expected #{this} to be at least #{exp}",e)}function y(e,i){i&&r(this,"message",i);var s,a=r(this,"object"),l=r(this,"doLength"),c=r(this,"message"),p=c?c+": ":"",u=r(this,"ssfi"),h=t.type(a).toLowerCase(),d=t.type(e).toLowerCase(),f=!0;if(l&&"map"!==h&&"set"!==h&&new o(a,c,u,!0).to.have.property("length"),l||"date"!==h||"date"===d)if("number"===d||!l&&"number"!==h)if(l||"date"===h||"number"===h)f=!1;else{s=p+"expected "+("string"===h?"'"+a+"'":a)+" to be a number or a date"}else s=p+"the argument to most must be a number";else s=p+"the argument to most must be a date";if(f)throw new n(s,void 0,u);if(l){var m,y="length";"map"===h||"set"===h?(y="size",m=a.size):m=a.length,this.assert(m<=e,"expected #{this} to have a "+y+" at most #{exp} but got #{act}","expected #{this} to have a "+y+" above #{exp}",e,m)}else this.assert(a<=e,"expected #{this} to be at most #{exp}","expected #{this} to be above #{exp}",e)}function g(e,o){o&&r(this,"message",o);var i=r(this,"object"),s=r(this,"ssfi"),a=r(this,"message");try{var l=i instanceof e}catch(o){if(o instanceof TypeError)throw new n((a=a?a+": ":"")+"The instanceof assertion needs a constructor but "+t.type(e)+" was given.",void 0,s);throw o}var c=t.getName(e);null===c&&(c="an unnamed constructor"),this.assert(l,"expected #{this} to be an instance of "+c,"expected #{this} to not be an instance of "+c)}function b(e,o,i){i&&r(this,"message",i);var s=r(this,"nested"),a=r(this,"own"),l=r(this,"message"),c=r(this,"object"),p=r(this,"ssfi"),u=typeof e;if(l=l?l+": ":"",s){if("string"!==u)throw new n(l+"the argument to property must be a string when using nested syntax",void 0,p)}else if("string"!==u&&"number"!==u&&"symbol"!==u)throw new n(l+"the argument to property must be a string, number, or symbol",void 0,p);if(s&&a)throw new n(l+'The "nested" and "own" flags cannot be combined.',void 0,p);if(null==c)throw new n(l+"Target cannot be null or undefined.",void 0,p);var h,d=r(this,"deep"),f=r(this,"negate"),m=s?t.getPathInfo(c,e):null,y=s?m.value:c[e],g="";d&&(g+="deep "),a&&(g+="own "),s&&(g+="nested "),g+="property ",h=a?Object.prototype.hasOwnProperty.call(c,e):s?m.exists:t.hasProperty(c,e),f&&1!==arguments.length||this.assert(h,"expected #{this} to have "+g+t.inspect(e),"expected #{this} to not have "+g+t.inspect(e)),arguments.length>1&&this.assert(h&&(d?t.eql(o,y):o===y),"expected #{this} to have "+g+t.inspect(e)+" of #{exp}, but got #{act}","expected #{this} to not have "+g+t.inspect(e)+" of #{act}",o,y),r(this,"object",y)}function w(e,t,o){r(this,"own",!0),b.apply(this,arguments)}function v(e,o,n){"string"==typeof o&&(n=o,o=null),n&&r(this,"message",n);var i=r(this,"object"),s=Object.getOwnPropertyDescriptor(Object(i),e);s&&o?this.assert(t.eql(o,s),"expected the own property descriptor for "+t.inspect(e)+" on #{this} to match "+t.inspect(o)+", got "+t.inspect(s),"expected the own property descriptor for "+t.inspect(e)+" on #{this} to not match "+t.inspect(o),o,s,!0):this.assert(s,"expected #{this} to have an own property descriptor for "+t.inspect(e),"expected #{this} to not have an own property descriptor for "+t.inspect(e)),r(this,"object",s)}function x(){r(this,"doLength",!0)}function $(e,n){n&&r(this,"message",n);var i,s=r(this,"object"),a=t.type(s).toLowerCase(),l=r(this,"message"),c=r(this,"ssfi"),p="length";switch(a){case"map":case"set":p="size",i=s.size;break;default:new o(s,l,c,!0).to.have.property("length"),i=s.length}this.assert(i==e,"expected #{this} to have a "+p+" of #{exp} but got #{act}","expected #{this} to not have a "+p+" of #{act}",e,i)}function S(e,t){t&&r(this,"message",t);var o=r(this,"object");this.assert(e.exec(o),"expected #{this} to match "+e,"expected #{this} not to match "+e)}function k(e){var o,i,s=r(this,"object"),a=t.type(s),l=t.type(e),c=r(this,"ssfi"),p=r(this,"deep"),u="",h=!0,d=r(this,"message"),f=(d=d?d+": ":"")+"when testing keys against an object or an array you must give a single Array|Object|String argument or multiple String arguments";if("Map"===a||"Set"===a)u=p?"deeply ":"",i=[],s.forEach((function(e,t){i.push(t)})),"Array"!==l&&(e=Array.prototype.slice.call(arguments));else{switch(i=t.getOwnEnumerableProperties(s),l){case"Array":if(arguments.length>1)throw new n(f,void 0,c);break;case"Object":if(arguments.length>1)throw new n(f,void 0,c);e=Object.keys(e);break;default:e=Array.prototype.slice.call(arguments)}e=e.map((function(e){return"symbol"==typeof e?e:String(e)}))}if(!e.length)throw new n(d+"keys required",void 0,c);var m=e.length,y=r(this,"any"),g=r(this,"all"),b=e;if(y||g||(g=!0),y&&(h=b.some((function(e){return i.some((function(o){return p?t.eql(e,o):e===o}))}))),g&&(h=b.every((function(e){return i.some((function(o){return p?t.eql(e,o):e===o}))})),r(this,"contains")||(h=h&&e.length==i.length)),m>1){var w=(e=e.map((function(e){return t.inspect(e)}))).pop();g&&(o=e.join(", ")+", and "+w),y&&(o=e.join(", ")+", or "+w)}else o=t.inspect(e[0]);o=(m>1?"keys ":"key ")+o,o=(r(this,"contains")?"contain ":"have ")+o,this.assert(h,"expected #{this} to "+u+o,"expected #{this} to not "+u+o,b.slice(0).sort(t.compareByInspect),i.sort(t.compareByInspect),!0)}function M(e,n,i){i&&r(this,"message",i);var s,a=r(this,"object"),l=r(this,"ssfi"),c=r(this,"message"),p=r(this,"negate")||!1;new o(a,c,l,!0).is.a("function"),(e instanceof RegExp||"string"==typeof e)&&(n=e,e=null);try{a()}catch(e){s=e}var u=void 0===e&&void 0===n,h=Boolean(e&&n),d=!1,f=!1;if(u||!u&&!p){var m="an error";e instanceof Error?m="#{exp}":e&&(m=t.checkError.getConstructorName(e)),this.assert(s,"expected #{this} to throw "+m,"expected #{this} to not throw an error but #{act} was thrown",e&&e.toString(),s instanceof Error?s.toString():"string"==typeof s?s:s&&t.checkError.getConstructorName(s))}if(e&&s){if(e instanceof Error)t.checkError.compatibleInstance(s,e)===p&&(h&&p?d=!0:this.assert(p,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}"+(s&&!p?" but #{act} was thrown":""),e.toString(),s.toString()));t.checkError.compatibleConstructor(s,e)===p&&(h&&p?d=!0:this.assert(p,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}"+(s?" but #{act} was thrown":""),e instanceof Error?e.toString():e&&t.checkError.getConstructorName(e),s instanceof Error?s.toString():s&&t.checkError.getConstructorName(s)))}if(s&&null!=n){var y="including";n instanceof RegExp&&(y="matching"),t.checkError.compatibleMessage(s,n)===p&&(h&&p?f=!0:this.assert(p,"expected #{this} to throw error "+y+" #{exp} but got #{act}","expected #{this} to throw error not "+y+" #{exp}",n,t.checkError.getMessage(s)))}d&&f&&this.assert(p,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}"+(s?" but #{act} was thrown":""),e instanceof Error?e.toString():e&&t.checkError.getConstructorName(e),s instanceof Error?s.toString():s&&t.checkError.getConstructorName(s)),r(this,"object",s)}function E(e,o){o&&r(this,"message",o);var n=r(this,"object"),i=r(this,"itself"),s="function"!=typeof n||i?n[e]:n.prototype[e];this.assert("function"==typeof s,"expected #{this} to respond to "+t.inspect(e),"expected #{this} to not respond to "+t.inspect(e))}function N(e,o){o&&r(this,"message",o);var n=e(r(this,"object"));this.assert(n,"expected #{this} to satisfy "+t.objDisplay(e),"expected #{this} to not satisfy"+t.objDisplay(e),!r(this,"negate"),n)}function O(e,t,i){i&&r(this,"message",i);var s=r(this,"object"),a=r(this,"message"),l=r(this,"ssfi");if(new o(s,a,l,!0).is.a("number"),"number"!=typeof e||"number"!=typeof t)throw new n((a=a?a+": ":"")+"the arguments to closeTo or approximately must be numbers"+(void 0===t?", and a delta is required":""),void 0,l);this.assert(Math.abs(s-e)<=t,"expected #{this} to be close to "+e+" +/- "+t,"expected #{this} not to be close to "+e+" +/- "+t)}function j(e,t,n){n&&r(this,"message",n);var i,s=r(this,"object"),a=r(this,"message"),l=r(this,"ssfi");new o(s,a,l,!0).is.a("function"),t?(new o(e,a,l,!0).to.have.property(t),i=e[t]):(new o(e,a,l,!0).is.a("function"),i=e()),s();var c=null==t?e():e[t],p=null==t?i:"."+t;r(this,"deltaMsgObj",p),r(this,"initialDeltaValue",i),r(this,"finalDeltaValue",c),r(this,"deltaBehavior","change"),r(this,"realDelta",c!==i),this.assert(i!==c,"expected "+p+" to change","expected "+p+" to not change")}function P(e,t,n){n&&r(this,"message",n);var i,s=r(this,"object"),a=r(this,"message"),l=r(this,"ssfi");new o(s,a,l,!0).is.a("function"),t?(new o(e,a,l,!0).to.have.property(t),i=e[t]):(new o(e,a,l,!0).is.a("function"),i=e()),new o(i,a,l,!0).is.a("number"),s();var c=null==t?e():e[t],p=null==t?i:"."+t;r(this,"deltaMsgObj",p),r(this,"initialDeltaValue",i),r(this,"finalDeltaValue",c),r(this,"deltaBehavior","increase"),r(this,"realDelta",c-i),this.assert(c-i>0,"expected "+p+" to increase","expected "+p+" to not increase")}function T(e,t,n){n&&r(this,"message",n);var i,s=r(this,"object"),a=r(this,"message"),l=r(this,"ssfi");new o(s,a,l,!0).is.a("function"),t?(new o(e,a,l,!0).to.have.property(t),i=e[t]):(new o(e,a,l,!0).is.a("function"),i=e()),new o(i,a,l,!0).is.a("number"),s();var c=null==t?e():e[t],p=null==t?i:"."+t;r(this,"deltaMsgObj",p),r(this,"initialDeltaValue",i),r(this,"finalDeltaValue",c),r(this,"deltaBehavior","decrease"),r(this,"realDelta",i-c),this.assert(c-i<0,"expected "+p+" to decrease","expected "+p+" to not decrease")}["to","be","been","is","and","has","have","with","that","which","at","of","same","but","does","still","also"].forEach((function(e){o.addProperty(e)})),o.addProperty("not",(function(){r(this,"negate",!0)})),o.addProperty("deep",(function(){r(this,"deep",!0)})),o.addProperty("nested",(function(){r(this,"nested",!0)})),o.addProperty("own",(function(){r(this,"own",!0)})),o.addProperty("ordered",(function(){r(this,"ordered",!0)})),o.addProperty("any",(function(){r(this,"any",!0),r(this,"all",!1)})),o.addProperty("all",(function(){r(this,"all",!0),r(this,"any",!1)})),o.addChainableMethod("an",i),o.addChainableMethod("a",i),o.addChainableMethod("include",l,a),o.addChainableMethod("contain",l,a),o.addChainableMethod("contains",l,a),o.addChainableMethod("includes",l,a),o.addProperty("ok",(function(){this.assert(r(this,"object"),"expected #{this} to be truthy","expected #{this} to be falsy")})),o.addProperty("true",(function(){this.assert(!0===r(this,"object"),"expected #{this} to be true","expected #{this} to be false",!r(this,"negate"))})),o.addProperty("false",(function(){this.assert(!1===r(this,"object"),"expected #{this} to be false","expected #{this} to be true",!!r(this,"negate"))})),o.addProperty("null",(function(){this.assert(null===r(this,"object"),"expected #{this} to be null","expected #{this} not to be null")})),o.addProperty("undefined",(function(){this.assert(void 0===r(this,"object"),"expected #{this} to be undefined","expected #{this} not to be undefined")})),o.addProperty("NaN",(function(){this.assert(t.isNaN(r(this,"object")),"expected #{this} to be NaN","expected #{this} not to be NaN")})),o.addProperty("exist",c),o.addProperty("exists",c),o.addProperty("empty",(function(){var e,o=r(this,"object"),i=r(this,"ssfi"),s=r(this,"message");switch(s=s?s+": ":"",t.type(o).toLowerCase()){case"array":case"string":e=o.length;break;case"map":case"set":e=o.size;break;case"weakmap":case"weakset":throw new n(s+".empty was passed a weak collection",void 0,i);case"function":var a=s+".empty was passed a function "+t.getName(o);throw new n(a.trim(),void 0,i);default:if(o!==Object(o))throw new n(s+".empty was passed non-string primitive "+t.inspect(o),void 0,i);e=Object.keys(o).length}this.assert(0===e,"expected #{this} to be empty","expected #{this} not to be empty")})),o.addProperty("arguments",p),o.addProperty("Arguments",p),o.addMethod("equal",u),o.addMethod("equals",u),o.addMethod("eq",u),o.addMethod("eql",h),o.addMethod("eqls",h),o.addMethod("above",d),o.addMethod("gt",d),o.addMethod("greaterThan",d),o.addMethod("least",f),o.addMethod("gte",f),o.addMethod("greaterThanOrEqual",f),o.addMethod("below",m),o.addMethod("lt",m),o.addMethod("lessThan",m),o.addMethod("most",y),o.addMethod("lte",y),o.addMethod("lessThanOrEqual",y),o.addMethod("within",(function(e,i,s){s&&r(this,"message",s);var a,l=r(this,"object"),c=r(this,"doLength"),p=r(this,"message"),u=p?p+": ":"",h=r(this,"ssfi"),d=t.type(l).toLowerCase(),f=t.type(e).toLowerCase(),m=t.type(i).toLowerCase(),y=!0,g="date"===f&&"date"===m?e.toUTCString()+".."+i.toUTCString():e+".."+i;if(c&&"map"!==d&&"set"!==d&&new o(l,p,h,!0).to.have.property("length"),c||"date"!==d||"date"===f&&"date"===m)if("number"===f&&"number"===m||!c&&"number"!==d)if(c||"date"===d||"number"===d)y=!1;else{a=u+"expected "+("string"===d?"'"+l+"'":l)+" to be a number or a date"}else a=u+"the arguments to within must be numbers";else a=u+"the arguments to within must be dates";if(y)throw new n(a,void 0,h);if(c){var b,w="length";"map"===d||"set"===d?(w="size",b=l.size):b=l.length,this.assert(b>=e&&b<=i,"expected #{this} to have a "+w+" within "+g,"expected #{this} to not have a "+w+" within "+g)}else this.assert(l>=e&&l<=i,"expected #{this} to be within "+g,"expected #{this} to not be within "+g)})),o.addMethod("instanceof",g),o.addMethod("instanceOf",g),o.addMethod("property",b),o.addMethod("ownProperty",w),o.addMethod("haveOwnProperty",w),o.addMethod("ownPropertyDescriptor",v),o.addMethod("haveOwnPropertyDescriptor",v),o.addChainableMethod("length",$,x),o.addChainableMethod("lengthOf",$,x),o.addMethod("match",S),o.addMethod("matches",S),o.addMethod("string",(function(e,n){n&&r(this,"message",n);var i=r(this,"object"),s=r(this,"message"),a=r(this,"ssfi");new o(i,s,a,!0).is.a("string"),this.assert(~i.indexOf(e),"expected #{this} to contain "+t.inspect(e),"expected #{this} to not contain "+t.inspect(e))})),o.addMethod("keys",k),o.addMethod("key",k),o.addMethod("throw",M),o.addMethod("throws",M),o.addMethod("Throw",M),o.addMethod("respondTo",E),o.addMethod("respondsTo",E),o.addProperty("itself",(function(){r(this,"itself",!0)})),o.addMethod("satisfy",N),o.addMethod("satisfies",N),o.addMethod("closeTo",O),o.addMethod("approximately",O),o.addMethod("members",(function(e,n){n&&r(this,"message",n);var i=r(this,"object"),s=r(this,"message"),a=r(this,"ssfi");new o(i,s,a,!0).to.be.an("array"),new o(e,s,a,!0).to.be.an("array");var l,c,p,u=r(this,"contains"),h=r(this,"ordered");u?(c="expected #{this} to be "+(l=h?"an ordered superset":"a superset")+" of #{exp}",p="expected #{this} to not be "+l+" of #{exp}"):(c="expected #{this} to have the same "+(l=h?"ordered members":"members")+" as #{exp}",p="expected #{this} to not have the same "+l+" as #{exp}");var d=r(this,"deep")?t.eql:void 0;this.assert(function(e,t,o,n,r){if(!n){if(e.length!==t.length)return!1;t=t.slice()}return e.every((function(e,i){if(r)return o?o(e,t[i]):e===t[i];if(!o){var s=t.indexOf(e);return-1!==s&&(n||t.splice(s,1),!0)}return t.some((function(r,i){return!!o(e,r)&&(n||t.splice(i,1),!0)}))}))}(e,i,d,u,h),c,p,e,i,!0)})),o.addMethod("oneOf",(function(e,n){n&&r(this,"message",n);var i=r(this,"object"),s=r(this,"message"),a=r(this,"ssfi"),l=r(this,"contains"),c=r(this,"deep");new o(e,s,a,!0).to.be.an("array"),l?this.assert(e.some((function(e){return i.indexOf(e)>-1})),"expected #{this} to contain one of #{exp}","expected #{this} to not contain one of #{exp}",e,i):c?this.assert(e.some((function(e){return t.eql(i,e)})),"expected #{this} to deeply equal one of #{exp}","expected #{this} to deeply equal one of #{exp}",e,i):this.assert(e.indexOf(i)>-1,"expected #{this} to be one of #{exp}","expected #{this} to not be one of #{exp}",e,i)})),o.addMethod("change",j),o.addMethod("changes",j),o.addMethod("increase",P),o.addMethod("increases",P),o.addMethod("decrease",T),o.addMethod("decreases",T),o.addMethod("by",(function(e,t){t&&r(this,"message",t);var o,n=r(this,"deltaMsgObj"),i=r(this,"initialDeltaValue"),s=r(this,"finalDeltaValue"),a=r(this,"deltaBehavior"),l=r(this,"realDelta");o="change"===a?Math.abs(s-i)===Math.abs(e):l===Math.abs(e),this.assert(o,"expected "+n+" to "+a+" by "+e,"expected "+n+" to not "+a+" by "+e)})),o.addProperty("extensible",(function(){var e=r(this,"object"),t=e===Object(e)&&Object.isExtensible(e);this.assert(t,"expected #{this} to be extensible","expected #{this} to not be extensible")})),o.addProperty("sealed",(function(){var e=r(this,"object"),t=e!==Object(e)||Object.isSealed(e);this.assert(t,"expected #{this} to be sealed","expected #{this} to not be sealed")})),o.addProperty("frozen",(function(){var e=r(this,"object"),t=e!==Object(e)||Object.isFrozen(e);this.assert(t,"expected #{this} to be frozen","expected #{this} to not be frozen")})),o.addProperty("finite",(function(e){var t=r(this,"object");this.assert("number"==typeof t&&isFinite(t),"expected #{this} to be a finite number","expected #{this} to not be a finite number")}))},expect=function(e,t){e.expect=function(t,o){return new e.Assertion(t,o)},e.expect.fail=function(t,o,n,r){throw arguments.length<2&&(n=t,t=void 0),n=n||"expect.fail()",new e.AssertionError(n,{actual:t,expected:o,operator:r},e.expect.fail)}},should=function(e,t){var o=e.Assertion;function n(){Object.defineProperty(Object.prototype,"should",{set:function(e){Object.defineProperty(this,"should",{value:e,enumerable:!0,configurable:!0,writable:!0})},get:function e(){return this instanceof String||this instanceof Number||this instanceof Boolean||"function"==typeof Symbol&&this instanceof Symbol||"function"==typeof BigInt&&this instanceof BigInt?new o(this.valueOf(),null,e):new o(this,null,e)},configurable:!0});var t={fail:function(o,n,r,i){throw arguments.length<2&&(r=o,o=void 0),r=r||"should.fail()",new e.AssertionError(r,{actual:o,expected:n,operator:i},t.fail)},equal:function(e,t,n){new o(e,n).to.equal(t)},Throw:function(e,t,n,r){new o(e,r).to.Throw(t,n)},exist:function(e,t){new o(e,t).to.exist},not:{}};return t.not.equal=function(e,t,n){new o(e,n).to.not.equal(t)},t.not.Throw=function(e,t,n,r){new o(e,r).to.not.Throw(t,n)},t.not.exist=function(e,t){new o(e,t).to.not.exist},t.throw=t.Throw,t.not.throw=t.not.Throw,t}e.should=n,e.Should=n},assert=function(e,t){
/*!
   * Chai dependencies.
   */
var o=e.Assertion,n=t.flag,r=e.assert=function(t,n){new o(null,null,e.assert,!0).assert(t,n,"[ negation message unavailable ]")};
/*!
   * Module export.
   */r.fail=function(t,o,n,i){throw arguments.length<2&&(n=t,t=void 0),n=n||"assert.fail()",new e.AssertionError(n,{actual:t,expected:o,operator:i},r.fail)},r.isOk=function(e,t){new o(e,t,r.isOk,!0).is.ok},r.isNotOk=function(e,t){new o(e,t,r.isNotOk,!0).is.not.ok},r.equal=function(e,t,i){var s=new o(e,i,r.equal,!0);s.assert(t==n(s,"object"),"expected #{this} to equal #{exp}","expected #{this} to not equal #{act}",t,e,!0)},r.notEqual=function(e,t,i){var s=new o(e,i,r.notEqual,!0);s.assert(t!=n(s,"object"),"expected #{this} to not equal #{exp}","expected #{this} to equal #{act}",t,e,!0)},r.strictEqual=function(e,t,n){new o(e,n,r.strictEqual,!0).to.equal(t)},r.notStrictEqual=function(e,t,n){new o(e,n,r.notStrictEqual,!0).to.not.equal(t)},r.deepEqual=r.deepStrictEqual=function(e,t,n){new o(e,n,r.deepEqual,!0).to.eql(t)},r.notDeepEqual=function(e,t,n){new o(e,n,r.notDeepEqual,!0).to.not.eql(t)},r.isAbove=function(e,t,n){new o(e,n,r.isAbove,!0).to.be.above(t)},r.isAtLeast=function(e,t,n){new o(e,n,r.isAtLeast,!0).to.be.least(t)},r.isBelow=function(e,t,n){new o(e,n,r.isBelow,!0).to.be.below(t)},r.isAtMost=function(e,t,n){new o(e,n,r.isAtMost,!0).to.be.most(t)},r.isTrue=function(e,t){new o(e,t,r.isTrue,!0).is.true},r.isNotTrue=function(e,t){new o(e,t,r.isNotTrue,!0).to.not.equal(!0)},r.isFalse=function(e,t){new o(e,t,r.isFalse,!0).is.false},r.isNotFalse=function(e,t){new o(e,t,r.isNotFalse,!0).to.not.equal(!1)},r.isNull=function(e,t){new o(e,t,r.isNull,!0).to.equal(null)},r.isNotNull=function(e,t){new o(e,t,r.isNotNull,!0).to.not.equal(null)},r.isNaN=function(e,t){new o(e,t,r.isNaN,!0).to.be.NaN},r.isNotNaN=function(e,t){new o(e,t,r.isNotNaN,!0).not.to.be.NaN},r.exists=function(e,t){new o(e,t,r.exists,!0).to.exist},r.notExists=function(e,t){new o(e,t,r.notExists,!0).to.not.exist},r.isUndefined=function(e,t){new o(e,t,r.isUndefined,!0).to.equal(void 0)},r.isDefined=function(e,t){new o(e,t,r.isDefined,!0).to.not.equal(void 0)},r.isFunction=function(e,t){new o(e,t,r.isFunction,!0).to.be.a("function")},r.isNotFunction=function(e,t){new o(e,t,r.isNotFunction,!0).to.not.be.a("function")},r.isObject=function(e,t){new o(e,t,r.isObject,!0).to.be.a("object")},r.isNotObject=function(e,t){new o(e,t,r.isNotObject,!0).to.not.be.a("object")},r.isArray=function(e,t){new o(e,t,r.isArray,!0).to.be.an("array")},r.isNotArray=function(e,t){new o(e,t,r.isNotArray,!0).to.not.be.an("array")},r.isString=function(e,t){new o(e,t,r.isString,!0).to.be.a("string")},r.isNotString=function(e,t){new o(e,t,r.isNotString,!0).to.not.be.a("string")},r.isNumber=function(e,t){new o(e,t,r.isNumber,!0).to.be.a("number")},r.isNotNumber=function(e,t){new o(e,t,r.isNotNumber,!0).to.not.be.a("number")},r.isFinite=function(e,t){new o(e,t,r.isFinite,!0).to.be.finite},r.isBoolean=function(e,t){new o(e,t,r.isBoolean,!0).to.be.a("boolean")},r.isNotBoolean=function(e,t){new o(e,t,r.isNotBoolean,!0).to.not.be.a("boolean")},r.typeOf=function(e,t,n){new o(e,n,r.typeOf,!0).to.be.a(t)},r.notTypeOf=function(e,t,n){new o(e,n,r.notTypeOf,!0).to.not.be.a(t)},r.instanceOf=function(e,t,n){new o(e,n,r.instanceOf,!0).to.be.instanceOf(t)},r.notInstanceOf=function(e,t,n){new o(e,n,r.notInstanceOf,!0).to.not.be.instanceOf(t)},r.include=function(e,t,n){new o(e,n,r.include,!0).include(t)},r.notInclude=function(e,t,n){new o(e,n,r.notInclude,!0).not.include(t)},r.deepInclude=function(e,t,n){new o(e,n,r.deepInclude,!0).deep.include(t)},r.notDeepInclude=function(e,t,n){new o(e,n,r.notDeepInclude,!0).not.deep.include(t)},r.nestedInclude=function(e,t,n){new o(e,n,r.nestedInclude,!0).nested.include(t)},r.notNestedInclude=function(e,t,n){new o(e,n,r.notNestedInclude,!0).not.nested.include(t)},r.deepNestedInclude=function(e,t,n){new o(e,n,r.deepNestedInclude,!0).deep.nested.include(t)},r.notDeepNestedInclude=function(e,t,n){new o(e,n,r.notDeepNestedInclude,!0).not.deep.nested.include(t)},r.ownInclude=function(e,t,n){new o(e,n,r.ownInclude,!0).own.include(t)},r.notOwnInclude=function(e,t,n){new o(e,n,r.notOwnInclude,!0).not.own.include(t)},r.deepOwnInclude=function(e,t,n){new o(e,n,r.deepOwnInclude,!0).deep.own.include(t)},r.notDeepOwnInclude=function(e,t,n){new o(e,n,r.notDeepOwnInclude,!0).not.deep.own.include(t)},r.match=function(e,t,n){new o(e,n,r.match,!0).to.match(t)},r.notMatch=function(e,t,n){new o(e,n,r.notMatch,!0).to.not.match(t)},r.property=function(e,t,n){new o(e,n,r.property,!0).to.have.property(t)},r.notProperty=function(e,t,n){new o(e,n,r.notProperty,!0).to.not.have.property(t)},r.propertyVal=function(e,t,n,i){new o(e,i,r.propertyVal,!0).to.have.property(t,n)},r.notPropertyVal=function(e,t,n,i){new o(e,i,r.notPropertyVal,!0).to.not.have.property(t,n)},r.deepPropertyVal=function(e,t,n,i){new o(e,i,r.deepPropertyVal,!0).to.have.deep.property(t,n)},r.notDeepPropertyVal=function(e,t,n,i){new o(e,i,r.notDeepPropertyVal,!0).to.not.have.deep.property(t,n)},r.ownProperty=function(e,t,n){new o(e,n,r.ownProperty,!0).to.have.own.property(t)},r.notOwnProperty=function(e,t,n){new o(e,n,r.notOwnProperty,!0).to.not.have.own.property(t)},r.ownPropertyVal=function(e,t,n,i){new o(e,i,r.ownPropertyVal,!0).to.have.own.property(t,n)},r.notOwnPropertyVal=function(e,t,n,i){new o(e,i,r.notOwnPropertyVal,!0).to.not.have.own.property(t,n)},r.deepOwnPropertyVal=function(e,t,n,i){new o(e,i,r.deepOwnPropertyVal,!0).to.have.deep.own.property(t,n)},r.notDeepOwnPropertyVal=function(e,t,n,i){new o(e,i,r.notDeepOwnPropertyVal,!0).to.not.have.deep.own.property(t,n)},r.nestedProperty=function(e,t,n){new o(e,n,r.nestedProperty,!0).to.have.nested.property(t)},r.notNestedProperty=function(e,t,n){new o(e,n,r.notNestedProperty,!0).to.not.have.nested.property(t)},r.nestedPropertyVal=function(e,t,n,i){new o(e,i,r.nestedPropertyVal,!0).to.have.nested.property(t,n)},r.notNestedPropertyVal=function(e,t,n,i){new o(e,i,r.notNestedPropertyVal,!0).to.not.have.nested.property(t,n)},r.deepNestedPropertyVal=function(e,t,n,i){new o(e,i,r.deepNestedPropertyVal,!0).to.have.deep.nested.property(t,n)},r.notDeepNestedPropertyVal=function(e,t,n,i){new o(e,i,r.notDeepNestedPropertyVal,!0).to.not.have.deep.nested.property(t,n)},r.lengthOf=function(e,t,n){new o(e,n,r.lengthOf,!0).to.have.lengthOf(t)},r.hasAnyKeys=function(e,t,n){new o(e,n,r.hasAnyKeys,!0).to.have.any.keys(t)},r.hasAllKeys=function(e,t,n){new o(e,n,r.hasAllKeys,!0).to.have.all.keys(t)},r.containsAllKeys=function(e,t,n){new o(e,n,r.containsAllKeys,!0).to.contain.all.keys(t)},r.doesNotHaveAnyKeys=function(e,t,n){new o(e,n,r.doesNotHaveAnyKeys,!0).to.not.have.any.keys(t)},r.doesNotHaveAllKeys=function(e,t,n){new o(e,n,r.doesNotHaveAllKeys,!0).to.not.have.all.keys(t)},r.hasAnyDeepKeys=function(e,t,n){new o(e,n,r.hasAnyDeepKeys,!0).to.have.any.deep.keys(t)},r.hasAllDeepKeys=function(e,t,n){new o(e,n,r.hasAllDeepKeys,!0).to.have.all.deep.keys(t)},r.containsAllDeepKeys=function(e,t,n){new o(e,n,r.containsAllDeepKeys,!0).to.contain.all.deep.keys(t)},r.doesNotHaveAnyDeepKeys=function(e,t,n){new o(e,n,r.doesNotHaveAnyDeepKeys,!0).to.not.have.any.deep.keys(t)},r.doesNotHaveAllDeepKeys=function(e,t,n){new o(e,n,r.doesNotHaveAllDeepKeys,!0).to.not.have.all.deep.keys(t)},r.throws=function(e,t,i,s){("string"==typeof t||t instanceof RegExp)&&(i=t,t=null);var a=new o(e,s,r.throws,!0).to.throw(t,i);return n(a,"object")},r.doesNotThrow=function(e,t,n,i){("string"==typeof t||t instanceof RegExp)&&(n=t,t=null),new o(e,i,r.doesNotThrow,!0).to.not.throw(t,n)},r.operator=function(i,s,a,l){var c;switch(s){case"==":c=i==a;break;case"===":c=i===a;break;case">":c=i>a;break;case">=":c=i>=a;break;case"<":c=i<a;break;case"<=":c=i<=a;break;case"!=":c=i!=a;break;case"!==":c=i!==a;break;default:throw l=l?l+": ":l,new e.AssertionError(l+'Invalid operator "'+s+'"',void 0,r.operator)}var p=new o(c,l,r.operator,!0);p.assert(!0===n(p,"object"),"expected "+t.inspect(i)+" to be "+s+" "+t.inspect(a),"expected "+t.inspect(i)+" to not be "+s+" "+t.inspect(a))},r.closeTo=function(e,t,n,i){new o(e,i,r.closeTo,!0).to.be.closeTo(t,n)},r.approximately=function(e,t,n,i){new o(e,i,r.approximately,!0).to.be.approximately(t,n)},r.sameMembers=function(e,t,n){new o(e,n,r.sameMembers,!0).to.have.same.members(t)},r.notSameMembers=function(e,t,n){new o(e,n,r.notSameMembers,!0).to.not.have.same.members(t)},r.sameDeepMembers=function(e,t,n){new o(e,n,r.sameDeepMembers,!0).to.have.same.deep.members(t)},r.notSameDeepMembers=function(e,t,n){new o(e,n,r.notSameDeepMembers,!0).to.not.have.same.deep.members(t)},r.sameOrderedMembers=function(e,t,n){new o(e,n,r.sameOrderedMembers,!0).to.have.same.ordered.members(t)},r.notSameOrderedMembers=function(e,t,n){new o(e,n,r.notSameOrderedMembers,!0).to.not.have.same.ordered.members(t)},r.sameDeepOrderedMembers=function(e,t,n){new o(e,n,r.sameDeepOrderedMembers,!0).to.have.same.deep.ordered.members(t)},r.notSameDeepOrderedMembers=function(e,t,n){new o(e,n,r.notSameDeepOrderedMembers,!0).to.not.have.same.deep.ordered.members(t)},r.includeMembers=function(e,t,n){new o(e,n,r.includeMembers,!0).to.include.members(t)},r.notIncludeMembers=function(e,t,n){new o(e,n,r.notIncludeMembers,!0).to.not.include.members(t)},r.includeDeepMembers=function(e,t,n){new o(e,n,r.includeDeepMembers,!0).to.include.deep.members(t)},r.notIncludeDeepMembers=function(e,t,n){new o(e,n,r.notIncludeDeepMembers,!0).to.not.include.deep.members(t)},r.includeOrderedMembers=function(e,t,n){new o(e,n,r.includeOrderedMembers,!0).to.include.ordered.members(t)},r.notIncludeOrderedMembers=function(e,t,n){new o(e,n,r.notIncludeOrderedMembers,!0).to.not.include.ordered.members(t)},r.includeDeepOrderedMembers=function(e,t,n){new o(e,n,r.includeDeepOrderedMembers,!0).to.include.deep.ordered.members(t)},r.notIncludeDeepOrderedMembers=function(e,t,n){new o(e,n,r.notIncludeDeepOrderedMembers,!0).to.not.include.deep.ordered.members(t)},r.oneOf=function(e,t,n){new o(e,n,r.oneOf,!0).to.be.oneOf(t)},r.changes=function(e,t,n,i){3===arguments.length&&"function"==typeof t&&(i=n,n=null),new o(e,i,r.changes,!0).to.change(t,n)},r.changesBy=function(e,t,n,i,s){if(4===arguments.length&&"function"==typeof t){var a=i;i=n,s=a}else 3===arguments.length&&(i=n,n=null);new o(e,s,r.changesBy,!0).to.change(t,n).by(i)},r.doesNotChange=function(e,t,n,i){return 3===arguments.length&&"function"==typeof t&&(i=n,n=null),new o(e,i,r.doesNotChange,!0).to.not.change(t,n)},r.changesButNotBy=function(e,t,n,i,s){if(4===arguments.length&&"function"==typeof t){var a=i;i=n,s=a}else 3===arguments.length&&(i=n,n=null);new o(e,s,r.changesButNotBy,!0).to.change(t,n).but.not.by(i)},r.increases=function(e,t,n,i){return 3===arguments.length&&"function"==typeof t&&(i=n,n=null),new o(e,i,r.increases,!0).to.increase(t,n)},r.increasesBy=function(e,t,n,i,s){if(4===arguments.length&&"function"==typeof t){var a=i;i=n,s=a}else 3===arguments.length&&(i=n,n=null);new o(e,s,r.increasesBy,!0).to.increase(t,n).by(i)},r.doesNotIncrease=function(e,t,n,i){return 3===arguments.length&&"function"==typeof t&&(i=n,n=null),new o(e,i,r.doesNotIncrease,!0).to.not.increase(t,n)},r.increasesButNotBy=function(e,t,n,i,s){if(4===arguments.length&&"function"==typeof t){var a=i;i=n,s=a}else 3===arguments.length&&(i=n,n=null);new o(e,s,r.increasesButNotBy,!0).to.increase(t,n).but.not.by(i)},r.decreases=function(e,t,n,i){return 3===arguments.length&&"function"==typeof t&&(i=n,n=null),new o(e,i,r.decreases,!0).to.decrease(t,n)},r.decreasesBy=function(e,t,n,i,s){if(4===arguments.length&&"function"==typeof t){var a=i;i=n,s=a}else 3===arguments.length&&(i=n,n=null);new o(e,s,r.decreasesBy,!0).to.decrease(t,n).by(i)},r.doesNotDecrease=function(e,t,n,i){return 3===arguments.length&&"function"==typeof t&&(i=n,n=null),new o(e,i,r.doesNotDecrease,!0).to.not.decrease(t,n)},r.doesNotDecreaseBy=function(e,t,n,i,s){if(4===arguments.length&&"function"==typeof t){var a=i;i=n,s=a}else 3===arguments.length&&(i=n,n=null);return new o(e,s,r.doesNotDecreaseBy,!0).to.not.decrease(t,n).by(i)},r.decreasesButNotBy=function(e,t,n,i,s){if(4===arguments.length&&"function"==typeof t){var a=i;i=n,s=a}else 3===arguments.length&&(i=n,n=null);new o(e,s,r.decreasesButNotBy,!0).to.decrease(t,n).but.not.by(i)},
/*!
   * ### .ifError(object)
   *
   * Asserts if value is not a false value, and throws if it is a true value.
   * This is added to allow for chai to be a drop-in replacement for Node's
   * assert class.
   *
   *     var err = new Error('I am a custom error');
   *     assert.ifError(err); // Rethrows err!
   *
   * @name ifError
   * @param {Object} object
   * @namespace Assert
   * @api public
   */
r.ifError=function(e){if(e)throw e},r.isExtensible=function(e,t){new o(e,t,r.isExtensible,!0).to.be.extensible},r.isNotExtensible=function(e,t){new o(e,t,r.isNotExtensible,!0).to.not.be.extensible},r.isSealed=function(e,t){new o(e,t,r.isSealed,!0).to.be.sealed},r.isNotSealed=function(e,t){new o(e,t,r.isNotSealed,!0).to.not.be.sealed},r.isFrozen=function(e,t){new o(e,t,r.isFrozen,!0).to.be.frozen},r.isNotFrozen=function(e,t){new o(e,t,r.isNotFrozen,!0).to.not.be.frozen},r.isEmpty=function(e,t){new o(e,t,r.isEmpty,!0).to.be.empty},r.isNotEmpty=function(e,t){new o(e,t,r.isNotEmpty,!0).to.not.be.empty},
/*!
   * Aliases.
   */
function e(t,o){return r[o]=r[t],e}("isOk","ok")("isNotOk","notOk")("throws","throw")("throws","Throw")("isExtensible","extensible")("isNotExtensible","notExtensible")("isSealed","sealed")("isNotSealed","notSealed")("isFrozen","frozen")("isNotFrozen","notFrozen")("isEmpty","empty")("isNotEmpty","notEmpty")},chai$1=createCommonjsModule((function(e,t){var o=[];
/*!
 * Chai version
 */t.version="4.3.3",
/*!
 * Assertion Error
 */
t.AssertionError=assertionError,
/*!
 * Utils for plugins (not exported)
 */
t.use=function(e){return~o.indexOf(e)||(e(t,utils),o.push(e)),t},
/*!
 * Utility Functions
 */
t.util=utils,
/*!
 * Configuration
 */
t.config=config,
/*!
 * Primary `Assertion` prototype
 */
t.use(assertion),
/*!
 * Core Assertions
 */
t.use(assertions),
/*!
 * Expect interface
 */
t.use(expect),
/*!
 * Should interface
 */
t.use(should),
/*!
 * Assert interface
 */
t.use(assert)})),chai=chai$1;
/*!
 * chai
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
/*!
 * Dependencies that are used for multiple exports are required here only once
 */
/*!
 * test utility
 */chai.expect,chai.version,chai.Assertion,chai.AssertionError,chai.util,chai.config,chai.use,chai.should,chai.assert,chai.core;class Engine{constructor(){if(Engine.instance)return Engine.instance;Engine.instance=this,this.origin="",this.learners={},this.analysers={},this.mediaStreamSource={},this.mediaStream={},this.sharedArrayBuffers={},this.dispatcher=new Dispatcher,this.samplesLoaded=!1,this.isHushed=!1}async addLearner(e,t){if(!t)throw new Error("Error adding Learner instance to Engine");try{await t.init(this.origin),this.addEventListener("onSharedBuffer",(e=>{console.log("engine received onSharedBuffer",e),t.addSharedBuffer(e)})),t.addEventListener("onSharedBuffer",(e=>{console.log("learner received onSharedBuffer",e),this.addSharedBuffer(e)})),this.learners[e]=t}catch(e){console.error("Error adding Learner to Engine: ",e)}}removeLearner(e){if(!e)throw new Error("Error with learner ID when removing Learner from Engine");if(this.learners&&e in this.learners){let t=this.learners[e];t.removeEventListener("onSharedBuffer",(e=>this.addSharedBuffer(e))),t=null,delete this.learners[e]}}addEventListener(e,t){if(!(this.dispatcher&&e&&t))throw new Error("Error adding event listener to Engine");this.dispatcher.addEventListener(e,t)}createSharedBuffer(e,t,o){let n=RingBuffer.getStorageForCapacity(32*o,Float64Array),r=new RingBuffer(n,Float64Array);return this.audioWorkletNode.port.postMessage({func:"sab",value:n,ttype:t,channelID:e,blocksize:o}),this.sharedArrayBuffers[e]={sab:n,rb:r,blocksize:o},n}addSharedBuffer(e){if(console.log("addSharedBuffer engine.js",e),!e)throw new Error("Error with onSharedBuffer event");if(e.sab&&e.sab instanceof SharedArrayBuffer)try{let t=new RingBuffer(e.sab,Float64Array);this.audioWorkletNode.port.postMessage({func:"sab",value:e.sab,ttype:e.ttype,channelID:e.channelID,blocksize:e.blocksize}),this.sharedArrayBuffers[e.channelID]={sab:e.sab,rb:t,blocksize:e.blocksize}}catch(e){console.error("Error pushing SharedBuffer to engine")}else e.name&&e.data&&this.audioWorkletNode.port.postMessage({func:"sendbuf",name:e.name,data:e.data})}pushDataToSharedBuffer(e,t){if(!(e&&t&&(Array.isArray(t),1)))throw new Error("Error in function parameters");this.sharedArrayBuffers&&this.sharedArrayBuffers[e]&&this.sharedArrayBuffers[e].rb.push(t)}pollAnalyserData(e){if(void 0!==e){const t=new Uint8Array(e.fftSize),o=new Uint8Array(e.fftSize);return e.getByteTimeDomainData(t),e.getByteFrequencyData(o),{smoothingTimeConstant:e.smoothingTimeConstant,fftSize:e.fftSize,frequencyDataArray:o,timeDataArray:t}}}createAnalyser(e,t){if(!e||!t)throw new Error("Parameters to createAnalyser incorrect");if(this.audioContext&&this.audioWorkletNode){let o=this.audioContext.createAnalyser();o.smoothingTimeConstant=.25,o.fftSize=256,o.minDecibels=-90,o.maxDecibels=-0,this.audioWorkletNode.connect(o);let n=-1,r={};this.analysers[e]={analyser:o,analyserFrameId:n,callback:t};const i=()=>(r=this.pollAnalyserData(this.analysers[e].analyser),this.analysers[e].callback(r),this.analysers[e].analyserFrameId=requestAnimationFrame(i),n);i()}else this.analysers[e]={callback:t}}connectAnalysers(){Object.keys(this.analysers).map((e=>this.createAnalyser(e,this.analysers[e].callback)))}removeAnalyser(e){if(this.audioContext&&this.audioWorkletNode){void 0!==this.analysers[e.id]&&(cancelAnimationFrame(this.analysers[e.id].analyserFrameId),delete this.analysers[e.id])}}async init(e){if(e&&new URL(e)){let t;try{this.audioContext,this.origin=e,this.audioWorkletName="maxi-processor",this.audioWorkletUrl=e+"/"+this.audioWorkletName+".js",void 0===this.audioContext&&(this.audioContext=new AudioContext({latencyHint:"playback"})),t=await this.loadWorkletProcessorCode()}catch(e){return!1}return!!t&&(this.connectWorkletNode(),!0)}throw new Error("Name and valid URL required for AudioWorklet processor")}play(){if(void 0!==this.audioContext)return"suspended"===this.audioContext.state?(this.audioContext.resume(),!0):(this.hush(),!1)}stop(){void 0!==this.audioWorkletNode&&this.hush()}stopAndRelease(){void 0!==this.audioWorkletNode&&(this.audioWorkletNode.disconnect(this.audioContext.destination),this.audioWorkletNode=void 0)}setGain(e){if(void 0!==this.audioWorkletNode&&e>=0&&e<=1){const t=this.audioWorkletNode.parameters.get("gain");return t.value=e,console.log(t.value),!0}return!1}more(){if(void 0!==this.audioWorkletNode){const e=this.audioWorkletNode.parameters.get("gain");return e.value+=.05,console.info(e.value),e.value}throw new Error("error increasing sound level")}less(){if(void 0!==this.audioWorkletNode){const e=this.audioWorkletNode.parameters.get("gain");return e.value-=.05,console.info(e.value),e.value}throw new Error("error decreasing sound level")}hush(){return void 0!==this.audioWorkletNode&&(this.audioWorkletNode.port.postMessage({hush:1}),this.isHushed=!0,!0)}unHush(){return void 0!==this.audioWorkletNode&&(this.audioWorkletNode.port.postMessage({unhush:1}),this.isHushed=!1,!0)}eval(e){return!(!this.audioWorkletNode||!this.audioWorkletNode.port)&&("suspended"===this.audioContext.state&&this.audioContext.resume(),this.audioWorkletNode.port.postMessage({eval:1,setup:e.setup,loop:e.loop}),this.isHushed=!1,!0)}asyncPostToProcessor(e){if(!(e&&this.audioWorkletNode&&this.audioWorkletNode.port))throw new Error("Error async posting to processor");console.log("DEBUG:AudioEngine:onMessagingEventHandler:"),console.log(e),this.audioWorkletNode.port.postMessage(e)}sendClockPhase(e,t){void 0!==this.audioWorkletNode&&this.audioWorkletNode.port.postMessage({phase:e,i:t})}onAudioInputInit(e){try{this.mediaStreamSource=this.audioContext.createMediaStreamSource(e),this.mediaStreamSource.connect(this.audioWorkletNode),this.mediaStream=e,this.mediaStreamSourceConnected=!0}catch(e){console.error(e)}}onAudioInputFail(e){this.mediaStreamSourceConnected=!1,console.error(`ERROR:Engine:AudioInputFail: ${e.message} ${e.name}`)}onAudioInputDisconnect(){}async connectMediaStream(){const e=window.constraints={audio:{latency:.02,echoCancellation:!1,mozNoiseSuppression:!1,mozAutoGainControl:!1},video:!1};return await navigator.mediaDevices.getUserMedia(e).then((e=>this.onAudioInputInit(e))).catch(this.onAudioInputFail),this.mediaStreamSourceConnected}async disconnectMediaStream(){try{this.mediaStreamSource.disconnect(this.audioWorkletNode),this.mediaStream.getAudioTracks().forEach((e=>e.stop())),this.mediaStreamSource=null,this.mediaStreamSourceConnected=!1}catch(e){console.error(e)}finally{return this.mediaStreamSourceConnected}}async loadWorkletProcessorCode(){if(void 0===this.audioContext)return!1;try{await this.audioContext.audioWorklet.addModule(this.audioWorkletUrl)}catch(e){return console.error("ERROR:Engine:loadWorkletProcessorCode: AudioWorklet not supported in this browser: ",e.message),!1}try{return this.audioWorkletNode=new AudioWorkletNode(this.audioContext,this.audioWorkletName),this.audioWorkletNode.channelInterpretation="discrete",this.audioWorkletNode.channelCountMode="explicit",this.audioWorkletNode.channelCount=this.audioContext.destination.maxChannelCount,!0}catch(e){return console.error("Error loading worklet processor code: ",e),!1}}connectWorkletNode(){if(void 0!==this.audioWorkletNode)try{this.audioContext.destination.channelInterpretation="discrete",this.audioContext.destination.channelCountMode="explicit",this.audioContext.destination.channelCount=this.audioContext.destination.maxChannelCount,this.audioWorkletNode.connect(this.audioContext.destination),this.audioWorkletNode.onprocessorerror=e=>console.error("Engine processor error detected",e),this.audioWorkletNode.onprocessorstatechange=e=>console.info("Engine processor state change: "+audioWorkletNode.processorState),this.audioWorkletNode.port.onmessageerror=e=>console.error("Engine processor port error: "+e),this.audioWorkletNode.port.onmessage=e=>this.onProcessorMessageHandler(e)}catch(e){console.error("Error connecting WorkletNode: ",e)}}onProcessorMessageHandler(e){if(console.log("onProcessorMessageHandler",e),e&&e.data)if(e.data.rq&&"send"===e.data.rq)switch(e.data.ttype){case"ML":break;case"NET":this.peerNet.send(e.data.ch[0],e.data.value,e.data.ch[1])}else if(e.data.rq&&"buf"===e.data.rq)switch(e.data.ttype){case"ML":console.log("ML",e.data),this.dispatcher.dispatch("onSharedBuffer",{sab:e.data.value,channelID:e.data.channelID,blocksize:e.data.blocksize});break;case"scope":let t=new RingBuffer(e.data.value,Float64Array);this.sharedArrayBuffers[e.data.channelID]={sab:e.data.value,rb:t,ttype:e.data.ttype,channelID:e.data.channelID,blocksize:e.data.blocksize}}else e.data.rq&&"rts"===e.data.rq?(this.audioContext.suspend(),this.isHushed=!0):e.data instanceof Error&&console.error(`On Processor Message ${e.data}`)}subscribeProcessorMessage(e){if(!e||!this.audioWorkletNode)throw new Error("Error subscribing processor message");this.audioWorkletNode.port.onmessage=e}loadSample(e,t){if(!this.audioContext||!this.audioWorkletNode)throw"Engine is not initialised!";if(!(t&&0!==t.length&&this.origin&&0!==this.origin.length&&new URL(this.origin+t)))throw"Problem with sample relative URL";try{loadSampleToArray(this.audioContext,e,this.origin+t,this.audioWorkletNode)}catch(o){console.error(`Error loading sample ${e} from ${t}: `,o)}}}var nearley=createCommonjsModule((function(e){var t,o;t=commonjsGlobal,o=function(){function e(t,o,n){return this.id=++e.highestId,this.name=t,this.symbols=o,this.postprocess=n,this}function t(e,t,o,n){this.rule=e,this.dot=t,this.reference=o,this.data=[],this.wantedBy=n,this.isComplete=this.dot===e.symbols.length}function o(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function n(e,t){this.rules=e,this.start=t||this.rules[0].name;var o=this.byName={};this.rules.forEach((function(e){o.hasOwnProperty(e.name)||(o[e.name]=[]),o[e.name].push(e)}))}function r(){this.reset("")}function i(e,t,i){if(e instanceof n){var s=e;i=t}else s=n.fromCompiled(e,t);for(var a in this.grammar=s,this.options={keepHistory:!1,lexer:s.lexer||new r},i||{})this.options[a]=i[a];this.lexer=this.options.lexer,this.lexerState=void 0;var l=new o(s,0);this.table=[l],l.wants[s.start]=[],l.predict(s.start),l.process(),this.current=0}function s(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return e.toString();if(e.type)return"%"+e.type;if(e.test)return"<"+String(e.test)+">";throw new Error("Unknown symbol type: "+e)}}return e.highestId=0,e.prototype.toString=function(e){var t=void 0===e?this.symbols.map(s).join(" "):this.symbols.slice(0,e).map(s).join(" ")+"  "+this.symbols.slice(e).map(s).join(" ");return this.name+"  "+t},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var o=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return o.left=this,o.right=e,o.isComplete&&(o.data=o.build(),o.right=void 0),o},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,i.fail))},o.prototype.process=function(e){for(var t=this.states,o=this.wants,n=this.completed,r=0;r<t.length;r++){var s=t[r];if(s.isComplete){if(s.finish(),s.data!==i.fail){for(var a=s.wantedBy,l=a.length;l--;){var c=a[l];this.complete(c,s)}if(s.reference===this.index){var p=s.rule.name;(this.completed[p]=this.completed[p]||[]).push(s)}}}else{if("string"!=typeof(p=s.rule.symbols[s.dot])){this.scannable.push(s);continue}if(o[p]){if(o[p].push(s),n.hasOwnProperty(p)){var u=n[p];for(l=0;l<u.length;l++){var h=u[l];this.complete(s,h)}}}else o[p]=[s],this.predict(p)}}},o.prototype.predict=function(e){for(var o=this.grammar.byName[e]||[],n=0;n<o.length;n++){var r=o[n],i=this.wants[e],s=new t(r,0,this.index,i);this.states.push(s)}},o.prototype.complete=function(e,t){var o=e.nextState(t);this.states.push(o)},n.fromCompiled=function(t,o){var r=t.Lexer;t.ParserStart&&(o=t.ParserStart,t=t.ParserRules);var i=new n(t=t.map((function(t){return new e(t.name,t.symbols,t.postprocess)})),o);return i.lexer=r,i},r.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},r.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},r.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},r.prototype.formatError=function(e,t){var o=this.buffer;if("string"==typeof o){var n=o.split("\n").slice(Math.max(0,this.line-5),this.line);o.indexOf("\n",this.index);var r=this.index-this.lastLineBreak,i=String(this.line).length;return t+=" at line "+this.line+" col "+r+":\n\n",t+=n.map((function(e,t){return s(this.line-n.length+t+1,i)+" "+e}),this).join("\n"),t+="\n"+s("",i+r)+"^\n"}return t+" at index "+(this.index-1);function s(e,t){var o=String(e);return Array(t-o.length+1).join(" ")+o}},i.fail={},i.prototype.feed=function(e){var t,n=this.lexer;for(n.reset(e,this.lexerState);;){try{if(!(t=n.next()))break}catch(e){var i=new o(this.grammar,this.current+1);throw this.table.push(i),(l=new Error(this.reportLexerError(e))).offset=this.current,l.token=e.token,l}var s=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var a=this.current+1;i=new o(this.grammar,a),this.table.push(i);for(var l,c=void 0!==t.text?t.text:t.value,p=n.constructor===r?t.value:t,u=s.scannable,h=u.length;h--;){var d=u[h],f=d.rule.symbols[d.dot];if(f.test?f.test(p):f.type?f.type===t.type:f.literal===c){var m=d.nextState({data:p,token:t,isToken:!0,reference:a-1});i.states.push(m)}}if(i.process(),0===i.states.length)throw(l=new Error(this.reportError(t))).offset=this.current,l.token=t,l;this.options.keepHistory&&(s.lexerState=n.save()),this.current++}return s&&(this.lexerState=n.save()),this.results=this.finish(),this},i.prototype.reportLexerError=function(e){var t,o,n=e.token;return n?(t="input "+JSON.stringify(n.text[0])+" (lexer error)",o=this.lexer.formatError(n,"Syntax error")):(t="input (lexer error)",o=e.message),this.reportErrorCommon(o,t)},i.prototype.reportError=function(e){var t=(e.type?e.type+" token: ":"")+JSON.stringify(void 0!==e.value?e.value:e),o=this.lexer.formatError(e,"Syntax error");return this.reportErrorCommon(o,t)},i.prototype.reportErrorCommon=function(e,t){var o=[];o.push(e);var n=this.table.length-2,r=this.table[n],i=r.states.filter((function(e){var t=e.rule.symbols[e.dot];return t&&"string"!=typeof t}));return 0===i.length?(o.push("Unexpected "+t+". I did not expect any more input. Here is the state of my parse table:\n"),this.displayStateStack(r.states,o)):(o.push("Unexpected "+t+". Instead, I was expecting to see one of the following:\n"),i.map((function(e){return this.buildFirstStateStack(e,[])||[e]}),this).forEach((function(e){var t=e[0],n=t.rule.symbols[t.dot],r=this.getSymbolDisplay(n);o.push("A "+r+" based on:"),this.displayStateStack(e,o)}),this)),o.push(""),o.join("\n")},i.prototype.displayStateStack=function(e,t){for(var o,n=0,r=0;r<e.length;r++){var i=e[r],s=i.rule.toString(i.dot);s===o?n++:(n>0&&t.push("    ^ "+n+" more lines identical to this"),n=0,t.push("    "+s)),o=s}},i.prototype.getSymbolDisplay=function(e){return function(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return"character matching "+e;if(e.type)return e.type+" token";if(e.test)return"token matching "+String(e.test);throw new Error("Unknown symbol type: "+e)}}(e)},i.prototype.buildFirstStateStack=function(e,t){if(-1!==t.indexOf(e))return null;if(0===e.wantedBy.length)return[e];var o=e.wantedBy[0],n=[e].concat(t),r=this.buildFirstStateStack(o,n);return null===r?null:[e].concat(r)},i.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},i.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},i.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},i.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach((function(o){o.rule.name===t&&o.dot===o.rule.symbols.length&&0===o.reference&&o.data!==i.fail&&e.push(o)})),e.map((function(e){return e.data}))},{Parser:i,Grammar:n,Rule:e}},e.exports?e.exports=o():t.nearley=o()})),moo=createCommonjsModule((function(e){var t,o;t=commonjsGlobal,o=function(){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,o="boolean"==typeof(new RegExp).sticky;function n(e){return e&&"[object RegExp]"===t.call(e)}function r(e){return e&&"object"==typeof e&&!n(e)&&!Array.isArray(e)}function i(e){return"("+e+")"}function s(e){return e.length?"(?:"+e.map((function(e){return"(?:"+e+")"})).join("|")+")":"(?!)"}function a(e){if("string"==typeof e)return"(?:"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(n(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("Not a pattern: "+e)}function l(t,o){if(r(o)||(o={match:o}),o.include)throw new Error("Matching rules cannot also include states");var i={defaultType:t,lineBreaks:!!o.error||!!o.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var s in o)e.call(o,s)&&(i[s]=o[s]);if("string"==typeof i.type&&t!==i.type)throw new Error("Type transform cannot be a string (type '"+i.type+"' for token '"+t+"')");var a=i.match;return i.match=Array.isArray(a)?a:a?[a]:[],i.match.sort((function(e,t){return n(e)&&n(t)?0:n(t)?-1:n(e)?1:t.length-e.length})),i}function c(e){return Array.isArray(e)?function(e){for(var t=[],o=0;o<e.length;o++){var n=e[o];if(n.include)for(var r=[].concat(n.include),i=0;i<r.length;i++)t.push({include:r[i]});else{if(!n.type)throw new Error("Rule has no type: "+JSON.stringify(n));t.push(l(n.type,n))}}return t}(e):function(e){for(var t=Object.getOwnPropertyNames(e),o=[],n=0;n<t.length;n++){var i=t[n],s=e[i],a=[].concat(s);if("include"!==i){var c=[];a.forEach((function(e){r(e)?(c.length&&o.push(l(i,c)),o.push(l(i,e)),c=[]):c.push(e)})),c.length&&o.push(l(i,c))}else for(var p=0;p<a.length;p++)o.push({include:a[p]})}return o}(e)}var p=l("error",{lineBreaks:!0,shouldThrow:!0});function u(e,t){for(var r=null,l=Object.create(null),c=!0,u=null,h=[],d=[],f=0;f<e.length;f++)e[f].fallback&&(c=!1);for(f=0;f<e.length;f++){var m=e[f];if(m.include)throw new Error("Inheritance is not allowed in stateless lexers");if(m.error||m.fallback){if(r)throw!m.fallback==!r.fallback?new Error("Multiple "+(m.fallback?"fallback":"error")+" rules not allowed (for token '"+m.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+m.defaultType+"')");r=m}var y=m.match.slice();if(c)for(;y.length&&"string"==typeof y[0]&&1===y[0].length;)l[y.shift().charCodeAt(0)]=m;if(m.pop||m.push||m.next){if(!t)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+m.defaultType+"')");if(m.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+m.defaultType+"')")}if(0!==y.length){c=!1,h.push(m);for(var g=0;g<y.length;g++){var b=y[g];if(n(b))if(null===u)u=b.unicode;else if(u!==b.unicode&&!1===m.fallback)throw new Error("If one rule is /u then all must be")}var w=s(y.map(a)),v=new RegExp(w);if(v.test(""))throw new Error("RegExp matches empty string: "+v);if(new RegExp("|"+w).exec("").length-1>0)throw new Error("RegExp has capture groups: "+v+"\nUse (?:  ) instead");if(!m.lineBreaks&&v.test("\n"))throw new Error("Rule should declare lineBreaks: "+v);d.push(i(w))}}var x=r&&r.fallback,$=o&&!x?"ym":"gm",S=o||x?"":"|";return!0===u&&($+="u"),{regexp:new RegExp(s(d)+S,$),groups:h,fast:l,error:r||p}}function h(e,t,o){var n=e&&(e.push||e.next);if(n&&!o[n])throw new Error("Missing state '"+n+"' (in token '"+e.defaultType+"' of state '"+t+"')");if(e&&e.pop&&1!=+e.pop)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+t+"')")}var d=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};d.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.queuedToken=t?t.queuedToken:null,this.queuedThrow=t?t.queuedThrow:null,this.setState(t?t.state:this.startState),this.stack=t&&t.stack?t.stack.slice():[],this},d.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},d.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error,this.re=t.regexp,this.fast=t.fast}},d.prototype.popState=function(){this.setState(this.stack.pop())},d.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var f=o?function(e,t){return e.exec(t)}:function(e,t){var o=e.exec(t);return 0===o[0].length?null:o};function m(){return this.value}if(d.prototype._getGroup=function(e){for(var t=this.groups.length,o=0;o<t;o++)if(void 0!==e[o+1])return this.groups[o];throw new Error("Cannot find token type for matched text")},d.prototype.next=function(){var e=this.index;if(this.queuedGroup){var t=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",t}var o=this.buffer;if(e!==o.length){if(s=this.fast[o.charCodeAt(e)])return this._token(s,o.charAt(e),e);var n=this.re;n.lastIndex=e;var r=f(n,o),i=this.error;if(null==r)return this._token(i,o.slice(e,o.length),e);var s=this._getGroup(r),a=r[0];return i.fallback&&r.index!==e?(this.queuedGroup=s,this.queuedText=a,this._token(i,o.slice(e,r.index),e)):this._token(s,a,e)}},d.prototype._token=function(e,t,o){var n=0;if(e.lineBreaks){var r=/\n/g,i=1;if("\n"===t)n=1;else for(;r.exec(t);)n++,i=r.lastIndex}var s={type:"function"==typeof e.type&&e.type(t)||e.defaultType,value:"function"==typeof e.value?e.value(t):t,text:t,toString:m,offset:o,lineBreaks:n,line:this.line,col:this.col},a=t.length;if(this.index+=a,this.line+=n,0!==n?this.col=a-i+1:this.col+=a,e.shouldThrow)throw new Error(this.formatError(s,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),s},"undefined"!=typeof Symbol&&Symbol.iterator){var y=function(e){this.lexer=e};y.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},y.prototype[Symbol.iterator]=function(){return this},d.prototype[Symbol.iterator]=function(){return new y(this)}}return d.prototype.formatError=function(e,t){if(null==e){var o=this.buffer.slice(this.index);e={text:o,offset:this.index,lineBreaks:-1===o.indexOf("\n")?0:1,line:this.line,col:this.col}}var n=Math.max(0,e.offset-e.col+1),r=e.lineBreaks?e.text.indexOf("\n"):e.text.length,i=this.buffer.substring(n,e.offset+r);return t+=" at line "+e.line+" col "+e.col+":\n\n",t+="  "+i+"\n",t+="  "+Array(e.col).join(" ")+"^"},d.prototype.clone=function(){return new d(this.states,this.state)},d.prototype.has=function(e){return!0},{compile:function(e){var t=u(c(e));return new d({start:t},"start")},states:function(e,t){var o=e.$all?c(e.$all):[];delete e.$all;var n=Object.getOwnPropertyNames(e);t||(t=n[0]);for(var r=Object.create(null),i=0;i<n.length;i++)r[w=n[i]]=c(e[w]).concat(o);for(i=0;i<n.length;i++)for(var s=r[w=n[i]],a=Object.create(null),l=0;l<s.length;l++){var p=s[l];if(p.include){var f=[l,1];if(p.include!==w&&!a[p.include]){a[p.include]=!0;var m=r[p.include];if(!m)throw new Error("Cannot include nonexistent state '"+p.include+"' (in state '"+w+"')");for(var y=0;y<m.length;y++){var g=m[y];-1===s.indexOf(g)&&f.push(g)}}s.splice.apply(s,f),l--}}var b=Object.create(null);for(i=0;i<n.length;i++){var w;b[w=n[i]]=u(r[w],!0)}for(i=0;i<n.length;i++){var v=n[i],x=b[v],$=x.groups;for(l=0;l<$.length;l++)h($[l],v,b);var S=Object.getOwnPropertyNames(x.fast);for(l=0;l<S.length;l++)h(x.fast[S[l]],v,b)}return new d(b,t)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(e){for(var t=Object.create(null),o=Object.create(null),n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var i=n[r],s=e[i];(Array.isArray(s)?s:[s]).forEach((function(e){if((o[e.length]=o[e.length]||[]).push(e),"string"!=typeof e)throw new Error("keyword must be string (in keyword '"+i+"')");t[e]=i}))}function a(e){return JSON.stringify(e)}var l="";for(var c in l+="switch (value.length) {\n",o){var p=o[c];l+="case "+c+":\n",l+="switch (value) {\n",p.forEach((function(e){var o=t[e];l+="case "+a(e)+": return "+a(o)+"\n"})),l+="}\n"}return l+="}\n",Function("value",l)}}},e.exports?e.exports=o():t.moo=o()})),nearleyLanguageBootstrapped=createCommonjsModule((function(e){!function(){function t(e){return e[0]}function o(e){return e[0].value}var n=moo,r=Object.assign({ws:{match:/\s+/,lineBreaks:!0,next:"main"},comment:/\#.*/,arrow:{match:/[=-]+\>/,next:"main"},js:{match:/\{\%(?:[^%]|\%[^}])*\%\}/,value:e=>e.slice(2,-2),lineBreaks:!0},word:{match:/[\w\?\+]+/,next:"afterWord"},string:{match:/"(?:[^\\"\n]|\\["\\/bfnrt]|\\u[a-fA-F0-9]{4})*"/,value:e=>JSON.parse(e),next:"main"},btstring:{match:/`[^`]*`/,value:e=>e.slice(1,-1),next:"main",lineBreaks:!0}},function(e){var t={};for(var o of e)t[o]={match:o,next:"main"};return t}([",","|","$","%","(",")",":?",":*",":+","@include","@builtin","@","]"])),i=n.states({main:Object.assign({},r,{charclass:{match:/\.|\[(?:\\.|[^\\\n])+?\]/,value:e=>new RegExp(e)}}),afterWord:Object.assign({},r,{"[":{match:"[",next:"main"}})});var s={Lexer:i,ParserRules:[{name:"final$ebnf$1",symbols:[i.has("ws")?{type:"ws"}:ws],postprocess:t},{name:"final$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"final",symbols:["_","prog","_","final$ebnf$1"],postprocess:function(e){return e[1]}},{name:"prog",symbols:["prod"],postprocess:function(e){return[e[0]]}},{name:"prog",symbols:["prod","ws","prog"],postprocess:function(e){return[e[0]].concat(e[2])}},{name:"prod",symbols:["word","_",i.has("arrow")?{type:"arrow"}:arrow,"_","expression+"],postprocess:function(e){return{name:e[0],rules:e[4]}}},{name:"prod",symbols:["word",{literal:"["},"_","wordlist","_",{literal:"]"},"_",i.has("arrow")?{type:"arrow"}:arrow,"_","expression+"],postprocess:function(e){return{macro:e[0],args:e[3],exprs:e[9]}}},{name:"prod",symbols:[{literal:"@"},"_","js"],postprocess:function(e){return{body:e[2]}}},{name:"prod",symbols:[{literal:"@"},"word","ws","word"],postprocess:function(e){return{config:e[1],value:e[3]}}},{name:"prod",symbols:[{literal:"@include"},"_","string"],postprocess:function(e){return{include:e[2].literal,builtin:!1}}},{name:"prod",symbols:[{literal:"@builtin"},"_","string"],postprocess:function(e){return{include:e[2].literal,builtin:!0}}},{name:"expression+",symbols:["completeexpression"]},{name:"expression+",symbols:["expression+","_",{literal:"|"},"_","completeexpression"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"expressionlist",symbols:["completeexpression"]},{name:"expressionlist",symbols:["expressionlist","_",{literal:","},"_","completeexpression"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"wordlist",symbols:["word"]},{name:"wordlist",symbols:["wordlist","_",{literal:","},"_","word"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"completeexpression",symbols:["expr"],postprocess:function(e){return{tokens:e[0]}}},{name:"completeexpression",symbols:["expr","_","js"],postprocess:function(e){return{tokens:e[0],postprocess:e[2]}}},{name:"expr_member",symbols:["word"],postprocess:t},{name:"expr_member",symbols:[{literal:"$"},"word"],postprocess:function(e){return{mixin:e[1]}}},{name:"expr_member",symbols:["word",{literal:"["},"_","expressionlist","_",{literal:"]"}],postprocess:function(e){return{macrocall:e[0],args:e[3]}}},{name:"expr_member$ebnf$1",symbols:[{literal:"i"}],postprocess:t},{name:"expr_member$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"expr_member",symbols:["string","expr_member$ebnf$1"],postprocess:function(e){return e[1]?function(e){for(var t=e.literal,o=[],n=0;n<t.length;n++){var r=t.charAt(n);r.toUpperCase()!==r||r.toLowerCase()!==r?o.push(new RegExp("["+r.toLowerCase()+r.toUpperCase()+"]")):o.push({literal:r})}return{subexpression:[{tokens:o,postprocess:function(e){return e.join("")}}]}}(e[0]):e[0]}},{name:"expr_member",symbols:[{literal:"%"},"word"],postprocess:function(e){return{token:e[1]}}},{name:"expr_member",symbols:["charclass"],postprocess:t},{name:"expr_member",symbols:[{literal:"("},"_","expression+","_",{literal:")"}],postprocess:function(e){return{subexpression:e[2]}}},{name:"expr_member",symbols:["expr_member","_","ebnf_modifier"],postprocess:function(e){return{ebnf:e[0],modifier:e[2]}}},{name:"ebnf_modifier",symbols:[{literal:":+"}],postprocess:o},{name:"ebnf_modifier",symbols:[{literal:":*"}],postprocess:o},{name:"ebnf_modifier",symbols:[{literal:":?"}],postprocess:o},{name:"expr",symbols:["expr_member"]},{name:"expr",symbols:["expr","ws","expr_member"],postprocess:function(e){return e[0].concat([e[2]])}},{name:"word",symbols:[i.has("word")?{type:"word"}:word],postprocess:o},{name:"string",symbols:[i.has("string")?{type:"string"}:string],postprocess:e=>({literal:e[0].value})},{name:"string",symbols:[i.has("btstring")?{type:"btstring"}:btstring],postprocess:e=>({literal:e[0].value})},{name:"charclass",symbols:[i.has("charclass")?{type:"charclass"}:charclass],postprocess:o},{name:"js",symbols:[i.has("js")?{type:"js"}:js],postprocess:o},{name:"_$ebnf$1",symbols:["ws"],postprocess:t},{name:"_$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_",symbols:["_$ebnf$1"]},{name:"ws",symbols:[i.has("ws")?{type:"ws"}:ws]},{name:"ws$ebnf$1",symbols:[i.has("ws")?{type:"ws"}:ws],postprocess:t},{name:"ws$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ws",symbols:["ws$ebnf$1",i.has("comment")?{type:"comment"}:comment,"_"]}],ParserStart:"final"};e.exports=s}()}));function compileLowLevel(e,t){var o=uniquer();t.alreadycompiled||(t.alreadycompiled=[]);for(var n={rules:[],body:[],config:{},customTokens:[],macros:{},start:""},r=0;r<e.length;r++){var i=e[r];if(u(i.name,i.pos,i.name&&i.name.length),i.body)t.nojs||n.body.push(i.body);else if(i.include){var s;if(s=i.builtin?i.include:require("path").resolve(t.file?require("path").dirname(t.file):process.cwd(),i.include),-1===t.alreadycompiled.indexOf(s)){if(t.alreadycompiled.push(s),"postprocessors.ne"===s)var a=require("nearley/builtin/postprocessors.ne");else if("whitespace.ne"===s)a=require("nearley/builtin/whitespace.ne");else if("string.ne"===s)a=require("nearley/builtin/string.ne");else if("number.ne"===s)a=require("nearley/builtin/number.ne");else if("cow.ne"===s)a=require("nearley/builtin/cow.ne");var l=nearley.Grammar.fromCompiled(nearleyLanguageBootstrapped),c=new nearley.Parser(l);c.feed(a);var p=Compile(c.results[0],{file:s,__proto__:t});n.rules=n.rules.concat(p.rules),n.body=n.body.concat(p.body),Object.keys(p.config).forEach((function(e){n.config[e]=p.config[e]})),Object.keys(p.macros).forEach((function(e){n.macros[e]=p.macros[e]}))}}else i.macro?n.macros[i.macro]={args:i.args,exprs:i.exprs}:i.config?n.config[i.config]=i.value:(h(i.name,i.rules,{}),n.start||(n.start=i.name))}return n;function u(e,o,n){t.rangeCallback&&t.rangeCallback(e,o,o+n)}function h(e,o,r){for(var i=0;i<o.length;i++){var s=d(e,o[i],r);t.nojs&&(s.postprocess=null),n.rules.push(s)}}function d(e,t,o){for(var n=[],r=0;r<t.tokens.length;r++){var i=f(e,t.tokens[r],o);null!==i&&n.push(i)}return new nearley.Rule(e,n,t.postprocess)}function f(e,t,r){if("string"==typeof t)return"null"===t?null:t;if(t instanceof RegExp)return t;if(t.literal)return t.literal.length?1===t.literal.length||n.config.lexer?t:function(e,t,n){var r=o(e+"$string");return u(r,t.pos,JSON.stringify(t.literal).length),h(r,[{tokens:t.literal.split("").map((function(e){return{literal:e}})),postprocess:{builtin:"joiner"}}],n),r}(e,t,r):null;if(t.token){if(n.config.lexer){var i=t.token;return-1===n.customTokens.indexOf(i)&&n.customTokens.push(i),{token:"("+(n.config.lexer+".has("+JSON.stringify(i)+") ? {type: "+JSON.stringify(i)+"} : "+i)+")"}}return t}if(t.subexpression)return function(e,t,n){var r=t.subexpression,i=o(e+"$subexpression");return h(i,r,n),i}(e,t,r);if(t.ebnf)return function(e,t,n){switch(t.modifier){case":+":return function(e,t,n){var r=o(e+"$ebnf");return h(r,[{tokens:[t.ebnf]},{tokens:[t.ebnf,r],postprocess:{builtin:"arrconcat"}}],n),r}(e,t,n);case":*":return function(e,t,n){var r=o(e+"$ebnf");return h(r,[{tokens:[]},{tokens:[t.ebnf,r],postprocess:{builtin:"arrconcat"}}],n),r}(e,t,n);case":?":return function(e,t,n){var r=o(e+"$ebnf");return h(r,[{tokens:[t.ebnf],postprocess:{builtin:"id"}},{tokens:[],postprocess:{builtin:"nuller"}}],n),r}(e,t,n)}}(e,t,r);if(t.macrocall)return function(e,t,r){var i=o(e+"$macrocall"),s=n.macros[t.macrocall];if(!s)throw new Error("Unkown macro: "+t.macrocall);if(s.args.length!==t.args.length)throw new Error("Argument count mismatch.");for(var a={__proto__:r},l=0;l<s.args.length;l++){var c=o(e+"$macrocall");a[s.args[l]]=c,h(c,[t.args[l]],r)}return h(i,s.exprs,a),i}(e,t,r);if(t.mixin){if(r[t.mixin])return f(e,r[t.mixin],r);throw new Error("Unbound variable: "+t.mixin)}throw new Error("unrecognized token: "+JSON.stringify(t))}}function uniquer(){var e={};return function(t){var o=e[t]=(e[t]||0)+1;return t+"$"+o}}var generate=createCommonjsModule((function(e){var t,o;t=commonjsGlobal,o=function(e){function t(e,t,i){return null==i&&(i=""),"[\n    "+e.map((function(e){return function(e,t){var i="{";return i+='"name": '+JSON.stringify(e.name),i+=', "symbols": ['+e.symbols.map(r).join(", ")+"]",e.postprocess&&(e.postprocess.builtin&&(e.postprocess=t[e.postprocess.builtin]),i+=', "postprocess": '+n(o(e.postprocess),"        ",{indentFirst:!1})),i+="}"}(e,t)})).join(",\n    ")+"\n"+i+"]"}function o(e){var t=e.toString().split(/\n/);if(1===t.length)return[t[0].replace(/^\s+|\s+$/g,"")];for(var o=null,n=t.slice(1),r=0;r<n.length;r++){var i=/^\s*/.exec(n[r]);i&&i[0].length!==n[r].length&&(null===o||i[0].length<o.length)&&(o=i[0])}return null===o?t:t.map((function(e){return e.slice(0,o.length)===o?e.slice(o.length):e}))}function n(e,t,o){var n;return n=Array.isArray(e)?e:e.toString().split("\n"),o=o||{},n.map((function(e,n){var r=!0;return 0!=n||o.indentFirst||(r=!1),r?t+e:e})).join("\n")}function r(e){return e instanceof RegExp?e.toString():e.token?e.token:JSON.stringify(e)}var i=function(e,t){if(e.config.preprocessor||(e.config.preprocessor="_default"),!i[e.config.preprocessor])throw new Error("No such preprocessor: "+e.config.preprocessor);return i[e.config.preprocessor](e,t)};return i.js=i._default=i.javascript=function(e,o){var n="// Generated automatically by nearley, version "+e.version+"\n";return n+="// http://github.com/Hardmath123/nearley\n",n+="(function () {\n",n+="function id(x) { return x[0]; }\n",n+=e.body.join("\n"),n+="var grammar = {\n",n+="    Lexer: "+e.config.lexer+",\n",n+="    ParserRules: "+t(e.rules,i.javascript.builtinPostprocessors)+"\n",n+="  , ParserStart: "+JSON.stringify(e.start)+"\n",n+="}\n",n+="if (typeof module !== 'undefined'&& typeof module.exports !== 'undefined') {\n",n+="   module.exports = grammar;\n",n+="} else {\n",n+="   window."+o+" = grammar;\n",n+="}\n",n+="})();\n"},i.javascript.builtinPostprocessors={joiner:"function joiner(d) {return d.join('');}",arrconcat:"function arrconcat(d) {return [d[0]].concat(d[1]);}",arrpush:"function arrpush(d) {return d[0].concat([d[1]]);}",nuller:"function(d) {return null;}",id:"id"},i.module=i.esmodule=function(e,o){var n="// Generated automatically by nearley, version "+e.version+"\n";return n+="// http://github.com/Hardmath123/nearley\n",n+="function id(x) { return x[0]; }\n",n+=e.body.join("\n"),n+="let Lexer = "+e.config.lexer+";\n",n+="let ParserRules = "+t(e.rules,i.javascript.builtinPostprocessors)+";\n",n+="let ParserStart = "+JSON.stringify(e.start)+";\n",n+="export default { Lexer, ParserRules, ParserStart };\n"},i.cs=i.coffee=i.coffeescript=function(e,r){var s="# Generated automatically by nearley, version "+e.version+"\n";return s+="# http://github.com/Hardmath123/nearley\n",s+="do ->\n",s+="  id = (d) -> d[0]\n",s+=n(o(e.body.join("\n")),"  ")+"\n",s+="  grammar = {\n",s+="    Lexer: "+e.config.lexer+",\n",s+="    ParserRules: "+n(t(e.rules,i.coffeescript.builtinPostprocessors),"      ",{indentFirst:!1})+",\n",s+="    ParserStart: "+JSON.stringify(e.start)+"\n",s+="  }\n",s+="  if typeof module != 'undefined' && typeof module.exports != 'undefined'\n",s+="    module.exports = grammar;\n",s+="  else\n",s+="    window."+r+" = grammar;\n"},i.coffeescript.builtinPostprocessors={joiner:"(d) -> d.join('')",arrconcat:"(d) -> [d[0]].concat(d[1])",arrpush:"(d) -> d[0].concat([d[1]])",nuller:"() -> null",id:"id"},i.ts=i.typescript=function(e,o){var n="// Generated automatically by nearley, version "+e.version+"\n";return n+="// http://github.com/Hardmath123/nearley\n",n+="// Bypasses TS6133. Allow declared but unused functions.\n",n+="// @ts-ignore\n",n+="function id(d: any[]): any { return d[0]; }\n",n+=e.customTokens.map((function(e){return"declare var "+e+": any;\n"})).join(""),n+=e.body.join("\n"),n+="\n",n+="interface NearleyToken {\n",n+="  value: any;\n",n+="  [key: string]: any;\n",n+="};\n",n+="\n",n+="interface NearleyLexer {\n",n+="  reset: (chunk: string, info: any) => void;\n",n+="  next: () => NearleyToken | undefined;\n",n+="  save: () => any;\n",n+="  formatError: (token: never) => string;\n",n+="  has: (tokenType: string) => boolean;\n",n+="};\n",n+="\n",n+="interface NearleyRule {\n",n+="  name: string;\n",n+="  symbols: NearleySymbol[];\n",n+="  postprocess?: (d: any[], loc?: number, reject?: {}) => any;\n",n+="};\n",n+="\n",n+="type NearleySymbol = string | { literal: any } | { test: (token: any) => boolean };\n",n+="\n",n+="interface Grammar {\n",n+="  Lexer: NearleyLexer | undefined;\n",n+="  ParserRules: NearleyRule[];\n",n+="  ParserStart: string;\n",n+="};\n",n+="\n",n+="const grammar: Grammar = {\n",n+="  Lexer: "+e.config.lexer+",\n",n+="  ParserRules: "+t(e.rules,i.typescript.builtinPostprocessors,"  ")+",\n",n+="  ParserStart: "+JSON.stringify(e.start)+",\n",n+="};\n",n+="\n",n+="export default grammar;\n"},i.typescript.builtinPostprocessors={joiner:"(d) => d.join('')",arrconcat:"(d) => [d[0]].concat(d[1])",arrpush:"(d) => d[0].concat([d[1]])",nuller:"() => null",id:"id"},i},e.exports?e.exports=o():t.generate=o(t.nearley)})),warn=function(e,t){e.out.write("WARN\t"+t+"\n")};function lintNames(e,t){var o=[];e.rules.forEach((function(e){o.push(e.name)})),e.rules.forEach((function(e){e.symbols.forEach((function(e){e.literal||e.token||e.constructor===RegExp||-1===o.indexOf(e)&&warn(t,"Undefined symbol `"+e+"` used.")}))}))}function lint(e,t){t.out||(t.out=process.stderr),lintNames(e,t)}var lint_1=lint,objectID=0,vars={},jsFuncMap={saw:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.saw(${t[0].loop})`},sin:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.sinewave(${t[0].loop})`},tri:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.triangle(${t[0].loop})`},pha:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.phasor(${t[0].loop})`},ph2:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>3?t[3].loop:0});`,loop:(e,t)=>`${e}.phasorBetween(${t[0].loop},${t[1].loop},${t[2].loop})`},sqr:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.square(${t[0].loop})`},pul:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>2?t[2].loop:0});`,loop:(e,t)=>`${e}.pulse(${t[0].loop},${t[1].loop})`},imp:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.impulse(${t[0].loop})`},sawn:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.sawn(${t[0].loop})`},noiz:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc()`,loop:(e,t)=>`${e}.noise()*${t[0].loop}`},gt:{setup:(e,t)=>"",loop:(e,t)=>`((${t[0].loop} > ${t[1].loop}) ? 1 : 0)`},lt:{setup:(e,t)=>"",loop:(e,t)=>`((${t[0].loop} < ${t[1].loop}) ? 1 : 0)`},mod:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} % ${t[1].loop})`},add:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} + ${t[1].loop})`},mul:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} * ${t[1].loop})`},sub:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} - ${t[1].loop})`},div:{setup:(e,t)=>"",loop:(e,t)=>`(${t[1].loop} != 0 ? ${t[0].loop}/${t[1].loop} : 0)`},pow:{setup:(e,t)=>"",loop:(e,t)=>`Math.pow(${t[0].loop},${t[1].loop})`},abs:{setup:(e,t)=>"",loop:(e,t)=>`Math.abs(${t[0].loop})`},env:{setup:(e,t)=>`${e} = new Maximilian.maxiEnv();\n                      ${e}.setAttack(${t[1].loop});\n                      ${e}.setDecay(${t[2].loop});\n                      ${e}.setSustain(${t[3].loop});\n                      ${e}.setRelease(${t[4].loop})`,loop:(e,t)=>`${e}.adsr(1,${t[0].loop})`},sum:{setup:(e,t)=>"",loop:(e,t)=>{let o=`(${t[0].loop}`;for(let e=1;e<t.length;e++)o+=`+${t[e].loop}`;return o+")"}},mix:{setup:(e,t)=>"",loop:(e,t)=>{let o=`((${t[0].loop}`;for(let e=1;e<t.length;e++)o+=`+${t[e].loop}`;return o+`)/${t.length})`}},prod:{setup:(e,t)=>"",loop:(e,t)=>{let o=`(${t[0].loop}`;for(let e=1;e<t.length;e++)o+=`*${t[e].loop}`;return o+")"}},blin:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linlin(${t[0].loop}, -1, 1, ${t[1].loop}, ${t[2].loop})`},ulin:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linlin(${t[0].loop}, 0, 1, ${t[1].loop}, ${t[2].loop})`},bexp:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linexp(${t[0].loop}, -1, 1, ${t[1].loop}, ${t[2].loop})`},uexp:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linexp(${t[0].loop}, 0.0000001, 1, ${t[1].loop}, ${t[2].loop})`},linlin:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linlin(${t[0].loop}, ${t[1].loop}, ${t[2].loop},${t[3].loop}, ${t[4].loop})`},linexp:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linexp(${t[0].loop}, ${t[1].loop}, ${t[2].loop}, ${t[3].loop}, ${t[4].loop})`},dist:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.atanDist(${t[0].loop},${t[1].loop})`},softclip:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.softclip(${t[0].loop})`},hardclip:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.hardclip(${t[0].loop})`},asymclip:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.asymclip(${t[0].loop},${t[1].loop},${t[2].loop})`},flange:{setup:(e,t)=>`${e} = new Maximilian.maxiFlanger()`,loop:(e,t)=>`${e}.flange(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},${t[4].loop})`},chor:{setup:(e,t)=>`${e} = new Maximilian.maxiChorus()`,loop:(e,t)=>`${e}.chorus(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},${t[4].loop})`},dl:{setup:(e,t)=>`${e} = new Maximilian.maxiDelayline()`,loop:(e,t)=>`${e}.dl(${t[0].loop},${t[1].loop},${t[2].loop})`},lpf:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.lopass(${t[0].loop},${t[1].loop})`},hpf:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.hipass(${t[0].loop},${t[1].loop})`},lpz:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.lores(${t[0].loop},${t[1].loop},${t[2].loop})`},hpz:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.hires(${t[0].loop},${t[1].loop},${t[2].loop})`},scop:{setup:(e,t)=>`${e} = new SABOutputTransducer(outputSABs,\n                                      this.port,\n                                      'scope',\n                                      ${t[1].loop},\n                                      this.currentSample,\n                                      ${3==t.length?1:t[3].loop})`,loop:(e,t)=>`${e}.send(${t[0].loop}, ${t[2].loop})`},toJS:{setup:(e,t)=>`${e} = new SABOutputTransducer(outputSABs,\n                                      this.port,\n                                      'ML',\n                                      ${t[1].loop},\n                                      this.currentSample,\n                                      ${3==t.length?1:t[3].loop})`,loop:(e,t)=>`${e}.send(${t[0].loop}, ${t[2].loop})`},fromJS:{setup:(e,t)=>`${e} = new SABInputTransducer(${t[0].loop}, ${2==t.length?1:0})`,loop:(e,t)=>`${e}.getSABValue(inputSABs, ${2==t.length?t[1].loop:0})`},mouseX:{setup:(e,t)=>"",loop:(e,t)=>"this.getSABValue('mxy')[0]"},mouseY:{setup:(e,t)=>"",loop:(e,t)=>"this.getSABValue('mxy')[1]"},at:{setup:(e,t)=>"",loop:(e,t)=>`${t[0].loop}[Math.min(${t[1].loop}, ${t[0].loop}.length-1)]`},sah:{setup:(e,t)=>`${e} = new Maximilian.maxiSampleAndHold();`,loop:(e,t)=>`${e}.sah(${t[0].loop},${t[1].loop})`},stretch:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[4].loop}));\n                      ${e}stretch = new Maximilian.maxiStretch();\n                      ${e}stretch.setSample(${e});`,loop:(e,t)=>`(${e}.isReady() ? ${e}stretch.play(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},0.0) : 0.0)`},adc:{setup:(e,t)=>"",loop:(e,t)=>`(inputs * ${t[0].loop})`},sampler:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[t.length-1].loop}));`,loop:(e,t)=>{let o=`${t[0].loop}`;return 3==t.length?o+=`,${t[1].loop}`:4==t.length&&(o+=`,${t[1].loop},${t[2].loop}`),`(${e}.isReady() ? ${e}.playOnZX(${o}) : 0.0)`}},loop:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[1].loop}));`,loop:(e,t)=>`(${e}.isReady() ? ${e}.play(${t[0].loop}) : 0.0)`},slice:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[2].loop}));`,loop:(e,t)=>`(${e}.isReady() ? ${e}.loopSetPosOnZX(${t[0].loop},${t[1].loop}) : 0.0)`},oscin:{setup:(e,t)=>"",loop:(e,t)=>`this.OSCTransducer(${t[0].loop},${t[1].loop})`},oscout:{setup:(e,t)=>"",loop:(e,t)=>`this.OSCTransducer(${t[0].loop},${t[1].loop})`},sah:{setup:(e,t)=>`${e} = new Maximilian.maxiSampleAndHold();`,loop:(e,t)=>`${e}.sah(${t[0].loop},${t[1].loop})`},stretch:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[4].loop}));\n                      ${e}stretch = new Maximilian.maxiStretch();\n                      ${e}stretch.setSample(${e});`,loop:(e,t)=>`(${e}.isReady() ? ${e}stretch.play(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},0.0) : 0.0)`},bitToSig:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.toSignal(${t[0].loop})`},bitToTrigSig:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.toTrigSignal(${t[0].loop})`},bitNeg:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.neg(${t[0].loop})`},bitInc:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.inc(${t[0].loop})`},bitDec:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.dec(${t[0].loop})`},bitAnd:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.land(${t[0].loop},${t[1].loop})`},bitOr:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lor(${t[0].loop},${t[1].loop})`},bitXor:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lxor(${t[0].loop},${t[1].loop})`},bitShl:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.shl(${t[0].loop},${t[1].loop})`},bitShr:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.shr(${t[0].loop},${t[1].loop})`},bitAt:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.at(${t[0].loop},${t[1].loop})`},bitAdd:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.add(${t[0].loop},${t[1].loop})`},bitSub:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.sub(${t[0].loop},${t[1].loop})`},bitMul:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.mul(${t[0].loop},${t[1].loop})`},bitEq:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.eq(${t[0].loop},${t[1].loop})`},bitGt:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.gt(${t[0].loop},${t[1].loop})`},bitGte:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.gte(${t[0].loop},${t[1].loop})`},bitLte:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lte(${t[0].loop},${t[1].loop})`},bitLt:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lt(${t[0].loop},${t[1].loop})`},setup:(e,t)=>"",bitDiv:{loop:(e,t)=>`Maximilian.maxiBits.div(${t[0].loop},${t[1].loop})`},bitr:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.at(${t[0].loop},${t[1].loop},${t[2].loop})`},bitnoise:{setup:(e,t)=>"",loop:(e,t)=>"Maximilian.maxiBits.noise()"},btime:{setup:(e,t)=>"",loop:(e,t)=>"this.bitTime"},bitFromSig:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.fromSignal(${t[0].loop})`},clp:{setup:(e,t)=>"",loop:(e,t)=>`this.clockPhase(${t[0].loop},${t.length>1?t[1].loop:0})`},clt:{setup:(e,t)=>"",loop:(e,t)=>`this.clockTrig(${t[0].loop},${t.length>1?t[1].loop:0})`},clk:{setup:(e,t)=>"",loop:(e,t)=>`(()=>{this.setBPM(${t[0].loop}); this.setBeatsPerBar(${t[1].loop});})()`},quantise:{setup:(e,t)=>`this.setCodeQuantiseMode(${t[0].loop>0?0:1})`,loop:(e,t)=>""},onzx:{setup:(e,t)=>`${e} = new Maximilian.maxiTrigger();`,loop:(e,t)=>`${e}.onZX(${t[0].loop})`},onchange:{setup:(e,t)=>`${e} = new Maximilian.maxiTrigger();`,loop:(e,t)=>`${e}.onChanged(${t[0].loop},${t[1].loop})`},count:{setup:(e,t)=>`${e} = new Maximilian.maxiCounter();`,loop:(e,t)=>`${e}.count(${t[0].loop},${t[1].loop})`},idx:{setup:(e,t)=>`${e} = new Maximilian.maxiIndex();`,loop:(e,t)=>`${e}.pull(${t[0].loop},${t[1].loop},${t[2].loop})`},svf:{setup:(e,t)=>`${e} = new Maximilian.maxiSVF();\n                      ${e}_p1 = new Maximilian.maxiTrigger();\n                      ${e}_p2 = new Maximilian.maxiTrigger();`,loop:(e,t)=>`( () => { ${e}_cutoff = ${t[1].loop};\n                                if (${e}_p1.onChanged(${e}_cutoff, 1e-5)) {${e}.setCutoff(${e}_cutoff)};\n                                ${e}_res = ${t[2].loop};\n                                if (${e}_p2.onChanged(${e}_res, 1e-5)) {${e}.setResonance(${e}_res)};\n                                return ${e}.play(${t[0].loop},${t[3].loop},${t[4].loop},${t[5].loop},${t[6].loop})})()`},bitclock:{setup:(e,t)=>"",loop:(e,t)=>"this.bitclock"},pvshift:{setup:(e,t)=>`${e} = new pvshift();`,loop:(e,t)=>`${e}.play(${t[0].loop},${t[1].loop})`},rsq:{setup:(e,t)=>`${e} = new Maximilian.maxiRatioSeq();`,loop:(e,t)=>2==t.length?`${e}.playTrig(${t[0].loop},${t[1].loop})`:`${e}.playValues(${t[0].loop},${t[1].loop},${t[2].loop})`},o303:{setup:(e,t)=>`${e} = new Open303.Open303();\n                      ${e}.setSampleRate(sampleRate);\n                      ${e}_tnote = new Maximilian.maxiTrigger();\n                      ${e}_twf = new Maximilian.maxiTrigger();\n                      ${e}_tcut = new Maximilian.maxiTrigger();\n                      ${e}_tres = new Maximilian.maxiTrigger();\n                      ${e}_tenvm = new Maximilian.maxiTrigger();\n                      ${e}_tdec = new Maximilian.maxiTrigger();\n                      ${e}_tnoteoff = new Maximilian.maxiTrigger();\n                      ${e}_tatt = new Maximilian.maxiTrigger();`,loop:(e,t)=>`(()=>{\n\t\t\tlet newNote = ${e}_tnote.onZX(${t[0].loop});\n\t\t\tlet accent = ${t[3].loop};\n\t\t\tif (newNote) {\n\t\t\t\tif (${t[2].loop}>0) {\n\t\t\t\t\t${e}.slideToNote(${t[1].loop},accent);\n\t\t\t\t}else{\n\t\t\t\t\t${e}.triggerNote(${t[1].loop},accent);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (${e}_tnoteoff.onChanged(${t[4].loop}, 1e-5)) {${e}.allNotesOff()};\n\t\t\tif (${e}_twf.onChanged(${t[5].loop}, 1e-5)) {${e}.setWaveform(${t[5].loop})};\n\t\t\tif (${e}_tcut.onChanged(${t[6].loop}, 1e-5)) {${e}.setCutoff(${t[6].loop})};\n\t\t\tif (${e}_tres.onChanged(${t[7].loop}, 1e-5)) {${e}.setResonance(${t[7].loop})};\n\t\t\tif (${e}_tenvm.onChanged(${t[8].loop}, 1e-5)) {${e}.setEnvMod(${t[8].loop})};\n\t\t\tif (${e}_tatt.onChanged(${t[9].loop}, 1e-5)) {${e}.setNormalAttack(${t[9].loop})};\n\t\t\tif (${e}_tdec.onChanged(${t[10].loop}, 1e-5)) {${e}.setDecay(${t[10].loop})};\n\t\t\t${e}.setAccent(${t[11].loop});\n\t\t\treturn ${e}.play();})()`},freeverb:{setup:(e,t)=>`${e} = new Maximilian.maxiFreeVerb();`,loop:(e,t)=>`${e}.play(${t[0].loop},${t[1].loop},${t[2].loop})`},line:{setup:(e,t)=>`${e} = new Maximilian.maxiLine(); ${e}.prepare(0,1,${t[1].loop}, false); ${e}.triggerEnable(1);`,loop:(e,t)=>`${e}.play(${t[0].loop})`},const:{setup:(e,t)=>"",loop:(e,t)=>`${t[0].loop}`},poll:{setup:(e,t)=>`${e} = new poll()`,loop:(e,t)=>`${e}.play(${t[0].loop})`},dac:{setup:(e,t)=>"",loop:(e,t)=>1==t.length?`this.dacOutAll(${t[0].loop})`:`this.dacOut(${t[0].loop},${t[1].loop})`},fft:{setup:(e,t)=>`${e} = new fft(${t[1].loop}, ${t[2].loop})`,loop:(e,t)=>`${e}.play(${t[0].loop})`},ifft:{setup:(e,t)=>`${e} = new ifft(${t[3].loop}, ${t[4].loop})`,loop:(e,t)=>`${e}.play(${t[0].loop}, ${t[1].loop}, ${t[2].loop})`},mfcc:{setup:(e,t)=>`${e} = new mfcc(${t[1].loop}, ${t[2].loop}, ${t[3].loop})`,loop:(e,t)=>`${e}.play(${t[0].loop})`}};class ASTreeToJavascript{static getNextID(){return objectID=objectID>9999?0:++objectID}static emptyCode(){return{setup:"",loop:"",paramMarkers:[]}}static traverseTree(e,t,o,n,r){let i={"@lang":(e,t)=>(t.map((t=>{let i=ASTreeToJavascript.traverseTree(t,ASTreeToJavascript.emptyCode(),o,n,r);e.setup+=i.setup,e.loop+=i.loop})),e),"@spawn":(e,t)=>((e=ASTreeToJavascript.traverseTree(t,e,o,n,r)).loop+=";",e),"@sigp":(e,t)=>{let i=[{s:t.paramBegin,e:t.paramEnd,l:o}];e.paramMarkers=e.paramMarkers.concat(i);let s=t["@func"].value,a=jsFuncMap[s],l="q.b"+r+"u"+ASTreeToJavascript.getNextID(),c=[];for(let e=0;e<t["@params"].length;e++){let i=ASTreeToJavascript.emptyCode();i=ASTreeToJavascript.traverseTree(t["@params"][e],i,o+1,n,r),c[e]=i}let p="";for(let t in c)p+=c[t].setup,e.paramMarkers=e.paramMarkers.concat(c[t].paramMarkers);return e.setup+=`${p} ${a.setup(l,c)};`,e.loop+=`${a.loop(l,c)}`,e},"@setvar":(e,t)=>{let i=t["@varname"],s=n[i];null==s&&(s=Object.keys(n).length,n[i]=s);let a=ASTreeToJavascript.traverseTree(t["@varvalue"],ASTreeToJavascript.emptyCode(),o+1,n,r);return e.setup+=a.setup,e.loop=`(mem[${s}] = ${a.loop})`,e},"@getvar":(e,t)=>{let o=n[t];return null==o&&(o=Object.keys(n).length,n[t]=o),e.loop+=`(mem[${o}] != undefined ? mem[${o}] : 0)`,e},"@string":(e,t)=>(("string"==typeof t||t instanceof String)&&(e.loop+=`'${t}'`),e),"@num":(e,t)=>(null!=t.value&&(e.loop+=`${t.value}`),e),"@list":(e,t)=>{let i="q.b"+r+"l"+ASTreeToJavascript.getNextID();e.setup+=`${i} = new Float64Array(${t.length});`,e.loop+="(()=>{";let s="";for(let a=0;a<t.length;a++){let l=ASTreeToJavascript.traverseTree(t[a],ASTreeToJavascript.emptyCode(),o,n,r);"@num"==Object.keys(t[a])[0]?e.setup+=`${i}[${a}] = ${l.loop};`:(s+=l.setup,e.loop+=`${i}[${a}] = ${l.loop};`)}return e.loop+=`return ${i}})()`,e.setup+=s,e}};return Array.isArray(e)?e.map((e=>{Object.keys(e).map((o=>{t=i[o](t,e[o])}))})):Object.keys(e).map((o=>{t=i[o](t,e[o])})),t}static treeToCode(e,t=0){vars={};let o=ASTreeToJavascript.traverseTree(e,ASTreeToJavascript.emptyCode(),0,vars,t);return o.setup=`() => {let q=this.newq(); ${o.setup}; return q;}`,o.loop=`(q, inputs, mem) => {${o.loop}}`,o}}var IR=Object.freeze({__proto__:null,default:ASTreeToJavascript}),sema=createCommonjsModule((function(e){var t;t=commonjsGlobal,e.exports?e.exports={num:function(e){return{"@num":{value:e}}},str:function(e){return{"@string":e}},synth:function(e,t){return{"@sigp":{"@params":t,"@func":{value:e}}}},setvar:function(e,t){return{"@setvar":{"@varname":e,"@varvalue":t}}},getvar:function(e){return{"@getvar":e}}}:t.sema={num:function(e){return{"@num":{value:e}}},str:function(e){return{"@string":e}},synth:function(e,t){return{"@sigp":{"@params":t,"@func":{value:e}}}},setvar:function(e,t){return{"@setvar":{"@varname":e,"@varvalue":t}}},getvar:function(e){return{"@getvar":e}}}}));function getParserModuleExports(source){let sema$1=sema;sema$1.num("3");let module={exports:""};return eval(source),module.exports}function compile(e,t){try{let o;const{errors:n,output:r}=compileGrammar(e),i=getParserModuleExports(r),s=new nearley.Parser(i);if(!n&&s){const e=s.feed(t);e&&(o=ASTreeToJavascript.treeToCode(e.results,0))}return{dspCode:o}}catch(e){return{errors:e}}}function parse(e,t){try{const{errors:o,output:n}=compileGrammar(e),r=getParserModuleExports(n),i=new nearley.Parser(r);if(!o&&i){return{livecodeParseTree:i.feed(t).results}}return{errors:o}}catch(e){return{errors:e}}}function ASTreeToDSPcode(e){if(!e)throw new Error("Problem with livecodeParseTree argument passed to ASTreeToDSPCode");try{return{dspCode:ASTreeToJavascript.treeToCode(e,0)}}catch(e){return{errors:e}}}function stream(){let e="";return{write(t){e+=t},dump:()=>e}}function AnnotatePositions(e){return e.map((e=>new nearley.Rule(e.name,e.symbols,e.postprocess&&((t,o,n)=>{var r=e.postprocess(t,o,n);return null===r?null:("object"!=typeof r||r.slice||(r.pos=o),r)}))))}function compileGrammar(e){let t=new nearley.Parser(AnnotatePositions(nearleyLanguageBootstrapped.ParserRules),nearleyLanguageBootstrapped.ParserStart,{lexer:nearleyLanguageBootstrapped.Lexer}),o=stream(),n="",r={};try{if(t.feed(e),t.results[0]){var i=compileLowLevel(t.results[0],{rangeCallback:function(e,t,o){r[e]=[t,o]}});lint_1(i,{out:o}),n=generate(i,"grammar")}}catch(e){o.write(e)}return{errors:o.dump(),positions:r,output:n}}var WorkerClass=null;try{var WorkerThreads="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");WorkerClass=WorkerThreads.Worker}catch(e){}function decodeBase64$1(e,t){return Buffer.from(e,"base64").toString(t?"utf16":"utf8")}function createBase64WorkerFactory$2(e,t,o){var n=void 0===t?null:t,r=decodeBase64$1(e,void 0!==o&&o),i=r.indexOf("\n",10)+1,s=r.substring(i)+(n?"//# sourceMappingURL="+n:"");return function(e){return new WorkerClass(s,Object.assign({},e,{eval:!0}))}}function decodeBase64(e,t){var o=atob(e);if(t){for(var n=new Uint8Array(o.length),r=0,i=o.length;r<i;++r)n[r]=o.charCodeAt(r);return String.fromCharCode.apply(null,new Uint16Array(n.buffer))}return o}function createURL(e,t,o){var n=void 0===t?null:t,r=decodeBase64(e,void 0!==o&&o),i=r.indexOf("\n",10)+1,s=r.substring(i)+(n?"//# sourceMappingURL="+n:""),a=new Blob([s],{type:"application/javascript"});return URL.createObjectURL(a)}function createBase64WorkerFactory$1(e,t,o){var n;return function(r){return n=n||createURL(e,t,o),new Worker(n,r)}}var kIsNodeJS="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);function isNodeJS(){return kIsNodeJS}function createBase64WorkerFactory(e,t,o){return isNodeJS()?createBase64WorkerFactory$2(e,t,o):createBase64WorkerFactory$1(e,t,o)}var WorkerFactory=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgdHtzdGF0aWMgZ2V0U3RvcmFnZUZvckNhcGFjaXR5KHQsZSl7aWYoIWUuQllURVNfUEVSX0VMRU1FTlQpdGhyb3ciUGFzcyBpbiBhIEFycmF5QnVmZmVyIHN1YmNsYXNzIjt2YXIgYT04Kyh0KzEpKmUuQllURVNfUEVSX0VMRU1FTlQ7cmV0dXJuIG5ldyBTaGFyZWRBcnJheUJ1ZmZlcihhKX1jb25zdHJ1Y3Rvcih0LGUpe2lmKCFBcnJheUJ1ZmZlci5fX3Byb3RvX18uaXNQcm90b3R5cGVPZihlKSYmdm9pZCAwIT09ZS5CWVRFU19QRVJfRUxFTUVOVCl0aHJvdyJQYXNzIGEgY29uY3JldGUgdHlwZWQgYXJyYXkgY2xhc3MgYXMgc2Vjb25kIGFyZ3VtZW50Ijt0aGlzLl90eXBlPWUsdGhpcy5jYXBhY2l0eT0odC5ieXRlTGVuZ3RoLTgpL2UuQllURVNfUEVSX0VMRU1FTlQsdGhpcy5idWY9dCx0aGlzLndyaXRlX3B0cj1uZXcgVWludDMyQXJyYXkodGhpcy5idWYsMCwxKSx0aGlzLnJlYWRfcHRyPW5ldyBVaW50MzJBcnJheSh0aGlzLmJ1Ziw0LDEpLHRoaXMuc3RvcmFnZT1uZXcgZSh0aGlzLmJ1Ziw4LHRoaXMuY2FwYWNpdHkpfXR5cGUoKXtyZXR1cm4gdGhpcy5fdHlwZS5uYW1lfXB1c2godCl7dmFyIGU9QXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsMCksYT1BdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsMCk7aWYoKGErMSkldGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpPT1lKXJldHVybiAwO2xldCBzPU1hdGgubWluKHRoaXMuX2F2YWlsYWJsZV93cml0ZShlLGEpLHQubGVuZ3RoKSxpPU1hdGgubWluKHRoaXMuX3N0b3JhZ2VfY2FwYWNpdHkoKS1hLHMpLHI9cy1pO3JldHVybiB0aGlzLl9jb3B5KHQsMCx0aGlzLnN0b3JhZ2UsYSxpKSx0aGlzLl9jb3B5KHQsaSx0aGlzLnN0b3JhZ2UsMCxyKSxBdG9taWNzLnN0b3JlKHRoaXMud3JpdGVfcHRyLDAsKGErcykldGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpKSxzfXBvcCh0KXt2YXIgZT1BdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwwKSxhPUF0b21pY3MubG9hZCh0aGlzLndyaXRlX3B0ciwwKTtpZihhPT1lKXJldHVybiAwO2xldCBzPU1hdGgubWluKHRoaXMuX2F2YWlsYWJsZV9yZWFkKGUsYSksdC5sZW5ndGgpLGk9TWF0aC5taW4odGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpLWUsdC5sZW5ndGgpLHI9cy1pO3JldHVybiB0aGlzLl9jb3B5KHRoaXMuc3RvcmFnZSxlLHQsMCxpKSx0aGlzLl9jb3B5KHRoaXMuc3RvcmFnZSwwLHQsaSxyKSxBdG9taWNzLnN0b3JlKHRoaXMucmVhZF9wdHIsMCwoZStzKSV0aGlzLl9zdG9yYWdlX2NhcGFjaXR5KCkpLHN9ZW1wdHkoKXt2YXIgdD1BdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwwKTtyZXR1cm4gQXRvbWljcy5sb2FkKHRoaXMud3JpdGVfcHRyLDApPT10fWZ1bGwoKXt2YXIgdD1BdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwwKTtyZXR1cm4oQXRvbWljcy5sb2FkKHRoaXMud3JpdGVfcHRyLDApKzEpJXRoaXMuY2FwYWNpdHkhPXR9Y2FwYWNpdHkoKXtyZXR1cm4gdGhpcy5jYXBhY2l0eS0xfWF2YWlsYWJsZV9yZWFkKCl7dmFyIHQ9QXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsMCksZT1BdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsMCk7cmV0dXJuIHRoaXMuX2F2YWlsYWJsZV9yZWFkKHQsZSl9YXZhaWxhYmxlX3dyaXRlKCl7dmFyIHQ9QXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsMCksZT1BdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsMCk7cmV0dXJuIHRoaXMuX2F2YWlsYWJsZV93cml0ZSh0LGUpfV9hdmFpbGFibGVfcmVhZCh0LGUpe3JldHVybiBlPnQ/ZS10OmUrdGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpLXR9X2F2YWlsYWJsZV93cml0ZSh0LGUpe2xldCBhPXQtZS0xO3JldHVybiBlPj10JiYoYSs9dGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpKSxhfV9zdG9yYWdlX2NhcGFjaXR5KCl7cmV0dXJuIHRoaXMuY2FwYWNpdHl9X2NvcHkodCxlLGEscyxpKXtmb3IodmFyIHI9MDtyPGk7cisrKWFbcytyXT10W2Urcl19fXNlbGYuUmluZ0J1ZmZlcj10O3ZhciBlPXt9O2NsYXNzIGF7Y29uc3RydWN0b3IoYSxzLGkpe3RoaXMuY2hhbm5lbD1zLHRoaXMuYmxvY2tzaXplPWkscyBpbiBlJiZlW3NdLmJsb2Nrc2l6ZT09aT90aGlzLnJpbmdidWY9ZVtzXS5yYjoodGhpcy5zYWI9dC5nZXRTdG9yYWdlRm9yQ2FwYWNpdHkoMzIqaSxGbG9hdDY0QXJyYXkpLHRoaXMucmluZ2J1Zj1uZXcgdCh0aGlzLnNhYixGbG9hdDY0QXJyYXkpLGVbc109e3JiOnRoaXMucmluZ2J1ZixzYWI6dGhpcy5zYWIsY3JlYXRlZDpEYXRlLm5vdygpLGJsb2Nrc2l6ZTppfSxwb3N0TWVzc2FnZSh7ZnVuYzoic2FiIix2YWx1ZTp0aGlzLnNhYix0dHlwZTphLGNoYW5uZWxJRDpzLGJsb2Nrc2l6ZTppfSkpfXNlbmQodCl7aWYodGhpcy5yaW5nYnVmLmF2YWlsYWJsZV93cml0ZSgpPjEpaWYoIm51bWJlciI9PXR5cGVvZiB0KXRoaXMucmluZ2J1Zi5wdXNoKG5ldyBGbG9hdDY0QXJyYXkoW3RdKSk7ZWxzZSBpZih0Lmxlbmd0aD09dGhpcy5ibG9ja3NpemUpdGhpcy5yaW5nYnVmLnB1c2godCk7ZWxzZSBpZih0Lmxlbmd0aDx0aGlzLmJsb2Nrc2l6ZSl7bGV0IGU9bmV3IEZsb2F0NjRBcnJheSh0aGlzLmJsb2Nrc2l6ZSk7Zm9yKGxldCBhIGluIHQpZVthXT10W2FdO3RoaXMucmluZ2J1Zi5wdXNoKGUpfWVsc2UgdGhpcy5yaW5nYnVmLnB1c2godC5zbGljZSgwLHRoaXMuYmxvY2tzaXplKSl9fXNlbGYuY3JlYXRlT3V0cHV0Q2hhbm5lbD0odCxlKT0+bmV3IGEoIk1MIix0LGUpLHNlbGYuaW5wdXQ9KHQsZSk9Pnt9LHNlbGYub3V0cHV0PSh0LGUpPT57cG9zdE1lc3NhZ2Uoe2Z1bmM6ImRhdGEiLHZhbDp0LGNoOmV9KX0sc2VsZi5sb2FkUmVzcG9uZGVycz17fSxzZWxmLmlucHV0U0FCcz17fSxzZWxmLnNlbWE9e3NhdmVGMzJBcnJheToodCxlKT0+KHBvc3RNZXNzYWdlKHtmdW5jOiJzYXZlIixuYW1lOnQsdmFsOmV9KSwwKSxsb2FkRjMyQXJyYXk6KHQsZSk9Pihwb3N0TWVzc2FnZSh7ZnVuYzoibG9hZCIsbmFtZTp0fSksbG9hZFJlc3BvbmRlcnNbdF09ZSwwKSxkb3dubG9hZDp0PT57cG9zdE1lc3NhZ2Uoe2Z1bmM6ImRvd25sb2FkIixuYW1lOnR9KX0sc2VuZENvZGU6dD0+e3Bvc3RNZXNzYWdlKHtmdW5jOiJzZW5kY29kZSIsY29kZTp0fSl9LHBiY29weTp0PT57cG9zdE1lc3NhZ2Uoe2Z1bmM6InBiY29weSIsbXNnOnR9KX0sc2VuZEJ1ZmZlcjoodCxlKT0+e3Bvc3RNZXNzYWdlKHtmdW5jOiJzZW5kYnVmIixuYW1lOnQsZGF0YTplfSl9LGVudjp7c2F2ZUxvY2FsOnQ9Pntwb3N0TWVzc2FnZSh7ZnVuYzoiZW52c2F2ZSIsbmFtZTp0LHN0b3JhZ2U6ImxvY2FsIn0pfSxsb2FkTG9jYWw6dD0+e3Bvc3RNZXNzYWdlKHtmdW5jOiJlbnZsb2FkIixuYW1lOnQsc3RvcmFnZToibG9jYWwifSl9LHNhdmVUb1BCOigpPT57cG9zdE1lc3NhZ2Uoe2Z1bmM6ImVudnNhdmUiLHN0b3JhZ2U6InBhc3RlYnVmZmVyIn0pfSxsb2FkR2lzdDp0PT57cG9zdE1lc3NhZ2Uoe2Z1bmM6ImVudmxvYWQiLG5hbWU6dCxzdG9yYWdlOiJnaXN0In0pfX0sZG9tZXZhbDp0PT57cG9zdE1lc3NhZ2Uoe2Z1bmM6ImRvbWV2YWwiLGNvZGU6dH0pfSxwZWVyaW5mbzooKT0+e3Bvc3RNZXNzYWdlKHtmdW5jOiJwZWVyaW5mbyJ9KSxjb25zb2xlLmxvZygiWW91ciBwZWVyIElEIGhhcyBiZWVuIGNvcGllZCB0byB0aGUgcGFzdGUgYnVmZmVyIil9fTtmdW5jdGlvbiBzKCl7dHJ5e2ZvcihsZXQgdCBpbiBpbnB1dFNBQnMpe2xldCBlPWlucHV0U0FCc1t0XS5yYi5hdmFpbGFibGVfcmVhZCgpO2lmKGUhPWlucHV0U0FCc1t0XS5yYi5jYXBhY2l0eSYmZT4wKWZvcihsZXQgYT0wO2E8ZTthKz1pbnB1dFNBQnNbdF0uYmxvY2tzaXplKXtsZXQgZT1uZXcgRmxvYXQ2NEFycmF5KGlucHV0U0FCc1t0XS5ibG9ja3NpemUpO2lucHV0U0FCc1t0XS5yYi5wb3AoZSksaW5wdXQodCxlKX19c2V0VGltZW91dChzLDIwKX1jYXRjaCh0KXtzZXRUaW1lb3V0KHMsMTAwKX19b25tZXNzYWdlPWU9PntpZihlLmRhdGEudXJsKSFmdW5jdGlvbih0KXtpZihuZXcgVVJMKHQpKXt0cnl7cygpfWNhdGNoKHQpe2NvbnNvbGUuZXJyb3IoIkVSUk9SOiBzYWJDaGVja2VyIix0KX1wb3N0TWVzc2FnZSh7aW5pdDohMH0pfWVsc2UgY29uc29sZS5lcnJvcigiRVJST1I6IGluaXRXaXRoVVJMIOKAkyBJbnZhbGlkIFVSTCIpfShlLmRhdGEudXJsKTtlbHNlIGlmKGUuZGF0YS5ldmFsKSh0PT57dHJ5e2lmKCFlKXZhciBlPWV2YWw7bGV0IGE9ZSh0KTt2b2lkIDAhPT1hP2NvbnNvbGUuaW5mbyhhKTpjb25zb2xlLmluZm8oImRvbmUiKX1jYXRjaCh0KXtjb25zb2xlLmVycm9yKCJFdmFsIGV4Y2VwdGlvbiBvbiBMZWFybmVyOiAiLHQpfX0pKGUuZGF0YS5ldmFsKTtlbHNlIGlmKCJ2YWwiaW4gZS5kYXRhKXtsZXQgdD1lLmRhdGEudmFsO3Q9SlNPTi5wYXJzZShgWyR7dH1dYCksbG9hZFJlc3BvbmRlcnNbZS5kYXRhLm5hbWVdKHQpLGRlbGV0ZSBsb2FkUmVzcG9uZGVyc1tlLmRhdGEubmFtZV19ZWxzZSBpZigibW9kZWwtaW5wdXQtZGF0YSI9PT1lLmRhdGEudHlwZSlpbnB1dChlLmRhdGEudmFsdWUsZS5kYXRhLmNoKTtlbHNlIGlmKGUuZGF0YS5zYWIpe2NvbnNvbGUuaW5mbygiYnVmZmVyIHJlY2VpdmVkIik7bGV0IGE9ZS5kYXRhLnNhYixzPW5ldyB0KGEsRmxvYXQ2NEFycmF5KTtpbnB1dFNBQnNbZS5kYXRhLmNoYW5uZWxJRF09e3NhYjphLHJiOnMsYmxvY2tzaXplOmUuZGF0YS5ibG9ja3NpemV9fX19KCk7Cgo=",null,!1);class Learner{constructor(){this.dispatcher=new Dispatcher}addEventListener(e,t){if(!(this.dispatcher&&e&&t))throw new Error("Error adding event listener to Learner");this.dispatcher.addEventListener(e,t)}removeEventListener(e,t){if(!(this.dispatcher&&e&&t))throw new Error("Error removing event listener to Learner");this.dispatcher.removeEventListener(e,t)}async init(e){return this.worker=new WorkerFactory,new Promise(((t,o)=>{let n={};this.worker&&new URL(e)&&(this.worker.postMessage({url:e}),this.worker.onerror=e=>{console.log("onError"),o(e)},this.worker.onmessage=e=>{n=e.data.init,console.info("running Learner"),t(n),this.worker.onmessage=this.onMessageHandler.bind(this)})}))}onMessageHandler(e){if(e&&e.data&&e.data.func){({sab:e=>{this.dispatcher.dispatch("onSharedBuffer",e)},sendbuf:e=>{this.dispatcher.dispatch("onSharedBuffer",e)},save:e=>{window.localStorage.setItem(e.name,e.val)},load:e=>{let t={name:e.name,val:window.localStorage.getItem(e.name)};modelWorker.postMessage(t)},download:e=>{let t=window.localStorage.getItem(e.name),o=new Blob([t],{type:"text/plain;charset=utf-8"});saveData(o,`${e.name}.data`)},sendcode:e=>{},data:()=>{},pbcopy:e=>{copyToPasteBuffer(e.msg)},envsave:e=>{messaging.publish("env-save",e)},envload:e=>{messaging.publish("env-load",e)},domeval:e=>{evalDOMCode(e.code)},peerinfo:e=>{messaging.publish("peerinfo-request",{})}})[e.data.func](e.data)}else void 0!==e.data&&0!=e.data.length&&res(e.data)}eval(e){this.worker&&e&&this.worker.postMessage({eval:e})}addSharedBuffer(e){if(console.log("addSharedBuffer leaner.js",e),!(this.worker&&e&&e.sab&&e.sab instanceof SharedArrayBuffer))throw new Error("Error pushing SharedBuffer in Learner");this.worker.postMessage({sab:e.sab,blocksize:e.blocksize,channelID:e.channelID})}evalBlock(e){let t=e.indexOf("\n");"//--DOM"==e.substr(0,t)?(e=e.substr(t),evalDomCode(e),addToHistory("dom-history-",e)):(this.worker.postMessage({eval:e}),window.localStorage.setItem("modelEditorValue",codeMirror.getValue()),addToHistory("model-history-",e))}terminate(){this.worker.onmessage=null,this.worker.terminate(),this.worker=null}}function getBlock(e){if(e){let t=e.getCursor(),o=t.line,n=e.lastLine();for(;o<n;){if(/___+/.test(e.getLine(o))){n=o-1;break}o++}o=t.line;let r=-1;for(;o>=0;){if(/___+/.test(e.getLine(o))){r=o;break}o--}return r>-1&&r++,e.getRange({line:r,ch:0},{line:n+1,ch:0})}}function takeOverConsole(e){if(e)try{var t=window.console;function o(e,o){var n=Array.prototype.slice.apply(o).join(" ");t&&t[e]("> "+n)}window.console={log:function(){o("log",arguments)},warn:function(){o("warn",arguments)},error:function(){o("error",arguments)},info:function(){o("info",arguments)}}}catch(e){console.error(e)}}var mooo=moo.mooo,nearley$1=nearley.nearley,semaa=sema.semaa;export{ASTreeToDSPcode,IR as ASTreeToJavascript,Engine,Learner,compile,compileGrammar,getBlock,getParserModuleExports,mooo,nearley$1 as nearley,parse,semaa,takeOverConsole};
//# sourceMappingURL=sema-engine.mjs.map
